var $L=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var mde=$L((xde,R3)=>{function HL(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var GL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qL(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hk={exports:{}},Ay={},dk={exports:{}},mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ip=Symbol.for("react.element"),KL=Symbol.for("react.portal"),XL=Symbol.for("react.fragment"),QL=Symbol.for("react.strict_mode"),YL=Symbol.for("react.profiler"),JL=Symbol.for("react.provider"),ZL=Symbol.for("react.context"),eB=Symbol.for("react.forward_ref"),tB=Symbol.for("react.suspense"),nB=Symbol.for("react.memo"),rB=Symbol.for("react.lazy"),LC=Symbol.iterator;function iB(n){return n===null||typeof n!="object"?null:(n=LC&&n[LC]||n["@@iterator"],typeof n=="function"?n:null)}var fk={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pk=Object.assign,mk={};function ld(n,e,t){this.props=n,this.context=e,this.refs=mk,this.updater=t||fk}ld.prototype.isReactComponent={};ld.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ld.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function vk(){}vk.prototype=ld.prototype;function M_(n,e,t){this.props=n,this.context=e,this.refs=mk,this.updater=t||fk}var F_=M_.prototype=new vk;F_.constructor=M_;pk(F_,ld.prototype);F_.isPureReactComponent=!0;var BC=Array.isArray,gk=Object.prototype.hasOwnProperty,L_={current:null},yk={key:!0,ref:!0,__self:!0,__source:!0};function xk(n,e,t){var r,i={},o=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(o=""+e.key),e)gk.call(e,r)&&!yk.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=t;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];i.children=u}if(n&&n.defaultProps)for(r in s=n.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:Ip,type:n,key:o,ref:a,props:i,_owner:L_.current}}function oB(n,e){return{$$typeof:Ip,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function B_(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ip}function aB(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var VC=/\/+/g;function J0(n,e){return typeof n=="object"&&n!==null&&n.key!=null?aB(""+n.key):e.toString(36)}function Pv(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Ip:case KL:a=!0}}if(a)return a=n,i=i(a),n=r===""?"."+J0(a,0):r,BC(i)?(t="",n!=null&&(t=n.replace(VC,"$&/")+"/"),Pv(i,e,t,"",function(l){return l})):i!=null&&(B_(i)&&(i=oB(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(VC,"$&/")+"/")+n)),e.push(i)),1;if(a=0,r=r===""?".":r+":",BC(n))for(var s=0;s<n.length;s++){o=n[s];var u=r+J0(o,s);a+=Pv(o,e,t,u,i)}else if(u=iB(n),typeof u=="function")for(n=u.call(n),s=0;!(o=n.next()).done;)o=o.value,u=r+J0(o,s++),a+=Pv(o,e,t,u,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function $m(n,e,t){if(n==null)return n;var r=[],i=0;return Pv(n,r,"","",function(o){return e.call(t,o,i++)}),r}function sB(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Gr={current:null},Ov={transition:null},uB={ReactCurrentDispatcher:Gr,ReactCurrentBatchConfig:Ov,ReactCurrentOwner:L_};function wk(){throw Error("act(...) is not supported in production builds of React.")}mt.Children={map:$m,forEach:function(n,e,t){$m(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return $m(n,function(){e++}),e},toArray:function(n){return $m(n,function(e){return e})||[]},only:function(n){if(!B_(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};mt.Component=ld;mt.Fragment=XL;mt.Profiler=YL;mt.PureComponent=M_;mt.StrictMode=QL;mt.Suspense=tB;mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uB;mt.act=wk;mt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=pk({},n.props),i=n.key,o=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,a=L_.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var s=n.type.defaultProps;for(u in e)gk.call(e,u)&&!yk.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&s!==void 0?s[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=t;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:Ip,type:n.type,key:i,ref:o,props:r,_owner:a}};mt.createContext=function(n){return n={$$typeof:ZL,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:JL,_context:n},n.Consumer=n};mt.createElement=xk;mt.createFactory=function(n){var e=xk.bind(null,n);return e.type=n,e};mt.createRef=function(){return{current:null}};mt.forwardRef=function(n){return{$$typeof:eB,render:n}};mt.isValidElement=B_;mt.lazy=function(n){return{$$typeof:rB,_payload:{_status:-1,_result:n},_init:sB}};mt.memo=function(n,e){return{$$typeof:nB,type:n,compare:e===void 0?null:e}};mt.startTransition=function(n){var e=Ov.transition;Ov.transition={};try{n()}finally{Ov.transition=e}};mt.unstable_act=wk;mt.useCallback=function(n,e){return Gr.current.useCallback(n,e)};mt.useContext=function(n){return Gr.current.useContext(n)};mt.useDebugValue=function(){};mt.useDeferredValue=function(n){return Gr.current.useDeferredValue(n)};mt.useEffect=function(n,e){return Gr.current.useEffect(n,e)};mt.useId=function(){return Gr.current.useId()};mt.useImperativeHandle=function(n,e,t){return Gr.current.useImperativeHandle(n,e,t)};mt.useInsertionEffect=function(n,e){return Gr.current.useInsertionEffect(n,e)};mt.useLayoutEffect=function(n,e){return Gr.current.useLayoutEffect(n,e)};mt.useMemo=function(n,e){return Gr.current.useMemo(n,e)};mt.useReducer=function(n,e,t){return Gr.current.useReducer(n,e,t)};mt.useRef=function(n){return Gr.current.useRef(n)};mt.useState=function(n){return Gr.current.useState(n)};mt.useSyncExternalStore=function(n,e,t){return Gr.current.useSyncExternalStore(n,e,t)};mt.useTransition=function(){return Gr.current.useTransition()};mt.version="18.3.1";dk.exports=mt;var fe=dk.exports;const Rt=qL(fe),lB=HL({__proto__:null,default:Rt},[fe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cB=fe,hB=Symbol.for("react.element"),dB=Symbol.for("react.fragment"),fB=Object.prototype.hasOwnProperty,pB=cB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,mB={key:!0,ref:!0,__self:!0,__source:!0};function _k(n,e,t){var r,i={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)fB.call(e,r)&&!mB.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:hB,type:n,key:o,ref:a,props:i,_owner:pB.current}}Ay.Fragment=dB;Ay.jsx=_k;Ay.jsxs=_k;hk.exports=Ay;var P=hk.exports,bk={exports:{}},Si={},Ek={exports:{}},Ck={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e($,K){var j=$.length;$.push(K);e:for(;0<j;){var ue=j-1>>>1,he=$[ue];if(0<i(he,K))$[ue]=K,$[j]=he,j=ue;else break e}}function t($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var K=$[0],j=$.pop();if(j!==K){$[0]=j;e:for(var ue=0,he=$.length,ve=he>>>1;ue<ve;){var we=2*(ue+1)-1,Ee=$[we],Ce=we+1,Ie=$[Ce];if(0>i(Ee,j))Ce<he&&0>i(Ie,Ee)?($[ue]=Ie,$[Ce]=j,ue=Ce):($[ue]=Ee,$[we]=j,ue=we);else if(Ce<he&&0>i(Ie,j))$[ue]=Ie,$[Ce]=j,ue=Ce;else break e}}return K}function i($,K){var j=$.sortIndex-K.sortIndex;return j!==0?j:$.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();n.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,h=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _($){for(var K=t(l);K!==null;){if(K.callback===null)r(l);else if(K.startTime<=$)r(l),K.sortIndex=K.expirationTime,e(u,K);else break;K=t(l)}}function b($){if(m=!1,_($),!p)if(t(u)!==null)p=!0,ee(C);else{var K=t(l);K!==null&&Q(b,K.startTime-$)}}function C($,K){p=!1,m&&(m=!1,y(E),E=-1),f=!0;var j=d;try{for(_(K),h=t(u);h!==null&&(!(h.expirationTime>K)||$&&!N());){var ue=h.callback;if(typeof ue=="function"){h.callback=null,d=h.priorityLevel;var he=ue(h.expirationTime<=K);K=n.unstable_now(),typeof he=="function"?h.callback=he:h===t(u)&&r(u),_(K)}else r(u);h=t(u)}if(h!==null)var ve=!0;else{var we=t(l);we!==null&&Q(b,we.startTime-K),ve=!1}return ve}finally{h=null,d=j,f=!1}}var k=!1,T=null,E=-1,I=5,R=-1;function N(){return!(n.unstable_now()-R<I)}function O(){if(T!==null){var $=n.unstable_now();R=$;var K=!0;try{K=T(!0,$)}finally{K?M():(k=!1,T=null)}}else k=!1}var M;if(typeof x=="function")M=function(){x(O)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,J=q.port2;q.port1.onmessage=O,M=function(){J.postMessage(null)}}else M=function(){g(O,0)};function ee($){T=$,k||(k=!0,M())}function Q($,K){E=g(function(){$(n.unstable_now())},K)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function($){$.callback=null},n.unstable_continueExecution=function(){p||f||(p=!0,ee(C))},n.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<$?Math.floor(1e3/$):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function($){switch(d){case 1:case 2:case 3:var K=3;break;default:K=d}var j=d;d=K;try{return $()}finally{d=j}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function($,K){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var j=d;d=$;try{return K()}finally{d=j}},n.unstable_scheduleCallback=function($,K,j){var ue=n.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?ue+j:ue):j=ue,$){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=j+he,$={id:c++,callback:K,priorityLevel:$,startTime:j,expirationTime:he,sortIndex:-1},j>ue?($.sortIndex=j,e(l,$),t(u)===null&&$===t(l)&&(m?(y(E),E=-1):m=!0,Q(b,j-ue))):($.sortIndex=he,e(u,$),p||f||(p=!0,ee(C))),$},n.unstable_shouldYield=N,n.unstable_wrapCallback=function($){var K=d;return function(){var j=d;d=K;try{return $.apply(this,arguments)}finally{d=j}}}})(Ck);Ek.exports=Ck;var vB=Ek.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gB=fe,Ii=vB;function xe(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Tk=new Set,zf={};function ec(n,e){Mh(n,e),Mh(n+"Capture",e)}function Mh(n,e){for(zf[n]=e,n=0;n<e.length;n++)Tk.add(e[n])}var es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cx=Object.prototype.hasOwnProperty,yB=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,UC={},WC={};function xB(n){return Cx.call(WC,n)?!0:Cx.call(UC,n)?!1:yB.test(n)?WC[n]=!0:(UC[n]=!0,!1)}function wB(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function _B(n,e,t,r){if(e===null||typeof e>"u"||wB(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qr(n,e,t,r,i,o,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var vr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){vr[n]=new qr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];vr[e]=new qr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){vr[n]=new qr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){vr[n]=new qr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){vr[n]=new qr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){vr[n]=new qr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){vr[n]=new qr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){vr[n]=new qr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){vr[n]=new qr(n,5,!1,n.toLowerCase(),null,!1,!1)});var V_=/[\-:]([a-z])/g;function U_(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(V_,U_);vr[e]=new qr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(V_,U_);vr[e]=new qr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(V_,U_);vr[e]=new qr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){vr[n]=new qr(n,1,!1,n.toLowerCase(),null,!1,!1)});vr.xlinkHref=new qr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){vr[n]=new qr(n,1,!1,n.toLowerCase(),null,!0,!0)});function W_(n,e,t,r){var i=vr.hasOwnProperty(e)?vr[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(_B(e,t,i,r)&&(t=null),r||i===null?xB(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var cs=gB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hm=Symbol.for("react.element"),th=Symbol.for("react.portal"),nh=Symbol.for("react.fragment"),j_=Symbol.for("react.strict_mode"),Tx=Symbol.for("react.profiler"),Ik=Symbol.for("react.provider"),Sk=Symbol.for("react.context"),z_=Symbol.for("react.forward_ref"),Ix=Symbol.for("react.suspense"),Sx=Symbol.for("react.suspense_list"),$_=Symbol.for("react.memo"),$s=Symbol.for("react.lazy"),Rk=Symbol.for("react.offscreen"),jC=Symbol.iterator;function Zd(n){return n===null||typeof n!="object"?null:(n=jC&&n[jC]||n["@@iterator"],typeof n=="function"?n:null)}var hn=Object.assign,Z0;function pf(n){if(Z0===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Z0=e&&e[1]||""}return`
`+Z0+n}var e1=!1;function t1(n,e){if(!n||e1)return"";e1=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(n,[],e)}else{try{e.call()}catch(l){r=l}n.call(e.prototype)}else{try{throw Error()}catch(l){r=l}n()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=r.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var u=`
`+i[a].replace(" at new "," at ");return n.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",n.displayName)),u}while(1<=a&&0<=s);break}}}finally{e1=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?pf(n):""}function bB(n){switch(n.tag){case 5:return pf(n.type);case 16:return pf("Lazy");case 13:return pf("Suspense");case 19:return pf("SuspenseList");case 0:case 2:case 15:return n=t1(n.type,!1),n;case 11:return n=t1(n.type.render,!1),n;case 1:return n=t1(n.type,!0),n;default:return""}}function Rx(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case nh:return"Fragment";case th:return"Portal";case Tx:return"Profiler";case j_:return"StrictMode";case Ix:return"Suspense";case Sx:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Sk:return(n.displayName||"Context")+".Consumer";case Ik:return(n._context.displayName||"Context")+".Provider";case z_:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case $_:return e=n.displayName||null,e!==null?e:Rx(n.type)||"Memo";case $s:e=n._payload,n=n._init;try{return Rx(n(e))}catch{}}return null}function EB(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Rx(e);case 8:return e===j_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Eu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function kk(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function CB(n){var e=kk(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,o.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Gm(n){n._valueTracker||(n._valueTracker=CB(n))}function Ak(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=kk(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ng(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function kx(n,e){var t=e.checked;return hn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function zC(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Eu(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Nk(n,e){e=e.checked,e!=null&&W_(n,"checked",e,!1)}function Ax(n,e){Nk(n,e);var t=Eu(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Nx(n,e.type,t):e.hasOwnProperty("defaultValue")&&Nx(n,e.type,Eu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function $C(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Nx(n,e,t){(e!=="number"||ng(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var mf=Array.isArray;function ph(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Eu(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Dx(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(xe(91));return hn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function HC(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(xe(92));if(mf(t)){if(1<t.length)throw Error(xe(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Eu(t)}}function Dk(n,e){var t=Eu(e.value),r=Eu(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function GC(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Pk(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Px(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Pk(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var qm,Ok=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(qm=qm||document.createElement("div"),qm.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qm.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function $f(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Tf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},TB=["Webkit","ms","Moz","O"];Object.keys(Tf).forEach(function(n){TB.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Tf[e]=Tf[n]})});function Mk(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Tf.hasOwnProperty(n)&&Tf[n]?(""+e).trim():e+"px"}function Fk(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Mk(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var IB=hn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ox(n,e){if(e){if(IB[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(xe(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(xe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(xe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(xe(62))}}function Mx(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fx=null;function H_(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Lx=null,mh=null,vh=null;function qC(n){if(n=kp(n)){if(typeof Lx!="function")throw Error(xe(280));var e=n.stateNode;e&&(e=My(e),Lx(n.stateNode,n.type,e))}}function Lk(n){mh?vh?vh.push(n):vh=[n]:mh=n}function Bk(){if(mh){var n=mh,e=vh;if(vh=mh=null,qC(n),e)for(n=0;n<e.length;n++)qC(e[n])}}function Vk(n,e){return n(e)}function Uk(){}var n1=!1;function Wk(n,e,t){if(n1)return n(e,t);n1=!0;try{return Vk(n,e,t)}finally{n1=!1,(mh!==null||vh!==null)&&(Uk(),Bk())}}function Hf(n,e){var t=n.stateNode;if(t===null)return null;var r=My(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(xe(231,e,typeof t));return t}var Bx=!1;if(es)try{var ef={};Object.defineProperty(ef,"passive",{get:function(){Bx=!0}}),window.addEventListener("test",ef,ef),window.removeEventListener("test",ef,ef)}catch{Bx=!1}function SB(n,e,t,r,i,o,a,s,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(c){this.onError(c)}}var If=!1,rg=null,ig=!1,Vx=null,RB={onError:function(n){If=!0,rg=n}};function kB(n,e,t,r,i,o,a,s,u){If=!1,rg=null,SB.apply(RB,arguments)}function AB(n,e,t,r,i,o,a,s,u){if(kB.apply(this,arguments),If){if(If){var l=rg;If=!1,rg=null}else throw Error(xe(198));ig||(ig=!0,Vx=l)}}function tc(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function jk(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function KC(n){if(tc(n)!==n)throw Error(xe(188))}function NB(n){var e=n.alternate;if(!e){if(e=tc(n),e===null)throw Error(xe(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return KC(i),n;if(o===r)return KC(i),e;o=o.sibling}throw Error(xe(188))}if(t.return!==r.return)t=i,r=o;else{for(var a=!1,s=i.child;s;){if(s===t){a=!0,t=i,r=o;break}if(s===r){a=!0,r=i,t=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===t){a=!0,t=o,r=i;break}if(s===r){a=!0,r=o,t=i;break}s=s.sibling}if(!a)throw Error(xe(189))}}if(t.alternate!==r)throw Error(xe(190))}if(t.tag!==3)throw Error(xe(188));return t.stateNode.current===t?n:e}function zk(n){return n=NB(n),n!==null?$k(n):null}function $k(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=$k(n);if(e!==null)return e;n=n.sibling}return null}var Hk=Ii.unstable_scheduleCallback,XC=Ii.unstable_cancelCallback,DB=Ii.unstable_shouldYield,PB=Ii.unstable_requestPaint,Rn=Ii.unstable_now,OB=Ii.unstable_getCurrentPriorityLevel,G_=Ii.unstable_ImmediatePriority,Gk=Ii.unstable_UserBlockingPriority,og=Ii.unstable_NormalPriority,MB=Ii.unstable_LowPriority,qk=Ii.unstable_IdlePriority,Ny=null,ra=null;function FB(n){if(ra&&typeof ra.onCommitFiberRoot=="function")try{ra.onCommitFiberRoot(Ny,n,void 0,(n.current.flags&128)===128)}catch{}}var Co=Math.clz32?Math.clz32:VB,LB=Math.log,BB=Math.LN2;function VB(n){return n>>>=0,n===0?32:31-(LB(n)/BB|0)|0}var Km=64,Xm=4194304;function vf(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ag(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,a=t&268435455;if(a!==0){var s=a&~i;s!==0?r=vf(s):(o&=a,o!==0&&(r=vf(o)))}else a=t&~i,a!==0?r=vf(a):o!==0&&(r=vf(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Co(e),i=1<<t,r|=n[t],e&=~i;return r}function UB(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function WB(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var a=31-Co(o),s=1<<a,u=i[a];u===-1?(!(s&t)||s&r)&&(i[a]=UB(s,e)):u<=e&&(n.expiredLanes|=s),o&=~s}}function Ux(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Kk(){var n=Km;return Km<<=1,!(Km&4194240)&&(Km=64),n}function r1(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Sp(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Co(e),n[e]=t}function jB(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Co(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function q_(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Co(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Wt=0;function Xk(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Qk,K_,Yk,Jk,Zk,Wx=!1,Qm=[],su=null,uu=null,lu=null,Gf=new Map,qf=new Map,Ks=[],zB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function QC(n,e){switch(n){case"focusin":case"focusout":su=null;break;case"dragenter":case"dragleave":uu=null;break;case"mouseover":case"mouseout":lu=null;break;case"pointerover":case"pointerout":Gf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":qf.delete(e.pointerId)}}function tf(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=kp(e),e!==null&&K_(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function $B(n,e,t,r,i){switch(e){case"focusin":return su=tf(su,n,e,t,r,i),!0;case"dragenter":return uu=tf(uu,n,e,t,r,i),!0;case"mouseover":return lu=tf(lu,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return Gf.set(o,tf(Gf.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,qf.set(o,tf(qf.get(o)||null,n,e,t,r,i)),!0}return!1}function eA(n){var e=El(n.target);if(e!==null){var t=tc(e);if(t!==null){if(e=t.tag,e===13){if(e=jk(t),e!==null){n.blockedOn=e,Zk(n.priority,function(){Yk(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Mv(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=jx(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Fx=r,t.target.dispatchEvent(r),Fx=null}else return e=kp(t),e!==null&&K_(e),n.blockedOn=t,!1;e.shift()}return!0}function YC(n,e,t){Mv(n)&&t.delete(e)}function HB(){Wx=!1,su!==null&&Mv(su)&&(su=null),uu!==null&&Mv(uu)&&(uu=null),lu!==null&&Mv(lu)&&(lu=null),Gf.forEach(YC),qf.forEach(YC)}function nf(n,e){n.blockedOn===e&&(n.blockedOn=null,Wx||(Wx=!0,Ii.unstable_scheduleCallback(Ii.unstable_NormalPriority,HB)))}function Kf(n){function e(i){return nf(i,n)}if(0<Qm.length){nf(Qm[0],n);for(var t=1;t<Qm.length;t++){var r=Qm[t];r.blockedOn===n&&(r.blockedOn=null)}}for(su!==null&&nf(su,n),uu!==null&&nf(uu,n),lu!==null&&nf(lu,n),Gf.forEach(e),qf.forEach(e),t=0;t<Ks.length;t++)r=Ks[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ks.length&&(t=Ks[0],t.blockedOn===null);)eA(t),t.blockedOn===null&&Ks.shift()}var gh=cs.ReactCurrentBatchConfig,sg=!0;function GB(n,e,t,r){var i=Wt,o=gh.transition;gh.transition=null;try{Wt=1,X_(n,e,t,r)}finally{Wt=i,gh.transition=o}}function qB(n,e,t,r){var i=Wt,o=gh.transition;gh.transition=null;try{Wt=4,X_(n,e,t,r)}finally{Wt=i,gh.transition=o}}function X_(n,e,t,r){if(sg){var i=jx(n,e,t,r);if(i===null)f1(n,e,r,ug,t),QC(n,r);else if($B(i,n,e,t,r))r.stopPropagation();else if(QC(n,r),e&4&&-1<zB.indexOf(n)){for(;i!==null;){var o=kp(i);if(o!==null&&Qk(o),o=jx(n,e,t,r),o===null&&f1(n,e,r,ug,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else f1(n,e,r,null,t)}}var ug=null;function jx(n,e,t,r){if(ug=null,n=H_(r),n=El(n),n!==null)if(e=tc(n),e===null)n=null;else if(t=e.tag,t===13){if(n=jk(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return ug=n,null}function tA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(OB()){case G_:return 1;case Gk:return 4;case og:case MB:return 16;case qk:return 536870912;default:return 16}default:return 16}}var Zs=null,Q_=null,Fv=null;function nA(){if(Fv)return Fv;var n,e=Q_,t=e.length,r,i="value"in Zs?Zs.value:Zs.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===i[o-r];r++);return Fv=i.slice(n,1<r?1-r:void 0)}function Lv(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Ym(){return!0}function JC(){return!1}function Ri(n){function e(t,r,i,o,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in n)n.hasOwnProperty(s)&&(t=n[s],this[s]=t?t(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Ym:JC,this.isPropagationStopped=JC,this}return hn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ym)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ym)},persist:function(){},isPersistent:Ym}),e}var cd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Y_=Ri(cd),Rp=hn({},cd,{view:0,detail:0}),KB=Ri(Rp),i1,o1,rf,Dy=hn({},Rp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:J_,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==rf&&(rf&&n.type==="mousemove"?(i1=n.screenX-rf.screenX,o1=n.screenY-rf.screenY):o1=i1=0,rf=n),i1)},movementY:function(n){return"movementY"in n?n.movementY:o1}}),ZC=Ri(Dy),XB=hn({},Dy,{dataTransfer:0}),QB=Ri(XB),YB=hn({},Rp,{relatedTarget:0}),a1=Ri(YB),JB=hn({},cd,{animationName:0,elapsedTime:0,pseudoElement:0}),ZB=Ri(JB),eV=hn({},cd,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),tV=Ri(eV),nV=hn({},cd,{data:0}),eT=Ri(nV),rV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aV(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=oV[n])?!!e[n]:!1}function J_(){return aV}var sV=hn({},Rp,{key:function(n){if(n.key){var e=rV[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Lv(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?iV[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:J_,charCode:function(n){return n.type==="keypress"?Lv(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Lv(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),uV=Ri(sV),lV=hn({},Dy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tT=Ri(lV),cV=hn({},Rp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:J_}),hV=Ri(cV),dV=hn({},cd,{propertyName:0,elapsedTime:0,pseudoElement:0}),fV=Ri(dV),pV=hn({},Dy,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),mV=Ri(pV),vV=[9,13,27,32],Z_=es&&"CompositionEvent"in window,Sf=null;es&&"documentMode"in document&&(Sf=document.documentMode);var gV=es&&"TextEvent"in window&&!Sf,rA=es&&(!Z_||Sf&&8<Sf&&11>=Sf),nT=" ",rT=!1;function iA(n,e){switch(n){case"keyup":return vV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var rh=!1;function yV(n,e){switch(n){case"compositionend":return oA(e);case"keypress":return e.which!==32?null:(rT=!0,nT);case"textInput":return n=e.data,n===nT&&rT?null:n;default:return null}}function xV(n,e){if(rh)return n==="compositionend"||!Z_&&iA(n,e)?(n=nA(),Fv=Q_=Zs=null,rh=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return rA&&e.locale!=="ko"?null:e.data;default:return null}}var wV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iT(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!wV[n.type]:e==="textarea"}function aA(n,e,t,r){Lk(r),e=lg(e,"onChange"),0<e.length&&(t=new Y_("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Rf=null,Xf=null;function _V(n){gA(n,0)}function Py(n){var e=ah(n);if(Ak(e))return n}function bV(n,e){if(n==="change")return e}var sA=!1;if(es){var s1;if(es){var u1="oninput"in document;if(!u1){var oT=document.createElement("div");oT.setAttribute("oninput","return;"),u1=typeof oT.oninput=="function"}s1=u1}else s1=!1;sA=s1&&(!document.documentMode||9<document.documentMode)}function aT(){Rf&&(Rf.detachEvent("onpropertychange",uA),Xf=Rf=null)}function uA(n){if(n.propertyName==="value"&&Py(Xf)){var e=[];aA(e,Xf,n,H_(n)),Wk(_V,e)}}function EV(n,e,t){n==="focusin"?(aT(),Rf=e,Xf=t,Rf.attachEvent("onpropertychange",uA)):n==="focusout"&&aT()}function CV(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Py(Xf)}function TV(n,e){if(n==="click")return Py(e)}function IV(n,e){if(n==="input"||n==="change")return Py(e)}function SV(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ao=typeof Object.is=="function"?Object.is:SV;function Qf(n,e){if(Ao(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Cx.call(e,i)||!Ao(n[i],e[i]))return!1}return!0}function sT(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function uT(n,e){var t=sT(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=sT(t)}}function lA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?lA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function cA(){for(var n=window,e=ng();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ng(n.document)}return e}function eb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function RV(n){var e=cA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&lA(t.ownerDocument.documentElement,t)){if(r!==null&&eb(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=uT(t,o);var a=uT(t,r);i&&a&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var kV=es&&"documentMode"in document&&11>=document.documentMode,ih=null,zx=null,kf=null,$x=!1;function lT(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;$x||ih==null||ih!==ng(r)||(r=ih,"selectionStart"in r&&eb(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),kf&&Qf(kf,r)||(kf=r,r=lg(zx,"onSelect"),0<r.length&&(e=new Y_("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=ih)))}function Jm(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var oh={animationend:Jm("Animation","AnimationEnd"),animationiteration:Jm("Animation","AnimationIteration"),animationstart:Jm("Animation","AnimationStart"),transitionend:Jm("Transition","TransitionEnd")},l1={},hA={};es&&(hA=document.createElement("div").style,"AnimationEvent"in window||(delete oh.animationend.animation,delete oh.animationiteration.animation,delete oh.animationstart.animation),"TransitionEvent"in window||delete oh.transitionend.transition);function Oy(n){if(l1[n])return l1[n];if(!oh[n])return n;var e=oh[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in hA)return l1[n]=e[t];return n}var dA=Oy("animationend"),fA=Oy("animationiteration"),pA=Oy("animationstart"),mA=Oy("transitionend"),vA=new Map,cT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fu(n,e){vA.set(n,e),ec(e,[n])}for(var c1=0;c1<cT.length;c1++){var h1=cT[c1],AV=h1.toLowerCase(),NV=h1[0].toUpperCase()+h1.slice(1);Fu(AV,"on"+NV)}Fu(dA,"onAnimationEnd");Fu(fA,"onAnimationIteration");Fu(pA,"onAnimationStart");Fu("dblclick","onDoubleClick");Fu("focusin","onFocus");Fu("focusout","onBlur");Fu(mA,"onTransitionEnd");Mh("onMouseEnter",["mouseout","mouseover"]);Mh("onMouseLeave",["mouseout","mouseover"]);Mh("onPointerEnter",["pointerout","pointerover"]);Mh("onPointerLeave",["pointerout","pointerover"]);ec("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ec("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ec("onBeforeInput",["compositionend","keypress","textInput","paste"]);ec("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ec("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ec("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DV=new Set("cancel close invalid load scroll toggle".split(" ").concat(gf));function hT(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,AB(r,e,void 0,n),n.currentTarget=null}function gA(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break e;hT(i,s,l),o=u}else for(a=0;a<r.length;a++){if(s=r[a],u=s.instance,l=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break e;hT(i,s,l),o=u}}}if(ig)throw n=Vx,ig=!1,Vx=null,n}function nn(n,e){var t=e[Xx];t===void 0&&(t=e[Xx]=new Set);var r=n+"__bubble";t.has(r)||(yA(e,n,2,!1),t.add(r))}function d1(n,e,t){var r=0;e&&(r|=4),yA(t,n,r,e)}var Zm="_reactListening"+Math.random().toString(36).slice(2);function Yf(n){if(!n[Zm]){n[Zm]=!0,Tk.forEach(function(t){t!=="selectionchange"&&(DV.has(t)||d1(t,!1,n),d1(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Zm]||(e[Zm]=!0,d1("selectionchange",!1,e))}}function yA(n,e,t,r){switch(tA(e)){case 1:var i=GB;break;case 4:i=qB;break;default:i=X_}t=i.bind(null,e,t,n),i=void 0,!Bx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function f1(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;a=a.return}for(;s!==null;){if(a=El(s),a===null)return;if(u=a.tag,u===5||u===6){r=o=a;continue e}s=s.parentNode}}r=r.return}Wk(function(){var l=o,c=H_(t),h=[];e:{var d=vA.get(n);if(d!==void 0){var f=Y_,p=n;switch(n){case"keypress":if(Lv(t)===0)break e;case"keydown":case"keyup":f=uV;break;case"focusin":p="focus",f=a1;break;case"focusout":p="blur",f=a1;break;case"beforeblur":case"afterblur":f=a1;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=ZC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=QB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=hV;break;case dA:case fA:case pA:f=ZB;break;case mA:f=fV;break;case"scroll":f=KB;break;case"wheel":f=mV;break;case"copy":case"cut":case"paste":f=tV;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=tT}var m=(e&4)!==0,g=!m&&n==="scroll",y=m?d!==null?d+"Capture":null:d;m=[];for(var x=l,_;x!==null;){_=x;var b=_.stateNode;if(_.tag===5&&b!==null&&(_=b,y!==null&&(b=Hf(x,y),b!=null&&m.push(Jf(x,b,_)))),g)break;x=x.return}0<m.length&&(d=new f(d,p,null,t,c),h.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",d&&t!==Fx&&(p=t.relatedTarget||t.fromElement)&&(El(p)||p[ts]))break e;if((f||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=l,p=p?El(p):null,p!==null&&(g=tc(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=l),f!==p)){if(m=ZC,b="onMouseLeave",y="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(m=tT,b="onPointerLeave",y="onPointerEnter",x="pointer"),g=f==null?d:ah(f),_=p==null?d:ah(p),d=new m(b,x+"leave",f,t,c),d.target=g,d.relatedTarget=_,b=null,El(c)===l&&(m=new m(y,x+"enter",p,t,c),m.target=_,m.relatedTarget=g,b=m),g=b,f&&p)t:{for(m=f,y=p,x=0,_=m;_;_=Vc(_))x++;for(_=0,b=y;b;b=Vc(b))_++;for(;0<x-_;)m=Vc(m),x--;for(;0<_-x;)y=Vc(y),_--;for(;x--;){if(m===y||y!==null&&m===y.alternate)break t;m=Vc(m),y=Vc(y)}m=null}else m=null;f!==null&&dT(h,d,f,m,!1),p!==null&&g!==null&&dT(h,g,p,m,!0)}}e:{if(d=l?ah(l):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var C=bV;else if(iT(d))if(sA)C=IV;else{C=CV;var k=EV}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(C=TV);if(C&&(C=C(n,l))){aA(h,C,t,c);break e}k&&k(n,d,l),n==="focusout"&&(k=d._wrapperState)&&k.controlled&&d.type==="number"&&Nx(d,"number",d.value)}switch(k=l?ah(l):window,n){case"focusin":(iT(k)||k.contentEditable==="true")&&(ih=k,zx=l,kf=null);break;case"focusout":kf=zx=ih=null;break;case"mousedown":$x=!0;break;case"contextmenu":case"mouseup":case"dragend":$x=!1,lT(h,t,c);break;case"selectionchange":if(kV)break;case"keydown":case"keyup":lT(h,t,c)}var T;if(Z_)e:{switch(n){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else rh?iA(n,t)&&(E="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(E="onCompositionStart");E&&(rA&&t.locale!=="ko"&&(rh||E!=="onCompositionStart"?E==="onCompositionEnd"&&rh&&(T=nA()):(Zs=c,Q_="value"in Zs?Zs.value:Zs.textContent,rh=!0)),k=lg(l,E),0<k.length&&(E=new eT(E,n,null,t,c),h.push({event:E,listeners:k}),T?E.data=T:(T=oA(t),T!==null&&(E.data=T)))),(T=gV?yV(n,t):xV(n,t))&&(l=lg(l,"onBeforeInput"),0<l.length&&(c=new eT("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:l}),c.data=T))}gA(h,e)})}function Jf(n,e,t){return{instance:n,listener:e,currentTarget:t}}function lg(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Hf(n,t),o!=null&&r.unshift(Jf(n,o,i)),o=Hf(n,e),o!=null&&r.push(Jf(n,o,i))),n=n.return}return r}function Vc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function dT(n,e,t,r,i){for(var o=e._reactName,a=[];t!==null&&t!==r;){var s=t,u=s.alternate,l=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&l!==null&&(s=l,i?(u=Hf(t,o),u!=null&&a.unshift(Jf(t,u,s))):i||(u=Hf(t,o),u!=null&&a.push(Jf(t,u,s)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var PV=/\r\n?/g,OV=/\u0000|\uFFFD/g;function fT(n){return(typeof n=="string"?n:""+n).replace(PV,`
`).replace(OV,"")}function ev(n,e,t){if(e=fT(e),fT(n)!==e&&t)throw Error(xe(425))}function cg(){}var Hx=null,Gx=null;function qx(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Kx=typeof setTimeout=="function"?setTimeout:void 0,MV=typeof clearTimeout=="function"?clearTimeout:void 0,pT=typeof Promise=="function"?Promise:void 0,FV=typeof queueMicrotask=="function"?queueMicrotask:typeof pT<"u"?function(n){return pT.resolve(null).then(n).catch(LV)}:Kx;function LV(n){setTimeout(function(){throw n})}function p1(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Kf(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Kf(e)}function cu(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function mT(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var hd=Math.random().toString(36).slice(2),Yo="__reactFiber$"+hd,Zf="__reactProps$"+hd,ts="__reactContainer$"+hd,Xx="__reactEvents$"+hd,BV="__reactListeners$"+hd,VV="__reactHandles$"+hd;function El(n){var e=n[Yo];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ts]||t[Yo]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=mT(n);n!==null;){if(t=n[Yo])return t;n=mT(n)}return e}n=t,t=n.parentNode}return null}function kp(n){return n=n[Yo]||n[ts],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ah(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(xe(33))}function My(n){return n[Zf]||null}var Qx=[],sh=-1;function Lu(n){return{current:n}}function rn(n){0>sh||(n.current=Qx[sh],Qx[sh]=null,sh--)}function Zt(n,e){sh++,Qx[sh]=n.current,n.current=e}var Cu={},Pr=Lu(Cu),ri=Lu(!1),Bl=Cu;function Fh(n,e){var t=n.type.contextTypes;if(!t)return Cu;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function ii(n){return n=n.childContextTypes,n!=null}function hg(){rn(ri),rn(Pr)}function vT(n,e,t){if(Pr.current!==Cu)throw Error(xe(168));Zt(Pr,e),Zt(ri,t)}function xA(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(xe(108,EB(n)||"Unknown",i));return hn({},t,r)}function dg(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Cu,Bl=Pr.current,Zt(Pr,n),Zt(ri,ri.current),!0}function gT(n,e,t){var r=n.stateNode;if(!r)throw Error(xe(169));t?(n=xA(n,e,Bl),r.__reactInternalMemoizedMergedChildContext=n,rn(ri),rn(Pr),Zt(Pr,n)):rn(ri),Zt(ri,t)}var La=null,Fy=!1,m1=!1;function wA(n){La===null?La=[n]:La.push(n)}function UV(n){Fy=!0,wA(n)}function Bu(){if(!m1&&La!==null){m1=!0;var n=0,e=Wt;try{var t=La;for(Wt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}La=null,Fy=!1}catch(i){throw La!==null&&(La=La.slice(n+1)),Hk(G_,Bu),i}finally{Wt=e,m1=!1}}return null}var uh=[],lh=0,fg=null,pg=0,Bi=[],Vi=0,Vl=null,za=1,$a="";function pl(n,e){uh[lh++]=pg,uh[lh++]=fg,fg=n,pg=e}function _A(n,e,t){Bi[Vi++]=za,Bi[Vi++]=$a,Bi[Vi++]=Vl,Vl=n;var r=za;n=$a;var i=32-Co(r)-1;r&=~(1<<i),t+=1;var o=32-Co(e)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,za=1<<32-Co(e)+i|t<<i|r,$a=o+n}else za=1<<o|t<<i|r,$a=n}function tb(n){n.return!==null&&(pl(n,1),_A(n,1,0))}function nb(n){for(;n===fg;)fg=uh[--lh],uh[lh]=null,pg=uh[--lh],uh[lh]=null;for(;n===Vl;)Vl=Bi[--Vi],Bi[Vi]=null,$a=Bi[--Vi],Bi[Vi]=null,za=Bi[--Vi],Bi[Vi]=null}var Ci=null,wi=null,an=!1,xo=null;function bA(n,e){var t=$i(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function yT(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Ci=n,wi=cu(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Ci=n,wi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Vl!==null?{id:za,overflow:$a}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=$i(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Ci=n,wi=null,!0):!1;default:return!1}}function Yx(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Jx(n){if(an){var e=wi;if(e){var t=e;if(!yT(n,e)){if(Yx(n))throw Error(xe(418));e=cu(t.nextSibling);var r=Ci;e&&yT(n,e)?bA(r,t):(n.flags=n.flags&-4097|2,an=!1,Ci=n)}}else{if(Yx(n))throw Error(xe(418));n.flags=n.flags&-4097|2,an=!1,Ci=n}}}function xT(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ci=n}function tv(n){if(n!==Ci)return!1;if(!an)return xT(n),an=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!qx(n.type,n.memoizedProps)),e&&(e=wi)){if(Yx(n))throw EA(),Error(xe(418));for(;e;)bA(n,e),e=cu(e.nextSibling)}if(xT(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(xe(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){wi=cu(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}wi=null}}else wi=Ci?cu(n.stateNode.nextSibling):null;return!0}function EA(){for(var n=wi;n;)n=cu(n.nextSibling)}function Lh(){wi=Ci=null,an=!1}function rb(n){xo===null?xo=[n]:xo.push(n)}var WV=cs.ReactCurrentBatchConfig;function of(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(xe(309));var r=t.stateNode}if(!r)throw Error(xe(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(a){var s=i.refs;a===null?delete s[o]:s[o]=a},e._stringRef=o,e)}if(typeof n!="string")throw Error(xe(284));if(!t._owner)throw Error(xe(290,n))}return n}function nv(n,e){throw n=Object.prototype.toString.call(e),Error(xe(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function wT(n){var e=n._init;return e(n._payload)}function CA(n){function e(y,x){if(n){var _=y.deletions;_===null?(y.deletions=[x],y.flags|=16):_.push(x)}}function t(y,x){if(!n)return null;for(;x!==null;)e(y,x),x=x.sibling;return null}function r(y,x){for(y=new Map;x!==null;)x.key!==null?y.set(x.key,x):y.set(x.index,x),x=x.sibling;return y}function i(y,x){return y=pu(y,x),y.index=0,y.sibling=null,y}function o(y,x,_){return y.index=_,n?(_=y.alternate,_!==null?(_=_.index,_<x?(y.flags|=2,x):_):(y.flags|=2,x)):(y.flags|=1048576,x)}function a(y){return n&&y.alternate===null&&(y.flags|=2),y}function s(y,x,_,b){return x===null||x.tag!==6?(x=b1(_,y.mode,b),x.return=y,x):(x=i(x,_),x.return=y,x)}function u(y,x,_,b){var C=_.type;return C===nh?c(y,x,_.props.children,b,_.key):x!==null&&(x.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===$s&&wT(C)===x.type)?(b=i(x,_.props),b.ref=of(y,x,_),b.return=y,b):(b=$v(_.type,_.key,_.props,null,y.mode,b),b.ref=of(y,x,_),b.return=y,b)}function l(y,x,_,b){return x===null||x.tag!==4||x.stateNode.containerInfo!==_.containerInfo||x.stateNode.implementation!==_.implementation?(x=E1(_,y.mode,b),x.return=y,x):(x=i(x,_.children||[]),x.return=y,x)}function c(y,x,_,b,C){return x===null||x.tag!==7?(x=Dl(_,y.mode,b,C),x.return=y,x):(x=i(x,_),x.return=y,x)}function h(y,x,_){if(typeof x=="string"&&x!==""||typeof x=="number")return x=b1(""+x,y.mode,_),x.return=y,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Hm:return _=$v(x.type,x.key,x.props,null,y.mode,_),_.ref=of(y,null,x),_.return=y,_;case th:return x=E1(x,y.mode,_),x.return=y,x;case $s:var b=x._init;return h(y,b(x._payload),_)}if(mf(x)||Zd(x))return x=Dl(x,y.mode,_,null),x.return=y,x;nv(y,x)}return null}function d(y,x,_,b){var C=x!==null?x.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return C!==null?null:s(y,x,""+_,b);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Hm:return _.key===C?u(y,x,_,b):null;case th:return _.key===C?l(y,x,_,b):null;case $s:return C=_._init,d(y,x,C(_._payload),b)}if(mf(_)||Zd(_))return C!==null?null:c(y,x,_,b,null);nv(y,_)}return null}function f(y,x,_,b,C){if(typeof b=="string"&&b!==""||typeof b=="number")return y=y.get(_)||null,s(x,y,""+b,C);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Hm:return y=y.get(b.key===null?_:b.key)||null,u(x,y,b,C);case th:return y=y.get(b.key===null?_:b.key)||null,l(x,y,b,C);case $s:var k=b._init;return f(y,x,_,k(b._payload),C)}if(mf(b)||Zd(b))return y=y.get(_)||null,c(x,y,b,C,null);nv(x,b)}return null}function p(y,x,_,b){for(var C=null,k=null,T=x,E=x=0,I=null;T!==null&&E<_.length;E++){T.index>E?(I=T,T=null):I=T.sibling;var R=d(y,T,_[E],b);if(R===null){T===null&&(T=I);break}n&&T&&R.alternate===null&&e(y,T),x=o(R,x,E),k===null?C=R:k.sibling=R,k=R,T=I}if(E===_.length)return t(y,T),an&&pl(y,E),C;if(T===null){for(;E<_.length;E++)T=h(y,_[E],b),T!==null&&(x=o(T,x,E),k===null?C=T:k.sibling=T,k=T);return an&&pl(y,E),C}for(T=r(y,T);E<_.length;E++)I=f(T,y,E,_[E],b),I!==null&&(n&&I.alternate!==null&&T.delete(I.key===null?E:I.key),x=o(I,x,E),k===null?C=I:k.sibling=I,k=I);return n&&T.forEach(function(N){return e(y,N)}),an&&pl(y,E),C}function m(y,x,_,b){var C=Zd(_);if(typeof C!="function")throw Error(xe(150));if(_=C.call(_),_==null)throw Error(xe(151));for(var k=C=null,T=x,E=x=0,I=null,R=_.next();T!==null&&!R.done;E++,R=_.next()){T.index>E?(I=T,T=null):I=T.sibling;var N=d(y,T,R.value,b);if(N===null){T===null&&(T=I);break}n&&T&&N.alternate===null&&e(y,T),x=o(N,x,E),k===null?C=N:k.sibling=N,k=N,T=I}if(R.done)return t(y,T),an&&pl(y,E),C;if(T===null){for(;!R.done;E++,R=_.next())R=h(y,R.value,b),R!==null&&(x=o(R,x,E),k===null?C=R:k.sibling=R,k=R);return an&&pl(y,E),C}for(T=r(y,T);!R.done;E++,R=_.next())R=f(T,y,E,R.value,b),R!==null&&(n&&R.alternate!==null&&T.delete(R.key===null?E:R.key),x=o(R,x,E),k===null?C=R:k.sibling=R,k=R);return n&&T.forEach(function(O){return e(y,O)}),an&&pl(y,E),C}function g(y,x,_,b){if(typeof _=="object"&&_!==null&&_.type===nh&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Hm:e:{for(var C=_.key,k=x;k!==null;){if(k.key===C){if(C=_.type,C===nh){if(k.tag===7){t(y,k.sibling),x=i(k,_.props.children),x.return=y,y=x;break e}}else if(k.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===$s&&wT(C)===k.type){t(y,k.sibling),x=i(k,_.props),x.ref=of(y,k,_),x.return=y,y=x;break e}t(y,k);break}else e(y,k);k=k.sibling}_.type===nh?(x=Dl(_.props.children,y.mode,b,_.key),x.return=y,y=x):(b=$v(_.type,_.key,_.props,null,y.mode,b),b.ref=of(y,x,_),b.return=y,y=b)}return a(y);case th:e:{for(k=_.key;x!==null;){if(x.key===k)if(x.tag===4&&x.stateNode.containerInfo===_.containerInfo&&x.stateNode.implementation===_.implementation){t(y,x.sibling),x=i(x,_.children||[]),x.return=y,y=x;break e}else{t(y,x);break}else e(y,x);x=x.sibling}x=E1(_,y.mode,b),x.return=y,y=x}return a(y);case $s:return k=_._init,g(y,x,k(_._payload),b)}if(mf(_))return p(y,x,_,b);if(Zd(_))return m(y,x,_,b);nv(y,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,x!==null&&x.tag===6?(t(y,x.sibling),x=i(x,_),x.return=y,y=x):(t(y,x),x=b1(_,y.mode,b),x.return=y,y=x),a(y)):t(y,x)}return g}var Bh=CA(!0),TA=CA(!1),mg=Lu(null),vg=null,ch=null,ib=null;function ob(){ib=ch=vg=null}function ab(n){var e=mg.current;rn(mg),n._currentValue=e}function Zx(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function yh(n,e){vg=n,ib=ch=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(ni=!0),n.firstContext=null)}function Qi(n){var e=n._currentValue;if(ib!==n)if(n={context:n,memoizedValue:e,next:null},ch===null){if(vg===null)throw Error(xe(308));ch=n,vg.dependencies={lanes:0,firstContext:n}}else ch=ch.next=n;return e}var Cl=null;function sb(n){Cl===null?Cl=[n]:Cl.push(n)}function IA(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,sb(e)):(t.next=i.next,i.next=t),e.interleaved=t,ns(n,r)}function ns(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Hs=!1;function ub(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function SA(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Qa(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function hu(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,St&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ns(n,t)}return i=r.interleaved,i===null?(e.next=e,sb(r)):(e.next=i.next,i.next=e),r.interleaved=e,ns(n,t)}function Bv(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,q_(n,t)}}function _T(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=a:o=o.next=a,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function gg(n,e,t,r){var i=n.updateQueue;Hs=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var u=s,l=u.next;u.next=null,a===null?o=l:a.next=l,a=u;var c=n.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(o!==null){var h=i.baseState;a=0,c=l=u=null,s=o;do{var d=s.lane,f=s.eventTime;if((r&d)===d){c!==null&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=n,m=s;switch(d=e,f=t,m.tag){case 1:if(p=m.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=hn({},h,d);break e;case 2:Hs=!0}}s.callback!==null&&s.lane!==0&&(n.flags|=64,d=i.effects,d===null?i.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=f,u=h):c=c.next=f,a|=d;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;d=s,s=d.next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}while(!0);if(c===null&&(u=h),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Wl|=a,n.lanes=a,n.memoizedState=h}}function bT(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(xe(191,i));i.call(r)}}}var Ap={},ia=Lu(Ap),ep=Lu(Ap),tp=Lu(Ap);function Tl(n){if(n===Ap)throw Error(xe(174));return n}function lb(n,e){switch(Zt(tp,e),Zt(ep,n),Zt(ia,Ap),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Px(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Px(e,n)}rn(ia),Zt(ia,e)}function Vh(){rn(ia),rn(ep),rn(tp)}function RA(n){Tl(tp.current);var e=Tl(ia.current),t=Px(e,n.type);e!==t&&(Zt(ep,n),Zt(ia,t))}function cb(n){ep.current===n&&(rn(ia),rn(ep))}var ln=Lu(0);function yg(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var v1=[];function hb(){for(var n=0;n<v1.length;n++)v1[n]._workInProgressVersionPrimary=null;v1.length=0}var Vv=cs.ReactCurrentDispatcher,g1=cs.ReactCurrentBatchConfig,Ul=0,cn=null,jn=null,tr=null,xg=!1,Af=!1,np=0,jV=0;function br(){throw Error(xe(321))}function db(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ao(n[t],e[t]))return!1;return!0}function fb(n,e,t,r,i,o){if(Ul=o,cn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Vv.current=n===null||n.memoizedState===null?GV:qV,n=t(r,i),Af){o=0;do{if(Af=!1,np=0,25<=o)throw Error(xe(301));o+=1,tr=jn=null,e.updateQueue=null,Vv.current=KV,n=t(r,i)}while(Af)}if(Vv.current=wg,e=jn!==null&&jn.next!==null,Ul=0,tr=jn=cn=null,xg=!1,e)throw Error(xe(300));return n}function pb(){var n=np!==0;return np=0,n}function Ho(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tr===null?cn.memoizedState=tr=n:tr=tr.next=n,tr}function Yi(){if(jn===null){var n=cn.alternate;n=n!==null?n.memoizedState:null}else n=jn.next;var e=tr===null?cn.memoizedState:tr.next;if(e!==null)tr=e,jn=n;else{if(n===null)throw Error(xe(310));jn=n,n={memoizedState:jn.memoizedState,baseState:jn.baseState,baseQueue:jn.baseQueue,queue:jn.queue,next:null},tr===null?cn.memoizedState=tr=n:tr=tr.next=n}return tr}function rp(n,e){return typeof e=="function"?e(n):e}function y1(n){var e=Yi(),t=e.queue;if(t===null)throw Error(xe(311));t.lastRenderedReducer=n;var r=jn,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var s=a=null,u=null,l=o;do{var c=l.lane;if((Ul&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:n(r,l.action);else{var h={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=h,a=r):u=u.next=h,cn.lanes|=c,Wl|=c}l=l.next}while(l!==null&&l!==o);u===null?a=r:u.next=s,Ao(r,e.memoizedState)||(ni=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,cn.lanes|=o,Wl|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function x1(n){var e=Yi(),t=e.queue;if(t===null)throw Error(xe(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do o=n(o,a.action),a=a.next;while(a!==i);Ao(o,e.memoizedState)||(ni=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function kA(){}function AA(n,e){var t=cn,r=Yi(),i=e(),o=!Ao(r.memoizedState,i);if(o&&(r.memoizedState=i,ni=!0),r=r.queue,mb(PA.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||tr!==null&&tr.memoizedState.tag&1){if(t.flags|=2048,ip(9,DA.bind(null,t,r,i,e),void 0,null),rr===null)throw Error(xe(349));Ul&30||NA(t,e,i)}return i}function NA(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=cn.updateQueue,e===null?(e={lastEffect:null,stores:null},cn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function DA(n,e,t,r){e.value=t,e.getSnapshot=r,OA(e)&&MA(n)}function PA(n,e,t){return t(function(){OA(e)&&MA(n)})}function OA(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ao(n,t)}catch{return!0}}function MA(n){var e=ns(n,1);e!==null&&To(e,n,1,-1)}function ET(n){var e=Ho();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:rp,lastRenderedState:n},e.queue=n,n=n.dispatch=HV.bind(null,cn,n),[e.memoizedState,n]}function ip(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=cn.updateQueue,e===null?(e={lastEffect:null,stores:null},cn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function FA(){return Yi().memoizedState}function Uv(n,e,t,r){var i=Ho();cn.flags|=n,i.memoizedState=ip(1|e,t,void 0,r===void 0?null:r)}function Ly(n,e,t,r){var i=Yi();r=r===void 0?null:r;var o=void 0;if(jn!==null){var a=jn.memoizedState;if(o=a.destroy,r!==null&&db(r,a.deps)){i.memoizedState=ip(e,t,o,r);return}}cn.flags|=n,i.memoizedState=ip(1|e,t,o,r)}function CT(n,e){return Uv(8390656,8,n,e)}function mb(n,e){return Ly(2048,8,n,e)}function LA(n,e){return Ly(4,2,n,e)}function BA(n,e){return Ly(4,4,n,e)}function VA(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function UA(n,e,t){return t=t!=null?t.concat([n]):null,Ly(4,4,VA.bind(null,e,n),t)}function vb(){}function WA(n,e){var t=Yi();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&db(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function jA(n,e){var t=Yi();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&db(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function zA(n,e,t){return Ul&21?(Ao(t,e)||(t=Kk(),cn.lanes|=t,Wl|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,ni=!0),n.memoizedState=t)}function zV(n,e){var t=Wt;Wt=t!==0&&4>t?t:4,n(!0);var r=g1.transition;g1.transition={};try{n(!1),e()}finally{Wt=t,g1.transition=r}}function $A(){return Yi().memoizedState}function $V(n,e,t){var r=fu(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},HA(n))GA(e,t);else if(t=IA(n,e,t,r),t!==null){var i=zr();To(t,n,r,i),qA(t,e,r)}}function HV(n,e,t){var r=fu(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(HA(n))GA(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,s=o(a,t);if(i.hasEagerState=!0,i.eagerState=s,Ao(s,a)){var u=e.interleaved;u===null?(i.next=i,sb(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}t=IA(n,e,i,r),t!==null&&(i=zr(),To(t,n,r,i),qA(t,e,r))}}function HA(n){var e=n.alternate;return n===cn||e!==null&&e===cn}function GA(n,e){Af=xg=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function qA(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,q_(n,t)}}var wg={readContext:Qi,useCallback:br,useContext:br,useEffect:br,useImperativeHandle:br,useInsertionEffect:br,useLayoutEffect:br,useMemo:br,useReducer:br,useRef:br,useState:br,useDebugValue:br,useDeferredValue:br,useTransition:br,useMutableSource:br,useSyncExternalStore:br,useId:br,unstable_isNewReconciler:!1},GV={readContext:Qi,useCallback:function(n,e){return Ho().memoizedState=[n,e===void 0?null:e],n},useContext:Qi,useEffect:CT,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Uv(4194308,4,VA.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Uv(4194308,4,n,e)},useInsertionEffect:function(n,e){return Uv(4,2,n,e)},useMemo:function(n,e){var t=Ho();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ho();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=$V.bind(null,cn,n),[r.memoizedState,n]},useRef:function(n){var e=Ho();return n={current:n},e.memoizedState=n},useState:ET,useDebugValue:vb,useDeferredValue:function(n){return Ho().memoizedState=n},useTransition:function(){var n=ET(!1),e=n[0];return n=zV.bind(null,n[1]),Ho().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=cn,i=Ho();if(an){if(t===void 0)throw Error(xe(407));t=t()}else{if(t=e(),rr===null)throw Error(xe(349));Ul&30||NA(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,CT(PA.bind(null,r,o,n),[n]),r.flags|=2048,ip(9,DA.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=Ho(),e=rr.identifierPrefix;if(an){var t=$a,r=za;t=(r&~(1<<32-Co(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=np++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=jV++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},qV={readContext:Qi,useCallback:WA,useContext:Qi,useEffect:mb,useImperativeHandle:UA,useInsertionEffect:LA,useLayoutEffect:BA,useMemo:jA,useReducer:y1,useRef:FA,useState:function(){return y1(rp)},useDebugValue:vb,useDeferredValue:function(n){var e=Yi();return zA(e,jn.memoizedState,n)},useTransition:function(){var n=y1(rp)[0],e=Yi().memoizedState;return[n,e]},useMutableSource:kA,useSyncExternalStore:AA,useId:$A,unstable_isNewReconciler:!1},KV={readContext:Qi,useCallback:WA,useContext:Qi,useEffect:mb,useImperativeHandle:UA,useInsertionEffect:LA,useLayoutEffect:BA,useMemo:jA,useReducer:x1,useRef:FA,useState:function(){return x1(rp)},useDebugValue:vb,useDeferredValue:function(n){var e=Yi();return jn===null?e.memoizedState=n:zA(e,jn.memoizedState,n)},useTransition:function(){var n=x1(rp)[0],e=Yi().memoizedState;return[n,e]},useMutableSource:kA,useSyncExternalStore:AA,useId:$A,unstable_isNewReconciler:!1};function go(n,e){if(n&&n.defaultProps){e=hn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function ew(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:hn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var By={isMounted:function(n){return(n=n._reactInternals)?tc(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=zr(),i=fu(n),o=Qa(r,i);o.payload=e,t!=null&&(o.callback=t),e=hu(n,o,i),e!==null&&(To(e,n,i,r),Bv(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=zr(),i=fu(n),o=Qa(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=hu(n,o,i),e!==null&&(To(e,n,i,r),Bv(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=zr(),r=fu(n),i=Qa(t,r);i.tag=2,e!=null&&(i.callback=e),e=hu(n,i,r),e!==null&&(To(e,n,r,t),Bv(e,n,r))}};function TT(n,e,t,r,i,o,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,a):e.prototype&&e.prototype.isPureReactComponent?!Qf(t,r)||!Qf(i,o):!0}function KA(n,e,t){var r=!1,i=Cu,o=e.contextType;return typeof o=="object"&&o!==null?o=Qi(o):(i=ii(e)?Bl:Pr.current,r=e.contextTypes,o=(r=r!=null)?Fh(n,i):Cu),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=By,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function IT(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&By.enqueueReplaceState(e,e.state,null)}function tw(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},ub(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Qi(o):(o=ii(e)?Bl:Pr.current,i.context=Fh(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(ew(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&By.enqueueReplaceState(i,i.state,null),gg(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Uh(n,e){try{var t="",r=e;do t+=bB(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function w1(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function nw(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var XV=typeof WeakMap=="function"?WeakMap:Map;function XA(n,e,t){t=Qa(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){bg||(bg=!0,dw=r),nw(n,e)},t}function QA(n,e,t){t=Qa(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){nw(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){nw(n,e),typeof r!="function"&&(du===null?du=new Set([this]):du.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function ST(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new XV;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=lU.bind(null,n,e,t),e.then(n,n))}function RT(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function kT(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Qa(-1,1),e.tag=2,hu(t,e,1))),t.lanes|=1),n)}var QV=cs.ReactCurrentOwner,ni=!1;function Vr(n,e,t,r){e.child=n===null?TA(e,null,t,r):Bh(e,n.child,t,r)}function AT(n,e,t,r,i){t=t.render;var o=e.ref;return yh(e,i),r=fb(n,e,t,r,o,i),t=pb(),n!==null&&!ni?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,rs(n,e,i)):(an&&t&&tb(e),e.flags|=1,Vr(n,e,r,i),e.child)}function NT(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!Cb(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,YA(n,e,o,r,i)):(n=$v(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var a=o.memoizedProps;if(t=t.compare,t=t!==null?t:Qf,t(a,r)&&n.ref===e.ref)return rs(n,e,i)}return e.flags|=1,n=pu(o,r),n.ref=e.ref,n.return=e,e.child=n}function YA(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(Qf(o,r)&&n.ref===e.ref)if(ni=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(ni=!0);else return e.lanes=n.lanes,rs(n,e,i)}return rw(n,e,t,r,i)}function JA(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zt(dh,fi),fi|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Zt(dh,fi),fi|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,Zt(dh,fi),fi|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,Zt(dh,fi),fi|=r;return Vr(n,e,i,t),e.child}function ZA(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function rw(n,e,t,r,i){var o=ii(t)?Bl:Pr.current;return o=Fh(e,o),yh(e,i),t=fb(n,e,t,r,o,i),r=pb(),n!==null&&!ni?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,rs(n,e,i)):(an&&r&&tb(e),e.flags|=1,Vr(n,e,t,i),e.child)}function DT(n,e,t,r,i){if(ii(t)){var o=!0;dg(e)}else o=!1;if(yh(e,i),e.stateNode===null)Wv(n,e),KA(e,t,r),tw(e,t,r,i),r=!0;else if(n===null){var a=e.stateNode,s=e.memoizedProps;a.props=s;var u=a.context,l=t.contextType;typeof l=="object"&&l!==null?l=Qi(l):(l=ii(t)?Bl:Pr.current,l=Fh(e,l));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||u!==l)&&IT(e,a,r,l),Hs=!1;var d=e.memoizedState;a.state=d,gg(e,r,a,i),u=e.memoizedState,s!==r||d!==u||ri.current||Hs?(typeof c=="function"&&(ew(e,t,c,r),u=e.memoizedState),(s=Hs||TT(e,t,s,r,d,u,l))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=l,r=s):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,SA(n,e),s=e.memoizedProps,l=e.type===e.elementType?s:go(e.type,s),a.props=l,h=e.pendingProps,d=a.context,u=t.contextType,typeof u=="object"&&u!==null?u=Qi(u):(u=ii(t)?Bl:Pr.current,u=Fh(e,u));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==h||d!==u)&&IT(e,a,r,u),Hs=!1,d=e.memoizedState,a.state=d,gg(e,r,a,i);var p=e.memoizedState;s!==h||d!==p||ri.current||Hs?(typeof f=="function"&&(ew(e,t,f,r),p=e.memoizedState),(l=Hs||TT(e,t,l,r,d,p,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),a.props=r,a.state=p,a.context=u,r=l):(typeof a.componentDidUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),r=!1)}return iw(n,e,t,r,o,i)}function iw(n,e,t,r,i,o){ZA(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&gT(e,t,!1),rs(n,e,o);r=e.stateNode,QV.current=e;var s=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=Bh(e,n.child,null,o),e.child=Bh(e,null,s,o)):Vr(n,e,s,o),e.memoizedState=r.state,i&&gT(e,t,!0),e.child}function eN(n){var e=n.stateNode;e.pendingContext?vT(n,e.pendingContext,e.pendingContext!==e.context):e.context&&vT(n,e.context,!1),lb(n,e.containerInfo)}function PT(n,e,t,r,i){return Lh(),rb(i),e.flags|=256,Vr(n,e,t,r),e.child}var ow={dehydrated:null,treeContext:null,retryLane:0};function aw(n){return{baseLanes:n,cachePool:null,transitions:null}}function tN(n,e,t){var r=e.pendingProps,i=ln.current,o=!1,a=(e.flags&128)!==0,s;if((s=a)||(s=n!==null&&n.memoizedState===null?!1:(i&2)!==0),s?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Zt(ln,i&1),n===null)return Jx(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,o?(r=e.mode,o=e.child,a={mode:"hidden",children:a},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=Wy(a,r,0,null),n=Dl(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=aw(t),e.memoizedState=ow,n):gb(e,a));if(i=n.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return YV(n,e,a,r,s,i,t);if(o){o=r.fallback,a=e.mode,i=n.child,s=i.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=pu(i,u),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=pu(s,o):(o=Dl(o,a,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,a=n.child.memoizedState,a=a===null?aw(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=n.childLanes&~t,e.memoizedState=ow,r}return o=n.child,n=o.sibling,r=pu(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function gb(n,e){return e=Wy({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function rv(n,e,t,r){return r!==null&&rb(r),Bh(e,n.child,null,t),n=gb(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function YV(n,e,t,r,i,o,a){if(t)return e.flags&256?(e.flags&=-257,r=w1(Error(xe(422))),rv(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=Wy({mode:"visible",children:r.children},i,0,null),o=Dl(o,i,a,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Bh(e,n.child,null,a),e.child.memoizedState=aw(a),e.memoizedState=ow,o);if(!(e.mode&1))return rv(n,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,o=Error(xe(419)),r=w1(o,r,void 0),rv(n,e,a,r)}if(s=(a&n.childLanes)!==0,ni||s){if(r=rr,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,ns(n,i),To(r,n,i,-1))}return Eb(),r=w1(Error(xe(421))),rv(n,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=cU.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,wi=cu(i.nextSibling),Ci=e,an=!0,xo=null,n!==null&&(Bi[Vi++]=za,Bi[Vi++]=$a,Bi[Vi++]=Vl,za=n.id,$a=n.overflow,Vl=e),e=gb(e,r.children),e.flags|=4096,e)}function OT(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Zx(n.return,e,t)}function _1(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function nN(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Vr(n,e,r.children,t),r=ln.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&OT(n,t,e);else if(n.tag===19)OT(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Zt(ln,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&yg(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),_1(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&yg(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}_1(e,!0,t,null,o);break;case"together":_1(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Wv(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function rs(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Wl|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(xe(153));if(e.child!==null){for(n=e.child,t=pu(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=pu(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function JV(n,e,t){switch(e.tag){case 3:eN(e),Lh();break;case 5:RA(e);break;case 1:ii(e.type)&&dg(e);break;case 4:lb(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Zt(mg,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Zt(ln,ln.current&1),e.flags|=128,null):t&e.child.childLanes?tN(n,e,t):(Zt(ln,ln.current&1),n=rs(n,e,t),n!==null?n.sibling:null);Zt(ln,ln.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return nN(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Zt(ln,ln.current),r)break;return null;case 22:case 23:return e.lanes=0,JA(n,e,t)}return rs(n,e,t)}var rN,sw,iN,oN;rN=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};sw=function(){};iN=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Tl(ia.current);var o=null;switch(t){case"input":i=kx(n,i),r=kx(n,r),o=[];break;case"select":i=hn({},i,{value:void 0}),r=hn({},r,{value:void 0}),o=[];break;case"textarea":i=Dx(n,i),r=Dx(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=cg)}Ox(t,r);var a;t=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(a in s)s.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(zf.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(s=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in u)u.hasOwnProperty(a)&&s[a]!==u[a]&&(t||(t={}),t[a]=u[a])}else t||(o||(o=[]),o.push(l,t)),t=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(o=o||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(o=o||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(zf.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&nn("scroll",n),o||s===u||(o=[])):(o=o||[]).push(l,u))}t&&(o=o||[]).push("style",t);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};oN=function(n,e,t,r){t!==r&&(e.flags|=4)};function af(n,e){if(!an)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Er(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function ZV(n,e,t){var r=e.pendingProps;switch(nb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Er(e),null;case 1:return ii(e.type)&&hg(),Er(e),null;case 3:return r=e.stateNode,Vh(),rn(ri),rn(Pr),hb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(tv(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xo!==null&&(mw(xo),xo=null))),sw(n,e),Er(e),null;case 5:cb(e);var i=Tl(tp.current);if(t=e.type,n!==null&&e.stateNode!=null)iN(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(xe(166));return Er(e),null}if(n=Tl(ia.current),tv(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[Yo]=e,r[Zf]=o,n=(e.mode&1)!==0,t){case"dialog":nn("cancel",r),nn("close",r);break;case"iframe":case"object":case"embed":nn("load",r);break;case"video":case"audio":for(i=0;i<gf.length;i++)nn(gf[i],r);break;case"source":nn("error",r);break;case"img":case"image":case"link":nn("error",r),nn("load",r);break;case"details":nn("toggle",r);break;case"input":zC(r,o),nn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},nn("invalid",r);break;case"textarea":HC(r,o),nn("invalid",r)}Ox(t,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?r.textContent!==s&&(o.suppressHydrationWarning!==!0&&ev(r.textContent,s,n),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&ev(r.textContent,s,n),i=["children",""+s]):zf.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&nn("scroll",r)}switch(t){case"input":Gm(r),$C(r,o,!0);break;case"textarea":Gm(r),GC(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=cg)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Pk(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[Yo]=e,n[Zf]=r,rN(n,e,!1,!1),e.stateNode=n;e:{switch(a=Mx(t,r),t){case"dialog":nn("cancel",n),nn("close",n),i=r;break;case"iframe":case"object":case"embed":nn("load",n),i=r;break;case"video":case"audio":for(i=0;i<gf.length;i++)nn(gf[i],n);i=r;break;case"source":nn("error",n),i=r;break;case"img":case"image":case"link":nn("error",n),nn("load",n),i=r;break;case"details":nn("toggle",n),i=r;break;case"input":zC(n,r),i=kx(n,r),nn("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=hn({},r,{value:void 0}),nn("invalid",n);break;case"textarea":HC(n,r),i=Dx(n,r),nn("invalid",n);break;default:i=r}Ox(t,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var u=s[o];o==="style"?Fk(n,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Ok(n,u)):o==="children"?typeof u=="string"?(t!=="textarea"||u!=="")&&$f(n,u):typeof u=="number"&&$f(n,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(zf.hasOwnProperty(o)?u!=null&&o==="onScroll"&&nn("scroll",n):u!=null&&W_(n,o,u,a))}switch(t){case"input":Gm(n),$C(n,r,!1);break;case"textarea":Gm(n),GC(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Eu(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?ph(n,!!r.multiple,o,!1):r.defaultValue!=null&&ph(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=cg)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Er(e),null;case 6:if(n&&e.stateNode!=null)oN(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(xe(166));if(t=Tl(tp.current),Tl(ia.current),tv(e)){if(r=e.stateNode,t=e.memoizedProps,r[Yo]=e,(o=r.nodeValue!==t)&&(n=Ci,n!==null))switch(n.tag){case 3:ev(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ev(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Yo]=e,e.stateNode=r}return Er(e),null;case 13:if(rn(ln),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(an&&wi!==null&&e.mode&1&&!(e.flags&128))EA(),Lh(),e.flags|=98560,o=!1;else if(o=tv(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(xe(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(xe(317));o[Yo]=e}else Lh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Er(e),o=!1}else xo!==null&&(mw(xo),xo=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ln.current&1?Hn===0&&(Hn=3):Eb())),e.updateQueue!==null&&(e.flags|=4),Er(e),null);case 4:return Vh(),sw(n,e),n===null&&Yf(e.stateNode.containerInfo),Er(e),null;case 10:return ab(e.type._context),Er(e),null;case 17:return ii(e.type)&&hg(),Er(e),null;case 19:if(rn(ln),o=e.memoizedState,o===null)return Er(e),null;if(r=(e.flags&128)!==0,a=o.rendering,a===null)if(r)af(o,!1);else{if(Hn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=yg(n),a!==null){for(e.flags|=128,af(o,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,n=a.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Zt(ln,ln.current&1|2),e.child}n=n.sibling}o.tail!==null&&Rn()>Wh&&(e.flags|=128,r=!0,af(o,!1),e.lanes=4194304)}else{if(!r)if(n=yg(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),af(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!an)return Er(e),null}else 2*Rn()-o.renderingStartTime>Wh&&t!==1073741824&&(e.flags|=128,r=!0,af(o,!1),e.lanes=4194304);o.isBackwards?(a.sibling=e.child,e.child=a):(t=o.last,t!==null?t.sibling=a:e.child=a,o.last=a)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Rn(),e.sibling=null,t=ln.current,Zt(ln,r?t&1|2:t&1),e):(Er(e),null);case 22:case 23:return bb(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?fi&1073741824&&(Er(e),e.subtreeFlags&6&&(e.flags|=8192)):Er(e),null;case 24:return null;case 25:return null}throw Error(xe(156,e.tag))}function eU(n,e){switch(nb(e),e.tag){case 1:return ii(e.type)&&hg(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Vh(),rn(ri),rn(Pr),hb(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return cb(e),null;case 13:if(rn(ln),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(xe(340));Lh()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return rn(ln),null;case 4:return Vh(),null;case 10:return ab(e.type._context),null;case 22:case 23:return bb(),null;case 24:return null;default:return null}}var iv=!1,Rr=!1,tU=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function hh(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){_n(n,e,r)}else t.current=null}function uw(n,e,t){try{t()}catch(r){_n(n,e,r)}}var MT=!1;function nU(n,e){if(Hx=sg,n=cA(),eb(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var a=0,s=-1,u=-1,l=0,c=0,h=n,d=null;t:for(;;){for(var f;h!==t||i!==0&&h.nodeType!==3||(s=a+i),h!==o||r!==0&&h.nodeType!==3||(u=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===n)break t;if(d===t&&++l===i&&(s=a),d===o&&++c===r&&(u=a),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=s===-1||u===-1?null:{start:s,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;for(Gx={focusedElem:n,selectionRange:t},sg=!1,Ae=e;Ae!==null;)if(e=Ae,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ae=n;else for(;Ae!==null;){e=Ae;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,y=e.stateNode,x=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:go(e.type,m),g);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(xe(163))}}catch(b){_n(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,Ae=n;break}Ae=e.return}return p=MT,MT=!1,p}function Nf(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&uw(e,t,o)}i=i.next}while(i!==r)}}function Vy(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function lw(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function aN(n){var e=n.alternate;e!==null&&(n.alternate=null,aN(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Yo],delete e[Zf],delete e[Xx],delete e[BV],delete e[VV])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function sN(n){return n.tag===5||n.tag===3||n.tag===4}function FT(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||sN(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function cw(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=cg));else if(r!==4&&(n=n.child,n!==null))for(cw(n,e,t),n=n.sibling;n!==null;)cw(n,e,t),n=n.sibling}function hw(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(hw(n,e,t),n=n.sibling;n!==null;)hw(n,e,t),n=n.sibling}var ur=null,yo=!1;function Vs(n,e,t){for(t=t.child;t!==null;)uN(n,e,t),t=t.sibling}function uN(n,e,t){if(ra&&typeof ra.onCommitFiberUnmount=="function")try{ra.onCommitFiberUnmount(Ny,t)}catch{}switch(t.tag){case 5:Rr||hh(t,e);case 6:var r=ur,i=yo;ur=null,Vs(n,e,t),ur=r,yo=i,ur!==null&&(yo?(n=ur,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):ur.removeChild(t.stateNode));break;case 18:ur!==null&&(yo?(n=ur,t=t.stateNode,n.nodeType===8?p1(n.parentNode,t):n.nodeType===1&&p1(n,t),Kf(n)):p1(ur,t.stateNode));break;case 4:r=ur,i=yo,ur=t.stateNode.containerInfo,yo=!0,Vs(n,e,t),ur=r,yo=i;break;case 0:case 11:case 14:case 15:if(!Rr&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&uw(t,e,a),i=i.next}while(i!==r)}Vs(n,e,t);break;case 1:if(!Rr&&(hh(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(s){_n(t,e,s)}Vs(n,e,t);break;case 21:Vs(n,e,t);break;case 22:t.mode&1?(Rr=(r=Rr)||t.memoizedState!==null,Vs(n,e,t),Rr=r):Vs(n,e,t);break;default:Vs(n,e,t)}}function LT(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new tU),e.forEach(function(r){var i=hU.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function mo(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,a=e,s=a;e:for(;s!==null;){switch(s.tag){case 5:ur=s.stateNode,yo=!1;break e;case 3:ur=s.stateNode.containerInfo,yo=!0;break e;case 4:ur=s.stateNode.containerInfo,yo=!0;break e}s=s.return}if(ur===null)throw Error(xe(160));uN(o,a,i),ur=null,yo=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){_n(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)lN(e,n),e=e.sibling}function lN(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(mo(e,n),zo(n),r&4){try{Nf(3,n,n.return),Vy(3,n)}catch(m){_n(n,n.return,m)}try{Nf(5,n,n.return)}catch(m){_n(n,n.return,m)}}break;case 1:mo(e,n),zo(n),r&512&&t!==null&&hh(t,t.return);break;case 5:if(mo(e,n),zo(n),r&512&&t!==null&&hh(t,t.return),n.flags&32){var i=n.stateNode;try{$f(i,"")}catch(m){_n(n,n.return,m)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,a=t!==null?t.memoizedProps:o,s=n.type,u=n.updateQueue;if(n.updateQueue=null,u!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&Nk(i,o),Mx(s,a);var l=Mx(s,o);for(a=0;a<u.length;a+=2){var c=u[a],h=u[a+1];c==="style"?Fk(i,h):c==="dangerouslySetInnerHTML"?Ok(i,h):c==="children"?$f(i,h):W_(i,c,h,l)}switch(s){case"input":Ax(i,o);break;case"textarea":Dk(i,o);break;case"select":var d=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?ph(i,!!o.multiple,f,!1):d!==!!o.multiple&&(o.defaultValue!=null?ph(i,!!o.multiple,o.defaultValue,!0):ph(i,!!o.multiple,o.multiple?[]:"",!1))}i[Zf]=o}catch(m){_n(n,n.return,m)}}break;case 6:if(mo(e,n),zo(n),r&4){if(n.stateNode===null)throw Error(xe(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(m){_n(n,n.return,m)}}break;case 3:if(mo(e,n),zo(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Kf(e.containerInfo)}catch(m){_n(n,n.return,m)}break;case 4:mo(e,n),zo(n);break;case 13:mo(e,n),zo(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(wb=Rn())),r&4&&LT(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(Rr=(l=Rr)||c,mo(e,n),Rr=l):mo(e,n),zo(n),r&8192){if(l=n.memoizedState!==null,(n.stateNode.isHidden=l)&&!c&&n.mode&1)for(Ae=n,c=n.child;c!==null;){for(h=Ae=c;Ae!==null;){switch(d=Ae,f=d.child,d.tag){case 0:case 11:case 14:case 15:Nf(4,d,d.return);break;case 1:hh(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){r=d,t=d.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){_n(r,t,m)}}break;case 5:hh(d,d.return);break;case 22:if(d.memoizedState!==null){VT(h);continue}}f!==null?(f.return=d,Ae=f):VT(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{i=h.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=h.stateNode,u=h.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=Mk("display",a))}catch(m){_n(n,n.return,m)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(m){_n(n,n.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mo(e,n),zo(n),r&4&&LT(n);break;case 21:break;default:mo(e,n),zo(n)}}function zo(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(sN(t)){var r=t;break e}t=t.return}throw Error(xe(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&($f(i,""),r.flags&=-33);var o=FT(n);hw(n,o,i);break;case 3:case 4:var a=r.stateNode.containerInfo,s=FT(n);cw(n,s,a);break;default:throw Error(xe(161))}}catch(u){_n(n,n.return,u)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function rU(n,e,t){Ae=n,cN(n)}function cN(n,e,t){for(var r=(n.mode&1)!==0;Ae!==null;){var i=Ae,o=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||iv;if(!a){var s=i.alternate,u=s!==null&&s.memoizedState!==null||Rr;s=iv;var l=Rr;if(iv=a,(Rr=u)&&!l)for(Ae=i;Ae!==null;)a=Ae,u=a.child,a.tag===22&&a.memoizedState!==null?UT(i):u!==null?(u.return=a,Ae=u):UT(i);for(;o!==null;)Ae=o,cN(o),o=o.sibling;Ae=i,iv=s,Rr=l}BT(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,Ae=o):BT(n)}}function BT(n){for(;Ae!==null;){var e=Ae;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Rr||Vy(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Rr)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:go(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&bT(e,o,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}bT(e,a,t)}break;case 5:var s=e.stateNode;if(t===null&&e.flags&4){t=s;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&t.focus();break;case"img":u.src&&(t.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Kf(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(xe(163))}Rr||e.flags&512&&lw(e)}catch(d){_n(e,e.return,d)}}if(e===n){Ae=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function VT(n){for(;Ae!==null;){var e=Ae;if(e===n){Ae=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ae=t;break}Ae=e.return}}function UT(n){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Vy(4,e)}catch(u){_n(e,t,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){_n(e,i,u)}}var o=e.return;try{lw(e)}catch(u){_n(e,o,u)}break;case 5:var a=e.return;try{lw(e)}catch(u){_n(e,a,u)}}}catch(u){_n(e,e.return,u)}if(e===n){Ae=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Ae=s;break}Ae=e.return}}var iU=Math.ceil,_g=cs.ReactCurrentDispatcher,yb=cs.ReactCurrentOwner,Ki=cs.ReactCurrentBatchConfig,St=0,rr=null,Mn=null,pr=0,fi=0,dh=Lu(0),Hn=0,op=null,Wl=0,Uy=0,xb=0,Df=null,ei=null,wb=0,Wh=1/0,Fa=null,bg=!1,dw=null,du=null,ov=!1,eu=null,Eg=0,Pf=0,fw=null,jv=-1,zv=0;function zr(){return St&6?Rn():jv!==-1?jv:jv=Rn()}function fu(n){return n.mode&1?St&2&&pr!==0?pr&-pr:WV.transition!==null?(zv===0&&(zv=Kk()),zv):(n=Wt,n!==0||(n=window.event,n=n===void 0?16:tA(n.type)),n):1}function To(n,e,t,r){if(50<Pf)throw Pf=0,fw=null,Error(xe(185));Sp(n,t,r),(!(St&2)||n!==rr)&&(n===rr&&(!(St&2)&&(Uy|=t),Hn===4&&Xs(n,pr)),oi(n,r),t===1&&St===0&&!(e.mode&1)&&(Wh=Rn()+500,Fy&&Bu()))}function oi(n,e){var t=n.callbackNode;WB(n,e);var r=ag(n,n===rr?pr:0);if(r===0)t!==null&&XC(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&XC(t),e===1)n.tag===0?UV(WT.bind(null,n)):wA(WT.bind(null,n)),FV(function(){!(St&6)&&Bu()}),t=null;else{switch(Xk(r)){case 1:t=G_;break;case 4:t=Gk;break;case 16:t=og;break;case 536870912:t=qk;break;default:t=og}t=yN(t,hN.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function hN(n,e){if(jv=-1,zv=0,St&6)throw Error(xe(327));var t=n.callbackNode;if(xh()&&n.callbackNode!==t)return null;var r=ag(n,n===rr?pr:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Cg(n,r);else{e=r;var i=St;St|=2;var o=fN();(rr!==n||pr!==e)&&(Fa=null,Wh=Rn()+500,Nl(n,e));do try{sU();break}catch(s){dN(n,s)}while(!0);ob(),_g.current=o,St=i,Mn!==null?e=0:(rr=null,pr=0,e=Hn)}if(e!==0){if(e===2&&(i=Ux(n),i!==0&&(r=i,e=pw(n,i))),e===1)throw t=op,Nl(n,0),Xs(n,r),oi(n,Rn()),t;if(e===6)Xs(n,r);else{if(i=n.current.alternate,!(r&30)&&!oU(i)&&(e=Cg(n,r),e===2&&(o=Ux(n),o!==0&&(r=o,e=pw(n,o))),e===1))throw t=op,Nl(n,0),Xs(n,r),oi(n,Rn()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(xe(345));case 2:ml(n,ei,Fa);break;case 3:if(Xs(n,r),(r&130023424)===r&&(e=wb+500-Rn(),10<e)){if(ag(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){zr(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Kx(ml.bind(null,n,ei,Fa),e);break}ml(n,ei,Fa);break;case 4:if(Xs(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var a=31-Co(r);o=1<<a,a=e[a],a>i&&(i=a),r&=~o}if(r=i,r=Rn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*iU(r/1960))-r,10<r){n.timeoutHandle=Kx(ml.bind(null,n,ei,Fa),r);break}ml(n,ei,Fa);break;case 5:ml(n,ei,Fa);break;default:throw Error(xe(329))}}}return oi(n,Rn()),n.callbackNode===t?hN.bind(null,n):null}function pw(n,e){var t=Df;return n.current.memoizedState.isDehydrated&&(Nl(n,e).flags|=256),n=Cg(n,e),n!==2&&(e=ei,ei=t,e!==null&&mw(e)),n}function mw(n){ei===null?ei=n:ei.push.apply(ei,n)}function oU(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!Ao(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Xs(n,e){for(e&=~xb,e&=~Uy,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Co(e),r=1<<t;n[t]=-1,e&=~r}}function WT(n){if(St&6)throw Error(xe(327));xh();var e=ag(n,0);if(!(e&1))return oi(n,Rn()),null;var t=Cg(n,e);if(n.tag!==0&&t===2){var r=Ux(n);r!==0&&(e=r,t=pw(n,r))}if(t===1)throw t=op,Nl(n,0),Xs(n,e),oi(n,Rn()),t;if(t===6)throw Error(xe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ml(n,ei,Fa),oi(n,Rn()),null}function _b(n,e){var t=St;St|=1;try{return n(e)}finally{St=t,St===0&&(Wh=Rn()+500,Fy&&Bu())}}function jl(n){eu!==null&&eu.tag===0&&!(St&6)&&xh();var e=St;St|=1;var t=Ki.transition,r=Wt;try{if(Ki.transition=null,Wt=1,n)return n()}finally{Wt=r,Ki.transition=t,St=e,!(St&6)&&Bu()}}function bb(){fi=dh.current,rn(dh)}function Nl(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,MV(t)),Mn!==null)for(t=Mn.return;t!==null;){var r=t;switch(nb(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&hg();break;case 3:Vh(),rn(ri),rn(Pr),hb();break;case 5:cb(r);break;case 4:Vh();break;case 13:rn(ln);break;case 19:rn(ln);break;case 10:ab(r.type._context);break;case 22:case 23:bb()}t=t.return}if(rr=n,Mn=n=pu(n.current,null),pr=fi=e,Hn=0,op=null,xb=Uy=Wl=0,ei=Df=null,Cl!==null){for(e=0;e<Cl.length;e++)if(t=Cl[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var a=o.next;o.next=i,r.next=a}t.pending=r}Cl=null}return n}function dN(n,e){do{var t=Mn;try{if(ob(),Vv.current=wg,xg){for(var r=cn.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}xg=!1}if(Ul=0,tr=jn=cn=null,Af=!1,np=0,yb.current=null,t===null||t.return===null){Hn=1,op=e,Mn=null;break}e:{var o=n,a=t.return,s=t,u=e;if(e=pr,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=RT(a);if(f!==null){f.flags&=-257,kT(f,a,s,o,e),f.mode&1&&ST(o,l,e),e=f,u=l;var p=e.updateQueue;if(p===null){var m=new Set;m.add(u),e.updateQueue=m}else p.add(u);break e}else{if(!(e&1)){ST(o,l,e),Eb();break e}u=Error(xe(426))}}else if(an&&s.mode&1){var g=RT(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),kT(g,a,s,o,e),rb(Uh(u,s));break e}}o=u=Uh(u,s),Hn!==4&&(Hn=2),Df===null?Df=[o]:Df.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var y=XA(o,u,e);_T(o,y);break e;case 1:s=u;var x=o.type,_=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(du===null||!du.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e;var b=QA(o,s,e);_T(o,b);break e}}o=o.return}while(o!==null)}mN(t)}catch(C){e=C,Mn===t&&t!==null&&(Mn=t=t.return);continue}break}while(!0)}function fN(){var n=_g.current;return _g.current=wg,n===null?wg:n}function Eb(){(Hn===0||Hn===3||Hn===2)&&(Hn=4),rr===null||!(Wl&268435455)&&!(Uy&268435455)||Xs(rr,pr)}function Cg(n,e){var t=St;St|=2;var r=fN();(rr!==n||pr!==e)&&(Fa=null,Nl(n,e));do try{aU();break}catch(i){dN(n,i)}while(!0);if(ob(),St=t,_g.current=r,Mn!==null)throw Error(xe(261));return rr=null,pr=0,Hn}function aU(){for(;Mn!==null;)pN(Mn)}function sU(){for(;Mn!==null&&!DB();)pN(Mn)}function pN(n){var e=gN(n.alternate,n,fi);n.memoizedProps=n.pendingProps,e===null?mN(n):Mn=e,yb.current=null}function mN(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=eU(t,e),t!==null){t.flags&=32767,Mn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Hn=6,Mn=null;return}}else if(t=ZV(t,e,fi),t!==null){Mn=t;return}if(e=e.sibling,e!==null){Mn=e;return}Mn=e=n}while(e!==null);Hn===0&&(Hn=5)}function ml(n,e,t){var r=Wt,i=Ki.transition;try{Ki.transition=null,Wt=1,uU(n,e,t,r)}finally{Ki.transition=i,Wt=r}return null}function uU(n,e,t,r){do xh();while(eu!==null);if(St&6)throw Error(xe(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(xe(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(jB(n,o),n===rr&&(Mn=rr=null,pr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||ov||(ov=!0,yN(og,function(){return xh(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=Ki.transition,Ki.transition=null;var a=Wt;Wt=1;var s=St;St|=4,yb.current=null,nU(n,t),lN(t,n),RV(Gx),sg=!!Hx,Gx=Hx=null,n.current=t,rU(t),PB(),St=s,Wt=a,Ki.transition=o}else n.current=t;if(ov&&(ov=!1,eu=n,Eg=i),o=n.pendingLanes,o===0&&(du=null),FB(t.stateNode),oi(n,Rn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(bg)throw bg=!1,n=dw,dw=null,n;return Eg&1&&n.tag!==0&&xh(),o=n.pendingLanes,o&1?n===fw?Pf++:(Pf=0,fw=n):Pf=0,Bu(),null}function xh(){if(eu!==null){var n=Xk(Eg),e=Ki.transition,t=Wt;try{if(Ki.transition=null,Wt=16>n?16:n,eu===null)var r=!1;else{if(n=eu,eu=null,Eg=0,St&6)throw Error(xe(331));var i=St;for(St|=4,Ae=n.current;Ae!==null;){var o=Ae,a=o.child;if(Ae.flags&16){var s=o.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(Ae=l;Ae!==null;){var c=Ae;switch(c.tag){case 0:case 11:case 15:Nf(8,c,o)}var h=c.child;if(h!==null)h.return=c,Ae=h;else for(;Ae!==null;){c=Ae;var d=c.sibling,f=c.return;if(aN(c),c===l){Ae=null;break}if(d!==null){d.return=f,Ae=d;break}Ae=f}}}var p=o.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}Ae=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,Ae=a;else e:for(;Ae!==null;){if(o=Ae,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Nf(9,o,o.return)}var y=o.sibling;if(y!==null){y.return=o.return,Ae=y;break e}Ae=o.return}}var x=n.current;for(Ae=x;Ae!==null;){a=Ae;var _=a.child;if(a.subtreeFlags&2064&&_!==null)_.return=a,Ae=_;else e:for(a=x;Ae!==null;){if(s=Ae,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Vy(9,s)}}catch(C){_n(s,s.return,C)}if(s===a){Ae=null;break e}var b=s.sibling;if(b!==null){b.return=s.return,Ae=b;break e}Ae=s.return}}if(St=i,Bu(),ra&&typeof ra.onPostCommitFiberRoot=="function")try{ra.onPostCommitFiberRoot(Ny,n)}catch{}r=!0}return r}finally{Wt=t,Ki.transition=e}}return!1}function jT(n,e,t){e=Uh(t,e),e=XA(n,e,1),n=hu(n,e,1),e=zr(),n!==null&&(Sp(n,1,e),oi(n,e))}function _n(n,e,t){if(n.tag===3)jT(n,n,t);else for(;e!==null;){if(e.tag===3){jT(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(du===null||!du.has(r))){n=Uh(t,n),n=QA(e,n,1),e=hu(e,n,1),n=zr(),e!==null&&(Sp(e,1,n),oi(e,n));break}}e=e.return}}function lU(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=zr(),n.pingedLanes|=n.suspendedLanes&t,rr===n&&(pr&t)===t&&(Hn===4||Hn===3&&(pr&130023424)===pr&&500>Rn()-wb?Nl(n,0):xb|=t),oi(n,e)}function vN(n,e){e===0&&(n.mode&1?(e=Xm,Xm<<=1,!(Xm&130023424)&&(Xm=4194304)):e=1);var t=zr();n=ns(n,e),n!==null&&(Sp(n,e,t),oi(n,t))}function cU(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),vN(n,t)}function hU(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(xe(314))}r!==null&&r.delete(e),vN(n,t)}var gN;gN=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||ri.current)ni=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return ni=!1,JV(n,e,t);ni=!!(n.flags&131072)}else ni=!1,an&&e.flags&1048576&&_A(e,pg,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Wv(n,e),n=e.pendingProps;var i=Fh(e,Pr.current);yh(e,t),i=fb(null,e,r,n,i,t);var o=pb();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ii(r)?(o=!0,dg(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,ub(e),i.updater=By,e.stateNode=i,i._reactInternals=e,tw(e,r,n,t),e=iw(null,e,r,!0,o,t)):(e.tag=0,an&&o&&tb(e),Vr(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Wv(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=fU(r),n=go(r,n),i){case 0:e=rw(null,e,r,n,t);break e;case 1:e=DT(null,e,r,n,t);break e;case 11:e=AT(null,e,r,n,t);break e;case 14:e=NT(null,e,r,go(r.type,n),t);break e}throw Error(xe(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:go(r,i),rw(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:go(r,i),DT(n,e,r,i,t);case 3:e:{if(eN(e),n===null)throw Error(xe(387));r=e.pendingProps,o=e.memoizedState,i=o.element,SA(n,e),gg(e,r,null,t);var a=e.memoizedState;if(r=a.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=Uh(Error(xe(423)),e),e=PT(n,e,r,t,i);break e}else if(r!==i){i=Uh(Error(xe(424)),e),e=PT(n,e,r,t,i);break e}else for(wi=cu(e.stateNode.containerInfo.firstChild),Ci=e,an=!0,xo=null,t=TA(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Lh(),r===i){e=rs(n,e,t);break e}Vr(n,e,r,t)}e=e.child}return e;case 5:return RA(e),n===null&&Jx(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,a=i.children,qx(r,i)?a=null:o!==null&&qx(r,o)&&(e.flags|=32),ZA(n,e),Vr(n,e,a,t),e.child;case 6:return n===null&&Jx(e),null;case 13:return tN(n,e,t);case 4:return lb(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Bh(e,null,r,t):Vr(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:go(r,i),AT(n,e,r,i,t);case 7:return Vr(n,e,e.pendingProps,t),e.child;case 8:return Vr(n,e,e.pendingProps.children,t),e.child;case 12:return Vr(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,a=i.value,Zt(mg,r._currentValue),r._currentValue=a,o!==null)if(Ao(o.value,a)){if(o.children===i.children&&!ri.current){e=rs(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(o.tag===1){u=Qa(-1,t&-t),u.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}o.lanes|=t,u=o.alternate,u!==null&&(u.lanes|=t),Zx(o.return,t,e),s.lanes|=t;break}u=u.next}}else if(o.tag===10)a=o.type===e.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(xe(341));a.lanes|=t,s=a.alternate,s!==null&&(s.lanes|=t),Zx(a,t,e),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}Vr(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,yh(e,t),i=Qi(i),r=r(i),e.flags|=1,Vr(n,e,r,t),e.child;case 14:return r=e.type,i=go(r,e.pendingProps),i=go(r.type,i),NT(n,e,r,i,t);case 15:return YA(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:go(r,i),Wv(n,e),e.tag=1,ii(r)?(n=!0,dg(e)):n=!1,yh(e,t),KA(e,r,i),tw(e,r,i,t),iw(null,e,r,!0,n,t);case 19:return nN(n,e,t);case 22:return JA(n,e,t)}throw Error(xe(156,e.tag))};function yN(n,e){return Hk(n,e)}function dU(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $i(n,e,t,r){return new dU(n,e,t,r)}function Cb(n){return n=n.prototype,!(!n||!n.isReactComponent)}function fU(n){if(typeof n=="function")return Cb(n)?1:0;if(n!=null){if(n=n.$$typeof,n===z_)return 11;if(n===$_)return 14}return 2}function pu(n,e){var t=n.alternate;return t===null?(t=$i(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function $v(n,e,t,r,i,o){var a=2;if(r=n,typeof n=="function")Cb(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case nh:return Dl(t.children,i,o,e);case j_:a=8,i|=8;break;case Tx:return n=$i(12,t,e,i|2),n.elementType=Tx,n.lanes=o,n;case Ix:return n=$i(13,t,e,i),n.elementType=Ix,n.lanes=o,n;case Sx:return n=$i(19,t,e,i),n.elementType=Sx,n.lanes=o,n;case Rk:return Wy(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Ik:a=10;break e;case Sk:a=9;break e;case z_:a=11;break e;case $_:a=14;break e;case $s:a=16,r=null;break e}throw Error(xe(130,n==null?n:typeof n,""))}return e=$i(a,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function Dl(n,e,t,r){return n=$i(7,n,r,e),n.lanes=t,n}function Wy(n,e,t,r){return n=$i(22,n,r,e),n.elementType=Rk,n.lanes=t,n.stateNode={isHidden:!1},n}function b1(n,e,t){return n=$i(6,n,null,e),n.lanes=t,n}function E1(n,e,t){return e=$i(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function pU(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=r1(0),this.expirationTimes=r1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=r1(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Tb(n,e,t,r,i,o,a,s,u){return n=new pU(n,e,t,s,u),e===1?(e=1,o===!0&&(e|=8)):e=0,o=$i(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},ub(o),n}function mU(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:th,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function xN(n){if(!n)return Cu;n=n._reactInternals;e:{if(tc(n)!==n||n.tag!==1)throw Error(xe(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ii(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(xe(171))}if(n.tag===1){var t=n.type;if(ii(t))return xA(n,t,e)}return e}function wN(n,e,t,r,i,o,a,s,u){return n=Tb(t,r,!0,n,i,o,a,s,u),n.context=xN(null),t=n.current,r=zr(),i=fu(t),o=Qa(r,i),o.callback=e??null,hu(t,o,i),n.current.lanes=i,Sp(n,i,r),oi(n,r),n}function jy(n,e,t,r){var i=e.current,o=zr(),a=fu(i);return t=xN(t),e.context===null?e.context=t:e.pendingContext=t,e=Qa(o,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=hu(i,e,a),n!==null&&(To(n,i,a,o),Bv(n,i,a)),a}function Tg(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function zT(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Ib(n,e){zT(n,e),(n=n.alternate)&&zT(n,e)}function vU(){return null}var _N=typeof reportError=="function"?reportError:function(n){console.error(n)};function Sb(n){this._internalRoot=n}zy.prototype.render=Sb.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(xe(409));jy(n,e,null,null)};zy.prototype.unmount=Sb.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;jl(function(){jy(null,n,null,null)}),e[ts]=null}};function zy(n){this._internalRoot=n}zy.prototype.unstable_scheduleHydration=function(n){if(n){var e=Jk();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ks.length&&e!==0&&e<Ks[t].priority;t++);Ks.splice(t,0,n),t===0&&eA(n)}};function Rb(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function $y(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function $T(){}function gU(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var l=Tg(a);o.call(l)}}var a=wN(e,r,n,0,null,!1,!1,"",$T);return n._reactRootContainer=a,n[ts]=a.current,Yf(n.nodeType===8?n.parentNode:n),jl(),a}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var l=Tg(u);s.call(l)}}var u=Tb(n,0,!1,null,null,!1,!1,"",$T);return n._reactRootContainer=u,n[ts]=u.current,Yf(n.nodeType===8?n.parentNode:n),jl(function(){jy(e,u,t,r)}),u}function Hy(n,e,t,r,i){var o=t._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var u=Tg(a);s.call(u)}}jy(e,a,n,i)}else a=gU(t,e,n,i,r);return Tg(a)}Qk=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=vf(e.pendingLanes);t!==0&&(q_(e,t|1),oi(e,Rn()),!(St&6)&&(Wh=Rn()+500,Bu()))}break;case 13:jl(function(){var r=ns(n,1);if(r!==null){var i=zr();To(r,n,1,i)}}),Ib(n,1)}};K_=function(n){if(n.tag===13){var e=ns(n,134217728);if(e!==null){var t=zr();To(e,n,134217728,t)}Ib(n,134217728)}};Yk=function(n){if(n.tag===13){var e=fu(n),t=ns(n,e);if(t!==null){var r=zr();To(t,n,e,r)}Ib(n,e)}};Jk=function(){return Wt};Zk=function(n,e){var t=Wt;try{return Wt=n,e()}finally{Wt=t}};Lx=function(n,e,t){switch(e){case"input":if(Ax(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=My(r);if(!i)throw Error(xe(90));Ak(r),Ax(r,i)}}}break;case"textarea":Dk(n,t);break;case"select":e=t.value,e!=null&&ph(n,!!t.multiple,e,!1)}};Vk=_b;Uk=jl;var yU={usingClientEntryPoint:!1,Events:[kp,ah,My,Lk,Bk,_b]},sf={findFiberByHostInstance:El,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},xU={bundleType:sf.bundleType,version:sf.version,rendererPackageName:sf.rendererPackageName,rendererConfig:sf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:cs.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=zk(n),n===null?null:n.stateNode},findFiberByHostInstance:sf.findFiberByHostInstance||vU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var av=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!av.isDisabled&&av.supportsFiber)try{Ny=av.inject(xU),ra=av}catch{}}Si.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yU;Si.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rb(e))throw Error(xe(200));return mU(n,e,null,t)};Si.createRoot=function(n,e){if(!Rb(n))throw Error(xe(299));var t=!1,r="",i=_N;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Tb(n,1,!1,null,null,t,!1,r,i),n[ts]=e.current,Yf(n.nodeType===8?n.parentNode:n),new Sb(e)};Si.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(xe(188)):(n=Object.keys(n).join(","),Error(xe(268,n)));return n=zk(e),n=n===null?null:n.stateNode,n};Si.flushSync=function(n){return jl(n)};Si.hydrate=function(n,e,t){if(!$y(e))throw Error(xe(200));return Hy(null,n,e,!0,t)};Si.hydrateRoot=function(n,e,t){if(!Rb(n))throw Error(xe(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",a=_N;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=wN(e,null,n,1,t??null,i,!1,o,a),n[ts]=e.current,Yf(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new zy(e)};Si.render=function(n,e,t){if(!$y(e))throw Error(xe(200));return Hy(null,n,e,!1,t)};Si.unmountComponentAtNode=function(n){if(!$y(n))throw Error(xe(40));return n._reactRootContainer?(jl(function(){Hy(null,null,n,!1,function(){n._reactRootContainer=null,n[ts]=null})}),!0):!1};Si.unstable_batchedUpdates=_b;Si.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!$y(t))throw Error(xe(200));if(n==null||n._reactInternals===void 0)throw Error(xe(38));return Hy(n,e,t,!1,r)};Si.version="18.3.1-next-f1338f8080-20240426";function bN(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bN)}catch(n){console.error(n)}}bN(),bk.exports=Si;var wU=bk.exports,EN,HT=wU;EN=HT.createRoot,HT.hydrateRoot;var _U={exports:{}};/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(n,e){(function(t,r){n.exports=r()})(GL,function(){const t=new Map,r={set(F,w,A){t.has(F)||t.set(F,new Map);const L=t.get(F);L.has(w)||L.size===0?L.set(w,A):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(L.keys())[0]}.`)},get:(F,w)=>t.has(F)&&t.get(F).get(w)||null,remove(F,w){if(!t.has(F))return;const A=t.get(F);A.delete(w),A.size===0&&t.delete(F)}},i="transitionend",o=F=>(F&&window.CSS&&window.CSS.escape&&(F=F.replace(/#([^\s"#']+)/g,(w,A)=>`#${CSS.escape(A)}`)),F),a=F=>{F.dispatchEvent(new Event(i))},s=F=>!(!F||typeof F!="object")&&(F.jquery!==void 0&&(F=F[0]),F.nodeType!==void 0),u=F=>s(F)?F.jquery?F[0]:F:typeof F=="string"&&F.length>0?document.querySelector(o(F)):null,l=F=>{if(!s(F)||F.getClientRects().length===0)return!1;const w=getComputedStyle(F).getPropertyValue("visibility")==="visible",A=F.closest("details:not([open])");if(!A)return w;if(A!==F){const L=F.closest("summary");if(L&&L.parentNode!==A||L===null)return!1}return w},c=F=>!F||F.nodeType!==Node.ELEMENT_NODE||!!F.classList.contains("disabled")||(F.disabled!==void 0?F.disabled:F.hasAttribute("disabled")&&F.getAttribute("disabled")!=="false"),h=F=>{if(!document.documentElement.attachShadow)return null;if(typeof F.getRootNode=="function"){const w=F.getRootNode();return w instanceof ShadowRoot?w:null}return F instanceof ShadowRoot?F:F.parentNode?h(F.parentNode):null},d=()=>{},f=F=>{F.offsetHeight},p=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,m=[],g=()=>document.documentElement.dir==="rtl",y=F=>{var w;w=()=>{const A=p();if(A){const L=F.NAME,Z=A.fn[L];A.fn[L]=F.jQueryInterface,A.fn[L].Constructor=F,A.fn[L].noConflict=()=>(A.fn[L]=Z,F.jQueryInterface)}},document.readyState==="loading"?(m.length||document.addEventListener("DOMContentLoaded",()=>{for(const A of m)A()}),m.push(w)):w()},x=(F,w=[],A=F)=>typeof F=="function"?F(...w):A,_=(F,w,A=!0)=>{if(!A)return void x(F);const L=(ae=>{if(!ae)return 0;let{transitionDuration:me,transitionDelay:be}=window.getComputedStyle(ae);const ke=Number.parseFloat(me),Ne=Number.parseFloat(be);return ke||Ne?(me=me.split(",")[0],be=be.split(",")[0],1e3*(Number.parseFloat(me)+Number.parseFloat(be))):0})(w)+5;let Z=!1;const te=({target:ae})=>{ae===w&&(Z=!0,w.removeEventListener(i,te),x(F))};w.addEventListener(i,te),setTimeout(()=>{Z||a(w)},L)},b=(F,w,A,L)=>{const Z=F.length;let te=F.indexOf(w);return te===-1?!A&&L?F[Z-1]:F[0]:(te+=A?1:-1,L&&(te=(te+Z)%Z),F[Math.max(0,Math.min(te,Z-1))])},C=/[^.]*(?=\..*)\.|.*/,k=/\..*/,T=/::\d+$/,E={};let I=1;const R={mouseenter:"mouseover",mouseleave:"mouseout"},N=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function O(F,w){return w&&`${w}::${I++}`||F.uidEvent||I++}function M(F){const w=O(F);return F.uidEvent=w,E[w]=E[w]||{},E[w]}function q(F,w,A=null){return Object.values(F).find(L=>L.callable===w&&L.delegationSelector===A)}function J(F,w,A){const L=typeof w=="string",Z=L?A:w||A;let te=K(F);return N.has(te)||(te=F),[L,Z,te]}function ee(F,w,A,L,Z){if(typeof w!="string"||!F)return;let[te,ae,me]=J(w,A,L);w in R&&(ae=(nt=>function(Ye){if(!Ye.relatedTarget||Ye.relatedTarget!==Ye.delegateTarget&&!Ye.delegateTarget.contains(Ye.relatedTarget))return nt.call(this,Ye)})(ae));const be=M(F),ke=be[me]||(be[me]={}),Ne=q(ke,ae,te?A:null);if(Ne)return void(Ne.oneOff=Ne.oneOff&&Z);const Se=O(ae,w.replace(C,"")),at=te?function(qe,nt,Ye){return function rt(zt){const Qt=qe.querySelectorAll(nt);for(let{target:ft}=zt;ft&&ft!==this;ft=ft.parentNode)for(const Dt of Qt)if(Dt===ft)return ue(zt,{delegateTarget:ft}),rt.oneOff&&j.off(qe,zt.type,nt,Ye),Ye.apply(ft,[zt])}}(F,A,ae):function(qe,nt){return function Ye(rt){return ue(rt,{delegateTarget:qe}),Ye.oneOff&&j.off(qe,rt.type,nt),nt.apply(qe,[rt])}}(F,ae);at.delegationSelector=te?A:null,at.callable=ae,at.oneOff=Z,at.uidEvent=Se,ke[Se]=at,F.addEventListener(me,at,te)}function Q(F,w,A,L,Z){const te=q(w[A],L,Z);te&&(F.removeEventListener(A,te,!!Z),delete w[A][te.uidEvent])}function $(F,w,A,L){const Z=w[A]||{};for(const[te,ae]of Object.entries(Z))te.includes(L)&&Q(F,w,A,ae.callable,ae.delegationSelector)}function K(F){return F=F.replace(k,""),R[F]||F}const j={on(F,w,A,L){ee(F,w,A,L,!1)},one(F,w,A,L){ee(F,w,A,L,!0)},off(F,w,A,L){if(typeof w!="string"||!F)return;const[Z,te,ae]=J(w,A,L),me=ae!==w,be=M(F),ke=be[ae]||{},Ne=w.startsWith(".");if(te===void 0){if(Ne)for(const Se of Object.keys(be))$(F,be,Se,w.slice(1));for(const[Se,at]of Object.entries(ke)){const qe=Se.replace(T,"");me&&!w.includes(qe)||Q(F,be,ae,at.callable,at.delegationSelector)}}else{if(!Object.keys(ke).length)return;Q(F,be,ae,te,Z?A:null)}},trigger(F,w,A){if(typeof w!="string"||!F)return null;const L=p();let Z=null,te=!0,ae=!0,me=!1;w!==K(w)&&L&&(Z=L.Event(w,A),L(F).trigger(Z),te=!Z.isPropagationStopped(),ae=!Z.isImmediatePropagationStopped(),me=Z.isDefaultPrevented());const be=ue(new Event(w,{bubbles:te,cancelable:!0}),A);return me&&be.preventDefault(),ae&&F.dispatchEvent(be),be.defaultPrevented&&Z&&Z.preventDefault(),be}};function ue(F,w={}){for(const[A,L]of Object.entries(w))try{F[A]=L}catch{Object.defineProperty(F,A,{configurable:!0,get:()=>L})}return F}function he(F){if(F==="true")return!0;if(F==="false")return!1;if(F===Number(F).toString())return Number(F);if(F===""||F==="null")return null;if(typeof F!="string")return F;try{return JSON.parse(decodeURIComponent(F))}catch{return F}}function ve(F){return F.replace(/[A-Z]/g,w=>`-${w.toLowerCase()}`)}const we={setDataAttribute(F,w,A){F.setAttribute(`data-bs-${ve(w)}`,A)},removeDataAttribute(F,w){F.removeAttribute(`data-bs-${ve(w)}`)},getDataAttributes(F){if(!F)return{};const w={},A=Object.keys(F.dataset).filter(L=>L.startsWith("bs")&&!L.startsWith("bsConfig"));for(const L of A){let Z=L.replace(/^bs/,"");Z=Z.charAt(0).toLowerCase()+Z.slice(1,Z.length),w[Z]=he(F.dataset[L])}return w},getDataAttribute:(F,w)=>he(F.getAttribute(`data-bs-${ve(w)}`))};class Ee{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(w){return w=this._mergeConfigObj(w),w=this._configAfterMerge(w),this._typeCheckConfig(w),w}_configAfterMerge(w){return w}_mergeConfigObj(w,A){const L=s(A)?we.getDataAttribute(A,"config"):{};return{...this.constructor.Default,...typeof L=="object"?L:{},...s(A)?we.getDataAttributes(A):{},...typeof w=="object"?w:{}}}_typeCheckConfig(w,A=this.constructor.DefaultType){for(const[Z,te]of Object.entries(A)){const ae=w[Z],me=s(ae)?"element":(L=ae)==null?`${L}`:Object.prototype.toString.call(L).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(te).test(me))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Z}" provided type "${me}" but expected type "${te}".`)}var L}}class Ce extends Ee{constructor(w,A){super(),(w=u(w))&&(this._element=w,this._config=this._getConfig(A),r.set(this._element,this.constructor.DATA_KEY,this))}dispose(){r.remove(this._element,this.constructor.DATA_KEY),j.off(this._element,this.constructor.EVENT_KEY);for(const w of Object.getOwnPropertyNames(this))this[w]=null}_queueCallback(w,A,L=!0){_(w,A,L)}_getConfig(w){return w=this._mergeConfigObj(w,this._element),w=this._configAfterMerge(w),this._typeCheckConfig(w),w}static getInstance(w){return r.get(u(w),this.DATA_KEY)}static getOrCreateInstance(w,A={}){return this.getInstance(w)||new this(w,typeof A=="object"?A:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(w){return`${w}${this.EVENT_KEY}`}}const Ie=F=>{let w=F.getAttribute("data-bs-target");if(!w||w==="#"){let A=F.getAttribute("href");if(!A||!A.includes("#")&&!A.startsWith("."))return null;A.includes("#")&&!A.startsWith("#")&&(A=`#${A.split("#")[1]}`),w=A&&A!=="#"?A.trim():null}return w?w.split(",").map(A=>o(A)).join(","):null},ce={find:(F,w=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(w,F)),findOne:(F,w=document.documentElement)=>Element.prototype.querySelector.call(w,F),children:(F,w)=>[].concat(...F.children).filter(A=>A.matches(w)),parents(F,w){const A=[];let L=F.parentNode.closest(w);for(;L;)A.push(L),L=L.parentNode.closest(w);return A},prev(F,w){let A=F.previousElementSibling;for(;A;){if(A.matches(w))return[A];A=A.previousElementSibling}return[]},next(F,w){let A=F.nextElementSibling;for(;A;){if(A.matches(w))return[A];A=A.nextElementSibling}return[]},focusableChildren(F){const w=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(A=>`${A}:not([tabindex^="-"])`).join(",");return this.find(w,F).filter(A=>!c(A)&&l(A))},getSelectorFromElement(F){const w=Ie(F);return w&&ce.findOne(w)?w:null},getElementFromSelector(F){const w=Ie(F);return w?ce.findOne(w):null},getMultipleElementsFromSelector(F){const w=Ie(F);return w?ce.find(w):[]}},Ue=(F,w="hide")=>{const A=`click.dismiss${F.EVENT_KEY}`,L=F.NAME;j.on(document,A,`[data-bs-dismiss="${L}"]`,function(Z){if(["A","AREA"].includes(this.tagName)&&Z.preventDefault(),c(this))return;const te=ce.getElementFromSelector(this)||this.closest(`.${L}`);F.getOrCreateInstance(te)[w]()})},je=".bs.alert",Be=`close${je}`,Ge=`closed${je}`;class We extends Ce{static get NAME(){return"alert"}close(){if(j.trigger(this._element,Be).defaultPrevented)return;this._element.classList.remove("show");const w=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,w)}_destroyElement(){this._element.remove(),j.trigger(this._element,Ge),this.dispose()}static jQueryInterface(w){return this.each(function(){const A=We.getOrCreateInstance(this);if(typeof w=="string"){if(A[w]===void 0||w.startsWith("_")||w==="constructor")throw new TypeError(`No method named "${w}"`);A[w](this)}})}}Ue(We,"close"),y(We);const ut='[data-bs-toggle="button"]';class ot extends Ce{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(w){return this.each(function(){const A=ot.getOrCreateInstance(this);w==="toggle"&&A[w]()})}}j.on(document,"click.bs.button.data-api",ut,F=>{F.preventDefault();const w=F.target.closest(ut);ot.getOrCreateInstance(w).toggle()}),y(ot);const dt=".bs.swipe",Yn=`touchstart${dt}`,En=`touchmove${dt}`,sn=`touchend${dt}`,Ln=`pointerdown${dt}`,Cn=`pointerup${dt}`,Bn={endCallback:null,leftCallback:null,rightCallback:null},ar={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Nn extends Ee{constructor(w,A){super(),this._element=w,w&&Nn.isSupported()&&(this._config=this._getConfig(A),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Bn}static get DefaultType(){return ar}static get NAME(){return"swipe"}dispose(){j.off(this._element,dt)}_start(w){this._supportPointerEvents?this._eventIsPointerPenTouch(w)&&(this._deltaX=w.clientX):this._deltaX=w.touches[0].clientX}_end(w){this._eventIsPointerPenTouch(w)&&(this._deltaX=w.clientX-this._deltaX),this._handleSwipe(),x(this._config.endCallback)}_move(w){this._deltaX=w.touches&&w.touches.length>1?0:w.touches[0].clientX-this._deltaX}_handleSwipe(){const w=Math.abs(this._deltaX);if(w<=40)return;const A=w/this._deltaX;this._deltaX=0,A&&x(A>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(j.on(this._element,Ln,w=>this._start(w)),j.on(this._element,Cn,w=>this._end(w)),this._element.classList.add("pointer-event")):(j.on(this._element,Yn,w=>this._start(w)),j.on(this._element,En,w=>this._move(w)),j.on(this._element,sn,w=>this._end(w)))}_eventIsPointerPenTouch(w){return this._supportPointerEvents&&(w.pointerType==="pen"||w.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const un=".bs.carousel",tn=".data-api",Tt="next",pn="prev",li="left",ba="right",Rd=`slide${un}`,oo=`slid${un}`,Es=`keydown${un}`,Cs=`mouseenter${un}`,Ea=`mouseleave${un}`,O0=`dragstart${un}`,M0=`load${un}${tn}`,kd=`click${un}${tn}`,Ad="carousel",Xu="active",Ts=".active",wc=".carousel-item",Nd=Ts+wc,Ca={ArrowLeft:ba,ArrowRight:li},pm={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},_c={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Ta extends Ce{constructor(w,A){super(w,A),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=ce.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===Ad&&this.cycle()}static get Default(){return pm}static get DefaultType(){return _c}static get NAME(){return"carousel"}next(){this._slide(Tt)}nextWhenVisible(){!document.hidden&&l(this._element)&&this.next()}prev(){this._slide(pn)}pause(){this._isSliding&&a(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?j.one(this._element,oo,()=>this.cycle()):this.cycle())}to(w){const A=this._getItems();if(w>A.length-1||w<0)return;if(this._isSliding)return void j.one(this._element,oo,()=>this.to(w));const L=this._getItemIndex(this._getActive());if(L===w)return;const Z=w>L?Tt:pn;this._slide(Z,A[w])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(w){return w.defaultInterval=w.interval,w}_addEventListeners(){this._config.keyboard&&j.on(this._element,Es,w=>this._keydown(w)),this._config.pause==="hover"&&(j.on(this._element,Cs,()=>this.pause()),j.on(this._element,Ea,()=>this._maybeEnableCycle())),this._config.touch&&Nn.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const A of ce.find(".carousel-item img",this._element))j.on(A,O0,L=>L.preventDefault());const w={leftCallback:()=>this._slide(this._directionToOrder(li)),rightCallback:()=>this._slide(this._directionToOrder(ba)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new Nn(this._element,w)}_keydown(w){if(/input|textarea/i.test(w.target.tagName))return;const A=Ca[w.key];A&&(w.preventDefault(),this._slide(this._directionToOrder(A)))}_getItemIndex(w){return this._getItems().indexOf(w)}_setActiveIndicatorElement(w){if(!this._indicatorsElement)return;const A=ce.findOne(Ts,this._indicatorsElement);A.classList.remove(Xu),A.removeAttribute("aria-current");const L=ce.findOne(`[data-bs-slide-to="${w}"]`,this._indicatorsElement);L&&(L.classList.add(Xu),L.setAttribute("aria-current","true"))}_updateInterval(){const w=this._activeElement||this._getActive();if(!w)return;const A=Number.parseInt(w.getAttribute("data-bs-interval"),10);this._config.interval=A||this._config.defaultInterval}_slide(w,A=null){if(this._isSliding)return;const L=this._getActive(),Z=w===Tt,te=A||b(this._getItems(),L,Z,this._config.wrap);if(te===L)return;const ae=this._getItemIndex(te),me=Se=>j.trigger(this._element,Se,{relatedTarget:te,direction:this._orderToDirection(w),from:this._getItemIndex(L),to:ae});if(me(Rd).defaultPrevented||!L||!te)return;const be=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(ae),this._activeElement=te;const ke=Z?"carousel-item-start":"carousel-item-end",Ne=Z?"carousel-item-next":"carousel-item-prev";te.classList.add(Ne),f(te),L.classList.add(ke),te.classList.add(ke),this._queueCallback(()=>{te.classList.remove(ke,Ne),te.classList.add(Xu),L.classList.remove(Xu,Ne,ke),this._isSliding=!1,me(oo)},L,this._isAnimated()),be&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return ce.findOne(Nd,this._element)}_getItems(){return ce.find(wc,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(w){return g()?w===li?pn:Tt:w===li?Tt:pn}_orderToDirection(w){return g()?w===pn?li:ba:w===pn?ba:li}static jQueryInterface(w){return this.each(function(){const A=Ta.getOrCreateInstance(this,w);if(typeof w!="number"){if(typeof w=="string"){if(A[w]===void 0||w.startsWith("_")||w==="constructor")throw new TypeError(`No method named "${w}"`);A[w]()}}else A.to(w)})}}j.on(document,kd,"[data-bs-slide], [data-bs-slide-to]",function(F){const w=ce.getElementFromSelector(this);if(!w||!w.classList.contains(Ad))return;F.preventDefault();const A=Ta.getOrCreateInstance(w),L=this.getAttribute("data-bs-slide-to");return L?(A.to(L),void A._maybeEnableCycle()):we.getDataAttribute(this,"slide")==="next"?(A.next(),void A._maybeEnableCycle()):(A.prev(),void A._maybeEnableCycle())}),j.on(window,M0,()=>{const F=ce.find('[data-bs-ride="carousel"]');for(const w of F)Ta.getOrCreateInstance(w)}),y(Ta);const ao=".bs.collapse",mm=`show${ao}`,sr=`shown${ao}`,vm=`hide${ao}`,Qu=`hidden${ao}`,Yu=`click${ao}.data-api`,Dd="show",Is="collapse",so="collapsing",F0=`:scope .${Is} .${Is}`,Pd='[data-bs-toggle="collapse"]',bc={parent:null,toggle:!0},gm={parent:"(null|element)",toggle:"boolean"};class Oo extends Ce{constructor(w,A){super(w,A),this._isTransitioning=!1,this._triggerArray=[];const L=ce.find(Pd);for(const Z of L){const te=ce.getSelectorFromElement(Z),ae=ce.find(te).filter(me=>me===this._element);te!==null&&ae.length&&this._triggerArray.push(Z)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return bc}static get DefaultType(){return gm}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let w=[];if(this._config.parent&&(w=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(Z=>Z!==this._element).map(Z=>Oo.getOrCreateInstance(Z,{toggle:!1}))),w.length&&w[0]._isTransitioning||j.trigger(this._element,mm).defaultPrevented)return;for(const Z of w)Z.hide();const A=this._getDimension();this._element.classList.remove(Is),this._element.classList.add(so),this._element.style[A]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const L=`scroll${A[0].toUpperCase()+A.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(so),this._element.classList.add(Is,Dd),this._element.style[A]="",j.trigger(this._element,sr)},this._element,!0),this._element.style[A]=`${this._element[L]}px`}hide(){if(this._isTransitioning||!this._isShown()||j.trigger(this._element,vm).defaultPrevented)return;const w=this._getDimension();this._element.style[w]=`${this._element.getBoundingClientRect()[w]}px`,f(this._element),this._element.classList.add(so),this._element.classList.remove(Is,Dd);for(const A of this._triggerArray){const L=ce.getElementFromSelector(A);L&&!this._isShown(L)&&this._addAriaAndCollapsedClass([A],!1)}this._isTransitioning=!0,this._element.style[w]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(so),this._element.classList.add(Is),j.trigger(this._element,Qu)},this._element,!0)}_isShown(w=this._element){return w.classList.contains(Dd)}_configAfterMerge(w){return w.toggle=!!w.toggle,w.parent=u(w.parent),w}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const w=this._getFirstLevelChildren(Pd);for(const A of w){const L=ce.getElementFromSelector(A);L&&this._addAriaAndCollapsedClass([A],this._isShown(L))}}_getFirstLevelChildren(w){const A=ce.find(F0,this._config.parent);return ce.find(w,this._config.parent).filter(L=>!A.includes(L))}_addAriaAndCollapsedClass(w,A){if(w.length)for(const L of w)L.classList.toggle("collapsed",!A),L.setAttribute("aria-expanded",A)}static jQueryInterface(w){const A={};return typeof w=="string"&&/show|hide/.test(w)&&(A.toggle=!1),this.each(function(){const L=Oo.getOrCreateInstance(this,A);if(typeof w=="string"){if(L[w]===void 0)throw new TypeError(`No method named "${w}"`);L[w]()}})}}j.on(document,Yu,Pd,function(F){(F.target.tagName==="A"||F.delegateTarget&&F.delegateTarget.tagName==="A")&&F.preventDefault();for(const w of ce.getMultipleElementsFromSelector(this))Oo.getOrCreateInstance(w,{toggle:!1}).toggle()}),y(Oo);var Dn="top",mn="bottom",xr="right",Jn="left",Ss="auto",Mo=[Dn,mn,xr,Jn],Fo="start",Ia="end",ym="clippingParents",Rs="viewport",Sa="popper",Ec="reference",Ra=Mo.reduce(function(F,w){return F.concat([w+"-"+Fo,w+"-"+Ia])},[]),uo=[].concat(Mo,[Ss]).reduce(function(F,w){return F.concat([w,w+"-"+Fo,w+"-"+Ia])},[]),Cc="beforeRead",xm="read",Od="afterRead",Md="beforeMain",Fd="main",Tc="afterMain",Ic="beforeWrite",Ld="write",Bd="afterWrite",wm=[Cc,xm,Od,Md,Fd,Tc,Ic,Ld,Bd];function ki(F){return F?(F.nodeName||"").toLowerCase():null}function wr(F){if(F==null)return window;if(F.toString()!=="[object Window]"){var w=F.ownerDocument;return w&&w.defaultView||window}return F}function Lo(F){return F instanceof wr(F).Element||F instanceof Element}function Kr(F){return F instanceof wr(F).HTMLElement||F instanceof HTMLElement}function lo(F){return typeof ShadowRoot<"u"&&(F instanceof wr(F).ShadowRoot||F instanceof ShadowRoot)}const ci={name:"applyStyles",enabled:!0,phase:"write",fn:function(F){var w=F.state;Object.keys(w.elements).forEach(function(A){var L=w.styles[A]||{},Z=w.attributes[A]||{},te=w.elements[A];Kr(te)&&ki(te)&&(Object.assign(te.style,L),Object.keys(Z).forEach(function(ae){var me=Z[ae];me===!1?te.removeAttribute(ae):te.setAttribute(ae,me===!0?"":me)}))})},effect:function(F){var w=F.state,A={popper:{position:w.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(w.elements.popper.style,A.popper),w.styles=A,w.elements.arrow&&Object.assign(w.elements.arrow.style,A.arrow),function(){Object.keys(w.elements).forEach(function(L){var Z=w.elements[L],te=w.attributes[L]||{},ae=Object.keys(w.styles.hasOwnProperty(L)?w.styles[L]:A[L]).reduce(function(me,be){return me[be]="",me},{});Kr(Z)&&ki(Z)&&(Object.assign(Z.style,ae),Object.keys(te).forEach(function(me){Z.removeAttribute(me)}))})}},requires:["computeStyles"]};function Fr(F){return F.split("-")[0]}var Ai=Math.max,Ju=Math.min,kt=Math.round;function ks(){var F=navigator.userAgentData;return F!=null&&F.brands&&Array.isArray(F.brands)?F.brands.map(function(w){return w.brand+"/"+w.version}).join(" "):navigator.userAgent}function As(){return!/^((?!chrome|android).)*safari/i.test(ks())}function Ni(F,w,A){w===void 0&&(w=!1),A===void 0&&(A=!1);var L=F.getBoundingClientRect(),Z=1,te=1;w&&Kr(F)&&(Z=F.offsetWidth>0&&kt(L.width)/F.offsetWidth||1,te=F.offsetHeight>0&&kt(L.height)/F.offsetHeight||1);var ae=(Lo(F)?wr(F):window).visualViewport,me=!As()&&A,be=(L.left+(me&&ae?ae.offsetLeft:0))/Z,ke=(L.top+(me&&ae?ae.offsetTop:0))/te,Ne=L.width/Z,Se=L.height/te;return{width:Ne,height:Se,top:ke,right:be+Ne,bottom:ke+Se,left:be,x:be,y:ke}}function Vd(F){var w=Ni(F),A=F.offsetWidth,L=F.offsetHeight;return Math.abs(w.width-A)<=1&&(A=w.width),Math.abs(w.height-L)<=1&&(L=w.height),{x:F.offsetLeft,y:F.offsetTop,width:A,height:L}}function Ud(F,w){var A=w.getRootNode&&w.getRootNode();if(F.contains(w))return!0;if(A&&lo(A)){var L=w;do{if(L&&F.isSameNode(L))return!0;L=L.parentNode||L.host}while(L)}return!1}function co(F){return wr(F).getComputedStyle(F)}function L0(F){return["table","td","th"].indexOf(ki(F))>=0}function Bo(F){return((Lo(F)?F.ownerDocument:F.document)||window.document).documentElement}function Sc(F){return ki(F)==="html"?F:F.assignedSlot||F.parentNode||(lo(F)?F.host:null)||Bo(F)}function Ns(F){return Kr(F)&&co(F).position!=="fixed"?F.offsetParent:null}function Xr(F){for(var w=wr(F),A=Ns(F);A&&L0(A)&&co(A).position==="static";)A=Ns(A);return A&&(ki(A)==="html"||ki(A)==="body"&&co(A).position==="static")?w:A||function(L){var Z=/firefox/i.test(ks());if(/Trident/i.test(ks())&&Kr(L)&&co(L).position==="fixed")return null;var te=Sc(L);for(lo(te)&&(te=te.host);Kr(te)&&["html","body"].indexOf(ki(te))<0;){var ae=co(te);if(ae.transform!=="none"||ae.perspective!=="none"||ae.contain==="paint"||["transform","perspective"].indexOf(ae.willChange)!==-1||Z&&ae.willChange==="filter"||Z&&ae.filter&&ae.filter!=="none")return te;te=te.parentNode}return null}(F)||w}function Rc(F){return["top","bottom"].indexOf(F)>=0?"x":"y"}function Ds(F,w,A){return Ai(F,Ju(w,A))}function Wd(F){return Object.assign({},{top:0,right:0,bottom:0,left:0},F)}function ka(F,w){return w.reduce(function(A,L){return A[L]=F,A},{})}const _m={name:"arrow",enabled:!0,phase:"main",fn:function(F){var w,A=F.state,L=F.name,Z=F.options,te=A.elements.arrow,ae=A.modifiersData.popperOffsets,me=Fr(A.placement),be=Rc(me),ke=[Jn,xr].indexOf(me)>=0?"height":"width";if(te&&ae){var Ne=function($t,Ut){return Wd(typeof($t=typeof $t=="function"?$t(Object.assign({},Ut.rects,{placement:Ut.placement})):$t)!="number"?$t:ka($t,Mo))}(Z.padding,A),Se=Vd(te),at=be==="y"?Dn:Jn,qe=be==="y"?mn:xr,nt=A.rects.reference[ke]+A.rects.reference[be]-ae[be]-A.rects.popper[ke],Ye=ae[be]-A.rects.reference[be],rt=Xr(te),zt=rt?be==="y"?rt.clientHeight||0:rt.clientWidth||0:0,Qt=nt/2-Ye/2,ft=Ne[at],Dt=zt-Se[ke]-Ne[qe],lt=zt/2-Se[ke]/2+Qt,xt=Ds(ft,lt,Dt),Vt=be;A.modifiersData[L]=((w={})[Vt]=xt,w.centerOffset=xt-lt,w)}},effect:function(F){var w=F.state,A=F.options.element,L=A===void 0?"[data-popper-arrow]":A;L!=null&&(typeof L!="string"||(L=w.elements.popper.querySelector(L)))&&Ud(w.elements.popper,L)&&(w.elements.arrow=L)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ps(F){return F.split("-")[1]}var B0={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ho(F){var w,A=F.popper,L=F.popperRect,Z=F.placement,te=F.variation,ae=F.offsets,me=F.position,be=F.gpuAcceleration,ke=F.adaptive,Ne=F.roundOffsets,Se=F.isFixed,at=ae.x,qe=at===void 0?0:at,nt=ae.y,Ye=nt===void 0?0:nt,rt=typeof Ne=="function"?Ne({x:qe,y:Ye}):{x:qe,y:Ye};qe=rt.x,Ye=rt.y;var zt=ae.hasOwnProperty("x"),Qt=ae.hasOwnProperty("y"),ft=Jn,Dt=Dn,lt=window;if(ke){var xt=Xr(A),Vt="clientHeight",$t="clientWidth";xt===wr(A)&&co(xt=Bo(A)).position!=="static"&&me==="absolute"&&(Vt="scrollHeight",$t="scrollWidth"),(Z===Dn||(Z===Jn||Z===xr)&&te===Ia)&&(Dt=mn,Ye-=(Se&&xt===lt&&lt.visualViewport?lt.visualViewport.height:xt[Vt])-L.height,Ye*=be?1:-1),Z!==Jn&&(Z!==Dn&&Z!==mn||te!==Ia)||(ft=xr,qe-=(Se&&xt===lt&&lt.visualViewport?lt.visualViewport.width:xt[$t])-L.width,qe*=be?1:-1)}var Ut,Tn=Object.assign({position:me},ke&&B0),hi=Ne===!0?function(po,Lr){var Mi=po.x,Fi=po.y,vn=Lr.devicePixelRatio||1;return{x:kt(Mi*vn)/vn||0,y:kt(Fi*vn)/vn||0}}({x:qe,y:Ye},wr(A)):{x:qe,y:Ye};return qe=hi.x,Ye=hi.y,be?Object.assign({},Tn,((Ut={})[Dt]=Qt?"0":"",Ut[ft]=zt?"0":"",Ut.transform=(lt.devicePixelRatio||1)<=1?"translate("+qe+"px, "+Ye+"px)":"translate3d("+qe+"px, "+Ye+"px, 0)",Ut)):Object.assign({},Tn,((w={})[Dt]=Qt?Ye+"px":"",w[ft]=zt?qe+"px":"",w.transform="",w))}const jd={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(F){var w=F.state,A=F.options,L=A.gpuAcceleration,Z=L===void 0||L,te=A.adaptive,ae=te===void 0||te,me=A.roundOffsets,be=me===void 0||me,ke={placement:Fr(w.placement),variation:Ps(w.placement),popper:w.elements.popper,popperRect:w.rects.popper,gpuAcceleration:Z,isFixed:w.options.strategy==="fixed"};w.modifiersData.popperOffsets!=null&&(w.styles.popper=Object.assign({},w.styles.popper,ho(Object.assign({},ke,{offsets:w.modifiersData.popperOffsets,position:w.options.strategy,adaptive:ae,roundOffsets:be})))),w.modifiersData.arrow!=null&&(w.styles.arrow=Object.assign({},w.styles.arrow,ho(Object.assign({},ke,{offsets:w.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:be})))),w.attributes.popper=Object.assign({},w.attributes.popper,{"data-popper-placement":w.placement})},data:{}};var kc={passive:!0};const Os={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(F){var w=F.state,A=F.instance,L=F.options,Z=L.scroll,te=Z===void 0||Z,ae=L.resize,me=ae===void 0||ae,be=wr(w.elements.popper),ke=[].concat(w.scrollParents.reference,w.scrollParents.popper);return te&&ke.forEach(function(Ne){Ne.addEventListener("scroll",A.update,kc)}),me&&be.addEventListener("resize",A.update,kc),function(){te&&ke.forEach(function(Ne){Ne.removeEventListener("scroll",A.update,kc)}),me&&be.removeEventListener("resize",A.update,kc)}},data:{}};var Ac={left:"right",right:"left",bottom:"top",top:"bottom"};function Zu(F){return F.replace(/left|right|bottom|top/g,function(w){return Ac[w]})}var el={start:"end",end:"start"};function Ms(F){return F.replace(/start|end/g,function(w){return el[w]})}function Nc(F){var w=wr(F);return{scrollLeft:w.pageXOffset,scrollTop:w.pageYOffset}}function tl(F){return Ni(Bo(F)).left+Nc(F).scrollLeft}function Xt(F){var w=co(F),A=w.overflow,L=w.overflowX,Z=w.overflowY;return/auto|scroll|overlay|hidden/.test(A+Z+L)}function bm(F){return["html","body","#document"].indexOf(ki(F))>=0?F.ownerDocument.body:Kr(F)&&Xt(F)?F:bm(Sc(F))}function nl(F,w){var A;w===void 0&&(w=[]);var L=bm(F),Z=L===((A=F.ownerDocument)==null?void 0:A.body),te=wr(L),ae=Z?[te].concat(te.visualViewport||[],Xt(L)?L:[]):L,me=w.concat(ae);return Z?me:me.concat(nl(Sc(ae)))}function Dc(F){return Object.assign({},F,{left:F.x,top:F.y,right:F.x+F.width,bottom:F.y+F.height})}function zd(F,w,A){return w===Rs?Dc(function(L,Z){var te=wr(L),ae=Bo(L),me=te.visualViewport,be=ae.clientWidth,ke=ae.clientHeight,Ne=0,Se=0;if(me){be=me.width,ke=me.height;var at=As();(at||!at&&Z==="fixed")&&(Ne=me.offsetLeft,Se=me.offsetTop)}return{width:be,height:ke,x:Ne+tl(L),y:Se}}(F,A)):Lo(w)?function(L,Z){var te=Ni(L,!1,Z==="fixed");return te.top=te.top+L.clientTop,te.left=te.left+L.clientLeft,te.bottom=te.top+L.clientHeight,te.right=te.left+L.clientWidth,te.width=L.clientWidth,te.height=L.clientHeight,te.x=te.left,te.y=te.top,te}(w,A):Dc(function(L){var Z,te=Bo(L),ae=Nc(L),me=(Z=L.ownerDocument)==null?void 0:Z.body,be=Ai(te.scrollWidth,te.clientWidth,me?me.scrollWidth:0,me?me.clientWidth:0),ke=Ai(te.scrollHeight,te.clientHeight,me?me.scrollHeight:0,me?me.clientHeight:0),Ne=-ae.scrollLeft+tl(L),Se=-ae.scrollTop;return co(me||te).direction==="rtl"&&(Ne+=Ai(te.clientWidth,me?me.clientWidth:0)-be),{width:be,height:ke,x:Ne,y:Se}}(Bo(F)))}function $d(F){var w,A=F.reference,L=F.element,Z=F.placement,te=Z?Fr(Z):null,ae=Z?Ps(Z):null,me=A.x+A.width/2-L.width/2,be=A.y+A.height/2-L.height/2;switch(te){case Dn:w={x:me,y:A.y-L.height};break;case mn:w={x:me,y:A.y+A.height};break;case xr:w={x:A.x+A.width,y:be};break;case Jn:w={x:A.x-L.width,y:be};break;default:w={x:A.x,y:A.y}}var ke=te?Rc(te):null;if(ke!=null){var Ne=ke==="y"?"height":"width";switch(ae){case Fo:w[ke]=w[ke]-(A[Ne]/2-L[Ne]/2);break;case Ia:w[ke]=w[ke]+(A[Ne]/2-L[Ne]/2)}}return w}function fo(F,w){w===void 0&&(w={});var A=w,L=A.placement,Z=L===void 0?F.placement:L,te=A.strategy,ae=te===void 0?F.strategy:te,me=A.boundary,be=me===void 0?ym:me,ke=A.rootBoundary,Ne=ke===void 0?Rs:ke,Se=A.elementContext,at=Se===void 0?Sa:Se,qe=A.altBoundary,nt=qe!==void 0&&qe,Ye=A.padding,rt=Ye===void 0?0:Ye,zt=Wd(typeof rt!="number"?rt:ka(rt,Mo)),Qt=at===Sa?Ec:Sa,ft=F.rects.popper,Dt=F.elements[nt?Qt:at],lt=function(Lr,Mi,Fi,vn){var Wo=Mi==="clippingParents"?function(Kt){var Br=nl(Sc(Kt)),Li=["absolute","fixed"].indexOf(co(Kt).position)>=0&&Kr(Kt)?Xr(Kt):Kt;return Lo(Li)?Br.filter(function(Bs){return Lo(Bs)&&Ud(Bs,Li)&&ki(Bs)!=="body"}):[]}(Lr):[].concat(Mi),jo=[].concat(Wo,[Fi]),Bc=jo[0],Zn=jo.reduce(function(Kt,Br){var Li=zd(Lr,Br,vn);return Kt.top=Ai(Li.top,Kt.top),Kt.right=Ju(Li.right,Kt.right),Kt.bottom=Ju(Li.bottom,Kt.bottom),Kt.left=Ai(Li.left,Kt.left),Kt},zd(Lr,Bc,vn));return Zn.width=Zn.right-Zn.left,Zn.height=Zn.bottom-Zn.top,Zn.x=Zn.left,Zn.y=Zn.top,Zn}(Lo(Dt)?Dt:Dt.contextElement||Bo(F.elements.popper),be,Ne,ae),xt=Ni(F.elements.reference),Vt=$d({reference:xt,element:ft,strategy:"absolute",placement:Z}),$t=Dc(Object.assign({},ft,Vt)),Ut=at===Sa?$t:xt,Tn={top:lt.top-Ut.top+zt.top,bottom:Ut.bottom-lt.bottom+zt.bottom,left:lt.left-Ut.left+zt.left,right:Ut.right-lt.right+zt.right},hi=F.modifiersData.offset;if(at===Sa&&hi){var po=hi[Z];Object.keys(Tn).forEach(function(Lr){var Mi=[xr,mn].indexOf(Lr)>=0?1:-1,Fi=[Dn,mn].indexOf(Lr)>=0?"y":"x";Tn[Lr]+=po[Fi]*Mi})}return Tn}function Em(F,w){w===void 0&&(w={});var A=w,L=A.placement,Z=A.boundary,te=A.rootBoundary,ae=A.padding,me=A.flipVariations,be=A.allowedAutoPlacements,ke=be===void 0?uo:be,Ne=Ps(L),Se=Ne?me?Ra:Ra.filter(function(nt){return Ps(nt)===Ne}):Mo,at=Se.filter(function(nt){return ke.indexOf(nt)>=0});at.length===0&&(at=Se);var qe=at.reduce(function(nt,Ye){return nt[Ye]=fo(F,{placement:Ye,boundary:Z,rootBoundary:te,padding:ae})[Fr(Ye)],nt},{});return Object.keys(qe).sort(function(nt,Ye){return qe[nt]-qe[Ye]})}const Di={name:"flip",enabled:!0,phase:"main",fn:function(F){var w=F.state,A=F.options,L=F.name;if(!w.modifiersData[L]._skip){for(var Z=A.mainAxis,te=Z===void 0||Z,ae=A.altAxis,me=ae===void 0||ae,be=A.fallbackPlacements,ke=A.padding,Ne=A.boundary,Se=A.rootBoundary,at=A.altBoundary,qe=A.flipVariations,nt=qe===void 0||qe,Ye=A.allowedAutoPlacements,rt=w.options.placement,zt=Fr(rt),Qt=be||(zt!==rt&&nt?function(Kt){if(Fr(Kt)===Ss)return[];var Br=Zu(Kt);return[Ms(Kt),Br,Ms(Br)]}(rt):[Zu(rt)]),ft=[rt].concat(Qt).reduce(function(Kt,Br){return Kt.concat(Fr(Br)===Ss?Em(w,{placement:Br,boundary:Ne,rootBoundary:Se,padding:ke,flipVariations:nt,allowedAutoPlacements:Ye}):Br)},[]),Dt=w.rects.reference,lt=w.rects.popper,xt=new Map,Vt=!0,$t=ft[0],Ut=0;Ut<ft.length;Ut++){var Tn=ft[Ut],hi=Fr(Tn),po=Ps(Tn)===Fo,Lr=[Dn,mn].indexOf(hi)>=0,Mi=Lr?"width":"height",Fi=fo(w,{placement:Tn,boundary:Ne,rootBoundary:Se,altBoundary:at,padding:ke}),vn=Lr?po?xr:Jn:po?mn:Dn;Dt[Mi]>lt[Mi]&&(vn=Zu(vn));var Wo=Zu(vn),jo=[];if(te&&jo.push(Fi[hi]<=0),me&&jo.push(Fi[vn]<=0,Fi[Wo]<=0),jo.every(function(Kt){return Kt})){$t=Tn,Vt=!1;break}xt.set(Tn,jo)}if(Vt)for(var Bc=function(Kt){var Br=ft.find(function(Li){var Bs=xt.get(Li);if(Bs)return Bs.slice(0,Kt).every(function(Wm){return Wm})});if(Br)return $t=Br,"break"},Zn=nt?3:1;Zn>0&&Bc(Zn)!=="break";Zn--);w.placement!==$t&&(w.modifiersData[L]._skip=!0,w.placement=$t,w.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Hd(F,w,A){return A===void 0&&(A={x:0,y:0}),{top:F.top-w.height-A.y,right:F.right-w.width+A.x,bottom:F.bottom-w.height+A.y,left:F.left-w.width-A.x}}function Cm(F){return[Dn,xr,mn,Jn].some(function(w){return F[w]>=0})}const Fs={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(F){var w=F.state,A=F.name,L=w.rects.reference,Z=w.rects.popper,te=w.modifiersData.preventOverflow,ae=fo(w,{elementContext:"reference"}),me=fo(w,{altBoundary:!0}),be=Hd(ae,L),ke=Hd(me,Z,te),Ne=Cm(be),Se=Cm(ke);w.modifiersData[A]={referenceClippingOffsets:be,popperEscapeOffsets:ke,isReferenceHidden:Ne,hasPopperEscaped:Se},w.attributes.popper=Object.assign({},w.attributes.popper,{"data-popper-reference-hidden":Ne,"data-popper-escaped":Se})}},Gd={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(F){var w=F.state,A=F.options,L=F.name,Z=A.offset,te=Z===void 0?[0,0]:Z,ae=uo.reduce(function(Ne,Se){return Ne[Se]=function(at,qe,nt){var Ye=Fr(at),rt=[Jn,Dn].indexOf(Ye)>=0?-1:1,zt=typeof nt=="function"?nt(Object.assign({},qe,{placement:at})):nt,Qt=zt[0],ft=zt[1];return Qt=Qt||0,ft=(ft||0)*rt,[Jn,xr].indexOf(Ye)>=0?{x:ft,y:Qt}:{x:Qt,y:ft}}(Se,w.rects,te),Ne},{}),me=ae[w.placement],be=me.x,ke=me.y;w.modifiersData.popperOffsets!=null&&(w.modifiersData.popperOffsets.x+=be,w.modifiersData.popperOffsets.y+=ke),w.modifiersData[L]=ae}},rl={name:"popperOffsets",enabled:!0,phase:"read",fn:function(F){var w=F.state,A=F.name;w.modifiersData[A]=$d({reference:w.rects.reference,element:w.rects.popper,strategy:"absolute",placement:w.placement})},data:{}},il={name:"preventOverflow",enabled:!0,phase:"main",fn:function(F){var w=F.state,A=F.options,L=F.name,Z=A.mainAxis,te=Z===void 0||Z,ae=A.altAxis,me=ae!==void 0&&ae,be=A.boundary,ke=A.rootBoundary,Ne=A.altBoundary,Se=A.padding,at=A.tether,qe=at===void 0||at,nt=A.tetherOffset,Ye=nt===void 0?0:nt,rt=fo(w,{boundary:be,rootBoundary:ke,padding:Se,altBoundary:Ne}),zt=Fr(w.placement),Qt=Ps(w.placement),ft=!Qt,Dt=Rc(zt),lt=Dt==="x"?"y":"x",xt=w.modifiersData.popperOffsets,Vt=w.rects.reference,$t=w.rects.popper,Ut=typeof Ye=="function"?Ye(Object.assign({},w.rects,{placement:w.placement})):Ye,Tn=typeof Ut=="number"?{mainAxis:Ut,altAxis:Ut}:Object.assign({mainAxis:0,altAxis:0},Ut),hi=w.modifiersData.offset?w.modifiersData.offset[w.placement]:null,po={x:0,y:0};if(xt){if(te){var Lr,Mi=Dt==="y"?Dn:Jn,Fi=Dt==="y"?mn:xr,vn=Dt==="y"?"height":"width",Wo=xt[Dt],jo=Wo+rt[Mi],Bc=Wo-rt[Fi],Zn=qe?-$t[vn]/2:0,Kt=Qt===Fo?Vt[vn]:$t[vn],Br=Qt===Fo?-$t[vn]:-Vt[vn],Li=w.elements.arrow,Bs=qe&&Li?Vd(Li):{width:0,height:0},Wm=w.modifiersData["arrow#persistent"]?w.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},TC=Wm[Mi],IC=Wm[Fi],jm=Ds(0,Vt[vn],Bs[vn]),FL=ft?Vt[vn]/2-Zn-jm-TC-Tn.mainAxis:Kt-jm-TC-Tn.mainAxis,LL=ft?-Vt[vn]/2+Zn+jm+IC+Tn.mainAxis:Br+jm+IC+Tn.mainAxis,X0=w.elements.arrow&&Xr(w.elements.arrow),BL=X0?Dt==="y"?X0.clientTop||0:X0.clientLeft||0:0,SC=(Lr=hi==null?void 0:hi[Dt])!=null?Lr:0,VL=Wo+LL-SC,RC=Ds(qe?Ju(jo,Wo+FL-SC-BL):jo,Wo,qe?Ai(Bc,VL):Bc);xt[Dt]=RC,po[Dt]=RC-Wo}if(me){var kC,UL=Dt==="x"?Dn:Jn,WL=Dt==="x"?mn:xr,dl=xt[lt],zm=lt==="y"?"height":"width",AC=dl+rt[UL],NC=dl-rt[WL],Q0=[Dn,Jn].indexOf(zt)!==-1,DC=(kC=hi==null?void 0:hi[lt])!=null?kC:0,PC=Q0?AC:dl-Vt[zm]-$t[zm]-DC+Tn.altAxis,OC=Q0?dl+Vt[zm]+$t[zm]-DC-Tn.altAxis:NC,MC=qe&&Q0?function(jL,zL,Y0){var FC=Ds(jL,zL,Y0);return FC>Y0?Y0:FC}(PC,dl,OC):Ds(qe?PC:AC,dl,qe?OC:NC);xt[lt]=MC,po[lt]=MC-dl}w.modifiersData[L]=po}},requiresIfExists:["offset"]};function Tm(F,w,A){A===void 0&&(A=!1);var L,Z,te=Kr(w),ae=Kr(w)&&function(Se){var at=Se.getBoundingClientRect(),qe=kt(at.width)/Se.offsetWidth||1,nt=kt(at.height)/Se.offsetHeight||1;return qe!==1||nt!==1}(w),me=Bo(w),be=Ni(F,ae,A),ke={scrollLeft:0,scrollTop:0},Ne={x:0,y:0};return(te||!te&&!A)&&((ki(w)!=="body"||Xt(me))&&(ke=(L=w)!==wr(L)&&Kr(L)?{scrollLeft:(Z=L).scrollLeft,scrollTop:Z.scrollTop}:Nc(L)),Kr(w)?((Ne=Ni(w,!0)).x+=w.clientLeft,Ne.y+=w.clientTop):me&&(Ne.x=tl(me))),{x:be.left+ke.scrollLeft-Ne.x,y:be.top+ke.scrollTop-Ne.y,width:be.width,height:be.height}}function Pc(F){var w=new Map,A=new Set,L=[];function Z(te){A.add(te.name),[].concat(te.requires||[],te.requiresIfExists||[]).forEach(function(ae){if(!A.has(ae)){var me=w.get(ae);me&&Z(me)}}),L.push(te)}return F.forEach(function(te){w.set(te.name,te)}),F.forEach(function(te){A.has(te.name)||Z(te)}),L}var Im={placement:"bottom",modifiers:[],strategy:"absolute"};function qd(){for(var F=arguments.length,w=new Array(F),A=0;A<F;A++)w[A]=arguments[A];return!w.some(function(L){return!(L&&typeof L.getBoundingClientRect=="function")})}function Vo(F){F===void 0&&(F={});var w=F,A=w.defaultModifiers,L=A===void 0?[]:A,Z=w.defaultOptions,te=Z===void 0?Im:Z;return function(ae,me,be){be===void 0&&(be=te);var ke,Ne,Se={placement:"bottom",orderedModifiers:[],options:Object.assign({},Im,te),modifiersData:{},elements:{reference:ae,popper:me},attributes:{},styles:{}},at=[],qe=!1,nt={state:Se,setOptions:function(rt){var zt=typeof rt=="function"?rt(Se.options):rt;Ye(),Se.options=Object.assign({},te,Se.options,zt),Se.scrollParents={reference:Lo(ae)?nl(ae):ae.contextElement?nl(ae.contextElement):[],popper:nl(me)};var Qt,ft,Dt=function(lt){var xt=Pc(lt);return wm.reduce(function(Vt,$t){return Vt.concat(xt.filter(function(Ut){return Ut.phase===$t}))},[])}((Qt=[].concat(L,Se.options.modifiers),ft=Qt.reduce(function(lt,xt){var Vt=lt[xt.name];return lt[xt.name]=Vt?Object.assign({},Vt,xt,{options:Object.assign({},Vt.options,xt.options),data:Object.assign({},Vt.data,xt.data)}):xt,lt},{}),Object.keys(ft).map(function(lt){return ft[lt]})));return Se.orderedModifiers=Dt.filter(function(lt){return lt.enabled}),Se.orderedModifiers.forEach(function(lt){var xt=lt.name,Vt=lt.options,$t=Vt===void 0?{}:Vt,Ut=lt.effect;if(typeof Ut=="function"){var Tn=Ut({state:Se,name:xt,instance:nt,options:$t});at.push(Tn||function(){})}}),nt.update()},forceUpdate:function(){if(!qe){var rt=Se.elements,zt=rt.reference,Qt=rt.popper;if(qd(zt,Qt)){Se.rects={reference:Tm(zt,Xr(Qt),Se.options.strategy==="fixed"),popper:Vd(Qt)},Se.reset=!1,Se.placement=Se.options.placement,Se.orderedModifiers.forEach(function(Ut){return Se.modifiersData[Ut.name]=Object.assign({},Ut.data)});for(var ft=0;ft<Se.orderedModifiers.length;ft++)if(Se.reset!==!0){var Dt=Se.orderedModifiers[ft],lt=Dt.fn,xt=Dt.options,Vt=xt===void 0?{}:xt,$t=Dt.name;typeof lt=="function"&&(Se=lt({state:Se,options:Vt,name:$t,instance:nt})||Se)}else Se.reset=!1,ft=-1}}},update:(ke=function(){return new Promise(function(rt){nt.forceUpdate(),rt(Se)})},function(){return Ne||(Ne=new Promise(function(rt){Promise.resolve().then(function(){Ne=void 0,rt(ke())})})),Ne}),destroy:function(){Ye(),qe=!0}};if(!qd(ae,me))return nt;function Ye(){at.forEach(function(rt){return rt()}),at=[]}return nt.setOptions(be).then(function(rt){!qe&&be.onFirstUpdate&&be.onFirstUpdate(rt)}),nt}}var Sm=Vo(),Rm=Vo({defaultModifiers:[Os,rl,jd,ci]}),ol=Vo({defaultModifiers:[Os,rl,jd,ci,Gd,Di,il,_m,Fs]});const Oc=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Tc,afterRead:Od,afterWrite:Bd,applyStyles:ci,arrow:_m,auto:Ss,basePlacements:Mo,beforeMain:Md,beforeRead:Cc,beforeWrite:Ic,bottom:mn,clippingParents:ym,computeStyles:jd,createPopper:ol,createPopperBase:Sm,createPopperLite:Rm,detectOverflow:fo,end:Ia,eventListeners:Os,flip:Di,hide:Fs,left:Jn,main:Fd,modifierPhases:wm,offset:Gd,placements:uo,popper:Sa,popperGenerator:Vo,popperOffsets:rl,preventOverflow:il,read:xm,reference:Ec,right:xr,start:Fo,top:Dn,variationPlacements:Ra,viewport:Rs,write:Ld},Symbol.toStringTag,{value:"Module"})),Kd="dropdown",Pi=".bs.dropdown",Mc=".data-api",km="ArrowUp",Uo="ArrowDown",Am=`hide${Pi}`,Nm=`hidden${Pi}`,Dm=`show${Pi}`,Pm=`shown${Pi}`,al=`click${Pi}${Mc}`,_r=`keydown${Pi}${Mc}`,Om=`keyup${Pi}${Mc}`,Aa="show",Qr='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',v=`${Qr}.${Aa}`,S=".dropdown-menu",D=g()?"top-end":"top-start",B=g()?"top-start":"top-end",ne=g()?"bottom-end":"bottom-start",ie=g()?"bottom-start":"bottom-end",_e=g()?"left-start":"right-start",Bt=g()?"right-start":"left-start",Vn={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},_t={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class jt extends Ce{constructor(w,A){super(w,A),this._popper=null,this._parent=this._element.parentNode,this._menu=ce.next(this._element,S)[0]||ce.prev(this._element,S)[0]||ce.findOne(S,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Vn}static get DefaultType(){return _t}static get NAME(){return Kd}toggle(){return this._isShown()?this.hide():this.show()}show(){if(c(this._element)||this._isShown())return;const w={relatedTarget:this._element};if(!j.trigger(this._element,Dm,w).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const A of[].concat(...document.body.children))j.on(A,"mouseover",d);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Aa),this._element.classList.add(Aa),j.trigger(this._element,Pm,w)}}hide(){if(c(this._element)||!this._isShown())return;const w={relatedTarget:this._element};this._completeHide(w)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(w){if(!j.trigger(this._element,Am,w).defaultPrevented){if("ontouchstart"in document.documentElement)for(const A of[].concat(...document.body.children))j.off(A,"mouseover",d);this._popper&&this._popper.destroy(),this._menu.classList.remove(Aa),this._element.classList.remove(Aa),this._element.setAttribute("aria-expanded","false"),we.removeDataAttribute(this._menu,"popper"),j.trigger(this._element,Nm,w)}}_getConfig(w){if(typeof(w=super._getConfig(w)).reference=="object"&&!s(w.reference)&&typeof w.reference.getBoundingClientRect!="function")throw new TypeError(`${Kd.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return w}_createPopper(){if(Oc===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let w=this._element;this._config.reference==="parent"?w=this._parent:s(this._config.reference)?w=u(this._config.reference):typeof this._config.reference=="object"&&(w=this._config.reference);const A=this._getPopperConfig();this._popper=ol(w,this._menu,A)}_isShown(){return this._menu.classList.contains(Aa)}_getPlacement(){const w=this._parent;if(w.classList.contains("dropend"))return _e;if(w.classList.contains("dropstart"))return Bt;if(w.classList.contains("dropup-center"))return"top";if(w.classList.contains("dropdown-center"))return"bottom";const A=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return w.classList.contains("dropup")?A?B:D:A?ie:ne}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:w}=this._config;return typeof w=="string"?w.split(",").map(A=>Number.parseInt(A,10)):typeof w=="function"?A=>w(A,this._element):w}_getPopperConfig(){const w={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(we.setDataAttribute(this._menu,"popper","static"),w.modifiers=[{name:"applyStyles",enabled:!1}]),{...w,...x(this._config.popperConfig,[w])}}_selectMenuItem({key:w,target:A}){const L=ce.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(Z=>l(Z));L.length&&b(L,A,w===Uo,!L.includes(A)).focus()}static jQueryInterface(w){return this.each(function(){const A=jt.getOrCreateInstance(this,w);if(typeof w=="string"){if(A[w]===void 0)throw new TypeError(`No method named "${w}"`);A[w]()}})}static clearMenus(w){if(w.button===2||w.type==="keyup"&&w.key!=="Tab")return;const A=ce.find(v);for(const L of A){const Z=jt.getInstance(L);if(!Z||Z._config.autoClose===!1)continue;const te=w.composedPath(),ae=te.includes(Z._menu);if(te.includes(Z._element)||Z._config.autoClose==="inside"&&!ae||Z._config.autoClose==="outside"&&ae||Z._menu.contains(w.target)&&(w.type==="keyup"&&w.key==="Tab"||/input|select|option|textarea|form/i.test(w.target.tagName)))continue;const me={relatedTarget:Z._element};w.type==="click"&&(me.clickEvent=w),Z._completeHide(me)}}static dataApiKeydownHandler(w){const A=/input|textarea/i.test(w.target.tagName),L=w.key==="Escape",Z=[km,Uo].includes(w.key);if(!Z&&!L||A&&!L)return;w.preventDefault();const te=this.matches(Qr)?this:ce.prev(this,Qr)[0]||ce.next(this,Qr)[0]||ce.findOne(Qr,w.delegateTarget.parentNode),ae=jt.getOrCreateInstance(te);if(Z)return w.stopPropagation(),ae.show(),void ae._selectMenuItem(w);ae._isShown()&&(w.stopPropagation(),ae.hide(),te.focus())}}j.on(document,_r,Qr,jt.dataApiKeydownHandler),j.on(document,_r,S,jt.dataApiKeydownHandler),j.on(document,al,jt.clearMenus),j.on(document,Om,jt.clearMenus),j.on(document,al,Qr,function(F){F.preventDefault(),jt.getOrCreateInstance(this).toggle()}),y(jt);const Un="backdrop",Na="show",Yr=`mousedown.bs.${Un}`,Fc={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Xd={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Q2 extends Ee{constructor(w){super(),this._config=this._getConfig(w),this._isAppended=!1,this._element=null}static get Default(){return Fc}static get DefaultType(){return Xd}static get NAME(){return Un}show(w){if(!this._config.isVisible)return void x(w);this._append();const A=this._getElement();this._config.isAnimated&&f(A),A.classList.add(Na),this._emulateAnimation(()=>{x(w)})}hide(w){this._config.isVisible?(this._getElement().classList.remove(Na),this._emulateAnimation(()=>{this.dispose(),x(w)})):x(w)}dispose(){this._isAppended&&(j.off(this._element,Yr),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const w=document.createElement("div");w.className=this._config.className,this._config.isAnimated&&w.classList.add("fade"),this._element=w}return this._element}_configAfterMerge(w){return w.rootElement=u(w.rootElement),w}_append(){if(this._isAppended)return;const w=this._getElement();this._config.rootElement.append(w),j.on(w,Yr,()=>{x(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(w){_(w,this._getElement(),this._config.isAnimated)}}const Mm=".bs.focustrap",k3=`focusin${Mm}`,A3=`keydown.tab${Mm}`,Y2="backward",N3={autofocus:!0,trapElement:null},D3={autofocus:"boolean",trapElement:"element"};class J2 extends Ee{constructor(w){super(),this._config=this._getConfig(w),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return N3}static get DefaultType(){return D3}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),j.off(document,Mm),j.on(document,k3,w=>this._handleFocusin(w)),j.on(document,A3,w=>this._handleKeydown(w)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,j.off(document,Mm))}_handleFocusin(w){const{trapElement:A}=this._config;if(w.target===document||w.target===A||A.contains(w.target))return;const L=ce.focusableChildren(A);L.length===0?A.focus():this._lastTabNavDirection===Y2?L[L.length-1].focus():L[0].focus()}_handleKeydown(w){w.key==="Tab"&&(this._lastTabNavDirection=w.shiftKey?Y2:"forward")}}const Z2=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",eC=".sticky-top",Fm="padding-right",tC="margin-right";class V0{constructor(){this._element=document.body}getWidth(){const w=document.documentElement.clientWidth;return Math.abs(window.innerWidth-w)}hide(){const w=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Fm,A=>A+w),this._setElementAttributes(Z2,Fm,A=>A+w),this._setElementAttributes(eC,tC,A=>A-w)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Fm),this._resetElementAttributes(Z2,Fm),this._resetElementAttributes(eC,tC)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(w,A,L){const Z=this.getWidth();this._applyManipulationCallback(w,te=>{if(te!==this._element&&window.innerWidth>te.clientWidth+Z)return;this._saveInitialAttribute(te,A);const ae=window.getComputedStyle(te).getPropertyValue(A);te.style.setProperty(A,`${L(Number.parseFloat(ae))}px`)})}_saveInitialAttribute(w,A){const L=w.style.getPropertyValue(A);L&&we.setDataAttribute(w,A,L)}_resetElementAttributes(w,A){this._applyManipulationCallback(w,L=>{const Z=we.getDataAttribute(L,A);Z!==null?(we.removeDataAttribute(L,A),L.style.setProperty(A,Z)):L.style.removeProperty(A)})}_applyManipulationCallback(w,A){if(s(w))A(w);else for(const L of ce.find(w,this._element))A(L)}}const Oi=".bs.modal",P3=`hide${Oi}`,O3=`hidePrevented${Oi}`,nC=`hidden${Oi}`,rC=`show${Oi}`,M3=`shown${Oi}`,F3=`resize${Oi}`,L3=`click.dismiss${Oi}`,B3=`mousedown.dismiss${Oi}`,V3=`keydown.dismiss${Oi}`,U3=`click${Oi}.data-api`,iC="modal-open",oC="show",U0="modal-static",W3={backdrop:!0,focus:!0,keyboard:!0},j3={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class sl extends Ce{constructor(w,A){super(w,A),this._dialog=ce.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new V0,this._addEventListeners()}static get Default(){return W3}static get DefaultType(){return j3}static get NAME(){return"modal"}toggle(w){return this._isShown?this.hide():this.show(w)}show(w){this._isShown||this._isTransitioning||j.trigger(this._element,rC,{relatedTarget:w}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(iC),this._adjustDialog(),this._backdrop.show(()=>this._showElement(w)))}hide(){this._isShown&&!this._isTransitioning&&(j.trigger(this._element,P3).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(oC),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){j.off(window,Oi),j.off(this._dialog,Oi),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Q2({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new J2({trapElement:this._element})}_showElement(w){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const A=ce.findOne(".modal-body",this._dialog);A&&(A.scrollTop=0),f(this._element),this._element.classList.add(oC),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,j.trigger(this._element,M3,{relatedTarget:w})},this._dialog,this._isAnimated())}_addEventListeners(){j.on(this._element,V3,w=>{w.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),j.on(window,F3,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),j.on(this._element,B3,w=>{j.one(this._element,L3,A=>{this._element===w.target&&this._element===A.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(iC),this._resetAdjustments(),this._scrollBar.reset(),j.trigger(this._element,nC)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(j.trigger(this._element,O3).defaultPrevented)return;const w=this._element.scrollHeight>document.documentElement.clientHeight,A=this._element.style.overflowY;A==="hidden"||this._element.classList.contains(U0)||(w||(this._element.style.overflowY="hidden"),this._element.classList.add(U0),this._queueCallback(()=>{this._element.classList.remove(U0),this._queueCallback(()=>{this._element.style.overflowY=A},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const w=this._element.scrollHeight>document.documentElement.clientHeight,A=this._scrollBar.getWidth(),L=A>0;if(L&&!w){const Z=g()?"paddingLeft":"paddingRight";this._element.style[Z]=`${A}px`}if(!L&&w){const Z=g()?"paddingRight":"paddingLeft";this._element.style[Z]=`${A}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(w,A){return this.each(function(){const L=sl.getOrCreateInstance(this,w);if(typeof w=="string"){if(L[w]===void 0)throw new TypeError(`No method named "${w}"`);L[w](A)}})}}j.on(document,U3,'[data-bs-toggle="modal"]',function(F){const w=ce.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&F.preventDefault(),j.one(w,rC,L=>{L.defaultPrevented||j.one(w,nC,()=>{l(this)&&this.focus()})});const A=ce.findOne(".modal.show");A&&sl.getInstance(A).hide(),sl.getOrCreateInstance(w).toggle(this)}),Ue(sl),y(sl);const Da=".bs.offcanvas",aC=".data-api",z3=`load${Da}${aC}`,sC="show",uC="showing",lC="hiding",cC=".offcanvas.show",$3=`show${Da}`,H3=`shown${Da}`,G3=`hide${Da}`,hC=`hidePrevented${Da}`,dC=`hidden${Da}`,q3=`resize${Da}`,K3=`click${Da}${aC}`,X3=`keydown.dismiss${Da}`,Q3={backdrop:!0,keyboard:!0,scroll:!1},Y3={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Pa extends Ce{constructor(w,A){super(w,A),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Q3}static get DefaultType(){return Y3}static get NAME(){return"offcanvas"}toggle(w){return this._isShown?this.hide():this.show(w)}show(w){this._isShown||j.trigger(this._element,$3,{relatedTarget:w}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new V0().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(uC),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(sC),this._element.classList.remove(uC),j.trigger(this._element,H3,{relatedTarget:w})},this._element,!0))}hide(){this._isShown&&(j.trigger(this._element,G3).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(lC),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(sC,lC),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new V0().reset(),j.trigger(this._element,dC)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const w=!!this._config.backdrop;return new Q2({className:"offcanvas-backdrop",isVisible:w,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:w?()=>{this._config.backdrop!=="static"?this.hide():j.trigger(this._element,hC)}:null})}_initializeFocusTrap(){return new J2({trapElement:this._element})}_addEventListeners(){j.on(this._element,X3,w=>{w.key==="Escape"&&(this._config.keyboard?this.hide():j.trigger(this._element,hC))})}static jQueryInterface(w){return this.each(function(){const A=Pa.getOrCreateInstance(this,w);if(typeof w=="string"){if(A[w]===void 0||w.startsWith("_")||w==="constructor")throw new TypeError(`No method named "${w}"`);A[w](this)}})}}j.on(document,K3,'[data-bs-toggle="offcanvas"]',function(F){const w=ce.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&F.preventDefault(),c(this))return;j.one(w,dC,()=>{l(this)&&this.focus()});const A=ce.findOne(cC);A&&A!==w&&Pa.getInstance(A).hide(),Pa.getOrCreateInstance(w).toggle(this)}),j.on(window,z3,()=>{for(const F of ce.find(cC))Pa.getOrCreateInstance(F).show()}),j.on(window,q3,()=>{for(const F of ce.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(F).position!=="fixed"&&Pa.getOrCreateInstance(F).hide()}),Ue(Pa),y(Pa);const fC={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},J3=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Z3=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,eL=(F,w)=>{const A=F.nodeName.toLowerCase();return w.includes(A)?!J3.has(A)||!!Z3.test(F.nodeValue):w.filter(L=>L instanceof RegExp).some(L=>L.test(A))},tL={allowList:fC,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},nL={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},rL={entry:"(string|element|function|null)",selector:"(string|element)"};class iL extends Ee{constructor(w){super(),this._config=this._getConfig(w)}static get Default(){return tL}static get DefaultType(){return nL}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(w=>this._resolvePossibleFunction(w)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(w){return this._checkContent(w),this._config.content={...this._config.content,...w},this}toHtml(){const w=document.createElement("div");w.innerHTML=this._maybeSanitize(this._config.template);for(const[Z,te]of Object.entries(this._config.content))this._setContent(w,te,Z);const A=w.children[0],L=this._resolvePossibleFunction(this._config.extraClass);return L&&A.classList.add(...L.split(" ")),A}_typeCheckConfig(w){super._typeCheckConfig(w),this._checkContent(w.content)}_checkContent(w){for(const[A,L]of Object.entries(w))super._typeCheckConfig({selector:A,entry:L},rL)}_setContent(w,A,L){const Z=ce.findOne(L,w);Z&&((A=this._resolvePossibleFunction(A))?s(A)?this._putElementInTemplate(u(A),Z):this._config.html?Z.innerHTML=this._maybeSanitize(A):Z.textContent=A:Z.remove())}_maybeSanitize(w){return this._config.sanitize?function(A,L,Z){if(!A.length)return A;if(Z&&typeof Z=="function")return Z(A);const te=new window.DOMParser().parseFromString(A,"text/html"),ae=[].concat(...te.body.querySelectorAll("*"));for(const me of ae){const be=me.nodeName.toLowerCase();if(!Object.keys(L).includes(be)){me.remove();continue}const ke=[].concat(...me.attributes),Ne=[].concat(L["*"]||[],L[be]||[]);for(const Se of ke)eL(Se,Ne)||me.removeAttribute(Se.nodeName)}return te.body.innerHTML}(w,this._config.allowList,this._config.sanitizeFn):w}_resolvePossibleFunction(w){return x(w,[this])}_putElementInTemplate(w,A){if(this._config.html)return A.innerHTML="",void A.append(w);A.textContent=w.textContent}}const oL=new Set(["sanitize","allowList","sanitizeFn"]),W0="fade",Lm="show",pC=".modal",mC="hide.bs.modal",Qd="hover",j0="focus",aL={AUTO:"auto",TOP:"top",RIGHT:g()?"left":"right",BOTTOM:"bottom",LEFT:g()?"right":"left"},sL={allowList:fC,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},uL={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ul extends Ce{constructor(w,A){if(Oc===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(w,A),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return sL}static get DefaultType(){return uL}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),j.off(this._element.closest(pC),mC,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const w=j.trigger(this._element,this.constructor.eventName("show")),A=(h(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(w.defaultPrevented||!A)return;this._disposePopper();const L=this._getTipElement();this._element.setAttribute("aria-describedby",L.getAttribute("id"));const{container:Z}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(Z.append(L),j.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(L),L.classList.add(Lm),"ontouchstart"in document.documentElement)for(const te of[].concat(...document.body.children))j.on(te,"mouseover",d);this._queueCallback(()=>{j.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!j.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Lm),"ontouchstart"in document.documentElement)for(const w of[].concat(...document.body.children))j.off(w,"mouseover",d);this._activeTrigger.click=!1,this._activeTrigger[j0]=!1,this._activeTrigger[Qd]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),j.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(w){const A=this._getTemplateFactory(w).toHtml();if(!A)return null;A.classList.remove(W0,Lm),A.classList.add(`bs-${this.constructor.NAME}-auto`);const L=(Z=>{do Z+=Math.floor(1e6*Math.random());while(document.getElementById(Z));return Z})(this.constructor.NAME).toString();return A.setAttribute("id",L),this._isAnimated()&&A.classList.add(W0),A}setContent(w){this._newContent=w,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(w){return this._templateFactory?this._templateFactory.changeContent(w):this._templateFactory=new iL({...this._config,content:w,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(w){return this.constructor.getOrCreateInstance(w.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(W0)}_isShown(){return this.tip&&this.tip.classList.contains(Lm)}_createPopper(w){const A=x(this._config.placement,[this,w,this._element]),L=aL[A.toUpperCase()];return ol(this._element,w,this._getPopperConfig(L))}_getOffset(){const{offset:w}=this._config;return typeof w=="string"?w.split(",").map(A=>Number.parseInt(A,10)):typeof w=="function"?A=>w(A,this._element):w}_resolvePossibleFunction(w){return x(w,[this._element])}_getPopperConfig(w){const A={placement:w,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:L=>{this._getTipElement().setAttribute("data-popper-placement",L.state.placement)}}]};return{...A,...x(this._config.popperConfig,[A])}}_setListeners(){const w=this._config.trigger.split(" ");for(const A of w)if(A==="click")j.on(this._element,this.constructor.eventName("click"),this._config.selector,L=>{this._initializeOnDelegatedTarget(L).toggle()});else if(A!=="manual"){const L=A===Qd?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),Z=A===Qd?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");j.on(this._element,L,this._config.selector,te=>{const ae=this._initializeOnDelegatedTarget(te);ae._activeTrigger[te.type==="focusin"?j0:Qd]=!0,ae._enter()}),j.on(this._element,Z,this._config.selector,te=>{const ae=this._initializeOnDelegatedTarget(te);ae._activeTrigger[te.type==="focusout"?j0:Qd]=ae._element.contains(te.relatedTarget),ae._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},j.on(this._element.closest(pC),mC,this._hideModalHandler)}_fixTitle(){const w=this._element.getAttribute("title");w&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",w),this._element.setAttribute("data-bs-original-title",w),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(w,A){clearTimeout(this._timeout),this._timeout=setTimeout(w,A)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(w){const A=we.getDataAttributes(this._element);for(const L of Object.keys(A))oL.has(L)&&delete A[L];return w={...A,...typeof w=="object"&&w?w:{}},w=this._mergeConfigObj(w),w=this._configAfterMerge(w),this._typeCheckConfig(w),w}_configAfterMerge(w){return w.container=w.container===!1?document.body:u(w.container),typeof w.delay=="number"&&(w.delay={show:w.delay,hide:w.delay}),typeof w.title=="number"&&(w.title=w.title.toString()),typeof w.content=="number"&&(w.content=w.content.toString()),w}_getDelegateConfig(){const w={};for(const[A,L]of Object.entries(this._config))this.constructor.Default[A]!==L&&(w[A]=L);return w.selector=!1,w.trigger="manual",w}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(w){return this.each(function(){const A=ul.getOrCreateInstance(this,w);if(typeof w=="string"){if(A[w]===void 0)throw new TypeError(`No method named "${w}"`);A[w]()}})}}y(ul);const lL={...ul.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},cL={...ul.DefaultType,content:"(null|string|element|function)"};class Bm extends ul{static get Default(){return lL}static get DefaultType(){return cL}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(w){return this.each(function(){const A=Bm.getOrCreateInstance(this,w);if(typeof w=="string"){if(A[w]===void 0)throw new TypeError(`No method named "${w}"`);A[w]()}})}}y(Bm);const z0=".bs.scrollspy",hL=`activate${z0}`,vC=`click${z0}`,dL=`load${z0}.data-api`,Lc="active",$0="[href]",gC=".nav-link",fL=`${gC}, .nav-item > ${gC}, .list-group-item`,pL={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},mL={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Yd extends Ce{constructor(w,A){super(w,A),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return pL}static get DefaultType(){return mL}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const w of this._observableSections.values())this._observer.observe(w)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(w){return w.target=u(w.target)||document.body,w.rootMargin=w.offset?`${w.offset}px 0px -30%`:w.rootMargin,typeof w.threshold=="string"&&(w.threshold=w.threshold.split(",").map(A=>Number.parseFloat(A))),w}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(j.off(this._config.target,vC),j.on(this._config.target,vC,$0,w=>{const A=this._observableSections.get(w.target.hash);if(A){w.preventDefault();const L=this._rootElement||window,Z=A.offsetTop-this._element.offsetTop;if(L.scrollTo)return void L.scrollTo({top:Z,behavior:"smooth"});L.scrollTop=Z}}))}_getNewObserver(){const w={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(A=>this._observerCallback(A),w)}_observerCallback(w){const A=ae=>this._targetLinks.get(`#${ae.target.id}`),L=ae=>{this._previousScrollData.visibleEntryTop=ae.target.offsetTop,this._process(A(ae))},Z=(this._rootElement||document.documentElement).scrollTop,te=Z>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Z;for(const ae of w){if(!ae.isIntersecting){this._activeTarget=null,this._clearActiveClass(A(ae));continue}const me=ae.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(te&&me){if(L(ae),!Z)return}else te||me||L(ae)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const w=ce.find($0,this._config.target);for(const A of w){if(!A.hash||c(A))continue;const L=ce.findOne(decodeURI(A.hash),this._element);l(L)&&(this._targetLinks.set(decodeURI(A.hash),A),this._observableSections.set(A.hash,L))}}_process(w){this._activeTarget!==w&&(this._clearActiveClass(this._config.target),this._activeTarget=w,w.classList.add(Lc),this._activateParents(w),j.trigger(this._element,hL,{relatedTarget:w}))}_activateParents(w){if(w.classList.contains("dropdown-item"))ce.findOne(".dropdown-toggle",w.closest(".dropdown")).classList.add(Lc);else for(const A of ce.parents(w,".nav, .list-group"))for(const L of ce.prev(A,fL))L.classList.add(Lc)}_clearActiveClass(w){w.classList.remove(Lc);const A=ce.find(`${$0}.${Lc}`,w);for(const L of A)L.classList.remove(Lc)}static jQueryInterface(w){return this.each(function(){const A=Yd.getOrCreateInstance(this,w);if(typeof w=="string"){if(A[w]===void 0||w.startsWith("_")||w==="constructor")throw new TypeError(`No method named "${w}"`);A[w]()}})}}j.on(window,dL,()=>{for(const F of ce.find('[data-bs-spy="scroll"]'))Yd.getOrCreateInstance(F)}),y(Yd);const ll=".bs.tab",vL=`hide${ll}`,gL=`hidden${ll}`,yL=`show${ll}`,xL=`shown${ll}`,wL=`click${ll}`,_L=`keydown${ll}`,bL=`load${ll}`,EL="ArrowLeft",yC="ArrowRight",CL="ArrowUp",xC="ArrowDown",H0="Home",wC="End",cl="active",_C="fade",G0="show",bC=".dropdown-toggle",q0=`:not(${bC})`,EC='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',K0=`.nav-link${q0}, .list-group-item${q0}, [role="tab"]${q0}, ${EC}`,TL=`.${cl}[data-bs-toggle="tab"], .${cl}[data-bs-toggle="pill"], .${cl}[data-bs-toggle="list"]`;class hl extends Ce{constructor(w){super(w),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),j.on(this._element,_L,A=>this._keydown(A)))}static get NAME(){return"tab"}show(){const w=this._element;if(this._elemIsActive(w))return;const A=this._getActiveElem(),L=A?j.trigger(A,vL,{relatedTarget:w}):null;j.trigger(w,yL,{relatedTarget:A}).defaultPrevented||L&&L.defaultPrevented||(this._deactivate(A,w),this._activate(w,A))}_activate(w,A){w&&(w.classList.add(cl),this._activate(ce.getElementFromSelector(w)),this._queueCallback(()=>{w.getAttribute("role")==="tab"?(w.removeAttribute("tabindex"),w.setAttribute("aria-selected",!0),this._toggleDropDown(w,!0),j.trigger(w,xL,{relatedTarget:A})):w.classList.add(G0)},w,w.classList.contains(_C)))}_deactivate(w,A){w&&(w.classList.remove(cl),w.blur(),this._deactivate(ce.getElementFromSelector(w)),this._queueCallback(()=>{w.getAttribute("role")==="tab"?(w.setAttribute("aria-selected",!1),w.setAttribute("tabindex","-1"),this._toggleDropDown(w,!1),j.trigger(w,gL,{relatedTarget:A})):w.classList.remove(G0)},w,w.classList.contains(_C)))}_keydown(w){if(![EL,yC,CL,xC,H0,wC].includes(w.key))return;w.stopPropagation(),w.preventDefault();const A=this._getChildren().filter(Z=>!c(Z));let L;if([H0,wC].includes(w.key))L=A[w.key===H0?0:A.length-1];else{const Z=[yC,xC].includes(w.key);L=b(A,w.target,Z,!0)}L&&(L.focus({preventScroll:!0}),hl.getOrCreateInstance(L).show())}_getChildren(){return ce.find(K0,this._parent)}_getActiveElem(){return this._getChildren().find(w=>this._elemIsActive(w))||null}_setInitialAttributes(w,A){this._setAttributeIfNotExists(w,"role","tablist");for(const L of A)this._setInitialAttributesOnChild(L)}_setInitialAttributesOnChild(w){w=this._getInnerElement(w);const A=this._elemIsActive(w),L=this._getOuterElement(w);w.setAttribute("aria-selected",A),L!==w&&this._setAttributeIfNotExists(L,"role","presentation"),A||w.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(w,"role","tab"),this._setInitialAttributesOnTargetPanel(w)}_setInitialAttributesOnTargetPanel(w){const A=ce.getElementFromSelector(w);A&&(this._setAttributeIfNotExists(A,"role","tabpanel"),w.id&&this._setAttributeIfNotExists(A,"aria-labelledby",`${w.id}`))}_toggleDropDown(w,A){const L=this._getOuterElement(w);if(!L.classList.contains("dropdown"))return;const Z=(te,ae)=>{const me=ce.findOne(te,L);me&&me.classList.toggle(ae,A)};Z(bC,cl),Z(".dropdown-menu",G0),L.setAttribute("aria-expanded",A)}_setAttributeIfNotExists(w,A,L){w.hasAttribute(A)||w.setAttribute(A,L)}_elemIsActive(w){return w.classList.contains(cl)}_getInnerElement(w){return w.matches(K0)?w:ce.findOne(K0,w)}_getOuterElement(w){return w.closest(".nav-item, .list-group-item")||w}static jQueryInterface(w){return this.each(function(){const A=hl.getOrCreateInstance(this);if(typeof w=="string"){if(A[w]===void 0||w.startsWith("_")||w==="constructor")throw new TypeError(`No method named "${w}"`);A[w]()}})}}j.on(document,wL,EC,function(F){["A","AREA"].includes(this.tagName)&&F.preventDefault(),c(this)||hl.getOrCreateInstance(this).show()}),j.on(window,bL,()=>{for(const F of ce.find(TL))hl.getOrCreateInstance(F)}),y(hl);const Ls=".bs.toast",IL=`mouseover${Ls}`,SL=`mouseout${Ls}`,RL=`focusin${Ls}`,kL=`focusout${Ls}`,AL=`hide${Ls}`,NL=`hidden${Ls}`,DL=`show${Ls}`,PL=`shown${Ls}`,CC="hide",Vm="show",Um="showing",OL={animation:"boolean",autohide:"boolean",delay:"number"},ML={animation:!0,autohide:!0,delay:5e3};class Jd extends Ce{constructor(w,A){super(w,A),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return ML}static get DefaultType(){return OL}static get NAME(){return"toast"}show(){j.trigger(this._element,DL).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(CC),f(this._element),this._element.classList.add(Vm,Um),this._queueCallback(()=>{this._element.classList.remove(Um),j.trigger(this._element,PL),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(j.trigger(this._element,AL).defaultPrevented||(this._element.classList.add(Um),this._queueCallback(()=>{this._element.classList.add(CC),this._element.classList.remove(Um,Vm),j.trigger(this._element,NL)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Vm),super.dispose()}isShown(){return this._element.classList.contains(Vm)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(w,A){switch(w.type){case"mouseover":case"mouseout":this._hasMouseInteraction=A;break;case"focusin":case"focusout":this._hasKeyboardInteraction=A}if(A)return void this._clearTimeout();const L=w.relatedTarget;this._element===L||this._element.contains(L)||this._maybeScheduleHide()}_setListeners(){j.on(this._element,IL,w=>this._onInteraction(w,!0)),j.on(this._element,SL,w=>this._onInteraction(w,!1)),j.on(this._element,RL,w=>this._onInteraction(w,!0)),j.on(this._element,kL,w=>this._onInteraction(w,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(w){return this.each(function(){const A=Jd.getOrCreateInstance(this,w);if(typeof w=="string"){if(A[w]===void 0)throw new TypeError(`No method named "${w}"`);A[w](this)}})}}return Ue(Jd),y(Jd),{Alert:We,Button:ot,Carousel:Ta,Collapse:Oo,Dropdown:jt,Modal:sl,Offcanvas:Pa,Popover:Bm,ScrollSpy:Yd,Tab:hl,Toast:Jd,Tooltip:ul}})})(_U);/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ap(){return ap=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ap.apply(this,arguments)}var tu;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(tu||(tu={}));const GT="popstate";function bU(n){n===void 0&&(n={});function e(r,i){let{pathname:o,search:a,hash:s}=r.location;return vw("",{pathname:o,search:a,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Ig(i)}return CU(e,t,null,n)}function kn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function CN(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function EU(){return Math.random().toString(36).substr(2,8)}function qT(n,e){return{usr:n.state,key:n.key,idx:e}}function vw(n,e,t,r){return t===void 0&&(t=null),ap({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?dd(e):e,{state:t,key:e&&e.key||r||EU()})}function Ig(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function dd(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function CU(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:o=!1}=r,a=i.history,s=tu.Pop,u=null,l=c();l==null&&(l=0,a.replaceState(ap({},a.state,{idx:l}),""));function c(){return(a.state||{idx:null}).idx}function h(){s=tu.Pop;let g=c(),y=g==null?null:g-l;l=g,u&&u({action:s,location:m.location,delta:y})}function d(g,y){s=tu.Push;let x=vw(m.location,g,y);l=c()+1;let _=qT(x,l),b=m.createHref(x);try{a.pushState(_,"",b)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(b)}o&&u&&u({action:s,location:m.location,delta:1})}function f(g,y){s=tu.Replace;let x=vw(m.location,g,y);l=c();let _=qT(x,l),b=m.createHref(x);a.replaceState(_,"",b),o&&u&&u({action:s,location:m.location,delta:0})}function p(g){let y=i.location.origin!=="null"?i.location.origin:i.location.href,x=typeof g=="string"?g:Ig(g);return x=x.replace(/ $/,"%20"),kn(y,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,y)}let m={get action(){return s},get location(){return n(i,a)},listen(g){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(GT,h),u=g,()=>{i.removeEventListener(GT,h),u=null}},createHref(g){return e(i,g)},createURL:p,encodeLocation(g){let y=p(g);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:d,replace:f,go(g){return a.go(g)}};return m}var KT;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(KT||(KT={}));function TU(n,e,t){return t===void 0&&(t="/"),IU(n,e,t,!1)}function IU(n,e,t,r){let i=typeof e=="string"?dd(e):e,o=kb(i.pathname||"/",t);if(o==null)return null;let a=TN(n);SU(a);let s=null;for(let u=0;s==null&&u<a.length;++u){let l=BU(o);s=FU(a[u],l,r)}return s}function TN(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(o,a,s)=>{let u={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};u.relativePath.startsWith("/")&&(kn(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let l=mu([r,u.relativePath]),c=t.concat(u);o.children&&o.children.length>0&&(kn(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),TN(o.children,e,c,l)),!(o.path==null&&!o.index)&&e.push({path:l,score:OU(l,o.index),routesMeta:c})};return n.forEach((o,a)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))i(o,a);else for(let u of IN(o.path))i(o,a,u)}),e}function IN(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let a=IN(r.join("/")),s=[];return s.push(...a.map(u=>u===""?o:[o,u].join("/"))),i&&s.push(...a),s.map(u=>n.startsWith("/")&&u===""?"/":u)}function SU(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:MU(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const RU=/^:[\w-]+$/,kU=3,AU=2,NU=1,DU=10,PU=-2,XT=n=>n==="*";function OU(n,e){let t=n.split("/"),r=t.length;return t.some(XT)&&(r+=PU),e&&(r+=AU),t.filter(i=>!XT(i)).reduce((i,o)=>i+(RU.test(o)?kU:o===""?NU:DU),r)}function MU(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function FU(n,e,t){let{routesMeta:r}=n,i={},o="/",a=[];for(let s=0;s<r.length;++s){let u=r[s],l=s===r.length-1,c=o==="/"?e:e.slice(o.length)||"/",h=QT({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),d=u.route;if(!h&&l&&t&&!r[r.length-1].route.index&&(h=QT({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!h)return null;Object.assign(i,h.params),a.push({params:i,pathname:mu([o,h.pathname]),pathnameBase:jU(mu([o,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(o=mu([o,h.pathnameBase]))}return a}function QT(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=LU(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce((l,c,h)=>{let{paramName:d,isOptional:f}=c;if(d==="*"){let m=s[h]||"";a=o.slice(0,o.length-m.length).replace(/(.)\/+$/,"$1")}const p=s[h];return f&&!p?l[d]=void 0:l[d]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:a,pattern:n}}function LU(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),CN(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,u)=>(r.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function BU(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return CN(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function kb(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function VU(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?dd(n):n;return{pathname:t?t.startsWith("/")?t:UU(t,e):e,search:zU(r),hash:$U(i)}}function UU(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function C1(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function WU(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Ab(n,e){let t=WU(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function Nb(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=dd(n):(i=ap({},n),kn(!i.pathname||!i.pathname.includes("?"),C1("?","pathname","search",i)),kn(!i.pathname||!i.pathname.includes("#"),C1("#","pathname","hash",i)),kn(!i.search||!i.search.includes("#"),C1("#","search","hash",i)));let o=n===""||i.pathname==="",a=o?"/":i.pathname,s;if(a==null)s=t;else{let h=e.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;i.pathname=d.join("/")}s=h>=0?e[h]:"/"}let u=VU(i,s),l=a&&a!=="/"&&a.endsWith("/"),c=(o||a===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const mu=n=>n.join("/").replace(/\/\/+/g,"/"),jU=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),zU=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,$U=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function HU(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const SN=["post","put","patch","delete"];new Set(SN);const GU=["get",...SN];new Set(GU);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function sp(){return sp=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},sp.apply(this,arguments)}const Db=fe.createContext(null),qU=fe.createContext(null),Vu=fe.createContext(null),Gy=fe.createContext(null),Uu=fe.createContext({outlet:null,matches:[],isDataRoute:!1}),RN=fe.createContext(null);function KU(n,e){let{relative:t}=e===void 0?{}:e;fd()||kn(!1);let{basename:r,navigator:i}=fe.useContext(Vu),{hash:o,pathname:a,search:s}=AN(n,{relative:t}),u=a;return r!=="/"&&(u=a==="/"?r:mu([r,a])),i.createHref({pathname:u,search:s,hash:o})}function fd(){return fe.useContext(Gy)!=null}function nc(){return fd()||kn(!1),fe.useContext(Gy).location}function kN(n){fe.useContext(Vu).static||fe.useLayoutEffect(n)}function Np(){let{isDataRoute:n}=fe.useContext(Uu);return n?sW():XU()}function XU(){fd()||kn(!1);let n=fe.useContext(Db),{basename:e,future:t,navigator:r}=fe.useContext(Vu),{matches:i}=fe.useContext(Uu),{pathname:o}=nc(),a=JSON.stringify(Ab(i,t.v7_relativeSplatPath)),s=fe.useRef(!1);return kN(()=>{s.current=!0}),fe.useCallback(function(l,c){if(c===void 0&&(c={}),!s.current)return;if(typeof l=="number"){r.go(l);return}let h=Nb(l,JSON.parse(a),o,c.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:mu([e,h.pathname])),(c.replace?r.replace:r.push)(h,c.state,c)},[e,r,a,o,n])}function AN(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=fe.useContext(Vu),{matches:i}=fe.useContext(Uu),{pathname:o}=nc(),a=JSON.stringify(Ab(i,r.v7_relativeSplatPath));return fe.useMemo(()=>Nb(n,JSON.parse(a),o,t==="path"),[n,a,o,t])}function QU(n,e){return YU(n,e)}function YU(n,e,t,r){fd()||kn(!1);let{navigator:i}=fe.useContext(Vu),{matches:o}=fe.useContext(Uu),a=o[o.length-1],s=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let l=nc(),c;if(e){var h;let g=typeof e=="string"?dd(e):e;u==="/"||(h=g.pathname)!=null&&h.startsWith(u)||kn(!1),c=g}else c=l;let d=c.pathname||"/",f=d;if(u!=="/"){let g=u.replace(/^\//,"").split("/");f="/"+d.replace(/^\//,"").split("/").slice(g.length).join("/")}let p=TU(n,{pathname:f}),m=nW(p&&p.map(g=>Object.assign({},g,{params:Object.assign({},s,g.params),pathname:mu([u,i.encodeLocation?i.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?u:mu([u,i.encodeLocation?i.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),o,t,r);return e&&m?fe.createElement(Gy.Provider,{value:{location:sp({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:tu.Pop}},m):m}function JU(){let n=aW(),e=HU(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return fe.createElement(fe.Fragment,null,fe.createElement("h2",null,"Unexpected Application Error!"),fe.createElement("h3",{style:{fontStyle:"italic"}},e),t?fe.createElement("pre",{style:i},t):null,null)}const ZU=fe.createElement(JU,null);class eW extends fe.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?fe.createElement(Uu.Provider,{value:this.props.routeContext},fe.createElement(RN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function tW(n){let{routeContext:e,match:t,children:r}=n,i=fe.useContext(Db);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),fe.createElement(Uu.Provider,{value:e},r)}function nW(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var o;if(!t)return null;if(t.errors)n=t.matches;else if((o=r)!=null&&o.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,s=(i=t)==null?void 0:i.errors;if(s!=null){let c=a.findIndex(h=>h.route.id&&(s==null?void 0:s[h.route.id])!==void 0);c>=0||kn(!1),a=a.slice(0,Math.min(a.length,c+1))}let u=!1,l=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let h=a[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=c),h.route.id){let{loaderData:d,errors:f}=t,p=h.route.loader&&d[h.route.id]===void 0&&(!f||f[h.route.id]===void 0);if(h.route.lazy||p){u=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((c,h,d)=>{let f,p=!1,m=null,g=null;t&&(f=s&&h.route.id?s[h.route.id]:void 0,m=h.route.errorElement||ZU,u&&(l<0&&d===0?(p=!0,g=null):l===d&&(p=!0,g=h.route.hydrateFallbackElement||null)));let y=e.concat(a.slice(0,d+1)),x=()=>{let _;return f?_=m:p?_=g:h.route.Component?_=fe.createElement(h.route.Component,null):h.route.element?_=h.route.element:_=c,fe.createElement(tW,{match:h,routeContext:{outlet:c,matches:y,isDataRoute:t!=null},children:_})};return t&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?fe.createElement(eW,{location:t.location,revalidation:t.revalidation,component:m,error:f,children:x(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):x()},null)}var NN=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(NN||{}),Sg=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Sg||{});function rW(n){let e=fe.useContext(Db);return e||kn(!1),e}function iW(n){let e=fe.useContext(qU);return e||kn(!1),e}function oW(n){let e=fe.useContext(Uu);return e||kn(!1),e}function DN(n){let e=oW(),t=e.matches[e.matches.length-1];return t.route.id||kn(!1),t.route.id}function aW(){var n;let e=fe.useContext(RN),t=iW(Sg.UseRouteError),r=DN(Sg.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function sW(){let{router:n}=rW(NN.UseNavigateStable),e=DN(Sg.UseNavigateStable),t=fe.useRef(!1);return kN(()=>{t.current=!0}),fe.useCallback(function(i,o){o===void 0&&(o={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,sp({fromRouteId:e},o)))},[n,e])}function uf(n){let{to:e,replace:t,state:r,relative:i}=n;fd()||kn(!1);let{future:o,static:a}=fe.useContext(Vu),{matches:s}=fe.useContext(Uu),{pathname:u}=nc(),l=Np(),c=Nb(e,Ab(s,o.v7_relativeSplatPath),u,i==="path"),h=JSON.stringify(c);return fe.useEffect(()=>l(JSON.parse(h),{replace:t,state:r,relative:i}),[l,h,i,t,r]),null}function vo(n){kn(!1)}function uW(n){let{basename:e="/",children:t=null,location:r,navigationType:i=tu.Pop,navigator:o,static:a=!1,future:s}=n;fd()&&kn(!1);let u=e.replace(/^\/*/,"/"),l=fe.useMemo(()=>({basename:u,navigator:o,static:a,future:sp({v7_relativeSplatPath:!1},s)}),[u,s,o,a]);typeof r=="string"&&(r=dd(r));let{pathname:c="/",search:h="",hash:d="",state:f=null,key:p="default"}=r,m=fe.useMemo(()=>{let g=kb(c,u);return g==null?null:{location:{pathname:g,search:h,hash:d,state:f,key:p},navigationType:i}},[u,c,h,d,f,p,i]);return m==null?null:fe.createElement(Vu.Provider,{value:l},fe.createElement(Gy.Provider,{children:t,value:m}))}function lW(n){let{children:e,location:t}=n;return QU(gw(e),t)}new Promise(()=>{});function gw(n,e){e===void 0&&(e=[]);let t=[];return fe.Children.forEach(n,(r,i)=>{if(!fe.isValidElement(r))return;let o=[...e,i];if(r.type===fe.Fragment){t.push.apply(t,gw(r.props.children,o));return}r.type!==vo&&kn(!1),!r.props.index||!r.props.children||kn(!1);let a={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=gw(r.props.children,o)),t.push(a)}),t}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yw(){return yw=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},yw.apply(this,arguments)}function cW(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function hW(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function dW(n,e){return n.button===0&&(!e||e==="_self")&&!hW(n)}const fW=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],pW="6";try{window.__reactRouterVersion=pW}catch{}const mW="startTransition",YT=lB[mW];function vW(n){let{basename:e,children:t,future:r,window:i}=n,o=fe.useRef();o.current==null&&(o.current=bU({window:i,v5Compat:!0}));let a=o.current,[s,u]=fe.useState({action:a.action,location:a.location}),{v7_startTransition:l}=r||{},c=fe.useCallback(h=>{l&&YT?YT(()=>u(h)):u(h)},[u,l]);return fe.useLayoutEffect(()=>a.listen(c),[a,c]),fe.createElement(uW,{basename:e,children:t,location:s.location,navigationType:s.action,navigator:a,future:r})}const gW=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",yW=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vl=fe.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:o,replace:a,state:s,target:u,to:l,preventScrollReset:c,unstable_viewTransition:h}=e,d=cW(e,fW),{basename:f}=fe.useContext(Vu),p,m=!1;if(typeof l=="string"&&yW.test(l)&&(p=l,gW))try{let _=new URL(window.location.href),b=l.startsWith("//")?new URL(_.protocol+l):new URL(l),C=kb(b.pathname,f);b.origin===_.origin&&C!=null?l=C+b.search+b.hash:m=!0}catch{}let g=KU(l,{relative:i}),y=xW(l,{replace:a,state:s,target:u,preventScrollReset:c,relative:i,unstable_viewTransition:h});function x(_){r&&r(_),_.defaultPrevented||y(_)}return fe.createElement("a",yw({},d,{href:p||g,onClick:m||o?r:x,ref:t,target:u}))});var JT;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(JT||(JT={}));var ZT;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(ZT||(ZT={}));function xW(n,e){let{target:t,replace:r,state:i,preventScrollReset:o,relative:a,unstable_viewTransition:s}=e===void 0?{}:e,u=Np(),l=nc(),c=AN(n,{relative:a});return fe.useCallback(h=>{if(dW(h,t)){h.preventDefault();let d=r!==void 0?r:Ig(l)===Ig(c);u(n,{replace:d,state:i,preventScrollReset:o,relative:a,unstable_viewTransition:s})}},[l,u,c,r,i,t,n,o,a,s])}function wW(){return P.jsx("div",{children:P.jsx("nav",{className:"navbar navbar-expand-lg",style:{position:"sticky",top:"0",zIndex:"1000",backgroundColor:"#fff",boxShadow:"0 4px 2px -2px gray",padding:"0.5rem 1rem",height:"60px",display:"flex",justifyContent:"space-between",overflow:"hidden"},children:P.jsxs("div",{className:"container-fluid",style:{display:"flex",alignItems:"center"},children:[P.jsx(vl,{className:"navbar-brand",to:"/home",style:{marginLeft:"2rem"},children:P.jsx("img",{src:"./src/assets/component/About/final logo.jpg",alt:"Logo",style:{height:"53px",width:"53px",borderRadius:"50%",border:"4px solid #f6e57aF",transition:"transform 0.3s ease"},onMouseEnter:n=>{n.target.style.transform="scale(1.2)"},onMouseLeave:n=>{n.target.style.transform="scale(1)"}})}),P.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarScroll","aria-controls":"navbarScroll","aria-expanded":"false","aria-label":"Toggle navigation",children:P.jsx("span",{className:"navbar-toggler-icon"})}),P.jsx("div",{className:"collapse navbar-collapse",id:"navbarScroll",style:{marginLeft:"auto"},children:P.jsxs("ul",{className:"navbar-nav ms-auto my-2 my-lg-0 navbar-nav-scroll",style:{marginRight:"2rem"},children:[P.jsx("li",{className:"nav-item",style:{marginRight:"1.9rem",fontFamily:"Verdana, Geneva, Tahoma, sans-serif",fontWeight:"bold",fontSize:"medium"},children:P.jsx(vl,{className:"nav-link","aria-current":"page",to:"/home",children:"Home"})}),P.jsx("li",{className:"nav-item",style:{marginRight:"1.5rem",fontFamily:"Verdana, Geneva, Tahoma, sans-serif",fontWeight:"bold",fontSize:"medium"},children:P.jsx(vl,{className:"nav-link",to:"/about",children:"About"})}),P.jsx("li",{className:"nav-item",style:{marginRight:"1.5rem",fontFamily:"Verdana, Geneva, Tahoma, sans-serif",fontWeight:"bold",fontSize:"medium"},children:P.jsx(vl,{className:"nav-link",to:"/online-test",children:"Online Test"})}),P.jsx("li",{className:"nav-item",style:{marginRight:"1.5rem",fontFamily:"Verdana, Geneva, Tahoma, sans-serif",fontWeight:"bold",fontSize:"medium"},children:P.jsx(vl,{className:"nav-link",to:"/contact",children:"Contact"})}),P.jsx("li",{className:"nav-item",style:{marginRight:"1.5rem",fontFamily:"Verdana, Geneva, Tahoma, sans-serif",fontWeight:"bold",fontSize:"medium"},children:P.jsx(vl,{className:"nav-link",to:"/profile",children:"Profile"})})]})})]})})})}function _W(){const[n,e]=fe.useState({name:"",mobile:"",email:"",organization:"",message:"",agreeToTerms:!1}),t=i=>{const{name:o,value:a,type:s,checked:u}=i.target;e({...n,[o]:s==="checkbox"?u:a})},r=i=>{i.preventDefault(),console.log("Form Data:",n)};return P.jsxs("div",{className:"contact-section",children:[P.jsxs("div",{className:"intro-text",children:[P.jsx("h2",{children:"Contact Us"}),P.jsx("p",{children:"Want to get a free demo of our product? "}),P.jsx("p",{children:"Fill out the form below, and we will contact you shortly."})]}),P.jsxs("div",{className:"contact-details",children:[P.jsxs("h3",{children:[P.jsx("img",{src:"./final logo.jpg",alt:"Location",className:"icon"}),"Code Tracker"]}),P.jsx("p",{children:P.jsxs("strong",{children:[P.jsx("img",{src:"https://th.bing.com/th/id/OIP.ZbZxdCrtalJVB3OIWp31MQHaHa?w=203&h=203&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"Email",className:"icon"})," Email"]})}),P.jsxs("p",{children:["Request proctoring: ",P.jsx("a",{href:"mailto:code@tracker24.com",children:"code@tracker24.com"})]}),P.jsxs("p",{children:["Marketing and SEO cooperation: ",P.jsx("a",{href:"mailto:info@tracker24.com",children:"code@tracker24.com"})]}),P.jsx("p",{children:P.jsxs("strong",{children:[P.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/1865/1865269.png",alt:"Location",className:"icon"}),"Location"]})}),P.jsx("p",{children:" Nagpur, Maharashtra-440023"})]}),P.jsx("div",{className:"contact-content",children:P.jsx("div",{className:"contact-form",children:P.jsxs("form",{onSubmit:r,children:[P.jsxs("div",{className:"form-group",children:[P.jsx("label",{htmlFor:"name",children:"Name"}),P.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:t,placeholder:"Enter your name",required:!0})]}),P.jsxs("div",{className:"form-group",children:[P.jsx("label",{htmlFor:"mobile",children:"Mobile"}),P.jsx("input",{type:"tel",id:"mobile",name:"mobile",value:n.mobile,onChange:t,placeholder:"Enter your mobile number",required:!0})]}),P.jsxs("div",{className:"form-group",children:[P.jsx("label",{htmlFor:"email",children:"Email"}),P.jsx("input",{type:"email",id:"email",name:"email",value:n.email,onChange:t,placeholder:"Enter your email",required:!0})]}),P.jsxs("div",{className:"form-group",children:[P.jsx("label",{htmlFor:"organization",children:"Organization Name"}),P.jsx("input",{type:"text",id:"organization",name:"organization",value:n.organization,onChange:t,placeholder:"Enter your organization name",required:!0})]}),P.jsxs("div",{className:"form-group",children:[P.jsx("label",{htmlFor:"message",children:"Message/Comment"}),P.jsx("textarea",{id:"message",name:"message",value:n.message,onChange:t,rows:"4",placeholder:"Enter your message",required:!0})]}),P.jsxs("div",{className:"form-group terms",children:[P.jsx("input",{type:"checkbox",id:"terms",name:"agreeToTerms",checked:n.agreeToTerms,onChange:t,required:!0}),P.jsxs("label",{htmlFor:"terms",children:["I agree to the ",P.jsx("a",{href:"#",children:"terms of service"})]})]}),P.jsx("button",{type:"submit",className:"submit-btn",children:"Send"})]})})})]})}var PN={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},eI=Rt.createContext&&Rt.createContext(PN),bW=["attr","size","title"];function EW(n,e){if(n==null)return{};var t=CW(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function CW(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function Rg(){return Rg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Rg.apply(this,arguments)}function tI(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function kg(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?tI(Object(t),!0).forEach(function(r){TW(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):tI(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function TW(n,e,t){return e=IW(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function IW(n){var e=SW(n,"string");return typeof e=="symbol"?e:e+""}function SW(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ON(n){return n&&n.map((e,t)=>Rt.createElement(e.tag,kg({key:t},e.attr),ON(e.child)))}function MN(n){return e=>Rt.createElement(RW,Rg({attr:kg({},n.attr)},e),ON(n.child))}function RW(n){var e=t=>{var{attr:r,size:i,title:o}=n,a=EW(n,bW),s=i||t.size||"1em",u;return t.className&&(u=t.className),n.className&&(u=(u?u+" ":"")+n.className),Rt.createElement("svg",Rg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:u,style:kg(kg({color:n.color||t.color},t.style),n.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),o&&Rt.createElement("title",null,o),n.children)};return eI!==void 0?Rt.createElement(eI.Consumer,null,t=>e(t)):e(PN)}function kW(n){return MN({tag:"svg",attr:{viewBox:"0 0 256 512"},child:[{tag:"path",attr:{d:"M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"},child:[]}]})(n)}function AW(n){return MN({tag:"svg",attr:{viewBox:"0 0 256 512"},child:[{tag:"path",attr:{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"},child:[]}]})(n)}const NW=[{name:"Trushna Kaware",role:"Project Handler",email:"trkaware98@gmail.com",img:"./src/assets/component/About/meetour team/trushna.jpg",contactLink:"https://linktr.ee/trkaware98"},{name:"Kush Sahu",role:"Java Developer",email:"kushdev.com@gmail.com",img:"./src/assets/component/About/meetour team/kush.png",contactLink:"https://linktr.ee/Kushsahu"},{name:"Sonal Gurve",role:" Database Administrator & QA Tester ",email:"sonalgurve03@gmail.com",img:"./src/assets/component/About/meetour team/sonal.jpg",contactLink:""},{name:"Love Sahu",role:"React  & Node.js Developer",email:"lovevsahu2003@gmail.com",img:"./src/assets/component/About/meetour team/love.jpg",contactLink:"https://www.linkedin.com/in/love-sahu-sahu"},{name:"Mayur Chopade",role:" UI/UX & Graphic Designer ",email:"mayurchopde2000@gmail.com",img:"./src/assets/component/About/meetour team/mayur.jpg",contactLink:" "}];function DW(){const n=fe.useRef(null),e=()=>{const r=n.current;r.scrollLeft-=r.offsetWidth},t=()=>{const r=n.current;r.scrollLeft+=r.offsetWidth};return P.jsxs("section",{className:"meet-our-team",children:[P.jsx("div",{className:"team-header",children:P.jsx("h1",{children:"Meet Our Team"})}),P.jsxs("div",{className:"carousel-wrapper",children:[P.jsx(kW,{className:"carousel-arrow left",onClick:e}),P.jsx("ul",{className:"carousel",ref:n,children:NW.map((r,i)=>P.jsxs("li",{className:"card",children:[P.jsx("div",{className:"img",children:P.jsx("img",{src:r.img,alt:r.name,draggable:"false"})}),P.jsx("h1",{children:P.jsx("b",{children:r.name})}),P.jsx("h3",{children:r.role}),P.jsx("p",{className:"card-email",children:r.email}),P.jsx("p",{children:P.jsx("button",{className:"button",children:P.jsx("a",{href:r.contactLink,target:"_blank",rel:"noopener noreferrer",children:"Contact"})})})]},i))}),P.jsx(AW,{className:"carousel-arrow right",onClick:t})]})]})}const PW=()=>{const[n,e]=fe.useState(null),t=[{question:"What is this platform?",answer:"Our platform conducts online coding examinations, ensuring a secure and fair environment for all participants by detecting cheating and blocking violators automatically."},{question:"How does the system detect cheating during coding tests?",answer:"The system monitors various parameters like code similarity, time spent on problems, unusual patterns in coding behavior, and copy-pasting activities to detect cheating."},{question:"What happens if someone is caught cheating?",answer:"If cheating is detected, the user is automatically blocked from further participation in the exam. A detailed report of the violation is generated."},{question:"Can I retake the exam if I'm blocked for cheating?",answer:"Unfortunately, once a user is blocked for cheating, they will not be allowed to retake the same exam. The issue will need to be reviewed by the examination administrators.."},{question:"Is it possible to appeal a cheating block?",answer:"Yes, if you believe you were wrongly flagged, you can submit an appeal, and the case will be manually reviewed by our team."},{question:"Is the data anonymous?",answer:"Yes, the data collected by the tracker is anonymous, ensuring privacy while providing insights into coding behavior."},{question:"Do I need to install any software to take the test?",answer:"Do I need to install any software to take the test?"},{question:"How do you ensure the privacy of users?",answer:"User privacy is a top priority. All activity is monitored anonymously, and personal data is securely encrypted and stored, ensuring a secure testing environment."},{question:"How user-friendly is the interface?",answer:"Our platform is designed to be intuitive and simple for all users, regardless of technical expertise. Both exam-takers and administrators can easily navigate and perform necessary tasks."},{question:"What languages are supported for coding tests?",answer:"Our platform supports a wide variety of programming languages including Python, Java, C++, JavaScript, and many others. A full list is provided before the exam begins."}],r=i=>{e(n===i?null:i)};return P.jsxs("div",{className:"faq-container",children:[P.jsx("h1",{children:"Frequently Asked Questions"}),P.jsx("div",{className:"faq-list",children:t.map((i,o)=>P.jsxs("div",{className:`faq-item ${n===o?"active":""}`,children:[P.jsx("button",{className:"faq-question",onClick:()=>r(o),children:i.question}),P.jsx("div",{className:"faq-answer",style:{display:n===o?"block":"none"},children:P.jsx("p",{children:i.answer})})]},o))})]})};function OW(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",{className:"about-container",children:[P.jsxs("div",{className:"about-content",children:[P.jsx("h1",{className:"about-title",children:"About Code Tracker?"}),P.jsx("p",{className:"about-description",children:"Mini Cheat is an online exam integrity system designed to prevent cheating during online exams. Our platform offers real-time monitoring with advanced technologies like eye-tracking, voice recognition, and user behavior analysis."}),P.jsxs("section",{className:"about-features",children:[P.jsx("h2",{children:"Key Features"}),P.jsxs("ul",{children:[P.jsxs("li",{children:[P.jsx("strong",{children:"Real-Time Proctoring:"})," Monitors exams through live video activity tracking to ensure exam integrity."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"Real-Time Monitoring:"})," Provides real-time video and audio feeds to supervisors."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"Voice Recognition:"})," Detects unauthorized conversations during the exam."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"Eye Tracking:"})," Monitors candidates eye movements to prevent unauthorized reference."]})]})]}),P.jsxs("section",{className:"about-mission",children:[P.jsx("h2",{children:"Our Mission"}),P.jsx("p",{children:"Our mission is to promote fairness and transparency in online exams. By using AI to detect cheating, Mini Cheat ensures that every exam reflects a student’s true capabilities and prevents academic dishonesty."})]}),P.jsxs("div",{className:"about-buttons",children:[P.jsx("button",{className:"demo-btn",children:"Book a Demo"}),P.jsx("button",{className:"test-btn",children:"Take a Proctored Test"})]})]}),P.jsx("div",{className:"about-image",children:P.jsx("img",{src:"./src/assets/component/About/final logo.jpg",alt:"Mini Cheat Overview"})})]}),P.jsx(P.Fragment,{children:P.jsxs("section",{className:"how-it-works",children:[P.jsx("h2",{children:"How it Works"}),P.jsxs("div",{className:"steps-container",children:[P.jsxs("div",{className:"step",children:[P.jsx("img",{src:"./src/assets/component/About/Settings.jpg",alt:"Integrate with LMS"}),P.jsx("h3",{children:"Integrate with LMS"}),P.jsx("p",{children:"ProctorEdu allows easy and quick incorporation into any learning management system."})]}),P.jsxs("div",{className:"step",children:[P.jsx("img",{src:"./src/assets/component/About/test person.jpeg",alt:"Conduct the test"}),P.jsx("h3",{children:"Conduct the Test"}),P.jsx("p",{children:"Our system verifies the identity of the test-taker and tracks behavior throughout the test."})]}),P.jsxs("div",{className:"step",children:[P.jsx("img",{src:"./src/assets/component/About/Report.jpeg",alt:"Get the report"}),P.jsx("h3",{children:"Get the Report"}),P.jsx("p",{children:"Once the exam is completed, our system evaluates it and creates a report."})]})]})]})}),P.jsx(DW,{}),P.jsx(PW,{})]})}function MW(){return P.jsxs("section",{className:"unique-section",children:[P.jsx("h2",{className:"section-title",children:"What makes ProctorEdu unique"}),P.jsx("p",{className:"section-subtitle",children:"Online proctoring service with user-experience in mind."}),P.jsxs("div",{className:"unique-row",children:[P.jsxs("div",{className:"unique-column",children:[P.jsx("img",{src:"/Unique img/1st.jpg",alt:"Customized Experience"}),P.jsx("h3",{children:"Customized Experience"}),P.jsx("p",{children:"With both AI and live proctoring options, we align to specific needs of Higher Education and Corporate domains."})]}),P.jsxs("div",{className:"unique-column",children:[P.jsx("img",{src:"/Unique img/2nd.jpeg",alt:"Zero Stress"}),P.jsx("h3",{children:"Zero Stress"}),P.jsx("p",{children:"We achieved an impressive passing rate of 99%, reflecting efforts to increase the percentage of individuals passing with no issues."})]}),P.jsxs("div",{className:"unique-column",children:[P.jsx("img",{src:"/Unique img/3rd.jpeg",alt:"AI tools detection"}),P.jsx("h3",{children:"AI tools detection"}),P.jsx("p",{children:"To prevent the use of AI extensions such as ChatGPT during online exams, ProctorEdu provides an assortment of tools."})]})]}),P.jsxs("div",{className:"unique-row",children:[P.jsxs("div",{className:"unique-column",children:[P.jsx("img",{src:"/Unique img/4th.jpeg",alt:"Scalability"}),P.jsx("h3",{children:"Scalability"}),P.jsx("p",{children:"99.95% of sessions with no downtime, with automated proctoring to meet institutional requirements."})]}),P.jsxs("div",{className:"unique-column",children:[P.jsx("img",{src:"/Unique img/5th.jpeg",alt:"Security Matters"}),P.jsx("h3",{children:"Security Matters"}),P.jsx("p",{children:"We handle data responsibly, ensuring privacy protection and preventing misuse."})]}),P.jsxs("div",{className:"unique-column",children:[P.jsx("img",{src:"/Unique img/6th.jpeg",alt:"Single Sign On"}),P.jsx("h3",{children:"Single Sign On"}),P.jsx("p",{children:"Allows users to enter credentials once for secure access to the system."})]})]})]})}const FW="/assets/HomePageSec-DabJte3J.png",LW=()=>P.jsxs("section",{className:"proctoring-section",children:[P.jsx("h2",{children:"Easy-To-Use, Secure, and Flexible Online Proctoring Software"}),P.jsxs("div",{className:"proctoring-container",children:[P.jsx("div",{className:"image-container",children:P.jsx("img",{src:FW,alt:"Code Tracker"})}),P.jsx("div",{className:"text-container",children:P.jsxs("ul",{children:[P.jsxs("li",{children:[P.jsx("strong",{children:"Accurate and Reliable Results:"})," Our proctoring solution ensures the integrity of exams, enabling organizations to confidently hire the most competent candidates and recognize the best-performing employees."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"Cost-Effective and Scalable:"})," The solution does not require significant investments in new infrastructure. Its flexible enough to suit small businesses while scalable to support large organizations and institutions with thousands of employees or students."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"Professional Certifications:"})," Proctored exams strengthen relationships with stakeholders, who can be assured that certifications are credible and employees are evaluated rigorously, adding trust to your brand."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"Advanced AI Integration:"})," Code Tracker incorporates cutting-edge artificial intelligence to monitor and prevent cheating, including features like facial recognition, behavioral analytics, and real-time alerts."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"Data Privacy and Security:"})," Your data is safeguarded with advanced encryption and secure cloud storage solutions, ensuring compliance with GDPR and other global data protection standards."]}),P.jsxs("li",{children:[P.jsx("strong",{children:"24/7 Technical Support:"})," We offer around-the-clock technical support to ensure a smooth experience for both exam administrators and candidates, with minimal disruptions."]})]})})]})]}),BW=()=>P.jsx("div",{className:"request-demo-container",children:P.jsxs("div",{className:"request-demo-content",children:[P.jsx("p",{children:"Any questions? Leave a request, and we will contact you!"}),P.jsx(vl,{to:"/contact",className:"request-button",children:"Request a Demo"})]})}),VW="/assets/Home%20Featuress-_VPJWxII.png",UW=()=>P.jsxs("section",{className:"features-section",children:[P.jsxs("div",{className:"heading-container",children:[P.jsx("h2",{children:"Features for unmatched testing experience"}),P.jsx("h6",{children:"ProctorEdu provides organizations and institutions with a solution "}),P.jsx("h6",{children:"to secure online certification exams while maintaining full control over processes."}),P.jsx("br",{})]}),P.jsxs("div",{className:"features-content",children:[P.jsx("div",{className:"left-side",children:P.jsxs("ul",{children:[P.jsx("li",{children:"Smart behavior analytics"}),P.jsx("h6",{children:" Automatic assessment of confidence in test  "}),P.jsx("h6",{children:" results,biometric verification of identity."}),P.jsx("li",{children:"Mobile support"}),P.jsx("h6",{children:"Support on Android and iOS mobile devices."}),P.jsx("li",{children:"Minimum network requirements"}),P.jsx("h6",{children:"256 Kbit/s (100 MB/h) + "}),P.jsx("h6",{children:" automatic recovery after disconnection."})]})}),P.jsx("div",{className:"image-container",children:P.jsx("img",{src:VW,alt:"Laptop, Tablet, Mobile"})}),P.jsx("div",{className:"right-side",children:P.jsxs("ul",{children:[P.jsx("li",{children:"No downloads"}),P.jsx("h6",{children:" No need to download anything "}),P.jsx("h6",{children:"on the test takers computers."}),P.jsx("li",{children:"Additional camera"}),P.jsx("h6",{children:"Connect an additional mobile  "}),P.jsx("h6",{children:" camera for the view of 360°."}),P.jsx("li",{children:"Observation"}),P.jsx("h6",{children:" Online monitoring of up to 30 "}),P.jsx("h6",{children:"  participants simultaneously for "}),P.jsx("h6",{children:"each proctor."})]})})]})]});function WW(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",{id:"carouselExampleIndicators",className:"carousel slide","data-bs-ride":"carousel",children:[P.jsxs("ol",{className:"carousel-indicators",children:[P.jsx("li",{"data-bs-target":"#carouselExampleIndicators","data-bs-slide-to":"0",className:"active"}),P.jsx("li",{"data-bs-target":"#carouselExampleIndicators","data-bs-slide-to":"1"}),P.jsx("li",{"data-bs-target":"#carouselExampleIndicators","data-bs-slide-to":"2"})]}),P.jsx("div",{className:"carousel-item active",children:P.jsx("img",{src:"https://thinkexam.com/blog/wp-content/uploads/2019/06/Online-Proctoring-is-the-new-Trend.png",className:"d-block w-100",alt:"First slide"})}),P.jsxs("div",{className:"carousel-item",children:[P.jsx("img",{src:"https://www.techokie.com/wp-content/uploads/2020/09/online-exam-proctoring.jpg",className:"d-block w-100",alt:"Second slide"}),P.jsxs("div",{className:"carousel-caption d-none d-md-block",children:[P.jsx("h1",{style:{color:"#FF7F50"},children:"Learn about our advanced AI-powered exam monitoring solution."}),P.jsx("p",{children:"Explore how AI helps ensure integrity in online exams."})]})]}),P.jsxs("div",{className:"carousel-item",children:[P.jsx("img",{src:"https://www.projectcubicle.com/wp-content/uploads/2023/06/Grey-and-Blue-Modern-Application-Developer-Business-Presentation-3-1038x584.png",className:"d-block w-100",alt:"Third slide"}),P.jsxs("div",{className:"carousel-caption d-none d-md-block",children:[P.jsx("h1",{style:{color:"#FF7F50"},children:"Real-Time Monitoring"}),P.jsx("p",{children:"Discover real-time features for exam security."})]})]}),P.jsxs("a",{className:"carousel-control-prev",href:"#carouselExampleIndicators",role:"button","data-bs-slide":"prev",children:[P.jsx("span",{className:"carousel-control-prev-icon","aria-hidden":"true"}),P.jsx("span",{className:"sr-only",children:" "})]}),P.jsxs("a",{className:"carousel-control-next",href:"#carouselExampleIndicators",role:"button","data-bs-slide":"next",children:[P.jsx("span",{className:"carousel-control-next-icon","aria-hidden":"true"}),P.jsx("span",{className:"sr-only",children:" "})]})]}),P.jsx(LW,{}),P.jsx("br",{}),P.jsx(BW,{}),P.jsx(MW,{}),P.jsx(UW,{})]})}function jW(){return P.jsx("footer",{style:{backgroundColor:"#2c2c2c"},className:"py-4",children:P.jsx("div",{className:"container",children:P.jsxs("div",{className:"row",children:[P.jsxs("div",{className:"col-lg-3 mb-4 text-white",children:[P.jsx("img",{src:"./src/assets/component/About/final logo.jpg",alt:"CODE TRACKER",className:"mb-3",style:{width:"100px",height:"100px",borderRadius:"2px 50%",border:"2px solid white"}}),P.jsx("p",{children:"© 2023-2025 CODE TRACKER™"})]}),P.jsxs("div",{className:"col-lg-2 mb-3 text-white",children:[P.jsx("h5",{className:"font-weight-bold",children:"COMMUNITY"}),P.jsxs("ul",{className:"list-unstyled",children:[P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Auto CODE-TRACKER"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Live CODE-TRACKER"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"CODE OG CONDUCT"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Exam Monitoring Software"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"MEET THE TEAM"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Contacts"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Acknowledgements"})})]})]}),P.jsxs("div",{className:"col-lg-2 mb-3 text-white",children:[P.jsx("h5",{className:"font-weight-bold",children:"HELP"}),P.jsxs("ul",{className:"list-unstyled",children:[P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Quick start"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"CODE-TRACKER APIs"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Documentation"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"For students"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Computer check"})})]})]}),P.jsxs("div",{className:"col-lg-2 mb-3 text-white",children:[P.jsx("h5",{className:"font-weight-bold",children:"MORE"}),P.jsxs("ul",{className:"list-unstyled",children:[P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Blog"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"CODE-TRACKER NATION"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Terms e"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Privacy policy"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"General data protection regulation"})})]})]}),P.jsxs("div",{className:"col-lg-2 mb-3 text-white",children:[P.jsx("h5",{className:"font-weight-bold",children:"INFORMATION"}),P.jsxs("ul",{className:"list-unstyled",children:[P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Blog"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"About us"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Terms of service"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Accessibility statement"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"Privacy policy"})}),P.jsx("li",{children:P.jsx("a",{href:"#",className:"text-decoration-none text-primary",children:"General data protection regulation"})})]})]}),P.jsxs("div",{className:"col-lg-2 mb-3 text-white",children:[P.jsx("h5",{className:"font-weight-bold",children:"Follow Us"}),P.jsxs("div",{className:"d-flex gap-3",children:[P.jsx("a",{href:"https://www.facebook.com/react",target:"_blank",rel:"noopener",className:"text-white hover-blue",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"2.5em",height:"2.5em",fill:"currentColor",children:P.jsx("path",{d:"M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.879V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.989C18.343 21.129 22 16.99 22 12c0-5.523-4.477-10-10-10z"})})}),P.jsx("a",{href:"https://twitter.com/reactjs",target:"_blank",rel:"noopener",className:"text-white hover-blue",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:"2.5em",width:"2.5em",fill:"currentColor",children:P.jsx("path",{d:"M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48z"})})}),P.jsx("a",{href:"https://github.com/facebook/react",target:"_blank",rel:"noopener",className:"text-white hover-blue",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"2.5em",height:"2.5em",fill:"currentColor",children:P.jsx("path",{d:"M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.83-2.33 4.68-4.55 4.94.35.3.66.91.66 1.84l-.01 2.73c0 .26.18.58.68.48A10 10 0 0 0 10 0"})})})]})]})]})})})}function zW(){const n=nc(),e=Np();return P.jsxs("div",{children:[P.jsx("h1",{children:"404"}),P.jsx("h2",{children:"Page Not Found"}),P.jsxs("p",{children:["The page ",P.jsx("code",{children:n.pathname})," does not exist."]}),P.jsx("button",{onClick:()=>{e("/")},children:"Go to Home"})]})}const $W=()=>{};var nI={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},HW=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=n[t++],a=n[t++],s=n[t++],u=((i&7)<<18|(o&63)<<12|(a&63)<<6|s&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},LN={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const o=n[i],a=i+1<n.length,s=a?n[i+1]:0,u=i+2<n.length,l=u?n[i+2]:0,c=o>>2,h=(o&3)<<4|s>>4;let d=(s&15)<<2|l>>6,f=l&63;u||(f=64,a||(d=64)),r.push(t[c],t[h],t[d],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(FN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):HW(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const o=t[n.charAt(i++)],s=i<n.length?t[n.charAt(i)]:0;++i;const l=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||s==null||l==null||h==null)throw new GW;const d=o<<2|s>>4;if(r.push(d),l!==64){const f=s<<4&240|l>>2;if(r.push(f),h!==64){const p=l<<6&192|h;r.push(p)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class GW extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qW=function(n){const e=FN(n);return LN.encodeByteArray(e,!0)},Ag=function(n){return qW(n).replace(/\./g,"")},BN=function(n){try{return LN.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KW(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XW=()=>KW().__FIREBASE_DEFAULTS__,QW=()=>{if(typeof process>"u"||typeof nI>"u")return;const n=nI.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},YW=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&BN(n[1]);return e&&JSON.parse(e)},qy=()=>{try{return $W()||XW()||QW()||YW()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},VN=n=>{var e,t;return(t=(e=qy())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},JW=n=>{const e=VN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},UN=()=>{var n;return(n=qy())===null||n===void 0?void 0:n.config},WN=n=>{var e;return(e=qy())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZW{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ej(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ag(JSON.stringify(t)),Ag(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function tj(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Or())}function nj(){var n;const e=(n=qy())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function rj(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ij(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function oj(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function aj(){const n=Or();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function sj(){return!nj()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function uj(){try{return typeof indexedDB=="object"}catch{return!1}}function lj(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cj="FirebaseError";class hs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=cj,Object.setPrototypeOf(this,hs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Dp.prototype.create)}}class Dp{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?hj(o,r):"Error",s=`${this.serviceName}: ${a} (${i}).`;return new hs(i,s,r)}}function hj(n,e){return n.replace(dj,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const dj=/\{\$([^}]+)}/g;function fj(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function zl(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const o=n[i],a=e[i];if(rI(o)&&rI(a)){if(!zl(o,a))return!1}else if(o!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function rI(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pp(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function yf(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function xf(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function pj(n,e){const t=new mj(n,e);return t.subscribe.bind(t)}class mj{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");vj(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=T1),i.error===void 0&&(i.error=T1),i.complete===void 0&&(i.complete=T1);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vj(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function T1(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ji(n){return n&&n._delegate?n._delegate:n}class $l{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new ZW;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(xj(e))try{this.getOrInitializeService({instanceIdentifier:gl})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=gl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=gl){return this.instances.has(e)}getOptions(e=gl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(o);r===s&&a.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);const a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:yj(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=gl){return this.component?this.component.multipleInstances?e:gl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function yj(n){return n===gl?void 0:n}function xj(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wj{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new gj(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(gt||(gt={}));const _j={debug:gt.DEBUG,verbose:gt.VERBOSE,info:gt.INFO,warn:gt.WARN,error:gt.ERROR,silent:gt.SILENT},bj=gt.INFO,Ej={[gt.DEBUG]:"log",[gt.VERBOSE]:"log",[gt.INFO]:"info",[gt.WARN]:"warn",[gt.ERROR]:"error"},Cj=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=Ej[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Pb=class{constructor(e){this.name=e,this._logLevel=bj,this._logHandler=Cj,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in gt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_j[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,gt.DEBUG,...e),this._logHandler(this,gt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,gt.VERBOSE,...e),this._logHandler(this,gt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,gt.INFO,...e),this._logHandler(this,gt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,gt.WARN,...e),this._logHandler(this,gt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,gt.ERROR,...e),this._logHandler(this,gt.ERROR,...e)}};const Tj=(n,e)=>e.some(t=>n instanceof t);let iI,oI;function Ij(){return iI||(iI=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Sj(){return oI||(oI=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jN=new WeakMap,xw=new WeakMap,zN=new WeakMap,I1=new WeakMap,Ob=new WeakMap;function Rj(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(vu(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&jN.set(t,n)}).catch(()=>{}),Ob.set(e,n),e}function kj(n){if(xw.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});xw.set(n,e)}let ww={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return xw.get(n);if(e==="objectStoreNames")return n.objectStoreNames||zN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return vu(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Aj(n){ww=n(ww)}function Nj(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(S1(this),e,...t);return zN.set(r,e.sort?e.sort():[e]),vu(r)}:Sj().includes(n)?function(...e){return n.apply(S1(this),e),vu(jN.get(this))}:function(...e){return vu(n.apply(S1(this),e))}}function Dj(n){return typeof n=="function"?Nj(n):(n instanceof IDBTransaction&&kj(n),Tj(n,Ij())?new Proxy(n,ww):n)}function vu(n){if(n instanceof IDBRequest)return Rj(n);if(I1.has(n))return I1.get(n);const e=Dj(n);return e!==n&&(I1.set(n,e),Ob.set(e,n)),e}const S1=n=>Ob.get(n);function Pj(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const a=indexedDB.open(n,e),s=vu(a);return r&&a.addEventListener("upgradeneeded",u=>{r(vu(a.result),u.oldVersion,u.newVersion,vu(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),s.then(u=>{o&&u.addEventListener("close",()=>o()),i&&u.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),s}const Oj=["get","getKey","getAll","getAllKeys","count"],Mj=["put","add","delete","clear"],R1=new Map;function aI(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(R1.get(e))return R1.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Mj.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Oj.includes(t)))return;const o=async function(a,...s){const u=this.transaction(a,i?"readwrite":"readonly");let l=u.store;return r&&(l=l.index(s.shift())),(await Promise.all([l[t](...s),i&&u.done]))[0]};return R1.set(e,o),o}Aj(n=>({...n,get:(e,t,r)=>aI(e,t)||n.get(e,t,r),has:(e,t)=>!!aI(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fj{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Lj(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Lj(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const _w="@firebase/app",sI="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is=new Pb("@firebase/app"),Bj="@firebase/app-compat",Vj="@firebase/analytics-compat",Uj="@firebase/analytics",Wj="@firebase/app-check-compat",jj="@firebase/app-check",zj="@firebase/auth",$j="@firebase/auth-compat",Hj="@firebase/database",Gj="@firebase/data-connect",qj="@firebase/database-compat",Kj="@firebase/functions",Xj="@firebase/functions-compat",Qj="@firebase/installations",Yj="@firebase/installations-compat",Jj="@firebase/messaging",Zj="@firebase/messaging-compat",ez="@firebase/performance",tz="@firebase/performance-compat",nz="@firebase/remote-config",rz="@firebase/remote-config-compat",iz="@firebase/storage",oz="@firebase/storage-compat",az="@firebase/firestore",sz="@firebase/vertexai",uz="@firebase/firestore-compat",lz="firebase",cz="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bw="[DEFAULT]",hz={[_w]:"fire-core",[Bj]:"fire-core-compat",[Uj]:"fire-analytics",[Vj]:"fire-analytics-compat",[jj]:"fire-app-check",[Wj]:"fire-app-check-compat",[zj]:"fire-auth",[$j]:"fire-auth-compat",[Hj]:"fire-rtdb",[Gj]:"fire-data-connect",[qj]:"fire-rtdb-compat",[Kj]:"fire-fn",[Xj]:"fire-fn-compat",[Qj]:"fire-iid",[Yj]:"fire-iid-compat",[Jj]:"fire-fcm",[Zj]:"fire-fcm-compat",[ez]:"fire-perf",[tz]:"fire-perf-compat",[nz]:"fire-rc",[rz]:"fire-rc-compat",[iz]:"fire-gcs",[oz]:"fire-gcs-compat",[az]:"fire-fst",[uz]:"fire-fst-compat",[sz]:"fire-vertex","fire-js":"fire-js",[lz]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ng=new Map,dz=new Map,Ew=new Map;function uI(n,e){try{n.container.addComponent(e)}catch(t){is.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function jh(n){const e=n.name;if(Ew.has(e))return is.debug(`There were multiple attempts to register component ${e}.`),!1;Ew.set(e,n);for(const t of Ng.values())uI(t,n);for(const t of dz.values())uI(t,n);return!0}function Mb(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function gi(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fz={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},gu=new Dp("app","Firebase",fz);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pz{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new $l("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw gu.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd=cz;function $N(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:bw,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw gu.create("bad-app-name",{appName:String(i)});if(t||(t=UN()),!t)throw gu.create("no-options");const o=Ng.get(i);if(o){if(zl(t,o.options)&&zl(r,o.config))return o;throw gu.create("duplicate-app",{appName:i})}const a=new wj(i);for(const u of Ew.values())a.addComponent(u);const s=new pz(t,r,a);return Ng.set(i,s),s}function HN(n=bw){const e=Ng.get(n);if(!e&&n===bw&&UN())return $N();if(!e)throw gu.create("no-app",{appName:n});return e}function yu(n,e,t){var r;let i=(r=hz[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const s=[`Unable to register library "${i}" with version "${e}":`];o&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&s.push("and"),a&&s.push(`version name "${e}" contains illegal characters (whitespace or "/")`),is.warn(s.join(" "));return}jh(new $l(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mz="firebase-heartbeat-database",vz=1,up="firebase-heartbeat-store";let k1=null;function GN(){return k1||(k1=Pj(mz,vz,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(up)}catch(t){console.warn(t)}}}}).catch(n=>{throw gu.create("idb-open",{originalErrorMessage:n.message})})),k1}async function gz(n){try{const t=(await GN()).transaction(up),r=await t.objectStore(up).get(qN(n));return await t.done,r}catch(e){if(e instanceof hs)is.warn(e.message);else{const t=gu.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});is.warn(t.message)}}}async function lI(n,e){try{const r=(await GN()).transaction(up,"readwrite");await r.objectStore(up).put(e,qN(n)),await r.done}catch(t){if(t instanceof hs)is.warn(t.message);else{const r=gu.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});is.warn(r.message)}}}function qN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yz=1024,xz=30;class wz{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new bz(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=cI();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>xz){const a=Ez(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){is.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=cI(),{heartbeatsToSend:r,unsentEntries:i}=_z(this._heartbeatsCache.heartbeats),o=Ag(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return is.warn(t),""}}}function cI(){return new Date().toISOString().substring(0,10)}function _z(n,e=yz){const t=[];let r=n.slice();for(const i of n){const o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),hI(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),hI(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class bz{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return uj()?lj().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await gz(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return lI(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return lI(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function hI(n){return Ag(JSON.stringify({version:2,heartbeats:n})).length}function Ez(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cz(n){jh(new $l("platform-logger",e=>new Fj(e),"PRIVATE")),jh(new $l("heartbeat",e=>new wz(e),"PRIVATE")),yu(_w,sI,n),yu(_w,sI,"esm2017"),yu("fire-js","")}Cz("");function Fb(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function KN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Tz=KN,XN=new Dp("auth","Firebase",KN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dg=new Pb("@firebase/auth");function Iz(n,...e){Dg.logLevel<=gt.WARN&&Dg.warn(`Auth (${pd}): ${n}`,...e)}function Hv(n,...e){Dg.logLevel<=gt.ERROR&&Dg.error(`Auth (${pd}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zi(n,...e){throw Bb(n,...e)}function Io(n,...e){return Bb(n,...e)}function Lb(n,e,t){const r=Object.assign(Object.assign({},Tz()),{[e]:t});return new Dp("auth","Firebase",r).create(e,{appName:n.name})}function Ya(n){return Lb(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Sz(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Zi(n,"argument-error"),Lb(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Bb(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return XN.create(n,...e)}function Ke(n,e,...t){if(!n)throw Bb(e,...t)}function Ha(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Hv(e),new Error(e)}function os(n,e){n||Ha(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cw(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Rz(){return dI()==="http:"||dI()==="https:"}function dI(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kz(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Rz()||ij()||"connection"in navigator)?navigator.onLine:!0}function Az(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(e,t){this.shortDelay=e,this.longDelay=t,os(t>e,"Short delay should be less than long delay!"),this.isMobile=tj()||oj()}get(){return kz()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vb(n,e){os(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ha("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ha("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ha("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dz=new Op(3e4,6e4);function Wu(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function ds(n,e,t,r,i={}){return YN(n,i,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const s=Pp(Object.assign({key:n.config.apiKey},a)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const l=Object.assign({method:e,headers:u},o);return rj()||(l.referrerPolicy="no-referrer"),QN.fetch()(JN(n,n.config.apiHost,t,s),l)})}async function YN(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},Nz),e);try{const i=new Oz(n),o=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw sv(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const s=o.ok?a.errorMessage:a.error.message,[u,l]=s.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw sv(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw sv(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw sv(n,"user-disabled",a);const c=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Lb(n,c,l);Zi(n,c)}}catch(i){if(i instanceof hs)throw i;Zi(n,"network-request-failed",{message:String(i)})}}async function Mp(n,e,t,r,i={}){const o=await ds(n,e,t,r,i);return"mfaPendingCredential"in o&&Zi(n,"multi-factor-auth-required",{_serverResponse:o}),o}function JN(n,e,t,r){const i=`${e}${t}?${r}`;return n.config.emulator?Vb(n.config,i):`${n.config.apiScheme}://${i}`}function Pz(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Oz{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Io(this.auth,"network-request-failed")),Dz.get())})}}function sv(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=Io(n,e,r);return i.customData._tokenResponse=t,i}function fI(n){return n!==void 0&&n.enterprise!==void 0}class Mz{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Pz(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Fz(n,e){return ds(n,"GET","/v2/recaptchaConfig",Wu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lz(n,e){return ds(n,"POST","/v1/accounts:delete",e)}async function ZN(n,e){return ds(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Of(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Bz(n,e=!1){const t=Ji(n),r=await t.getIdToken(e),i=Ub(r);Ke(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,a=o==null?void 0:o.sign_in_provider;return{claims:i,token:r,authTime:Of(A1(i.auth_time)),issuedAtTime:Of(A1(i.iat)),expirationTime:Of(A1(i.exp)),signInProvider:a||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function A1(n){return Number(n)*1e3}function Ub(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Hv("JWT malformed, contained fewer than 3 sections"),null;try{const i=BN(t);return i?JSON.parse(i):(Hv("Failed to decode base64 JWT payload"),null)}catch(i){return Hv("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function pI(n){const e=Ub(n);return Ke(e,"internal-error"),Ke(typeof e.exp<"u","internal-error"),Ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zh(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof hs&&Vz(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Vz({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uz{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Of(this.lastLoginAt),this.creationTime=Of(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pg(n){var e;const t=n.auth,r=await n.getIdToken(),i=await zh(n,ZN(t,{idToken:r}));Ke(i==null?void 0:i.users.length,t,"internal-error");const o=i.users[0];n._notifyReloadListener(o);const a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?eD(o.providerUserInfo):[],s=jz(n.providerData,a),u=n.isAnonymous,l=!(n.email&&o.passwordHash)&&!(s!=null&&s.length),c=u?l:!1,h={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:s,metadata:new Tw(o.createdAt,o.lastLoginAt),isAnonymous:c};Object.assign(n,h)}async function Wz(n){const e=Ji(n);await Pg(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function jz(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function eD(n){return n.map(e=>{var{providerId:t}=e,r=Fb(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zz(n,e){const t=await YN(n,{},async()=>{const r=Pp({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=JN(n,i,"/v1/token",`key=${o}`),s=await n._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",QN.fetch()(a,{method:"POST",headers:s,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function $z(n,e){return ds(n,"POST","/v2/accounts:revokeToken",Wu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ke(e.idToken,"internal-error"),Ke(typeof e.idToken<"u","internal-error"),Ke(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):pI(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ke(e.length!==0,"internal-error");const t=pI(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:o}=await zz(e,t);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new wh;return r&&(Ke(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(Ke(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(Ke(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new wh,this.toJSON())}_performRefresh(){return Ha("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(n,e){Ke(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ga{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=Fb(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Uz(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new Tw(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(e){const t=await zh(this,this.stsTokenManager.getToken(this.auth,e));return Ke(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Bz(this,e)}reload(){return Wz(this)}_assign(e){this!==e&&(Ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ga(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Pg(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(gi(this.auth.app))return Promise.reject(Ya(this.auth));const e=await this.getIdToken();return await zh(this,Lz(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,s,u,l,c;const h=(r=t.displayName)!==null&&r!==void 0?r:void 0,d=(i=t.email)!==null&&i!==void 0?i:void 0,f=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,p=(a=t.photoURL)!==null&&a!==void 0?a:void 0,m=(s=t.tenantId)!==null&&s!==void 0?s:void 0,g=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,y=(l=t.createdAt)!==null&&l!==void 0?l:void 0,x=(c=t.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:_,emailVerified:b,isAnonymous:C,providerData:k,stsTokenManager:T}=t;Ke(_&&T,e,"internal-error");const E=wh.fromJSON(this.name,T);Ke(typeof _=="string",e,"internal-error"),Us(h,e.name),Us(d,e.name),Ke(typeof b=="boolean",e,"internal-error"),Ke(typeof C=="boolean",e,"internal-error"),Us(f,e.name),Us(p,e.name),Us(m,e.name),Us(g,e.name),Us(y,e.name),Us(x,e.name);const I=new Ga({uid:_,auth:e,email:d,emailVerified:b,displayName:h,isAnonymous:C,photoURL:p,phoneNumber:f,tenantId:m,stsTokenManager:E,createdAt:y,lastLoginAt:x});return k&&Array.isArray(k)&&(I.providerData=k.map(R=>Object.assign({},R))),g&&(I._redirectEventId=g),I}static async _fromIdTokenResponse(e,t,r=!1){const i=new wh;i.updateFromServerResponse(t);const o=new Ga({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Pg(o),o}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];Ke(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?eD(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(o!=null&&o.length),s=new wh;s.updateFromIdToken(r);const u=new Ga({uid:i.localId,auth:e,stsTokenManager:s,isAnonymous:a}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Tw(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(o!=null&&o.length)};return Object.assign(u,l),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mI=new Map;function qa(n){os(n instanceof Function,"Expected a class definition");let e=mI.get(n);return e?(os(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,mI.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}tD.type="NONE";const vI=tD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gv(n,e,t){return`firebase:${n}:${e}:${t}`}class _h{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Gv(this.userKey,i.apiKey,o),this.fullPersistenceKey=Gv("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ga._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new _h(qa(vI),e,r);const i=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let o=i[0]||qa(vI);const a=Gv(r,e.config.apiKey,e.name);let s=null;for(const l of t)try{const c=await l._get(a);if(c){const h=Ga._fromJSON(e,c);l!==o&&(s=h),o=l;break}}catch{}const u=i.filter(l=>l._shouldAllowMigration);return!o._shouldAllowMigration||!u.length?new _h(o,e,r):(o=u[0],s&&await o._set(a,s.toJSON()),await Promise.all(t.map(async l=>{if(l!==o)try{await l._remove(a)}catch{}})),new _h(o,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(oD(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(nD(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sD(e))return"Blackberry";if(uD(e))return"Webos";if(rD(e))return"Safari";if((e.includes("chrome/")||iD(e))&&!e.includes("edge/"))return"Chrome";if(aD(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function nD(n=Or()){return/firefox\//i.test(n)}function rD(n=Or()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function iD(n=Or()){return/crios\//i.test(n)}function oD(n=Or()){return/iemobile/i.test(n)}function aD(n=Or()){return/android/i.test(n)}function sD(n=Or()){return/blackberry/i.test(n)}function uD(n=Or()){return/webos/i.test(n)}function Wb(n=Or()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Hz(n=Or()){var e;return Wb(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Gz(){return aj()&&document.documentMode===10}function lD(n=Or()){return Wb(n)||aD(n)||uD(n)||sD(n)||/windows phone/i.test(n)||oD(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cD(n,e=[]){let t;switch(n){case"Browser":t=gI(Or());break;case"Worker":t=`${gI(Or())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${pd}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qz{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,s)=>{try{const u=e(o);a(u)}catch(u){s(u)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kz(n,e={}){return ds(n,"GET","/v2/passwordPolicy",Wu(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xz=6;class Qz{constructor(e){var t,r,i,o;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Xz,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,s;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(o=u.containsUppercaseLetter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(s=u.containsNonAlphanumericCharacter)!==null&&s!==void 0?s:!0),u}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yz{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yI(this),this.idTokenSubscription=new yI(this),this.beforeStateQueue=new qz(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=XN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qa(t)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await _h.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ZN(this,{idToken:e}),r=await Ga._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(gi(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(s,s))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,s=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===s)&&(u!=null&&u.user)&&(i=u.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Pg(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Az()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(gi(this.app))return Promise.reject(Ya(this));const t=e?Ji(e):null;return t&&Ke(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return gi(this.app)?Promise.reject(Ya(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return gi(this.app)?Promise.reject(Ya(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qa(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Kz(this),t=new Qz(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Dp("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await $z(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qa(e)||this._popupRedirectResolver;Ke(t,this,"argument-error"),this.redirectPersistenceManager=await _h.create(this,[qa(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ke(s,this,"internal-error"),s.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,i);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=cD(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(gi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Iz(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function ju(n){return Ji(n)}class yI{constructor(e){this.auth=e,this.observer=null,this.addObserver=pj(t=>this.observer=t)}get next(){return Ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ky={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Jz(n){Ky=n}function hD(n){return Ky.loadJS(n)}function Zz(){return Ky.recaptchaEnterpriseScript}function e$(){return Ky.gapiScript}function t$(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class n${constructor(){this.enterprise=new r$}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class r${ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const i$="recaptcha-enterprise",dD="NO_RECAPTCHA";class o${constructor(e){this.type=i$,this.auth=ju(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,s)=>{Fz(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const l=new Mz(u);return o.tenantId==null?o._agentRecaptchaConfig=l:o._tenantRecaptchaConfigs[o.tenantId]=l,a(l.siteKey)}}).catch(u=>{s(u)})})}function i(o,a,s){const u=window.grecaptcha;fI(u)?u.enterprise.ready(()=>{u.enterprise.execute(o,{action:e}).then(l=>{a(l)}).catch(()=>{a(dD)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new n$().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(s=>{if(!t&&fI(window.grecaptcha))i(s,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=Zz();u.length!==0&&(u+=s),hD(u).then(()=>{i(s,o,a)}).catch(l=>{a(l)})}}).catch(s=>{a(s)})})}}async function xI(n,e,t,r=!1,i=!1){const o=new o$(n);let a;if(i)a=dD;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const s=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in s){const u=s.phoneEnrollmentInfo.phoneNumber,l=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const u=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return r?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function Iw(n,e,t,r,i){var o;if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await xI(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await xI(n,e,t,t==="getOobCode");return r(n,s)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a$(n,e){const t=Mb(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),o=t.getOptions();if(zl(o,e??{}))return i;Zi(i,"already-initialized")}return t.initialize({options:e})}function s$(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(qa);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function u$(n,e,t){const r=ju(n);Ke(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=fD(e),{host:a,port:s}=l$(e),u=s===null?"":`:${s}`,l={url:`${o}//${a}${u}/`},c=Object.freeze({host:a,port:s,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ke(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ke(zl(l,r.config.emulator)&&zl(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=l,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,c$()}function fD(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function l$(n){const e=fD(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:wI(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:wI(a)}}}function wI(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function c$(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ha("not implemented")}_getIdTokenResponse(e){return Ha("not implemented")}_linkToIdToken(e,t){return Ha("not implemented")}_getReauthenticationResolver(e){return Ha("not implemented")}}async function h$(n,e){return ds(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d$(n,e){return Mp(n,"POST","/v1/accounts:signInWithPassword",Wu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f$(n,e){return Mp(n,"POST","/v1/accounts:signInWithEmailLink",Wu(n,e))}async function p$(n,e){return Mp(n,"POST","/v1/accounts:signInWithEmailLink",Wu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lp extends jb{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new lp(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new lp(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Iw(e,t,"signInWithPassword",d$);case"emailLink":return f$(e,{email:this._email,oobCode:this._password});default:Zi(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Iw(e,r,"signUpPassword",h$);case"emailLink":return p$(e,{idToken:t,email:this._email,oobCode:this._password});default:Zi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bh(n,e){return Mp(n,"POST","/v1/accounts:signInWithIdp",Wu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m$="http://localhost";class Hl extends jb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Hl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Zi("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,o=Fb(t,["providerId","signInMethod"]);if(!r||!i)return null;const a=new Hl(r,i);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return bh(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,bh(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,bh(e,t)}buildRequest(){const e={requestUri:m$,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Pp(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v$(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function g$(n){const e=yf(xf(n)).link,t=e?yf(xf(e)).deep_link_id:null,r=yf(xf(n)).deep_link_id;return(r?yf(xf(r)).link:null)||r||t||e||n}class zb{constructor(e){var t,r,i,o,a,s;const u=yf(xf(e)),l=(t=u.apiKey)!==null&&t!==void 0?t:null,c=(r=u.oobCode)!==null&&r!==void 0?r:null,h=v$((i=u.mode)!==null&&i!==void 0?i:null);Ke(l&&c&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=c,this.continueUrl=(o=u.continueUrl)!==null&&o!==void 0?o:null,this.languageCode=(a=u.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(s=u.tenantId)!==null&&s!==void 0?s:null}static parseLink(e){const t=g$(e);try{return new zb(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(){this.providerId=md.PROVIDER_ID}static credential(e,t){return lp._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=zb.parseLink(t);return Ke(r,"argument-error"),lp._fromEmailAndCode(e,r.code,r.tenantId)}}md.PROVIDER_ID="password";md.EMAIL_PASSWORD_SIGN_IN_METHOD="password";md.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp extends $b{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs extends Fp{constructor(){super("facebook.com")}static credential(e){return Hl._fromParams({providerId:Qs.PROVIDER_ID,signInMethod:Qs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qs.credentialFromTaggedObject(e)}static credentialFromError(e){return Qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qs.credential(e.oauthAccessToken)}catch{return null}}}Qs.FACEBOOK_SIGN_IN_METHOD="facebook.com";Qs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua extends Fp{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Hl._fromParams({providerId:Ua.PROVIDER_ID,signInMethod:Ua.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ua.credentialFromTaggedObject(e)}static credentialFromError(e){return Ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ua.credential(t,r)}catch{return null}}}Ua.GOOGLE_SIGN_IN_METHOD="google.com";Ua.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends Fp{constructor(){super("github.com")}static credential(e){return Hl._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ys.credential(e.oauthAccessToken)}catch{return null}}}Ys.GITHUB_SIGN_IN_METHOD="github.com";Ys.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js extends Fp{constructor(){super("twitter.com")}static credential(e,t){return Hl._fromParams({providerId:Js.PROVIDER_ID,signInMethod:Js.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Js.credentialFromTaggedObject(e)}static credentialFromError(e){return Js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Js.credential(t,r)}catch{return null}}}Js.TWITTER_SIGN_IN_METHOD="twitter.com";Js.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y$(n,e){return Mp(n,"POST","/v1/accounts:signUp",Wu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const o=await Ga._fromIdTokenResponse(e,r,i),a=_I(r);return new Gl({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=_I(r);return new Gl({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function _I(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og extends hs{constructor(e,t,r,i){var o;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Og.prototype),this.customData={appName:e.name,tenantId:(o=e.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new Og(e,t,r,i)}}function pD(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Og._fromErrorAndOperation(n,o,e,r):o})}async function x$(n,e,t=!1){const r=await zh(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Gl._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w$(n,e,t=!1){const{auth:r}=n;if(gi(r.app))return Promise.reject(Ya(r));const i="reauthenticate";try{const o=await zh(n,pD(r,i,e,n),t);Ke(o.idToken,r,"internal-error");const a=Ub(o.idToken);Ke(a,r,"internal-error");const{sub:s}=a;return Ke(n.uid===s,r,"user-mismatch"),Gl._forOperation(n,i,o)}catch(o){throw(o==null?void 0:o.code)==="auth/user-not-found"&&Zi(r,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mD(n,e,t=!1){if(gi(n.app))return Promise.reject(Ya(n));const r="signIn",i=await pD(n,r,e),o=await Gl._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(o.user),o}async function _$(n,e){return mD(ju(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vD(n){const e=ju(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function b$(n,e,t){if(gi(n.app))return Promise.reject(Ya(n));const r=ju(n),a=await Iw(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",y$).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&vD(n),u}),s=await Gl._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(s.user),s}function E$(n,e,t){return gi(n.app)?Promise.reject(Ya(n)):_$(Ji(n),md.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&vD(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C$(n,e){return ds(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T$(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ji(n),o={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await zh(r,C$(r.auth,o));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const s=r.providerData.find(({providerId:u})=>u==="password");s&&(s.displayName=r.displayName,s.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function I$(n,e,t,r){return Ji(n).onIdTokenChanged(e,t,r)}function S$(n,e,t){return Ji(n).beforeAuthStateChanged(e,t)}const Mg="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Mg,"1"),this.storage.removeItem(Mg),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R$=1e3,k$=10;class yD extends gD{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=lD(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,s,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);Gz()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,k$):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},R$)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}yD.type="LOCAL";const A$=yD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD extends gD{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xD.type="SESSION";const wD=xD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N$(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new Xy(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:o}=t.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const s=Array.from(a).map(async l=>l(t.origin,o)),u=await N$(s);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Xy.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hb(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D${constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((s,u)=>{const l=Hb("",20);i.port1.start();const c=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(h){const d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(c),o=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),s(d.data.response);break;default:clearTimeout(c),clearTimeout(o),u(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oa(){return window}function P$(n){oa().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _D(){return typeof oa().WorkerGlobalScope<"u"&&typeof oa().importScripts=="function"}async function O$(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function M$(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function F$(){return _D()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bD="firebaseLocalStorageDb",L$=1,Fg="firebaseLocalStorage",ED="fbase_key";class Lp{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Qy(n,e){return n.transaction([Fg],e?"readwrite":"readonly").objectStore(Fg)}function B$(){const n=indexedDB.deleteDatabase(bD);return new Lp(n).toPromise()}function Sw(){const n=indexedDB.open(bD,L$);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Fg,{keyPath:ED})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Fg)?e(r):(r.close(),await B$(),e(await Sw()))})})}async function bI(n,e,t){const r=Qy(n,!0).put({[ED]:e,value:t});return new Lp(r).toPromise()}async function V$(n,e){const t=Qy(n,!1).get(e),r=await new Lp(t).toPromise();return r===void 0?null:r.value}function EI(n,e){const t=Qy(n,!0).delete(e);return new Lp(t).toPromise()}const U$=800,W$=3;class CD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Sw(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>W$)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _D()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Xy._getInstance(F$()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await O$(),!this.activeServiceWorker)return;this.sender=new D$(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||M$()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Sw();return await bI(e,Mg,"1"),await EI(e,Mg),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>bI(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>V$(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>EI(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=Qy(i,!1).getAll();return new Lp(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),U$)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}CD.type="LOCAL";const j$=CD;new Op(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TD(n,e){return e?qa(e):(Ke(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb extends jb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bh(e,this._buildIdpRequest())}_linkToIdToken(e,t){return bh(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return bh(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function z$(n){return mD(n.auth,new Gb(n),n.bypassAuthState)}function $$(n){const{auth:e,user:t}=n;return Ke(t,e,"internal-error"),w$(t,new Gb(n),n.bypassAuthState)}async function H$(n){const{auth:e,user:t}=n;return Ke(t,e,"internal-error"),x$(t,new Gb(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:s}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(u))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return z$;case"linkViaPopup":case"linkViaRedirect":return H$;case"reauthViaPopup":case"reauthViaRedirect":return $$;default:Zi(this.auth,"internal-error")}}resolve(e){os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G$=new Op(2e3,1e4);async function q$(n,e,t){if(gi(n.app))return Promise.reject(Io(n,"operation-not-supported-in-this-environment"));const r=ju(n);Sz(n,e,$b);const i=TD(r,t);return new Il(r,"signInViaPopup",e,i).executeNotNull()}class Il extends ID{constructor(e,t,r,i,o){super(e,t,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Il.currentPopupAction&&Il.currentPopupAction.cancel(),Il.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ke(e,this.auth,"internal-error"),e}async onExecution(){os(this.filter.length===1,"Popup operations only handle one event");const e=Hb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Io(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Io(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Il.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Io(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,G$.get())};e()}}Il.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K$="pendingRedirect",qv=new Map;class X$ extends ID{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=qv.get(this.auth._key());if(!e){try{const r=await Q$(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}qv.set(this.auth._key(),e)}return this.bypassAuthState||qv.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Q$(n,e){const t=Z$(e),r=J$(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function Y$(n,e){qv.set(n._key(),e)}function J$(n){return qa(n._redirectPersistence)}function Z$(n){return Gv(K$,n.config.apiKey,n.name)}async function e6(n,e,t=!1){if(gi(n.app))return Promise.reject(Ya(n));const r=ju(n),i=TD(r,e),a=await new X$(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t6=10*60*1e3;class n6{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!r6(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!SD(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Io(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=t6&&this.cachedEventUids.clear(),this.cachedEventUids.has(CI(e))}saveEventToCache(e){this.cachedEventUids.add(CI(e)),this.lastProcessedEventTime=Date.now()}}function CI(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function SD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function r6(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return SD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i6(n,e={}){return ds(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o6=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a6=/^https?/;async function s6(n){if(n.config.emulator)return;const{authorizedDomains:e}=await i6(n);for(const t of e)try{if(u6(t))return}catch{}Zi(n,"unauthorized-domain")}function u6(n){const e=Cw(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!a6.test(t))return!1;if(o6.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l6=new Op(3e4,6e4);function TI(){const n=oa().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function c6(n){return new Promise((e,t)=>{var r,i,o;function a(){TI(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{TI(),t(Io(n,"network-request-failed"))},timeout:l6.get()})}if(!((i=(r=oa().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((o=oa().gapi)===null||o===void 0)&&o.load)a();else{const s=t$("iframefcb");return oa()[s]=()=>{gapi.load?a():t(Io(n,"network-request-failed"))},hD(`${e$()}?onload=${s}`).catch(u=>t(u))}}).catch(e=>{throw Kv=null,e})}let Kv=null;function h6(n){return Kv=Kv||c6(n),Kv}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d6=new Op(5e3,15e3),f6="__/auth/iframe",p6="emulator/auth/iframe",m6={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},v6=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function g6(n){const e=n.config;Ke(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Vb(e,p6):`https://${n.config.authDomain}/${f6}`,r={apiKey:e.apiKey,appName:n.name,v:pd},i=v6.get(n.config.apiHost);i&&(r.eid=i);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${Pp(r).slice(1)}`}async function y6(n){const e=await h6(n),t=oa().gapi;return Ke(t,n,"internal-error"),e.open({where:document.body,url:g6(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:m6,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const a=Io(n,"network-request-failed"),s=oa().setTimeout(()=>{o(a)},d6.get());function u(){oa().clearTimeout(s),i(r)}r.ping(u).then(u,()=>{o(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x6={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},w6=500,_6=600,b6="_blank",E6="http://localhost";class II{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function C6(n,e,t,r=w6,i=_6){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let s="";const u=Object.assign(Object.assign({},x6),{width:r.toString(),height:i.toString(),top:o,left:a}),l=Or().toLowerCase();t&&(s=iD(l)?b6:t),nD(l)&&(e=e||E6,u.scrollbars="yes");const c=Object.entries(u).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(Hz(l)&&s!=="_self")return T6(e||"",s),new II(null);const h=window.open(e||"",s,c);Ke(h,n,"popup-blocked");try{h.focus()}catch{}return new II(h)}function T6(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I6="__/auth/handler",S6="emulator/auth/handler",R6=encodeURIComponent("fac");async function SI(n,e,t,r,i,o){Ke(n.config.authDomain,n,"auth-domain-config-required"),Ke(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:pd,eventId:i};if(e instanceof $b){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",fj(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))a[c]=h}if(e instanceof Fp){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(a.scopes=c.join(","))}n.tenantId&&(a.tid=n.tenantId);const s=a;for(const c of Object.keys(s))s[c]===void 0&&delete s[c];const u=await n._getAppCheckToken(),l=u?`#${R6}=${encodeURIComponent(u)}`:"";return`${k6(n)}?${Pp(s).slice(1)}${l}`}function k6({config:n}){return n.emulator?Vb(n,S6):`https://${n.authDomain}/${I6}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N1="webStorageSupport";class A6{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wD,this._completeRedirectFn=e6,this._overrideRedirectResult=Y$}async _openPopup(e,t,r,i){var o;os((o=this.eventManagers[e._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");const a=await SI(e,t,r,Cw(),i);return C6(e,a,Hb())}async _openRedirect(e,t,r,i){await this._originValidation(e);const o=await SI(e,t,r,Cw(),i);return P$(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(os(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await y6(e),r=new n6(e);return t.register("authEvent",i=>(Ke(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(N1,{type:N1},i=>{var o;const a=(o=i==null?void 0:i[0])===null||o===void 0?void 0:o[N1];a!==void 0&&t(!!a),Zi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=s6(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return lD()||rD()||Wb()}}const N6=A6;var RI="@firebase/auth",kI="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P6(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function O6(n){jh(new $l("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:s}=r.options;Ke(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:s,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cD(n)},l=new Yz(r,i,o,u);return s$(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),jh(new $l("auth-internal",e=>{const t=ju(e.getProvider("auth").getImmediate());return(r=>new D6(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),yu(RI,kI,P6(n)),yu(RI,kI,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M6=5*60,F6=WN("authIdTokenMaxAge")||M6;let AI=null;const L6=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>F6)return;const i=t==null?void 0:t.token;AI!==i&&(AI=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function B6(n=HN()){const e=Mb(n,"auth");if(e.isInitialized())return e.getImmediate();const t=a$(n,{popupRedirectResolver:N6,persistence:[j$,A$,wD]}),r=WN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=L6(o.toString());S$(t,a,()=>a(t.currentUser)),I$(t,s=>a(s))}}const i=VN("auth");return i&&u$(t,`http://${i}`),t}function V6(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Jz({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const o=Io("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",V6().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});O6("Browser");var U6="firebase",W6="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yu(U6,W6,"app");var NI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xu,RD;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,E){function I(){}I.prototype=E.prototype,T.D=E.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(R,N,O){for(var M=Array(arguments.length-2),q=2;q<arguments.length;q++)M[q-2]=arguments[q];return E.prototype[N].apply(R,M)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,E,I){I||(I=0);var R=Array(16);if(typeof E=="string")for(var N=0;16>N;++N)R[N]=E.charCodeAt(I++)|E.charCodeAt(I++)<<8|E.charCodeAt(I++)<<16|E.charCodeAt(I++)<<24;else for(N=0;16>N;++N)R[N]=E[I++]|E[I++]<<8|E[I++]<<16|E[I++]<<24;E=T.g[0],I=T.g[1],N=T.g[2];var O=T.g[3],M=E+(O^I&(N^O))+R[0]+3614090360&4294967295;E=I+(M<<7&4294967295|M>>>25),M=O+(N^E&(I^N))+R[1]+3905402710&4294967295,O=E+(M<<12&4294967295|M>>>20),M=N+(I^O&(E^I))+R[2]+606105819&4294967295,N=O+(M<<17&4294967295|M>>>15),M=I+(E^N&(O^E))+R[3]+3250441966&4294967295,I=N+(M<<22&4294967295|M>>>10),M=E+(O^I&(N^O))+R[4]+4118548399&4294967295,E=I+(M<<7&4294967295|M>>>25),M=O+(N^E&(I^N))+R[5]+1200080426&4294967295,O=E+(M<<12&4294967295|M>>>20),M=N+(I^O&(E^I))+R[6]+2821735955&4294967295,N=O+(M<<17&4294967295|M>>>15),M=I+(E^N&(O^E))+R[7]+4249261313&4294967295,I=N+(M<<22&4294967295|M>>>10),M=E+(O^I&(N^O))+R[8]+1770035416&4294967295,E=I+(M<<7&4294967295|M>>>25),M=O+(N^E&(I^N))+R[9]+2336552879&4294967295,O=E+(M<<12&4294967295|M>>>20),M=N+(I^O&(E^I))+R[10]+4294925233&4294967295,N=O+(M<<17&4294967295|M>>>15),M=I+(E^N&(O^E))+R[11]+2304563134&4294967295,I=N+(M<<22&4294967295|M>>>10),M=E+(O^I&(N^O))+R[12]+1804603682&4294967295,E=I+(M<<7&4294967295|M>>>25),M=O+(N^E&(I^N))+R[13]+4254626195&4294967295,O=E+(M<<12&4294967295|M>>>20),M=N+(I^O&(E^I))+R[14]+2792965006&4294967295,N=O+(M<<17&4294967295|M>>>15),M=I+(E^N&(O^E))+R[15]+1236535329&4294967295,I=N+(M<<22&4294967295|M>>>10),M=E+(N^O&(I^N))+R[1]+4129170786&4294967295,E=I+(M<<5&4294967295|M>>>27),M=O+(I^N&(E^I))+R[6]+3225465664&4294967295,O=E+(M<<9&4294967295|M>>>23),M=N+(E^I&(O^E))+R[11]+643717713&4294967295,N=O+(M<<14&4294967295|M>>>18),M=I+(O^E&(N^O))+R[0]+3921069994&4294967295,I=N+(M<<20&4294967295|M>>>12),M=E+(N^O&(I^N))+R[5]+3593408605&4294967295,E=I+(M<<5&4294967295|M>>>27),M=O+(I^N&(E^I))+R[10]+38016083&4294967295,O=E+(M<<9&4294967295|M>>>23),M=N+(E^I&(O^E))+R[15]+3634488961&4294967295,N=O+(M<<14&4294967295|M>>>18),M=I+(O^E&(N^O))+R[4]+3889429448&4294967295,I=N+(M<<20&4294967295|M>>>12),M=E+(N^O&(I^N))+R[9]+568446438&4294967295,E=I+(M<<5&4294967295|M>>>27),M=O+(I^N&(E^I))+R[14]+3275163606&4294967295,O=E+(M<<9&4294967295|M>>>23),M=N+(E^I&(O^E))+R[3]+4107603335&4294967295,N=O+(M<<14&4294967295|M>>>18),M=I+(O^E&(N^O))+R[8]+1163531501&4294967295,I=N+(M<<20&4294967295|M>>>12),M=E+(N^O&(I^N))+R[13]+2850285829&4294967295,E=I+(M<<5&4294967295|M>>>27),M=O+(I^N&(E^I))+R[2]+4243563512&4294967295,O=E+(M<<9&4294967295|M>>>23),M=N+(E^I&(O^E))+R[7]+1735328473&4294967295,N=O+(M<<14&4294967295|M>>>18),M=I+(O^E&(N^O))+R[12]+2368359562&4294967295,I=N+(M<<20&4294967295|M>>>12),M=E+(I^N^O)+R[5]+4294588738&4294967295,E=I+(M<<4&4294967295|M>>>28),M=O+(E^I^N)+R[8]+2272392833&4294967295,O=E+(M<<11&4294967295|M>>>21),M=N+(O^E^I)+R[11]+1839030562&4294967295,N=O+(M<<16&4294967295|M>>>16),M=I+(N^O^E)+R[14]+4259657740&4294967295,I=N+(M<<23&4294967295|M>>>9),M=E+(I^N^O)+R[1]+2763975236&4294967295,E=I+(M<<4&4294967295|M>>>28),M=O+(E^I^N)+R[4]+1272893353&4294967295,O=E+(M<<11&4294967295|M>>>21),M=N+(O^E^I)+R[7]+4139469664&4294967295,N=O+(M<<16&4294967295|M>>>16),M=I+(N^O^E)+R[10]+3200236656&4294967295,I=N+(M<<23&4294967295|M>>>9),M=E+(I^N^O)+R[13]+681279174&4294967295,E=I+(M<<4&4294967295|M>>>28),M=O+(E^I^N)+R[0]+3936430074&4294967295,O=E+(M<<11&4294967295|M>>>21),M=N+(O^E^I)+R[3]+3572445317&4294967295,N=O+(M<<16&4294967295|M>>>16),M=I+(N^O^E)+R[6]+76029189&4294967295,I=N+(M<<23&4294967295|M>>>9),M=E+(I^N^O)+R[9]+3654602809&4294967295,E=I+(M<<4&4294967295|M>>>28),M=O+(E^I^N)+R[12]+3873151461&4294967295,O=E+(M<<11&4294967295|M>>>21),M=N+(O^E^I)+R[15]+530742520&4294967295,N=O+(M<<16&4294967295|M>>>16),M=I+(N^O^E)+R[2]+3299628645&4294967295,I=N+(M<<23&4294967295|M>>>9),M=E+(N^(I|~O))+R[0]+4096336452&4294967295,E=I+(M<<6&4294967295|M>>>26),M=O+(I^(E|~N))+R[7]+1126891415&4294967295,O=E+(M<<10&4294967295|M>>>22),M=N+(E^(O|~I))+R[14]+2878612391&4294967295,N=O+(M<<15&4294967295|M>>>17),M=I+(O^(N|~E))+R[5]+4237533241&4294967295,I=N+(M<<21&4294967295|M>>>11),M=E+(N^(I|~O))+R[12]+1700485571&4294967295,E=I+(M<<6&4294967295|M>>>26),M=O+(I^(E|~N))+R[3]+2399980690&4294967295,O=E+(M<<10&4294967295|M>>>22),M=N+(E^(O|~I))+R[10]+4293915773&4294967295,N=O+(M<<15&4294967295|M>>>17),M=I+(O^(N|~E))+R[1]+2240044497&4294967295,I=N+(M<<21&4294967295|M>>>11),M=E+(N^(I|~O))+R[8]+1873313359&4294967295,E=I+(M<<6&4294967295|M>>>26),M=O+(I^(E|~N))+R[15]+4264355552&4294967295,O=E+(M<<10&4294967295|M>>>22),M=N+(E^(O|~I))+R[6]+2734768916&4294967295,N=O+(M<<15&4294967295|M>>>17),M=I+(O^(N|~E))+R[13]+1309151649&4294967295,I=N+(M<<21&4294967295|M>>>11),M=E+(N^(I|~O))+R[4]+4149444226&4294967295,E=I+(M<<6&4294967295|M>>>26),M=O+(I^(E|~N))+R[11]+3174756917&4294967295,O=E+(M<<10&4294967295|M>>>22),M=N+(E^(O|~I))+R[2]+718787259&4294967295,N=O+(M<<15&4294967295|M>>>17),M=I+(O^(N|~E))+R[9]+3951481745&4294967295,T.g[0]=T.g[0]+E&4294967295,T.g[1]=T.g[1]+(N+(M<<21&4294967295|M>>>11))&4294967295,T.g[2]=T.g[2]+N&4294967295,T.g[3]=T.g[3]+O&4294967295}r.prototype.u=function(T,E){E===void 0&&(E=T.length);for(var I=E-this.blockSize,R=this.B,N=this.h,O=0;O<E;){if(N==0)for(;O<=I;)i(this,T,O),O+=this.blockSize;if(typeof T=="string"){for(;O<E;)if(R[N++]=T.charCodeAt(O++),N==this.blockSize){i(this,R),N=0;break}}else for(;O<E;)if(R[N++]=T[O++],N==this.blockSize){i(this,R),N=0;break}}this.h=N,this.o+=E},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var E=1;E<T.length-8;++E)T[E]=0;var I=8*this.o;for(E=T.length-8;E<T.length;++E)T[E]=I&255,I/=256;for(this.u(T),T=Array(16),E=I=0;4>E;++E)for(var R=0;32>R;R+=8)T[I++]=this.g[E]>>>R&255;return T};function o(T,E){var I=s;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=E(T)}function a(T,E){this.h=E;for(var I=[],R=!0,N=T.length-1;0<=N;N--){var O=T[N]|0;R&&O==E||(I[N]=O,R=!1)}this.g=I}var s={};function u(T){return-128<=T&&128>T?o(T,function(E){return new a([E|0],0>E?-1:0)}):new a([T|0],0>T?-1:0)}function l(T){if(isNaN(T)||!isFinite(T))return h;if(0>T)return g(l(-T));for(var E=[],I=1,R=0;T>=I;R++)E[R]=T/I|0,I*=4294967296;return new a(E,0)}function c(T,E){if(T.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(T.charAt(0)=="-")return g(c(T.substring(1),E));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=l(Math.pow(E,8)),R=h,N=0;N<T.length;N+=8){var O=Math.min(8,T.length-N),M=parseInt(T.substring(N,N+O),E);8>O?(O=l(Math.pow(E,O)),R=R.j(O).add(l(M))):(R=R.j(I),R=R.add(l(M)))}return R}var h=u(0),d=u(1),f=u(16777216);n=a.prototype,n.m=function(){if(m(this))return-g(this).m();for(var T=0,E=1,I=0;I<this.g.length;I++){var R=this.i(I);T+=(0<=R?R:4294967296+R)*E,E*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(p(this))return"0";if(m(this))return"-"+g(this).toString(T);for(var E=l(Math.pow(T,6)),I=this,R="";;){var N=b(I,E).g;I=y(I,N.j(E));var O=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=N,p(I))return O+R;for(;6>O.length;)O="0"+O;R=O+R}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function p(T){if(T.h!=0)return!1;for(var E=0;E<T.g.length;E++)if(T.g[E]!=0)return!1;return!0}function m(T){return T.h==-1}n.l=function(T){return T=y(this,T),m(T)?-1:p(T)?0:1};function g(T){for(var E=T.g.length,I=[],R=0;R<E;R++)I[R]=~T.g[R];return new a(I,~T.h).add(d)}n.abs=function(){return m(this)?g(this):this},n.add=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],R=0,N=0;N<=E;N++){var O=R+(this.i(N)&65535)+(T.i(N)&65535),M=(O>>>16)+(this.i(N)>>>16)+(T.i(N)>>>16);R=M>>>16,O&=65535,M&=65535,I[N]=M<<16|O}return new a(I,I[I.length-1]&-2147483648?-1:0)};function y(T,E){return T.add(g(E))}n.j=function(T){if(p(this)||p(T))return h;if(m(this))return m(T)?g(this).j(g(T)):g(g(this).j(T));if(m(T))return g(this.j(g(T)));if(0>this.l(f)&&0>T.l(f))return l(this.m()*T.m());for(var E=this.g.length+T.g.length,I=[],R=0;R<2*E;R++)I[R]=0;for(R=0;R<this.g.length;R++)for(var N=0;N<T.g.length;N++){var O=this.i(R)>>>16,M=this.i(R)&65535,q=T.i(N)>>>16,J=T.i(N)&65535;I[2*R+2*N]+=M*J,x(I,2*R+2*N),I[2*R+2*N+1]+=O*J,x(I,2*R+2*N+1),I[2*R+2*N+1]+=M*q,x(I,2*R+2*N+1),I[2*R+2*N+2]+=O*q,x(I,2*R+2*N+2)}for(R=0;R<E;R++)I[R]=I[2*R+1]<<16|I[2*R];for(R=E;R<2*E;R++)I[R]=0;return new a(I,0)};function x(T,E){for(;(T[E]&65535)!=T[E];)T[E+1]+=T[E]>>>16,T[E]&=65535,E++}function _(T,E){this.g=T,this.h=E}function b(T,E){if(p(E))throw Error("division by zero");if(p(T))return new _(h,h);if(m(T))return E=b(g(T),E),new _(g(E.g),g(E.h));if(m(E))return E=b(T,g(E)),new _(g(E.g),E.h);if(30<T.g.length){if(m(T)||m(E))throw Error("slowDivide_ only works with positive integers.");for(var I=d,R=E;0>=R.l(T);)I=C(I),R=C(R);var N=k(I,1),O=k(R,1);for(R=k(R,2),I=k(I,2);!p(R);){var M=O.add(R);0>=M.l(T)&&(N=N.add(I),O=M),R=k(R,1),I=k(I,1)}return E=y(T,N.j(E)),new _(N,E)}for(N=h;0<=T.l(E);){for(I=Math.max(1,Math.floor(T.m()/E.m())),R=Math.ceil(Math.log(I)/Math.LN2),R=48>=R?1:Math.pow(2,R-48),O=l(I),M=O.j(E);m(M)||0<M.l(T);)I-=R,O=l(I),M=O.j(E);p(O)&&(O=d),N=N.add(O),T=y(T,M)}return new _(N,T)}n.A=function(T){return b(this,T).h},n.and=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],R=0;R<E;R++)I[R]=this.i(R)&T.i(R);return new a(I,this.h&T.h)},n.or=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],R=0;R<E;R++)I[R]=this.i(R)|T.i(R);return new a(I,this.h|T.h)},n.xor=function(T){for(var E=Math.max(this.g.length,T.g.length),I=[],R=0;R<E;R++)I[R]=this.i(R)^T.i(R);return new a(I,this.h^T.h)};function C(T){for(var E=T.g.length+1,I=[],R=0;R<E;R++)I[R]=T.i(R)<<1|T.i(R-1)>>>31;return new a(I,T.h)}function k(T,E){var I=E>>5;E%=32;for(var R=T.g.length-I,N=[],O=0;O<R;O++)N[O]=0<E?T.i(O+I)>>>E|T.i(O+I+1)<<32-E:T.i(O+I);return new a(N,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,RD=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=l,a.fromString=c,xu=a}).apply(typeof NI<"u"?NI:typeof self<"u"?self:typeof window<"u"?window:{});var uv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kD,wf,AD,Xv,Rw,ND,DD,PD;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(v,S,D){return v==Array.prototype||v==Object.prototype||(v[S]=D.value),v};function t(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof uv=="object"&&uv];for(var S=0;S<v.length;++S){var D=v[S];if(D&&D.Math==Math)return D}throw Error("Cannot find global object")}var r=t(this);function i(v,S){if(S)e:{var D=r;v=v.split(".");for(var B=0;B<v.length-1;B++){var ne=v[B];if(!(ne in D))break e;D=D[ne]}v=v[v.length-1],B=D[v],S=S(B),S!=B&&S!=null&&e(D,v,{configurable:!0,writable:!0,value:S})}}function o(v,S){v instanceof String&&(v+="");var D=0,B=!1,ne={next:function(){if(!B&&D<v.length){var ie=D++;return{value:S(ie,v[ie]),done:!1}}return B=!0,{done:!0,value:void 0}}};return ne[Symbol.iterator]=function(){return ne},ne}i("Array.prototype.values",function(v){return v||function(){return o(this,function(S,D){return D})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},s=this||self;function u(v){var S=typeof v;return S=S!="object"?S:v?Array.isArray(v)?"array":S:"null",S=="array"||S=="object"&&typeof v.length=="number"}function l(v){var S=typeof v;return S=="object"&&v!=null||S=="function"}function c(v,S,D){return v.call.apply(v.bind,arguments)}function h(v,S,D){if(!v)throw Error();if(2<arguments.length){var B=Array.prototype.slice.call(arguments,2);return function(){var ne=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ne,B),v.apply(S,ne)}}return function(){return v.apply(S,arguments)}}function d(v,S,D){return d=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?c:h,d.apply(null,arguments)}function f(v,S){var D=Array.prototype.slice.call(arguments,1);return function(){var B=D.slice();return B.push.apply(B,arguments),v.apply(this,B)}}function p(v,S){function D(){}D.prototype=S.prototype,v.aa=S.prototype,v.prototype=new D,v.prototype.constructor=v,v.Qb=function(B,ne,ie){for(var _e=Array(arguments.length-2),Bt=2;Bt<arguments.length;Bt++)_e[Bt-2]=arguments[Bt];return S.prototype[ne].apply(B,_e)}}function m(v){const S=v.length;if(0<S){const D=Array(S);for(let B=0;B<S;B++)D[B]=v[B];return D}return[]}function g(v,S){for(let D=1;D<arguments.length;D++){const B=arguments[D];if(u(B)){const ne=v.length||0,ie=B.length||0;v.length=ne+ie;for(let _e=0;_e<ie;_e++)v[ne+_e]=B[_e]}else v.push(B)}}class y{constructor(S,D){this.i=S,this.j=D,this.h=0,this.g=null}get(){let S;return 0<this.h?(this.h--,S=this.g,this.g=S.next,S.next=null):S=this.i(),S}}function x(v){return/^[\s\xa0]*$/.test(v)}function _(){var v=s.navigator;return v&&(v=v.userAgent)?v:""}function b(v){return b[" "](v),v}b[" "]=function(){};var C=_().indexOf("Gecko")!=-1&&!(_().toLowerCase().indexOf("webkit")!=-1&&_().indexOf("Edge")==-1)&&!(_().indexOf("Trident")!=-1||_().indexOf("MSIE")!=-1)&&_().indexOf("Edge")==-1;function k(v,S,D){for(const B in v)S.call(D,v[B],B,v)}function T(v,S){for(const D in v)S.call(void 0,v[D],D,v)}function E(v){const S={};for(const D in v)S[D]=v[D];return S}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(v,S){let D,B;for(let ne=1;ne<arguments.length;ne++){B=arguments[ne];for(D in B)v[D]=B[D];for(let ie=0;ie<I.length;ie++)D=I[ie],Object.prototype.hasOwnProperty.call(B,D)&&(v[D]=B[D])}}function N(v){var S=1;v=v.split(":");const D=[];for(;0<S&&v.length;)D.push(v.shift()),S--;return v.length&&D.push(v.join(":")),D}function O(v){s.setTimeout(()=>{throw v},0)}function M(){var v=K;let S=null;return v.g&&(S=v.g,v.g=v.g.next,v.g||(v.h=null),S.next=null),S}class q{constructor(){this.h=this.g=null}add(S,D){const B=J.get();B.set(S,D),this.h?this.h.next=B:this.g=B,this.h=B}}var J=new y(()=>new ee,v=>v.reset());class ee{constructor(){this.next=this.g=this.h=null}set(S,D){this.h=S,this.g=D,this.next=null}reset(){this.next=this.g=this.h=null}}let Q,$=!1,K=new q,j=()=>{const v=s.Promise.resolve(void 0);Q=()=>{v.then(ue)}};var ue=()=>{for(var v;v=M();){try{v.h.call(v.g)}catch(D){O(D)}var S=J;S.j(v),100>S.h&&(S.h++,v.next=S.g,S.g=v)}$=!1};function he(){this.s=this.s,this.C=this.C}he.prototype.s=!1,he.prototype.ma=function(){this.s||(this.s=!0,this.N())},he.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ve(v,S){this.type=v,this.g=this.target=S,this.defaultPrevented=!1}ve.prototype.h=function(){this.defaultPrevented=!0};var we=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var v=!1,S=Object.defineProperty({},"passive",{get:function(){v=!0}});try{const D=()=>{};s.addEventListener("test",D,S),s.removeEventListener("test",D,S)}catch{}return v}();function Ee(v,S){if(ve.call(this,v?v.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,v){var D=this.type=v.type,B=v.changedTouches&&v.changedTouches.length?v.changedTouches[0]:null;if(this.target=v.target||v.srcElement,this.g=S,S=v.relatedTarget){if(C){e:{try{b(S.nodeName);var ne=!0;break e}catch{}ne=!1}ne||(S=null)}}else D=="mouseover"?S=v.fromElement:D=="mouseout"&&(S=v.toElement);this.relatedTarget=S,B?(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0):(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0),this.button=v.button,this.key=v.key||"",this.ctrlKey=v.ctrlKey,this.altKey=v.altKey,this.shiftKey=v.shiftKey,this.metaKey=v.metaKey,this.pointerId=v.pointerId||0,this.pointerType=typeof v.pointerType=="string"?v.pointerType:Ce[v.pointerType]||"",this.state=v.state,this.i=v,v.defaultPrevented&&Ee.aa.h.call(this)}}p(Ee,ve);var Ce={2:"touch",3:"pen",4:"mouse"};Ee.prototype.h=function(){Ee.aa.h.call(this);var v=this.i;v.preventDefault?v.preventDefault():v.returnValue=!1};var Ie="closure_listenable_"+(1e6*Math.random()|0),ce=0;function Ue(v,S,D,B,ne){this.listener=v,this.proxy=null,this.src=S,this.type=D,this.capture=!!B,this.ha=ne,this.key=++ce,this.da=this.fa=!1}function je(v){v.da=!0,v.listener=null,v.proxy=null,v.src=null,v.ha=null}function Be(v){this.src=v,this.g={},this.h=0}Be.prototype.add=function(v,S,D,B,ne){var ie=v.toString();v=this.g[ie],v||(v=this.g[ie]=[],this.h++);var _e=We(v,S,B,ne);return-1<_e?(S=v[_e],D||(S.fa=!1)):(S=new Ue(S,this.src,ie,!!B,ne),S.fa=D,v.push(S)),S};function Ge(v,S){var D=S.type;if(D in v.g){var B=v.g[D],ne=Array.prototype.indexOf.call(B,S,void 0),ie;(ie=0<=ne)&&Array.prototype.splice.call(B,ne,1),ie&&(je(S),v.g[D].length==0&&(delete v.g[D],v.h--))}}function We(v,S,D,B){for(var ne=0;ne<v.length;++ne){var ie=v[ne];if(!ie.da&&ie.listener==S&&ie.capture==!!D&&ie.ha==B)return ne}return-1}var ut="closure_lm_"+(1e6*Math.random()|0),ot={};function dt(v,S,D,B,ne){if(Array.isArray(S)){for(var ie=0;ie<S.length;ie++)dt(v,S[ie],D,B,ne);return null}return D=un(D),v&&v[Ie]?v.K(S,D,l(B)?!!B.capture:!!B,ne):Yn(v,S,D,!1,B,ne)}function Yn(v,S,D,B,ne,ie){if(!S)throw Error("Invalid event type");var _e=l(ne)?!!ne.capture:!!ne,Bt=ar(v);if(Bt||(v[ut]=Bt=new Be(v)),D=Bt.add(S,D,B,_e,ie),D.proxy)return D;if(B=En(),D.proxy=B,B.src=v,B.listener=D,v.addEventListener)we||(ne=_e),ne===void 0&&(ne=!1),v.addEventListener(S.toString(),B,ne);else if(v.attachEvent)v.attachEvent(Cn(S.toString()),B);else if(v.addListener&&v.removeListener)v.addListener(B);else throw Error("addEventListener and attachEvent are unavailable.");return D}function En(){function v(D){return S.call(v.src,v.listener,D)}const S=Bn;return v}function sn(v,S,D,B,ne){if(Array.isArray(S))for(var ie=0;ie<S.length;ie++)sn(v,S[ie],D,B,ne);else B=l(B)?!!B.capture:!!B,D=un(D),v&&v[Ie]?(v=v.i,S=String(S).toString(),S in v.g&&(ie=v.g[S],D=We(ie,D,B,ne),-1<D&&(je(ie[D]),Array.prototype.splice.call(ie,D,1),ie.length==0&&(delete v.g[S],v.h--)))):v&&(v=ar(v))&&(S=v.g[S.toString()],v=-1,S&&(v=We(S,D,B,ne)),(D=-1<v?S[v]:null)&&Ln(D))}function Ln(v){if(typeof v!="number"&&v&&!v.da){var S=v.src;if(S&&S[Ie])Ge(S.i,v);else{var D=v.type,B=v.proxy;S.removeEventListener?S.removeEventListener(D,B,v.capture):S.detachEvent?S.detachEvent(Cn(D),B):S.addListener&&S.removeListener&&S.removeListener(B),(D=ar(S))?(Ge(D,v),D.h==0&&(D.src=null,S[ut]=null)):je(v)}}}function Cn(v){return v in ot?ot[v]:ot[v]="on"+v}function Bn(v,S){if(v.da)v=!0;else{S=new Ee(S,this);var D=v.listener,B=v.ha||v.src;v.fa&&Ln(v),v=D.call(B,S)}return v}function ar(v){return v=v[ut],v instanceof Be?v:null}var Nn="__closure_events_fn_"+(1e9*Math.random()>>>0);function un(v){return typeof v=="function"?v:(v[Nn]||(v[Nn]=function(S){return v.handleEvent(S)}),v[Nn])}function tn(){he.call(this),this.i=new Be(this),this.M=this,this.F=null}p(tn,he),tn.prototype[Ie]=!0,tn.prototype.removeEventListener=function(v,S,D,B){sn(this,v,S,D,B)};function Tt(v,S){var D,B=v.F;if(B)for(D=[];B;B=B.F)D.push(B);if(v=v.M,B=S.type||S,typeof S=="string")S=new ve(S,v);else if(S instanceof ve)S.target=S.target||v;else{var ne=S;S=new ve(B,v),R(S,ne)}if(ne=!0,D)for(var ie=D.length-1;0<=ie;ie--){var _e=S.g=D[ie];ne=pn(_e,B,!0,S)&&ne}if(_e=S.g=v,ne=pn(_e,B,!0,S)&&ne,ne=pn(_e,B,!1,S)&&ne,D)for(ie=0;ie<D.length;ie++)_e=S.g=D[ie],ne=pn(_e,B,!1,S)&&ne}tn.prototype.N=function(){if(tn.aa.N.call(this),this.i){var v=this.i,S;for(S in v.g){for(var D=v.g[S],B=0;B<D.length;B++)je(D[B]);delete v.g[S],v.h--}}this.F=null},tn.prototype.K=function(v,S,D,B){return this.i.add(String(v),S,!1,D,B)},tn.prototype.L=function(v,S,D,B){return this.i.add(String(v),S,!0,D,B)};function pn(v,S,D,B){if(S=v.i.g[String(S)],!S)return!0;S=S.concat();for(var ne=!0,ie=0;ie<S.length;++ie){var _e=S[ie];if(_e&&!_e.da&&_e.capture==D){var Bt=_e.listener,Vn=_e.ha||_e.src;_e.fa&&Ge(v.i,_e),ne=Bt.call(Vn,B)!==!1&&ne}}return ne&&!B.defaultPrevented}function li(v,S,D){if(typeof v=="function")D&&(v=d(v,D));else if(v&&typeof v.handleEvent=="function")v=d(v.handleEvent,v);else throw Error("Invalid listener argument");return 2147483647<Number(S)?-1:s.setTimeout(v,S||0)}function ba(v){v.g=li(()=>{v.g=null,v.i&&(v.i=!1,ba(v))},v.l);const S=v.h;v.h=null,v.m.apply(null,S)}class Rd extends he{constructor(S,D){super(),this.m=S,this.l=D,this.h=null,this.i=!1,this.g=null}j(S){this.h=arguments,this.g?this.i=!0:ba(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oo(v){he.call(this),this.h=v,this.g={}}p(oo,he);var Es=[];function Cs(v){k(v.g,function(S,D){this.g.hasOwnProperty(D)&&Ln(S)},v),v.g={}}oo.prototype.N=function(){oo.aa.N.call(this),Cs(this)},oo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ea=s.JSON.stringify,O0=s.JSON.parse,M0=class{stringify(v){return s.JSON.stringify(v,void 0)}parse(v){return s.JSON.parse(v,void 0)}};function kd(){}kd.prototype.h=null;function Ad(v){return v.h||(v.h=v.i())}function Xu(){}var Ts={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function wc(){ve.call(this,"d")}p(wc,ve);function Nd(){ve.call(this,"c")}p(Nd,ve);var Ca={},pm=null;function _c(){return pm=pm||new tn}Ca.La="serverreachability";function Ta(v){ve.call(this,Ca.La,v)}p(Ta,ve);function ao(v){const S=_c();Tt(S,new Ta(S))}Ca.STAT_EVENT="statevent";function mm(v,S){ve.call(this,Ca.STAT_EVENT,v),this.stat=S}p(mm,ve);function sr(v){const S=_c();Tt(S,new mm(S,v))}Ca.Ma="timingevent";function vm(v,S){ve.call(this,Ca.Ma,v),this.size=S}p(vm,ve);function Qu(v,S){if(typeof v!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){v()},S)}function Yu(){this.g=!0}Yu.prototype.xa=function(){this.g=!1};function Dd(v,S,D,B,ne,ie){v.info(function(){if(v.g)if(ie)for(var _e="",Bt=ie.split("&"),Vn=0;Vn<Bt.length;Vn++){var _t=Bt[Vn].split("=");if(1<_t.length){var jt=_t[0];_t=_t[1];var Un=jt.split("_");_e=2<=Un.length&&Un[1]=="type"?_e+(jt+"="+_t+"&"):_e+(jt+"=redacted&")}}else _e=null;else _e=ie;return"XMLHTTP REQ ("+B+") [attempt "+ne+"]: "+S+`
`+D+`
`+_e})}function Is(v,S,D,B,ne,ie,_e){v.info(function(){return"XMLHTTP RESP ("+B+") [ attempt "+ne+"]: "+S+`
`+D+`
`+ie+" "+_e})}function so(v,S,D,B){v.info(function(){return"XMLHTTP TEXT ("+S+"): "+Pd(v,D)+(B?" "+B:"")})}function F0(v,S){v.info(function(){return"TIMEOUT: "+S})}Yu.prototype.info=function(){};function Pd(v,S){if(!v.g)return S;if(!S)return null;try{var D=JSON.parse(S);if(D){for(v=0;v<D.length;v++)if(Array.isArray(D[v])){var B=D[v];if(!(2>B.length)){var ne=B[1];if(Array.isArray(ne)&&!(1>ne.length)){var ie=ne[0];if(ie!="noop"&&ie!="stop"&&ie!="close")for(var _e=1;_e<ne.length;_e++)ne[_e]=""}}}}return Ea(D)}catch{return S}}var bc={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},gm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Oo;function Dn(){}p(Dn,kd),Dn.prototype.g=function(){return new XMLHttpRequest},Dn.prototype.i=function(){return{}},Oo=new Dn;function mn(v,S,D,B){this.j=v,this.i=S,this.l=D,this.R=B||1,this.U=new oo(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xr}function xr(){this.i=null,this.g="",this.h=!1}var Jn={},Ss={};function Mo(v,S,D){v.L=1,v.v=ks(ci(S)),v.m=D,v.P=!0,Fo(v,null)}function Fo(v,S){v.F=Date.now(),Rs(v),v.A=ci(v.v);var D=v.A,B=v.R;Array.isArray(B)||(B=[String(B)]),Wd(D.i,"t",B),v.C=0,D=v.j.J,v.h=new xr,v.g=Dm(v.j,D?S:null,!v.m),0<v.O&&(v.M=new Rd(d(v.Y,v,v.g),v.O)),S=v.U,D=v.g,B=v.ca;var ne="readystatechange";Array.isArray(ne)||(ne&&(Es[0]=ne.toString()),ne=Es);for(var ie=0;ie<ne.length;ie++){var _e=dt(D,ne[ie],B||S.handleEvent,!1,S.h||S);if(!_e)break;S.g[_e.key]=_e}S=v.H?E(v.H):{},v.m?(v.u||(v.u="POST"),S["Content-Type"]="application/x-www-form-urlencoded",v.g.ea(v.A,v.u,v.m,S)):(v.u="GET",v.g.ea(v.A,v.u,null,S)),ao(),Dd(v.i,v.u,v.A,v.l,v.R,v.m)}mn.prototype.ca=function(v){v=v.target;const S=this.M;S&&Di(v)==3?S.j():this.Y(v)},mn.prototype.Y=function(v){try{if(v==this.g)e:{const Un=Di(this.g);var S=this.g.Ba();const Na=this.g.Z();if(!(3>Un)&&(Un!=3||this.g&&(this.h.h||this.g.oa()||Hd(this.g)))){this.J||Un!=4||S==7||(S==8||0>=Na?ao(3):ao(2)),Ec(this);var D=this.g.Z();this.X=D;t:if(Ia(this)){var B=Hd(this.g);v="";var ne=B.length,ie=Di(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){uo(this),Ra(this);var _e="";break t}this.h.i=new s.TextDecoder}for(S=0;S<ne;S++)this.h.h=!0,v+=this.h.i.decode(B[S],{stream:!(ie&&S==ne-1)});B.length=0,this.h.g+=v,this.C=0,_e=this.h.g}else _e=this.g.oa();if(this.o=D==200,Is(this.i,this.u,this.A,this.l,this.R,Un,D),this.o){if(this.T&&!this.K){t:{if(this.g){var Bt,Vn=this.g;if((Bt=Vn.g?Vn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Bt)){var _t=Bt;break t}}_t=null}if(D=_t)so(this.i,this.l,D,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cc(this,D);else{this.o=!1,this.s=3,sr(12),uo(this),Ra(this);break e}}if(this.P){D=!0;let Yr;for(;!this.J&&this.C<_e.length;)if(Yr=ym(this,_e),Yr==Ss){Un==4&&(this.s=4,sr(14),D=!1),so(this.i,this.l,null,"[Incomplete Response]");break}else if(Yr==Jn){this.s=4,sr(15),so(this.i,this.l,_e,"[Invalid Chunk]"),D=!1;break}else so(this.i,this.l,Yr,null),Cc(this,Yr);if(Ia(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Un!=4||_e.length!=0||this.h.h||(this.s=1,sr(16),D=!1),this.o=this.o&&D,!D)so(this.i,this.l,_e,"[Invalid Chunked Response]"),uo(this),Ra(this);else if(0<_e.length&&!this.W){this.W=!0;var jt=this.j;jt.g==this&&jt.ba&&!jt.M&&(jt.j.info("Great, no buffering proxy detected. Bytes received: "+_e.length),Oc(jt),jt.M=!0,sr(11))}}else so(this.i,this.l,_e,null),Cc(this,_e);Un==4&&uo(this),this.o&&!this.J&&(Un==4?Mc(this.j,this):(this.o=!1,Rs(this)))}else Cm(this.g),D==400&&0<_e.indexOf("Unknown SID")?(this.s=3,sr(12)):(this.s=0,sr(13)),uo(this),Ra(this)}}}catch{}finally{}};function Ia(v){return v.g?v.u=="GET"&&v.L!=2&&v.j.Ca:!1}function ym(v,S){var D=v.C,B=S.indexOf(`
`,D);return B==-1?Ss:(D=Number(S.substring(D,B)),isNaN(D)?Jn:(B+=1,B+D>S.length?Ss:(S=S.slice(B,B+D),v.C=B+D,S)))}mn.prototype.cancel=function(){this.J=!0,uo(this)};function Rs(v){v.S=Date.now()+v.I,Sa(v,v.I)}function Sa(v,S){if(v.B!=null)throw Error("WatchDog timer not null");v.B=Qu(d(v.ba,v),S)}function Ec(v){v.B&&(s.clearTimeout(v.B),v.B=null)}mn.prototype.ba=function(){this.B=null;const v=Date.now();0<=v-this.S?(F0(this.i,this.A),this.L!=2&&(ao(),sr(17)),uo(this),this.s=2,Ra(this)):Sa(this,this.S-v)};function Ra(v){v.j.G==0||v.J||Mc(v.j,v)}function uo(v){Ec(v);var S=v.M;S&&typeof S.ma=="function"&&S.ma(),v.M=null,Cs(v.U),v.g&&(S=v.g,v.g=null,S.abort(),S.ma())}function Cc(v,S){try{var D=v.j;if(D.G!=0&&(D.g==v||Tc(D.h,v))){if(!v.K&&Tc(D.h,v)&&D.G==3){try{var B=D.Da.g.parse(S)}catch{B=null}if(Array.isArray(B)&&B.length==3){var ne=B;if(ne[0]==0){e:if(!D.u){if(D.g)if(D.g.F+3e3<v.F)Pi(D),il(D);else break e;ol(D),sr(18)}}else D.za=ne[1],0<D.za-D.T&&37500>ne[2]&&D.F&&D.v==0&&!D.C&&(D.C=Qu(d(D.Za,D),6e3));if(1>=Fd(D.h)&&D.ca){try{D.ca()}catch{}D.ca=void 0}}else Uo(D,11)}else if((v.K||D.g==v)&&Pi(D),!x(S))for(ne=D.Da.g.parse(S),S=0;S<ne.length;S++){let _t=ne[S];if(D.T=_t[0],_t=_t[1],D.G==2)if(_t[0]=="c"){D.K=_t[1],D.ia=_t[2];const jt=_t[3];jt!=null&&(D.la=jt,D.j.info("VER="+D.la));const Un=_t[4];Un!=null&&(D.Aa=Un,D.j.info("SVER="+D.Aa));const Na=_t[5];Na!=null&&typeof Na=="number"&&0<Na&&(B=1.5*Na,D.L=B,D.j.info("backChannelRequestTimeoutMs_="+B)),B=D;const Yr=v.g;if(Yr){const Fc=Yr.g?Yr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fc){var ie=B.h;ie.g||Fc.indexOf("spdy")==-1&&Fc.indexOf("quic")==-1&&Fc.indexOf("h2")==-1||(ie.j=ie.l,ie.g=new Set,ie.h&&(Ic(ie,ie.h),ie.h=null))}if(B.D){const Xd=Yr.g?Yr.g.getResponseHeader("X-HTTP-Session-Id"):null;Xd&&(B.ya=Xd,kt(B.I,B.D,Xd))}}D.G=3,D.l&&D.l.ua(),D.ba&&(D.R=Date.now()-v.F,D.j.info("Handshake RTT: "+D.R+"ms")),B=D;var _e=v;if(B.qa=Nm(B,B.J?B.ia:null,B.W),_e.K){Ld(B.h,_e);var Bt=_e,Vn=B.L;Vn&&(Bt.I=Vn),Bt.B&&(Ec(Bt),Rs(Bt)),B.g=_e}else Rm(B);0<D.i.length&&Pc(D)}else _t[0]!="stop"&&_t[0]!="close"||Uo(D,7);else D.G==3&&(_t[0]=="stop"||_t[0]=="close"?_t[0]=="stop"?Uo(D,7):rl(D):_t[0]!="noop"&&D.l&&D.l.ta(_t),D.v=0)}}ao(4)}catch{}}var xm=class{constructor(v,S){this.g=v,this.map=S}};function Od(v){this.l=v||10,s.PerformanceNavigationTiming?(v=s.performance.getEntriesByType("navigation"),v=0<v.length&&(v[0].nextHopProtocol=="hq"||v[0].nextHopProtocol=="h2")):v=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=v?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Md(v){return v.h?!0:v.g?v.g.size>=v.j:!1}function Fd(v){return v.h?1:v.g?v.g.size:0}function Tc(v,S){return v.h?v.h==S:v.g?v.g.has(S):!1}function Ic(v,S){v.g?v.g.add(S):v.h=S}function Ld(v,S){v.h&&v.h==S?v.h=null:v.g&&v.g.has(S)&&v.g.delete(S)}Od.prototype.cancel=function(){if(this.i=Bd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const v of this.g.values())v.cancel();this.g.clear()}};function Bd(v){if(v.h!=null)return v.i.concat(v.h.D);if(v.g!=null&&v.g.size!==0){let S=v.i;for(const D of v.g.values())S=S.concat(D.D);return S}return m(v.i)}function wm(v){if(v.V&&typeof v.V=="function")return v.V();if(typeof Map<"u"&&v instanceof Map||typeof Set<"u"&&v instanceof Set)return Array.from(v.values());if(typeof v=="string")return v.split("");if(u(v)){for(var S=[],D=v.length,B=0;B<D;B++)S.push(v[B]);return S}S=[],D=0;for(B in v)S[D++]=v[B];return S}function ki(v){if(v.na&&typeof v.na=="function")return v.na();if(!v.V||typeof v.V!="function"){if(typeof Map<"u"&&v instanceof Map)return Array.from(v.keys());if(!(typeof Set<"u"&&v instanceof Set)){if(u(v)||typeof v=="string"){var S=[];v=v.length;for(var D=0;D<v;D++)S.push(D);return S}S=[],D=0;for(const B in v)S[D++]=B;return S}}}function wr(v,S){if(v.forEach&&typeof v.forEach=="function")v.forEach(S,void 0);else if(u(v)||typeof v=="string")Array.prototype.forEach.call(v,S,void 0);else for(var D=ki(v),B=wm(v),ne=B.length,ie=0;ie<ne;ie++)S.call(void 0,B[ie],D&&D[ie],v)}var Lo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kr(v,S){if(v){v=v.split("&");for(var D=0;D<v.length;D++){var B=v[D].indexOf("="),ne=null;if(0<=B){var ie=v[D].substring(0,B);ne=v[D].substring(B+1)}else ie=v[D];S(ie,ne?decodeURIComponent(ne.replace(/\+/g," ")):"")}}}function lo(v){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,v instanceof lo){this.h=v.h,Fr(this,v.j),this.o=v.o,this.g=v.g,Ai(this,v.s),this.l=v.l;var S=v.i,D=new Ns;D.i=S.i,S.g&&(D.g=new Map(S.g),D.h=S.h),Ju(this,D),this.m=v.m}else v&&(S=String(v).match(Lo))?(this.h=!1,Fr(this,S[1]||"",!0),this.o=As(S[2]||""),this.g=As(S[3]||"",!0),Ai(this,S[4]),this.l=As(S[5]||"",!0),Ju(this,S[6]||"",!0),this.m=As(S[7]||"")):(this.h=!1,this.i=new Ns(null,this.h))}lo.prototype.toString=function(){var v=[],S=this.j;S&&v.push(Ni(S,Ud,!0),":");var D=this.g;return(D||S=="file")&&(v.push("//"),(S=this.o)&&v.push(Ni(S,Ud,!0),"@"),v.push(encodeURIComponent(String(D)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),D=this.s,D!=null&&v.push(":",String(D))),(D=this.l)&&(this.g&&D.charAt(0)!="/"&&v.push("/"),v.push(Ni(D,D.charAt(0)=="/"?L0:co,!0))),(D=this.i.toString())&&v.push("?",D),(D=this.m)&&v.push("#",Ni(D,Sc)),v.join("")};function ci(v){return new lo(v)}function Fr(v,S,D){v.j=D?As(S,!0):S,v.j&&(v.j=v.j.replace(/:$/,""))}function Ai(v,S){if(S){if(S=Number(S),isNaN(S)||0>S)throw Error("Bad port number "+S);v.s=S}else v.s=null}function Ju(v,S,D){S instanceof Ns?(v.i=S,_m(v.i,v.h)):(D||(S=Ni(S,Bo)),v.i=new Ns(S,v.h))}function kt(v,S,D){v.i.set(S,D)}function ks(v){return kt(v,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),v}function As(v,S){return v?S?decodeURI(v.replace(/%25/g,"%2525")):decodeURIComponent(v):""}function Ni(v,S,D){return typeof v=="string"?(v=encodeURI(v).replace(S,Vd),D&&(v=v.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v):null}function Vd(v){return v=v.charCodeAt(0),"%"+(v>>4&15).toString(16)+(v&15).toString(16)}var Ud=/[#\/\?@]/g,co=/[#\?:]/g,L0=/[#\?]/g,Bo=/[#\?@]/g,Sc=/#/g;function Ns(v,S){this.h=this.g=null,this.i=v||null,this.j=!!S}function Xr(v){v.g||(v.g=new Map,v.h=0,v.i&&Kr(v.i,function(S,D){v.add(decodeURIComponent(S.replace(/\+/g," ")),D)}))}n=Ns.prototype,n.add=function(v,S){Xr(this),this.i=null,v=ka(this,v);var D=this.g.get(v);return D||this.g.set(v,D=[]),D.push(S),this.h+=1,this};function Rc(v,S){Xr(v),S=ka(v,S),v.g.has(S)&&(v.i=null,v.h-=v.g.get(S).length,v.g.delete(S))}function Ds(v,S){return Xr(v),S=ka(v,S),v.g.has(S)}n.forEach=function(v,S){Xr(this),this.g.forEach(function(D,B){D.forEach(function(ne){v.call(S,ne,B,this)},this)},this)},n.na=function(){Xr(this);const v=Array.from(this.g.values()),S=Array.from(this.g.keys()),D=[];for(let B=0;B<S.length;B++){const ne=v[B];for(let ie=0;ie<ne.length;ie++)D.push(S[B])}return D},n.V=function(v){Xr(this);let S=[];if(typeof v=="string")Ds(this,v)&&(S=S.concat(this.g.get(ka(this,v))));else{v=Array.from(this.g.values());for(let D=0;D<v.length;D++)S=S.concat(v[D])}return S},n.set=function(v,S){return Xr(this),this.i=null,v=ka(this,v),Ds(this,v)&&(this.h-=this.g.get(v).length),this.g.set(v,[S]),this.h+=1,this},n.get=function(v,S){return v?(v=this.V(v),0<v.length?String(v[0]):S):S};function Wd(v,S,D){Rc(v,S),0<D.length&&(v.i=null,v.g.set(ka(v,S),m(D)),v.h+=D.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const v=[],S=Array.from(this.g.keys());for(var D=0;D<S.length;D++){var B=S[D];const ie=encodeURIComponent(String(B)),_e=this.V(B);for(B=0;B<_e.length;B++){var ne=ie;_e[B]!==""&&(ne+="="+encodeURIComponent(String(_e[B]))),v.push(ne)}}return this.i=v.join("&")};function ka(v,S){return S=String(S),v.j&&(S=S.toLowerCase()),S}function _m(v,S){S&&!v.j&&(Xr(v),v.i=null,v.g.forEach(function(D,B){var ne=B.toLowerCase();B!=ne&&(Rc(this,B),Wd(this,ne,D))},v)),v.j=S}function Ps(v,S){const D=new Yu;if(s.Image){const B=new Image;B.onload=f(ho,D,"TestLoadImage: loaded",!0,S,B),B.onerror=f(ho,D,"TestLoadImage: error",!1,S,B),B.onabort=f(ho,D,"TestLoadImage: abort",!1,S,B),B.ontimeout=f(ho,D,"TestLoadImage: timeout",!1,S,B),s.setTimeout(function(){B.ontimeout&&B.ontimeout()},1e4),B.src=v}else S(!1)}function B0(v,S){const D=new Yu,B=new AbortController,ne=setTimeout(()=>{B.abort(),ho(D,"TestPingServer: timeout",!1,S)},1e4);fetch(v,{signal:B.signal}).then(ie=>{clearTimeout(ne),ie.ok?ho(D,"TestPingServer: ok",!0,S):ho(D,"TestPingServer: server error",!1,S)}).catch(()=>{clearTimeout(ne),ho(D,"TestPingServer: error",!1,S)})}function ho(v,S,D,B,ne){try{ne&&(ne.onload=null,ne.onerror=null,ne.onabort=null,ne.ontimeout=null),B(D)}catch{}}function jd(){this.g=new M0}function kc(v,S,D){const B=D||"";try{wr(v,function(ne,ie){let _e=ne;l(ne)&&(_e=Ea(ne)),S.push(B+ie+"="+encodeURIComponent(_e))})}catch(ne){throw S.push(B+"type="+encodeURIComponent("_badmap")),ne}}function Os(v){this.l=v.Ub||null,this.j=v.eb||!1}p(Os,kd),Os.prototype.g=function(){return new Ac(this.l,this.j)},Os.prototype.i=function(v){return function(){return v}}({});function Ac(v,S){tn.call(this),this.D=v,this.o=S,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}p(Ac,tn),n=Ac.prototype,n.open=function(v,S){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=v,this.A=S,this.readyState=1,Ms(this)},n.send=function(v){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const S={headers:this.u,method:this.B,credentials:this.m,cache:void 0};v&&(S.body=v),(this.D||s).fetch(new Request(this.A,S)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,el(this)),this.readyState=0},n.Sa=function(v){if(this.g&&(this.l=v,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=v.headers,this.readyState=2,Ms(this)),this.g&&(this.readyState=3,Ms(this),this.g)))if(this.responseType==="arraybuffer")v.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in v){if(this.j=v.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Zu(this)}else v.text().then(this.Ra.bind(this),this.ga.bind(this))};function Zu(v){v.j.read().then(v.Pa.bind(v)).catch(v.ga.bind(v))}n.Pa=function(v){if(this.g){if(this.o&&v.value)this.response.push(v.value);else if(!this.o){var S=v.value?v.value:new Uint8Array(0);(S=this.v.decode(S,{stream:!v.done}))&&(this.response=this.responseText+=S)}v.done?el(this):Ms(this),this.readyState==3&&Zu(this)}},n.Ra=function(v){this.g&&(this.response=this.responseText=v,el(this))},n.Qa=function(v){this.g&&(this.response=v,el(this))},n.ga=function(){this.g&&el(this)};function el(v){v.readyState=4,v.l=null,v.j=null,v.v=null,Ms(v)}n.setRequestHeader=function(v,S){this.u.append(v,S)},n.getResponseHeader=function(v){return this.h&&this.h.get(v.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const v=[],S=this.h.entries();for(var D=S.next();!D.done;)D=D.value,v.push(D[0]+": "+D[1]),D=S.next();return v.join(`\r
`)};function Ms(v){v.onreadystatechange&&v.onreadystatechange.call(v)}Object.defineProperty(Ac.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(v){this.m=v?"include":"same-origin"}});function Nc(v){let S="";return k(v,function(D,B){S+=B,S+=":",S+=D,S+=`\r
`}),S}function tl(v,S,D){e:{for(B in D){var B=!1;break e}B=!0}B||(D=Nc(D),typeof v=="string"?D!=null&&encodeURIComponent(String(D)):kt(v,S,D))}function Xt(v){tn.call(this),this.headers=new Map,this.o=v||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}p(Xt,tn);var bm=/^https?$/i,nl=["POST","PUT"];n=Xt.prototype,n.Ha=function(v){this.J=v},n.ea=function(v,S,D,B){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+v);S=S?S.toUpperCase():"GET",this.D=v,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Oo.g(),this.v=this.o?Ad(this.o):Ad(Oo),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(S,String(v),!0),this.B=!1}catch(ie){Dc(this,ie);return}if(v=D||"",D=new Map(this.headers),B)if(Object.getPrototypeOf(B)===Object.prototype)for(var ne in B)D.set(ne,B[ne]);else if(typeof B.keys=="function"&&typeof B.get=="function")for(const ie of B.keys())D.set(ie,B.get(ie));else throw Error("Unknown input type for opt_headers: "+String(B));B=Array.from(D.keys()).find(ie=>ie.toLowerCase()=="content-type"),ne=s.FormData&&v instanceof s.FormData,!(0<=Array.prototype.indexOf.call(nl,S,void 0))||B||ne||D.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ie,_e]of D)this.g.setRequestHeader(ie,_e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Em(this),this.u=!0,this.g.send(v),this.u=!1}catch(ie){Dc(this,ie)}};function Dc(v,S){v.h=!1,v.g&&(v.j=!0,v.g.abort(),v.j=!1),v.l=S,v.m=5,zd(v),fo(v)}function zd(v){v.A||(v.A=!0,Tt(v,"complete"),Tt(v,"error"))}n.abort=function(v){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=v||7,Tt(this,"complete"),Tt(this,"abort"),fo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fo(this,!0)),Xt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?$d(this):this.bb())},n.bb=function(){$d(this)};function $d(v){if(v.h&&typeof a<"u"&&(!v.v[1]||Di(v)!=4||v.Z()!=2)){if(v.u&&Di(v)==4)li(v.Ea,0,v);else if(Tt(v,"readystatechange"),Di(v)==4){v.h=!1;try{const _e=v.Z();e:switch(_e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var S=!0;break e;default:S=!1}var D;if(!(D=S)){var B;if(B=_e===0){var ne=String(v.D).match(Lo)[1]||null;!ne&&s.self&&s.self.location&&(ne=s.self.location.protocol.slice(0,-1)),B=!bm.test(ne?ne.toLowerCase():"")}D=B}if(D)Tt(v,"complete"),Tt(v,"success");else{v.m=6;try{var ie=2<Di(v)?v.g.statusText:""}catch{ie=""}v.l=ie+" ["+v.Z()+"]",zd(v)}}finally{fo(v)}}}}function fo(v,S){if(v.g){Em(v);const D=v.g,B=v.v[0]?()=>{}:null;v.g=null,v.v=null,S||Tt(v,"ready");try{D.onreadystatechange=B}catch{}}}function Em(v){v.I&&(s.clearTimeout(v.I),v.I=null)}n.isActive=function(){return!!this.g};function Di(v){return v.g?v.g.readyState:0}n.Z=function(){try{return 2<Di(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(v){if(this.g){var S=this.g.responseText;return v&&S.indexOf(v)==0&&(S=S.substring(v.length)),O0(S)}};function Hd(v){try{if(!v.g)return null;if("response"in v.g)return v.g.response;switch(v.H){case"":case"text":return v.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in v.g)return v.g.mozResponseArrayBuffer}return null}catch{return null}}function Cm(v){const S={};v=(v.g&&2<=Di(v)&&v.g.getAllResponseHeaders()||"").split(`\r
`);for(let B=0;B<v.length;B++){if(x(v[B]))continue;var D=N(v[B]);const ne=D[0];if(D=D[1],typeof D!="string")continue;D=D.trim();const ie=S[ne]||[];S[ne]=ie,ie.push(D)}T(S,function(B){return B.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Fs(v,S,D){return D&&D.internalChannelParams&&D.internalChannelParams[v]||S}function Gd(v){this.Aa=0,this.i=[],this.j=new Yu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Fs("failFast",!1,v),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Fs("baseRetryDelayMs",5e3,v),this.cb=Fs("retryDelaySeedMs",1e4,v),this.Wa=Fs("forwardChannelMaxRetries",2,v),this.wa=Fs("forwardChannelRequestTimeoutMs",2e4,v),this.pa=v&&v.xmlHttpFactory||void 0,this.Xa=v&&v.Tb||void 0,this.Ca=v&&v.useFetchStreams||!1,this.L=void 0,this.J=v&&v.supportsCrossDomainXhr||!1,this.K="",this.h=new Od(v&&v.concurrentRequestLimit),this.Da=new jd,this.P=v&&v.fastHandshake||!1,this.O=v&&v.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=v&&v.Rb||!1,v&&v.xa&&this.j.xa(),v&&v.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&v&&v.detectBufferingProxy||!1,this.ja=void 0,v&&v.longPollingTimeout&&0<v.longPollingTimeout&&(this.ja=v.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Gd.prototype,n.la=8,n.G=1,n.connect=function(v,S,D,B){sr(0),this.W=v,this.H=S||{},D&&B!==void 0&&(this.H.OSID=D,this.H.OAID=B),this.F=this.X,this.I=Nm(this,null,this.W),Pc(this)};function rl(v){if(Tm(v),v.G==3){var S=v.U++,D=ci(v.I);if(kt(D,"SID",v.K),kt(D,"RID",S),kt(D,"TYPE","terminate"),Vo(v,D),S=new mn(v,v.j,S),S.L=2,S.v=ks(ci(D)),D=!1,s.navigator&&s.navigator.sendBeacon)try{D=s.navigator.sendBeacon(S.v.toString(),"")}catch{}!D&&s.Image&&(new Image().src=S.v,D=!0),D||(S.g=Dm(S.j,null),S.g.ea(S.v)),S.F=Date.now(),Rs(S)}Am(v)}function il(v){v.g&&(Oc(v),v.g.cancel(),v.g=null)}function Tm(v){il(v),v.u&&(s.clearTimeout(v.u),v.u=null),Pi(v),v.h.cancel(),v.s&&(typeof v.s=="number"&&s.clearTimeout(v.s),v.s=null)}function Pc(v){if(!Md(v.h)&&!v.s){v.s=!0;var S=v.Ga;Q||j(),$||(Q(),$=!0),K.add(S,v),v.B=0}}function Im(v,S){return Fd(v.h)>=v.h.j-(v.s?1:0)?!1:v.s?(v.i=S.D.concat(v.i),!0):v.G==1||v.G==2||v.B>=(v.Va?0:v.Wa)?!1:(v.s=Qu(d(v.Ga,v,S),km(v,v.B)),v.B++,!0)}n.Ga=function(v){if(this.s)if(this.s=null,this.G==1){if(!v){this.U=Math.floor(1e5*Math.random()),v=this.U++;const ne=new mn(this,this.j,v);let ie=this.o;if(this.S&&(ie?(ie=E(ie),R(ie,this.S)):ie=this.S),this.m!==null||this.O||(ne.H=ie,ie=null),this.P)e:{for(var S=0,D=0;D<this.i.length;D++){t:{var B=this.i[D];if("__data__"in B.map&&(B=B.map.__data__,typeof B=="string")){B=B.length;break t}B=void 0}if(B===void 0)break;if(S+=B,4096<S){S=D;break e}if(S===4096||D===this.i.length-1){S=D+1;break e}}S=1e3}else S=1e3;S=Sm(this,ne,S),D=ci(this.I),kt(D,"RID",v),kt(D,"CVER",22),this.D&&kt(D,"X-HTTP-Session-Id",this.D),Vo(this,D),ie&&(this.O?S="headers="+encodeURIComponent(String(Nc(ie)))+"&"+S:this.m&&tl(D,this.m,ie)),Ic(this.h,ne),this.Ua&&kt(D,"TYPE","init"),this.P?(kt(D,"$req",S),kt(D,"SID","null"),ne.T=!0,Mo(ne,D,null)):Mo(ne,D,S),this.G=2}}else this.G==3&&(v?qd(this,v):this.i.length==0||Md(this.h)||qd(this))};function qd(v,S){var D;S?D=S.l:D=v.U++;const B=ci(v.I);kt(B,"SID",v.K),kt(B,"RID",D),kt(B,"AID",v.T),Vo(v,B),v.m&&v.o&&tl(B,v.m,v.o),D=new mn(v,v.j,D,v.B+1),v.m===null&&(D.H=v.o),S&&(v.i=S.D.concat(v.i)),S=Sm(v,D,1e3),D.I=Math.round(.5*v.wa)+Math.round(.5*v.wa*Math.random()),Ic(v.h,D),Mo(D,B,S)}function Vo(v,S){v.H&&k(v.H,function(D,B){kt(S,B,D)}),v.l&&wr({},function(D,B){kt(S,B,D)})}function Sm(v,S,D){D=Math.min(v.i.length,D);var B=v.l?d(v.l.Na,v.l,v):null;e:{var ne=v.i;let ie=-1;for(;;){const _e=["count="+D];ie==-1?0<D?(ie=ne[0].g,_e.push("ofs="+ie)):ie=0:_e.push("ofs="+ie);let Bt=!0;for(let Vn=0;Vn<D;Vn++){let _t=ne[Vn].g;const jt=ne[Vn].map;if(_t-=ie,0>_t)ie=Math.max(0,ne[Vn].g-100),Bt=!1;else try{kc(jt,_e,"req"+_t+"_")}catch{B&&B(jt)}}if(Bt){B=_e.join("&");break e}}}return v=v.i.splice(0,D),S.D=v,B}function Rm(v){if(!v.g&&!v.u){v.Y=1;var S=v.Fa;Q||j(),$||(Q(),$=!0),K.add(S,v),v.v=0}}function ol(v){return v.g||v.u||3<=v.v?!1:(v.Y++,v.u=Qu(d(v.Fa,v),km(v,v.v)),v.v++,!0)}n.Fa=function(){if(this.u=null,Kd(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var v=2*this.R;this.j.info("BP detection timer enabled: "+v),this.A=Qu(d(this.ab,this),v)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,sr(10),il(this),Kd(this))};function Oc(v){v.A!=null&&(s.clearTimeout(v.A),v.A=null)}function Kd(v){v.g=new mn(v,v.j,"rpc",v.Y),v.m===null&&(v.g.H=v.o),v.g.O=0;var S=ci(v.qa);kt(S,"RID","rpc"),kt(S,"SID",v.K),kt(S,"AID",v.T),kt(S,"CI",v.F?"0":"1"),!v.F&&v.ja&&kt(S,"TO",v.ja),kt(S,"TYPE","xmlhttp"),Vo(v,S),v.m&&v.o&&tl(S,v.m,v.o),v.L&&(v.g.I=v.L);var D=v.g;v=v.ia,D.L=1,D.v=ks(ci(S)),D.m=null,D.P=!0,Fo(D,v)}n.Za=function(){this.C!=null&&(this.C=null,il(this),ol(this),sr(19))};function Pi(v){v.C!=null&&(s.clearTimeout(v.C),v.C=null)}function Mc(v,S){var D=null;if(v.g==S){Pi(v),Oc(v),v.g=null;var B=2}else if(Tc(v.h,S))D=S.D,Ld(v.h,S),B=1;else return;if(v.G!=0){if(S.o)if(B==1){D=S.m?S.m.length:0,S=Date.now()-S.F;var ne=v.B;B=_c(),Tt(B,new vm(B,D)),Pc(v)}else Rm(v);else if(ne=S.s,ne==3||ne==0&&0<S.X||!(B==1&&Im(v,S)||B==2&&ol(v)))switch(D&&0<D.length&&(S=v.h,S.i=S.i.concat(D)),ne){case 1:Uo(v,5);break;case 4:Uo(v,10);break;case 3:Uo(v,6);break;default:Uo(v,2)}}}function km(v,S){let D=v.Ta+Math.floor(Math.random()*v.cb);return v.isActive()||(D*=2),D*S}function Uo(v,S){if(v.j.info("Error code "+S),S==2){var D=d(v.fb,v),B=v.Xa;const ne=!B;B=new lo(B||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||Fr(B,"https"),ks(B),ne?Ps(B.toString(),D):B0(B.toString(),D)}else sr(2);v.G=0,v.l&&v.l.sa(S),Am(v),Tm(v)}n.fb=function(v){v?(this.j.info("Successfully pinged google.com"),sr(2)):(this.j.info("Failed to ping google.com"),sr(1))};function Am(v){if(v.G=0,v.ka=[],v.l){const S=Bd(v.h);(S.length!=0||v.i.length!=0)&&(g(v.ka,S),g(v.ka,v.i),v.h.i.length=0,m(v.i),v.i.length=0),v.l.ra()}}function Nm(v,S,D){var B=D instanceof lo?ci(D):new lo(D);if(B.g!="")S&&(B.g=S+"."+B.g),Ai(B,B.s);else{var ne=s.location;B=ne.protocol,S=S?S+"."+ne.hostname:ne.hostname,ne=+ne.port;var ie=new lo(null);B&&Fr(ie,B),S&&(ie.g=S),ne&&Ai(ie,ne),D&&(ie.l=D),B=ie}return D=v.D,S=v.ya,D&&S&&kt(B,D,S),kt(B,"VER",v.la),Vo(v,B),B}function Dm(v,S,D){if(S&&!v.J)throw Error("Can't create secondary domain capable XhrIo object.");return S=v.Ca&&!v.pa?new Xt(new Os({eb:D})):new Xt(v.pa),S.Ha(v.J),S}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pm(){}n=Pm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function al(){}al.prototype.g=function(v,S){return new _r(v,S)};function _r(v,S){tn.call(this),this.g=new Gd(S),this.l=v,this.h=S&&S.messageUrlParams||null,v=S&&S.messageHeaders||null,S&&S.clientProtocolHeaderRequired&&(v?v["X-Client-Protocol"]="webchannel":v={"X-Client-Protocol":"webchannel"}),this.g.o=v,v=S&&S.initMessageHeaders||null,S&&S.messageContentType&&(v?v["X-WebChannel-Content-Type"]=S.messageContentType:v={"X-WebChannel-Content-Type":S.messageContentType}),S&&S.va&&(v?v["X-WebChannel-Client-Profile"]=S.va:v={"X-WebChannel-Client-Profile":S.va}),this.g.S=v,(v=S&&S.Sb)&&!x(v)&&(this.g.m=v),this.v=S&&S.supportsCrossDomainXhr||!1,this.u=S&&S.sendRawJson||!1,(S=S&&S.httpSessionIdParam)&&!x(S)&&(this.g.D=S,v=this.h,v!==null&&S in v&&(v=this.h,S in v&&delete v[S])),this.j=new Qr(this)}p(_r,tn),_r.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_r.prototype.close=function(){rl(this.g)},_r.prototype.o=function(v){var S=this.g;if(typeof v=="string"){var D={};D.__data__=v,v=D}else this.u&&(D={},D.__data__=Ea(v),v=D);S.i.push(new xm(S.Ya++,v)),S.G==3&&Pc(S)},_r.prototype.N=function(){this.g.l=null,delete this.j,rl(this.g),delete this.g,_r.aa.N.call(this)};function Om(v){wc.call(this),v.__headers__&&(this.headers=v.__headers__,this.statusCode=v.__status__,delete v.__headers__,delete v.__status__);var S=v.__sm__;if(S){e:{for(const D in S){v=D;break e}v=void 0}(this.i=v)&&(v=this.i,S=S!==null&&v in S?S[v]:void 0),this.data=S}else this.data=v}p(Om,wc);function Aa(){Nd.call(this),this.status=1}p(Aa,Nd);function Qr(v){this.g=v}p(Qr,Pm),Qr.prototype.ua=function(){Tt(this.g,"a")},Qr.prototype.ta=function(v){Tt(this.g,new Om(v))},Qr.prototype.sa=function(v){Tt(this.g,new Aa)},Qr.prototype.ra=function(){Tt(this.g,"b")},al.prototype.createWebChannel=al.prototype.g,_r.prototype.send=_r.prototype.o,_r.prototype.open=_r.prototype.m,_r.prototype.close=_r.prototype.close,PD=function(){return new al},DD=function(){return _c()},ND=Ca,Rw={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},bc.NO_ERROR=0,bc.TIMEOUT=8,bc.HTTP_ERROR=6,Xv=bc,gm.COMPLETE="complete",AD=gm,Xu.EventType=Ts,Ts.OPEN="a",Ts.CLOSE="b",Ts.ERROR="c",Ts.MESSAGE="d",tn.prototype.listen=tn.prototype.K,wf=Xu,Xt.prototype.listenOnce=Xt.prototype.L,Xt.prototype.getLastError=Xt.prototype.Ka,Xt.prototype.getLastErrorCode=Xt.prototype.Ba,Xt.prototype.getStatus=Xt.prototype.Z,Xt.prototype.getResponseJson=Xt.prototype.Oa,Xt.prototype.getResponseText=Xt.prototype.oa,Xt.prototype.send=Xt.prototype.ea,Xt.prototype.setWithCredentials=Xt.prototype.Ha,kD=Xt}).apply(typeof uv<"u"?uv:typeof self<"u"?self:typeof window<"u"?window:{});const DI="@firebase/firestore",PI="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Tr.UNAUTHENTICATED=new Tr(null),Tr.GOOGLE_CREDENTIALS=new Tr("google-credentials-uid"),Tr.FIRST_PARTY=new Tr("first-party-uid"),Tr.MOCK_USER=new Tr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vd="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ql=new Pb("@firebase/firestore");function $c(){return ql.logLevel}function Re(n,...e){if(ql.logLevel<=gt.DEBUG){const t=e.map(qb);ql.debug(`Firestore (${vd}): ${n}`,...t)}}function as(n,...e){if(ql.logLevel<=gt.ERROR){const t=e.map(qb);ql.error(`Firestore (${vd}): ${n}`,...t)}}function $h(n,...e){if(ql.logLevel<=gt.WARN){const t=e.map(qb);ql.warn(`Firestore (${vd}): ${n}`,...t)}}function qb(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qe(n="Unexpected state"){const e=`FIRESTORE (${vd}) INTERNAL ASSERTION FAILED: `+n;throw as(e),new Error(e)}function Ft(n,e){n||Qe()}function it(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ge={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $e extends hs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class j6{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Tr.UNAUTHENTICATED))}shutdown(){}}class z6{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class $6{constructor(e){this.t=e,this.currentUser=Tr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ft(this.o===void 0);let r=this.i;const i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let o=new wu;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new wu,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const u=o;e.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},s=u=>{Re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>s(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?s(u):(Re("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new wu)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ft(typeof r.accessToken=="string"),new OD(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ft(e===null||typeof e=="string"),new Tr(e)}}class H6{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Tr.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class G6{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new H6(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Tr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class OI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class q6{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,gi(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){Ft(this.o===void 0);const r=o=>{o.error!=null&&Re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.R;return this.R=o.token,Re("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const i=o=>{Re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?i(o):Re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new OI(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ft(typeof t.token=="string"),this.R=t.token,new OI(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K6(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=K6(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}}function wt(n,e){return n<e?-1:n>e?1:0}function Hh(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MI=-62135596800,FI=1e6;class Gn{static now(){return Gn.fromMillis(Date.now())}static fromDate(e){return Gn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*FI);return new Gn(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new $e(ge.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new $e(ge.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<MI)throw new $e(ge.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $e(ge.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/FI}_compareTo(e){return this.seconds===e.seconds?wt(this.nanoseconds,e.nanoseconds):wt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-MI;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{static fromTimestamp(e){return new tt(e)}static min(){return new tt(new Gn(0,0))}static max(){return new tt(new Gn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LI="__name__";class Ko{constructor(e,t,r){t===void 0?t=0:t>e.length&&Qe(),r===void 0?r=e.length-t:r>e.length-t&&Qe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ko.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ko?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=Ko.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return Math.sign(e.length-t.length)}static compareSegments(e,t){const r=Ko.isNumericId(e),i=Ko.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Ko.extractNumericId(e).compare(Ko.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return xu.fromString(e.substring(4,e.length-2))}}class bn extends Ko{construct(e,t,r){return new bn(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new $e(ge.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new bn(t)}static emptyPath(){return new bn([])}}const X6=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fr extends Ko{construct(e,t,r){return new fr(e,t,r)}static isValidIdentifier(e){return X6.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===LI}static keyField(){return new fr([LI])}static fromServerFormat(e){const t=[];let r="",i=0;const o=()=>{if(r.length===0)throw new $e(ge.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const s=e[i];if(s==="\\"){if(i+1===e.length)throw new $e(ge.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new $e(ge.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else s==="`"?(a=!a,i++):s!=="."||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new $e(ge.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fr(t)}static emptyPath(){return new fr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{constructor(e){this.path=e}static fromPath(e){return new He(bn.fromString(e))}static fromName(e){return new He(bn.fromString(e).popFirst(5))}static empty(){return new He(bn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&bn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return bn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new He(new bn(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cp=-1;function Q6(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=tt.fromTimestamp(r===1e9?new Gn(t+1,0):new Gn(t,r));return new Tu(i,He.empty(),e)}function Y6(n){return new Tu(n.readTime,n.key,cp)}class Tu{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Tu(tt.min(),He.empty(),cp)}static max(){return new Tu(tt.max(),He.empty(),cp)}}function J6(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=He.comparator(n.documentKey,e.documentKey),t!==0?t:wt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z6="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class e5{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gd(n){if(n.code!==ge.FAILED_PRECONDITION||n.message!==Z6)throw n;Re("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Qe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new de((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof de?t:de.resolve(t)}catch(t){return de.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):de.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):de.reject(t)}static resolve(e){return new de((t,r)=>{t(e)})}static reject(e){return new de((t,r)=>{r(e)})}static waitFor(e){return new de((t,r)=>{let i=0,o=0,a=!1;e.forEach(s=>{++i,s.next(()=>{++o,a&&o===i&&t()},u=>r(u))}),a=!0,o===i&&t()})}static or(e){let t=de.resolve(!1);for(const r of e)t=t.next(i=>i?de.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new de((r,i)=>{const o=e.length,a=new Array(o);let s=0;for(let u=0;u<o;u++){const l=u;t(e[l]).next(c=>{a[l]=c,++s,s===o&&r(a)},c=>i(c))}})}static doWhile(e,t){return new de((r,i)=>{const o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}}function t5(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function yd(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.oe(r),this._e=r=>t.writeSequenceNumber(r))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}Yy.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kb=-1;function Jy(n){return n==null}function Lg(n){return n===0&&1/n==-1/0}function n5(n){return typeof n=="number"&&Number.isInteger(n)&&!Lg(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD="";function r5(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=BI(e)),e=i5(n.get(t),e);return BI(e)}function i5(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const o=n.charAt(i);switch(o){case"\0":t+="";break;case FD:t+="";break;default:t+=o}}return t}function BI(n){return n+FD+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VI(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function rc(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function LD(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t){this.comparator=e,this.root=t||cr.EMPTY}insert(e,t){return new dn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,cr.BLACK,null,null))}remove(e){return new dn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,cr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new lv(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new lv(this.root,e,this.comparator,!1)}getReverseIterator(){return new lv(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new lv(this.root,e,this.comparator,!0)}}class lv{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class cr{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??cr.RED,this.left=i??cr.EMPTY,this.right=o??cr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new cr(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return cr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return cr.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,cr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,cr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Qe();const e=this.left.check();if(e!==this.right.check())throw Qe();return e+(this.isRed()?0:1)}}cr.EMPTY=null,cr.RED=!0,cr.BLACK=!1;cr.EMPTY=new class{constructor(){this.size=0}get key(){throw Qe()}get value(){throw Qe()}get color(){throw Qe()}get left(){throw Qe()}get right(){throw Qe()}copy(e,t,r,i,o){return this}insert(e,t,r){return new cr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.comparator=e,this.data=new dn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new UI(this.data.getIterator())}getIteratorFrom(e){return new UI(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof qn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new qn(this.comparator);return t.data=e,t}}class UI{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(e){this.fields=e,e.sort(fr.comparator)}static empty(){return new bo([])}unionWith(e){let t=new qn(fr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new bo(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Hh(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new BD("Invalid base64 string: "+o):o}}(e);return new gr(t)}static fromUint8Array(e){const t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new gr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return wt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}gr.EMPTY_BYTE_STRING=new gr("");const o5=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Iu(n){if(Ft(!!n),typeof n=="string"){let e=0;const t=o5.exec(n);if(Ft(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Sn(n.seconds),nanos:Sn(n.nanos)}}function Sn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Su(n){return typeof n=="string"?gr.fromBase64String(n):gr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VD="server_timestamp",UD="__type__",WD="__previous_value__",jD="__local_write_time__";function Xb(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[UD])===null||t===void 0?void 0:t.stringValue)===VD}function Zy(n){const e=n.mapValue.fields[WD];return Xb(e)?Zy(e):e}function hp(n){const e=Iu(n.mapValue.fields[jD].timestampValue);return new Gn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a5{constructor(e,t,r,i,o,a,s,u,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=s,this.longPollingOptions=u,this.useFetchStreams=l}}const Bg="(default)";class dp{constructor(e,t){this.projectId=e,this.database=t||Bg}static empty(){return new dp("","")}get isDefaultDatabase(){return this.database===Bg}isEqual(e){return e instanceof dp&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zD="__type__",$D="__max__",cv={mapValue:{fields:{__type__:{stringValue:$D}}}},HD="__vector__",Vg="value";function Ru(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Xb(n)?4:u5(n)?9007199254740991:s5(n)?10:11:Qe()}function la(n,e){if(n===e)return!0;const t=Ru(n);if(t!==Ru(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return hp(n).isEqual(hp(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const a=Iu(i.timestampValue),s=Iu(o.timestampValue);return a.seconds===s.seconds&&a.nanos===s.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return Su(i.bytesValue).isEqual(Su(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return Sn(i.geoPointValue.latitude)===Sn(o.geoPointValue.latitude)&&Sn(i.geoPointValue.longitude)===Sn(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return Sn(i.integerValue)===Sn(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const a=Sn(i.doubleValue),s=Sn(o.doubleValue);return a===s?Lg(a)===Lg(s):isNaN(a)&&isNaN(s)}return!1}(n,e);case 9:return Hh(n.arrayValue.values||[],e.arrayValue.values||[],la);case 10:case 11:return function(i,o){const a=i.mapValue.fields||{},s=o.mapValue.fields||{};if(VI(a)!==VI(s))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(s[u]===void 0||!la(a[u],s[u])))return!1;return!0}(n,e);default:return Qe()}}function fp(n,e){return(n.values||[]).find(t=>la(t,e))!==void 0}function Gh(n,e){if(n===e)return 0;const t=Ru(n),r=Ru(e);if(t!==r)return wt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return wt(n.booleanValue,e.booleanValue);case 2:return function(o,a){const s=Sn(o.integerValue||o.doubleValue),u=Sn(a.integerValue||a.doubleValue);return s<u?-1:s>u?1:s===u?0:isNaN(s)?isNaN(u)?0:-1:1}(n,e);case 3:return WI(n.timestampValue,e.timestampValue);case 4:return WI(hp(n),hp(e));case 5:return wt(n.stringValue,e.stringValue);case 6:return function(o,a){const s=Su(o),u=Su(a);return s.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){const s=o.split("/"),u=a.split("/");for(let l=0;l<s.length&&l<u.length;l++){const c=wt(s[l],u[l]);if(c!==0)return c}return wt(s.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){const s=wt(Sn(o.latitude),Sn(a.latitude));return s!==0?s:wt(Sn(o.longitude),Sn(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return jI(n.arrayValue,e.arrayValue);case 10:return function(o,a){var s,u,l,c;const h=o.fields||{},d=a.fields||{},f=(s=h[Vg])===null||s===void 0?void 0:s.arrayValue,p=(u=d[Vg])===null||u===void 0?void 0:u.arrayValue,m=wt(((l=f==null?void 0:f.values)===null||l===void 0?void 0:l.length)||0,((c=p==null?void 0:p.values)===null||c===void 0?void 0:c.length)||0);return m!==0?m:jI(f,p)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===cv.mapValue&&a===cv.mapValue)return 0;if(o===cv.mapValue)return 1;if(a===cv.mapValue)return-1;const s=o.fields||{},u=Object.keys(s),l=a.fields||{},c=Object.keys(l);u.sort(),c.sort();for(let h=0;h<u.length&&h<c.length;++h){const d=wt(u[h],c[h]);if(d!==0)return d;const f=Gh(s[u[h]],l[c[h]]);if(f!==0)return f}return wt(u.length,c.length)}(n.mapValue,e.mapValue);default:throw Qe()}}function WI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return wt(n,e);const t=Iu(n),r=Iu(e),i=wt(t.seconds,r.seconds);return i!==0?i:wt(t.nanos,r.nanos)}function jI(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const o=Gh(t[i],r[i]);if(o)return o}return wt(t.length,r.length)}function qh(n){return kw(n)}function kw(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Iu(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Su(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return He.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const o of t.values||[])i?i=!1:r+=",",r+=kw(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",o=!0;for(const a of r)o?o=!1:i+=",",i+=`${a}:${kw(t.fields[a])}`;return i+"}"}(n.mapValue):Qe()}function Qv(n){switch(Ru(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Zy(n);return e?16+Qv(e):16;case 5:return 2*n.stringValue.length;case 6:return Su(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+Qv(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return rc(r.fields,(o,a)=>{i+=o.length+Qv(a)}),i}(n.mapValue);default:throw Qe()}}function Aw(n){return!!n&&"integerValue"in n}function Qb(n){return!!n&&"arrayValue"in n}function zI(n){return!!n&&"nullValue"in n}function $I(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Yv(n){return!!n&&"mapValue"in n}function s5(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[zD])===null||t===void 0?void 0:t.stringValue)===HD}function Mf(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return rc(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Mf(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Mf(n.arrayValue.values[t]);return e}return Object.assign({},n)}function u5(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===$D}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji{constructor(e){this.value=e}static empty(){return new ji({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Yv(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Mf(t)}setAll(e){let t=fr.emptyPath(),r={},i=[];e.forEach((a,s)=>{if(!t.isImmediateParentOf(s)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=s.popLast()}a?r[s.lastSegment()]=Mf(a):i.push(s.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){const t=this.field(e.popLast());Yv(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return la(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Yv(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){rc(t,(i,o)=>e[i]=o);for(const i of r)delete e[i]}clone(){return new ji(Mf(this.value))}}function GD(n){const e=[];return rc(n.fields,(t,r)=>{const i=new fr([t]);if(Yv(r)){const o=GD(r.mapValue).fields;if(o.length===0)e.push(i);else for(const a of o)e.push(i.child(a))}else e.push(i)}),new bo(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e,t,r,i,o,a,s){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=s}static newInvalidDocument(e){return new kr(e,0,tt.min(),tt.min(),tt.min(),ji.empty(),0)}static newFoundDocument(e,t,r,i){return new kr(e,1,t,tt.min(),r,i,0)}static newNoDocument(e,t){return new kr(e,2,t,tt.min(),tt.min(),ji.empty(),0)}static newUnknownDocument(e,t){return new kr(e,3,t,tt.min(),tt.min(),ji.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(tt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ji.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ji.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof kr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new kr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,t){this.position=e,this.inclusive=t}}function HI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const o=e[i],a=n.position[i];if(o.field.isKeyField()?r=He.comparator(He.fromName(a.referenceValue),t.key):r=Gh(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function GI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!la(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(e,t="asc"){this.field=e,this.dir=t}}function l5(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{}class zn extends qD{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new h5(e,t,r):t==="array-contains"?new p5(e,r):t==="in"?new m5(e,r):t==="not-in"?new v5(e,r):t==="array-contains-any"?new g5(e,r):new zn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new d5(e,r):new f5(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Gh(t,this.value)):t!==null&&Ru(this.value)===Ru(t)&&this.matchesComparison(Gh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ca extends qD{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new ca(e,t)}matches(e){return KD(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function KD(n){return n.op==="and"}function XD(n){return c5(n)&&KD(n)}function c5(n){for(const e of n.filters)if(e instanceof ca)return!1;return!0}function Nw(n){if(n instanceof zn)return n.field.canonicalString()+n.op.toString()+qh(n.value);if(XD(n))return n.filters.map(e=>Nw(e)).join(",");{const e=n.filters.map(t=>Nw(t)).join(",");return`${n.op}(${e})`}}function QD(n,e){return n instanceof zn?function(r,i){return i instanceof zn&&r.op===i.op&&r.field.isEqual(i.field)&&la(r.value,i.value)}(n,e):n instanceof ca?function(r,i){return i instanceof ca&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,s)=>o&&QD(a,i.filters[s]),!0):!1}(n,e):void Qe()}function YD(n){return n instanceof zn?function(t){return`${t.field.canonicalString()} ${t.op} ${qh(t.value)}`}(n):n instanceof ca?function(t){return t.op.toString()+" {"+t.getFilters().map(YD).join(" ,")+"}"}(n):"Filter"}class h5 extends zn{constructor(e,t,r){super(e,t,r),this.key=He.fromName(r.referenceValue)}matches(e){const t=He.comparator(e.key,this.key);return this.matchesComparison(t)}}class d5 extends zn{constructor(e,t){super(e,"in",t),this.keys=JD("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class f5 extends zn{constructor(e,t){super(e,"not-in",t),this.keys=JD("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function JD(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>He.fromName(r.referenceValue))}class p5 extends zn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qb(t)&&fp(t.arrayValue,this.value)}}class m5 extends zn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&fp(this.value.arrayValue,t)}}class v5 extends zn{constructor(e,t){super(e,"not-in",t)}matches(e){if(fp(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!fp(this.value.arrayValue,t)}}class g5 extends zn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qb(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>fp(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(e,t=null,r=[],i=[],o=null,a=null,s=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=s,this.le=null}}function qI(n,e=null,t=[],r=[],i=null,o=null,a=null){return new y5(n,e,t,r,i,o,a)}function Yb(n){const e=it(n);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Nw(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),Jy(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>qh(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>qh(r)).join(",")),e.le=t}return e.le}function Jb(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!l5(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!QD(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!GI(n.startAt,e.startAt)&&GI(n.endAt,e.endAt)}function Dw(n){return He.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,t=null,r=[],i=[],o=null,a="F",s=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=s,this.endAt=u,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function x5(n,e,t,r,i,o,a,s){return new e0(n,e,t,r,i,o,a,s)}function Zb(n){return new e0(n)}function KI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function w5(n){return n.collectionGroup!==null}function Ff(n){const e=it(n);if(e.he===null){e.he=[];const t=new Set;for(const o of e.explicitOrderBy)e.he.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let s=new qn(fr.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(s=s.add(l.field))})}),s})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.he.push(new Wg(o,r))}),t.has(fr.keyField().canonicalString())||e.he.push(new Wg(fr.keyField(),r))}return e.he}function aa(n){const e=it(n);return e.Pe||(e.Pe=_5(e,Ff(n))),e.Pe}function _5(n,e){if(n.limitType==="F")return qI(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const o=i.dir==="desc"?"asc":"desc";return new Wg(i.field,o)});const t=n.endAt?new Ug(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ug(n.startAt.position,n.startAt.inclusive):null;return qI(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Pw(n,e,t){return new e0(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function t0(n,e){return Jb(aa(n),aa(e))&&n.limitType===e.limitType}function ZD(n){return`${Yb(aa(n))}|lt:${n.limitType}`}function Hc(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>YD(i)).join(", ")}]`),Jy(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>qh(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>qh(i)).join(",")),`Target(${r})`}(aa(n))}; limitType=${n.limitType})`}function n0(n,e){return e.isFoundDocument()&&function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):He.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(const o of Ff(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,s,u){const l=HI(a,s,u);return a.inclusive?l<=0:l<0}(r.startAt,Ff(r),i)||r.endAt&&!function(a,s,u){const l=HI(a,s,u);return a.inclusive?l>=0:l>0}(r.endAt,Ff(r),i))}(n,e)}function b5(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function eP(n){return(e,t)=>{let r=!1;for(const i of Ff(n)){const o=E5(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function E5(n,e,t){const r=n.field.isKeyField()?He.comparator(e.key,t.key):function(o,a,s){const u=a.data.field(o),l=s.data.field(o);return u!==null&&l!==null?Gh(u,l):Qe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Qe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){rc(this.inner,(t,r)=>{for(const[i,o]of r)e(i,o)})}isEmpty(){return LD(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C5=new dn(He.comparator);function ss(){return C5}const tP=new dn(He.comparator);function _f(...n){let e=tP;for(const t of n)e=e.insert(t.key,t);return e}function nP(n){let e=tP;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Sl(){return Lf()}function rP(){return Lf()}function Lf(){return new ic(n=>n.toString(),(n,e)=>n.isEqual(e))}const T5=new dn(He.comparator),I5=new qn(He.comparator);function yt(...n){let e=I5;for(const t of n)e=e.add(t);return e}const S5=new qn(wt);function R5(){return S5}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lg(e)?"-0":e}}function iP(n){return{integerValue:""+n}}function k5(n,e){return n5(e)?iP(e):eE(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(){this._=void 0}}function A5(n,e,t){return n instanceof jg?function(i,o){const a={fields:{[UD]:{stringValue:VD},[jD]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&Xb(o)&&(o=Zy(o)),o&&(a.fields[WD]=o),{mapValue:a}}(t,e):n instanceof pp?aP(n,e):n instanceof mp?sP(n,e):function(i,o){const a=oP(i,o),s=XI(a)+XI(i.Ie);return Aw(a)&&Aw(i.Ie)?iP(s):eE(i.serializer,s)}(n,e)}function N5(n,e,t){return n instanceof pp?aP(n,e):n instanceof mp?sP(n,e):t}function oP(n,e){return n instanceof zg?function(r){return Aw(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class jg extends r0{}class pp extends r0{constructor(e){super(),this.elements=e}}function aP(n,e){const t=uP(e);for(const r of n.elements)t.some(i=>la(i,r))||t.push(r);return{arrayValue:{values:t}}}class mp extends r0{constructor(e){super(),this.elements=e}}function sP(n,e){let t=uP(e);for(const r of n.elements)t=t.filter(i=>!la(i,r));return{arrayValue:{values:t}}}class zg extends r0{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function XI(n){return Sn(n.integerValue||n.doubleValue)}function uP(n){return Qb(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function D5(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof pp&&i instanceof pp||r instanceof mp&&i instanceof mp?Hh(r.elements,i.elements,la):r instanceof zg&&i instanceof zg?la(r.Ie,i.Ie):r instanceof jg&&i instanceof jg}(n.transform,e.transform)}class P5{constructor(e,t){this.version=e,this.transformResults=t}}class Ja{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ja}static exists(e){return new Ja(void 0,e)}static updateTime(e){return new Ja(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Jv(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class i0{}function lP(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new hP(n.key,Ja.none()):new Bp(n.key,n.data,Ja.none());{const t=n.data,r=ji.empty();let i=new qn(fr.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new oc(n.key,r,new bo(i.toArray()),Ja.none())}}function O5(n,e,t){n instanceof Bp?function(i,o,a){const s=i.value.clone(),u=YI(i.fieldTransforms,o,a.transformResults);s.setAll(u),o.convertToFoundDocument(a.version,s).setHasCommittedMutations()}(n,e,t):n instanceof oc?function(i,o,a){if(!Jv(i.precondition,o))return void o.convertToUnknownDocument(a.version);const s=YI(i.fieldTransforms,o,a.transformResults),u=o.data;u.setAll(cP(i)),u.setAll(s),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Bf(n,e,t,r){return n instanceof Bp?function(o,a,s,u){if(!Jv(o.precondition,a))return s;const l=o.value.clone(),c=JI(o.fieldTransforms,u,a);return l.setAll(c),a.convertToFoundDocument(a.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof oc?function(o,a,s,u){if(!Jv(o.precondition,a))return s;const l=JI(o.fieldTransforms,u,a),c=a.data;return c.setAll(cP(o)),c.setAll(l),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),s===null?null:s.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(o,a,s){return Jv(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):s}(n,e,t)}function M5(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),o=oP(r.transform,i||null);o!=null&&(t===null&&(t=ji.empty()),t.set(r.field,o))}return t||null}function QI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Hh(r,i,(o,a)=>D5(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Bp extends i0{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class oc extends i0{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function cP(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function YI(n,e,t){const r=new Map;Ft(n.length===t.length);for(let i=0;i<t.length;i++){const o=n[i],a=o.transform,s=e.data.field(o.field);r.set(o.field,N5(a,s,t[i]))}return r}function JI(n,e,t){const r=new Map;for(const i of n){const o=i.transform,a=t.data.field(i.field);r.set(i.field,A5(o,a,e))}return r}class hP extends i0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class F5 extends i0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&O5(o,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Bf(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Bf(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=rP();return this.mutations.forEach(i=>{const o=e.get(i.key),a=o.overlayedDocument;let s=this.applyToLocalView(a,o.mutatedFields);s=t.has(i.key)?null:s;const u=lP(a,s);u!==null&&r.set(i.key,u),a.isValidDocument()||a.convertToNoDocument(tt.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),yt())}isEqual(e){return this.batchId===e.batchId&&Hh(this.mutations,e.mutations,(t,r)=>QI(t,r))&&Hh(this.baseMutations,e.baseMutations,(t,r)=>QI(t,r))}}class tE{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Ft(e.mutations.length===r.length);let i=function(){return T5}();const o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new tE(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V5{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pn,bt;function U5(n){switch(n){case ge.OK:return Qe();case ge.CANCELLED:case ge.UNKNOWN:case ge.DEADLINE_EXCEEDED:case ge.RESOURCE_EXHAUSTED:case ge.INTERNAL:case ge.UNAVAILABLE:case ge.UNAUTHENTICATED:return!1;case ge.INVALID_ARGUMENT:case ge.NOT_FOUND:case ge.ALREADY_EXISTS:case ge.PERMISSION_DENIED:case ge.FAILED_PRECONDITION:case ge.ABORTED:case ge.OUT_OF_RANGE:case ge.UNIMPLEMENTED:case ge.DATA_LOSS:return!0;default:return Qe()}}function dP(n){if(n===void 0)return as("GRPC error has no .code"),ge.UNKNOWN;switch(n){case Pn.OK:return ge.OK;case Pn.CANCELLED:return ge.CANCELLED;case Pn.UNKNOWN:return ge.UNKNOWN;case Pn.DEADLINE_EXCEEDED:return ge.DEADLINE_EXCEEDED;case Pn.RESOURCE_EXHAUSTED:return ge.RESOURCE_EXHAUSTED;case Pn.INTERNAL:return ge.INTERNAL;case Pn.UNAVAILABLE:return ge.UNAVAILABLE;case Pn.UNAUTHENTICATED:return ge.UNAUTHENTICATED;case Pn.INVALID_ARGUMENT:return ge.INVALID_ARGUMENT;case Pn.NOT_FOUND:return ge.NOT_FOUND;case Pn.ALREADY_EXISTS:return ge.ALREADY_EXISTS;case Pn.PERMISSION_DENIED:return ge.PERMISSION_DENIED;case Pn.FAILED_PRECONDITION:return ge.FAILED_PRECONDITION;case Pn.ABORTED:return ge.ABORTED;case Pn.OUT_OF_RANGE:return ge.OUT_OF_RANGE;case Pn.UNIMPLEMENTED:return ge.UNIMPLEMENTED;case Pn.DATA_LOSS:return ge.DATA_LOSS;default:return Qe()}}(bt=Pn||(Pn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W5(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j5=new xu([4294967295,4294967295],0);function ZI(n){const e=W5().encode(n),t=new RD;return t.update(e),new Uint8Array(t.digest())}function eS(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new xu([t,r],0),new xu([i,o],0)]}class nE{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new bf(`Invalid padding: ${t}`);if(r<0)throw new bf(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new bf(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new bf(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=xu.fromNumber(this.Ee)}Ae(e,t,r){let i=e.add(t.multiply(xu.fromNumber(r)));return i.compare(j5)===1&&(i=new xu([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const t=ZI(e),[r,i]=eS(t);for(let o=0;o<this.hashCount;o++){const a=this.Ae(r,i,o);if(!this.Re(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new nE(o,i,t);return r.forEach(s=>a.insert(s)),a}insert(e){if(this.Ee===0)return;const t=ZI(e),[r,i]=eS(t);for(let o=0;o<this.hashCount;o++){const a=this.Ae(r,i,o);this.Ve(a)}}Ve(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class bf extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Vp.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new o0(tt.min(),i,new dn(wt),ss(),yt())}}class Vp{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Vp(r,t,yt(),yt(),yt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(e,t,r,i){this.me=e,this.removedTargetIds=t,this.key=r,this.fe=i}}class fP{constructor(e,t){this.targetId=e,this.ge=t}}class pP{constructor(e,t,r=gr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class tS{constructor(){this.pe=0,this.ye=nS(),this.we=gr.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=yt(),t=yt(),r=yt();return this.ye.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Qe()}}),new Vp(this.we,this.be,e,t,r)}Me(){this.Se=!1,this.ye=nS()}xe(e,t){this.Se=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,Ft(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class z5{constructor(e){this.ke=e,this.qe=new Map,this.Qe=ss(),this.$e=hv(),this.Ke=hv(),this.Ue=new dn(wt)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{const r=this.He(t);switch(e.state){case 0:this.Je(t)&&r.Ce(e.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(e.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(t);break;case 3:this.Je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),r.Ce(e.resumeToken));break;default:Qe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((r,i)=>{this.Je(i)&&t(i)})}Ze(e){const t=e.targetId,r=e.ge.count,i=this.Xe(t);if(i){const o=i.target;if(Dw(o))if(r===0){const a=new He(o.path);this.ze(t,a,kr.newNoDocument(a,tt.min()))}else Ft(r===1);else{const a=this.et(t);if(a!==r){const s=this.tt(e),u=s?this.nt(s,e,a):1;if(u!==0){this.Ye(t);const l=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(t,l)}}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t;let a,s;try{a=Su(r).toUint8Array()}catch(u){if(u instanceof BD)return $h("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{s=new nE(a,i,o)}catch(u){return $h(u instanceof bf?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return s.Ee===0?null:s}nt(e,t,r){return t.ge.count===r-this.st(e,t.targetId)?0:2}st(e,t){const r=this.ke.getRemoteKeysForTarget(t);let i=0;return r.forEach(o=>{const a=this.ke.it(),s=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(s)||(this.ze(t,o,null),i++)}),i}ot(e){const t=new Map;this.qe.forEach((o,a)=>{const s=this.Xe(a);if(s){if(o.current&&Dw(s.target)){const u=new He(s.target.path);this._t(u).has(a)||this.ut(a,u)||this.ze(a,u,kr.newNoDocument(u,e))}o.ve&&(t.set(a,o.Fe()),o.Me())}});let r=yt();this.Ke.forEach((o,a)=>{let s=!0;a.forEachWhile(u=>{const l=this.Xe(u);return!l||l.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)}),s&&(r=r.add(o))}),this.Qe.forEach((o,a)=>a.setReadTime(e));const i=new o0(e,t,this.Ue,this.Qe,r);return this.Qe=ss(),this.$e=hv(),this.Ke=hv(),this.Ue=new dn(wt),i}Ge(e,t){if(!this.Je(e))return;const r=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,r),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e))}ze(e,t,r){if(!this.Je(e))return;const i=this.He(e);this.ut(e,t)?i.xe(t,1):i.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),r&&(this.Qe=this.Qe.insert(t,r))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new tS,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new qn(wt),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new qn(wt),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||Re("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new tS),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function hv(){return new dn(He.comparator)}function nS(){return new dn(He.comparator)}const $5={asc:"ASCENDING",desc:"DESCENDING"},H5={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},G5={and:"AND",or:"OR"};class q5{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ow(n,e){return n.useProto3Json||Jy(e)?e:{value:e}}function $g(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mP(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function K5(n,e){return $g(n,e.toTimestamp())}function sa(n){return Ft(!!n),tt.fromTimestamp(function(t){const r=Iu(t);return new Gn(r.seconds,r.nanos)}(n))}function rE(n,e){return Mw(n,e).canonicalString()}function Mw(n,e){const t=function(i){return new bn(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function vP(n){const e=bn.fromString(n);return Ft(_P(e)),e}function Fw(n,e){return rE(n.databaseId,e.path)}function D1(n,e){const t=vP(e);if(t.get(1)!==n.databaseId.projectId)throw new $e(ge.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new $e(ge.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new He(yP(t))}function gP(n,e){return rE(n.databaseId,e)}function X5(n){const e=vP(n);return e.length===4?bn.emptyPath():yP(e)}function Lw(n){return new bn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function yP(n){return Ft(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function rS(n,e,t){return{name:Fw(n,e),fields:t.value.mapValue.fields}}function Q5(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:Qe()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(l,c){return l.useProto3Json?(Ft(c===void 0||typeof c=="string"),gr.fromBase64String(c||"")):(Ft(c===void 0||c instanceof Buffer||c instanceof Uint8Array),gr.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,s=a&&function(l){const c=l.code===void 0?ge.UNKNOWN:dP(l.code);return new $e(c,l.message||"")}(a);t=new pP(r,i,o,s||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=D1(n,r.document.name),o=sa(r.document.updateTime),a=r.document.createTime?sa(r.document.createTime):tt.min(),s=new ji({mapValue:{fields:r.document.fields}}),u=kr.newFoundDocument(i,o,a,s),l=r.targetIds||[],c=r.removedTargetIds||[];t=new Zv(l,c,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=D1(n,r.document),o=r.readTime?sa(r.readTime):tt.min(),a=kr.newNoDocument(i,o),s=r.removedTargetIds||[];t=new Zv([],s,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=D1(n,r.document),o=r.removedTargetIds||[];t=new Zv([],o,i,null)}else{if(!("filter"in e))return Qe();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,a=new V5(i,o),s=r.targetId;t=new fP(s,a)}}return t}function Y5(n,e){let t;if(e instanceof Bp)t={update:rS(n,e.key,e.value)};else if(e instanceof hP)t={delete:Fw(n,e.key)};else if(e instanceof oc)t={update:rS(n,e.key,e.data),updateMask:aH(e.fieldMask)};else{if(!(e instanceof F5))return Qe();t={verify:Fw(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){const s=a.transform;if(s instanceof jg)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof pp)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof mp)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof zg)return{fieldPath:a.field.canonicalString(),increment:s.Ie};throw Qe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:K5(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Qe()}(n,e.precondition)),t}function J5(n,e){return n&&n.length>0?(Ft(e!==void 0),n.map(t=>function(i,o){let a=i.updateTime?sa(i.updateTime):sa(o);return a.isEqual(tt.min())&&(a=sa(o)),new P5(a,i.transformResults||[])}(t,e))):[]}function Z5(n,e){return{documents:[gP(n,e.path)]}}function eH(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=gP(n,i);const o=function(l){if(l.length!==0)return wP(ca.create(l,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const a=function(l){if(l.length!==0)return l.map(c=>function(d){return{field:Gc(d.field),direction:rH(d.dir)}}(c))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const s=Ow(n,e.limit);return s!==null&&(t.structuredQuery.limit=s),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{ht:t,parent:i}}function tH(n){let e=X5(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Ft(r===1);const c=t.from[0];c.allDescendants?i=c.collectionId:e=e.child(c.collectionId)}let o=[];t.where&&(o=function(h){const d=xP(h);return d instanceof ca&&XD(d)?d.getFilters():[d]}(t.where));let a=[];t.orderBy&&(a=function(h){return h.map(d=>function(p){return new Wg(qc(p.field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(d))}(t.orderBy));let s=null;t.limit&&(s=function(h){let d;return d=typeof h=="object"?h.value:h,Jy(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){const d=!!h.before,f=h.values||[];return new Ug(f,d)}(t.startAt));let l=null;return t.endAt&&(l=function(h){const d=!h.before,f=h.values||[];return new Ug(f,d)}(t.endAt)),x5(e,i,a,o,s,"F",u,l)}function nH(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function xP(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=qc(t.unaryFilter.field);return zn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=qc(t.unaryFilter.field);return zn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=qc(t.unaryFilter.field);return zn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=qc(t.unaryFilter.field);return zn.create(a,"!=",{nullValue:"NULL_VALUE"});default:return Qe()}}(n):n.fieldFilter!==void 0?function(t){return zn.create(qc(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Qe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ca.create(t.compositeFilter.filters.map(r=>xP(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Qe()}}(t.compositeFilter.op))}(n):Qe()}function rH(n){return $5[n]}function iH(n){return H5[n]}function oH(n){return G5[n]}function Gc(n){return{fieldPath:n.canonicalString()}}function qc(n){return fr.fromServerFormat(n.fieldPath)}function wP(n){return n instanceof zn?function(t){if(t.op==="=="){if($I(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NAN"}};if(zI(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if($I(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NOT_NAN"}};if(zI(t.value))return{unaryFilter:{field:Gc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gc(t.field),op:iH(t.op),value:t.value}}}(n):n instanceof ca?function(t){const r=t.getFilters().map(i=>wP(i));return r.length===1?r[0]:{compositeFilter:{op:oH(t.op),filters:r}}}(n):Qe()}function aH(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _P(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(e,t,r,i,o=tt.min(),a=tt.min(),s=gr.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=s,this.expectedCount=u}withSequenceNumber(e){return new nu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sH{constructor(e){this.Tt=e}}function uH(n){const e=tH({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Pw(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lH{constructor(){this.Tn=new cH}addToCollectionParentIndex(e,t){return this.Tn.add(t),de.resolve()}getCollectionParents(e,t){return de.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return de.resolve()}deleteFieldIndex(e,t){return de.resolve()}deleteAllFieldIndexes(e){return de.resolve()}createTargetIndexes(e,t){return de.resolve()}getDocumentsMatchingTarget(e,t){return de.resolve(null)}getIndexType(e,t){return de.resolve(0)}getFieldIndexes(e,t){return de.resolve([])}getNextCollectionGroupToUpdate(e){return de.resolve(null)}getMinOffset(e,t){return de.resolve(Tu.min())}getMinOffsetFromCollectionGroup(e,t){return de.resolve(Tu.min())}updateCollectionGroup(e,t,r){return de.resolve()}updateIndexEntries(e,t){return de.resolve()}}class cH{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new qn(bn.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new qn(bn.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bP=41943040;class Jr{static withCacheSize(e){return new Jr(e,Jr.DEFAULT_COLLECTION_PERCENTILE,Jr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jr.DEFAULT_COLLECTION_PERCENTILE=10,Jr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Jr.DEFAULT=new Jr(bP,Jr.DEFAULT_COLLECTION_PERCENTILE,Jr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Jr.DISABLED=new Jr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new Kh(0)}static Un(){return new Kh(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oS="LruGarbageCollector",hH=1048576;function aS([n,e],[t,r]){const i=wt(n,t);return i===0?wt(e,r):i}class dH{constructor(e){this.Hn=e,this.buffer=new qn(aS),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();aS(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class fH{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){Re(oS,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){yd(t)?Re(oS,"Ignoring IndexedDB error during garbage collection: ",t):await gd(t)}await this.er(3e5)})}}class pH{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return de.resolve(Yy.ae);const r=new dH(t);return this.tr.forEachTarget(e,i=>r.Zn(i.sequenceNumber)).next(()=>this.tr.rr(e,i=>r.Zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.tr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Re("LruGarbageCollector","Garbage collection skipped; disabled"),de.resolve(iS)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Re("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iS):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let r,i,o,a,s,u,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(Re("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,a=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,s=Date.now(),this.removeTargets(e,r,t))).next(h=>(o=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(l=Date.now(),$c()<=gt.DEBUG&&Re("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-c}ms
	Determined least recently used ${i} in `+(s-a)+`ms
	Removed ${o} targets in `+(u-s)+`ms
	Removed ${h} documents in `+(l-u)+`ms
Total Duration: ${l-c}ms`),de.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:h})))}}function mH(n,e){return new pH(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vH{constructor(){this.changes=new ic(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,kr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?de.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gH{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yH{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Bf(r.mutation,i,bo.empty(),Gn.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,yt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=yt()){const i=Sl();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=_f();return o.forEach((s,u)=>{a=a.insert(s,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Sl();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,yt()))}populateOverlays(e,t,r){const i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,s)=>{t.set(a,s)})})}computeViews(e,t,r,i){let o=ss();const a=Lf(),s=function(){return Lf()}();return t.forEach((u,l)=>{const c=r.get(l.key);i.has(l.key)&&(c===void 0||c.mutation instanceof oc)?o=o.insert(l.key,l):c!==void 0?(a.set(l.key,c.mutation.getFieldMask()),Bf(c.mutation,l,c.mutation.getFieldMask(),Gn.now())):a.set(l.key,bo.empty())}),this.recalculateAndSaveOverlays(e,o).next(u=>(u.forEach((l,c)=>a.set(l,c)),t.forEach((l,c)=>{var h;return s.set(l,new gH(c,(h=a.get(l))!==null&&h!==void 0?h:null))}),s))}recalculateAndSaveOverlays(e,t){const r=Lf();let i=new dn((a,s)=>a-s),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const s of a)s.keys().forEach(u=>{const l=t.get(u);if(l===null)return;let c=r.get(u)||bo.empty();c=s.applyToLocalView(l,c),r.set(u,c);const h=(i.get(s.batchId)||yt()).add(u);i=i.insert(s.batchId,h)})}).next(()=>{const a=[],s=i.getReverseIterator();for(;s.hasNext();){const u=s.getNext(),l=u.key,c=u.value,h=rP();c.forEach(d=>{if(!o.has(d)){const f=lP(t.get(d),r.get(d));f!==null&&h.set(d,f),o=o.add(d)}}),a.push(this.documentOverlayCache.saveOverlays(e,l,h))}return de.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return He.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):w5(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{const a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):de.resolve(Sl());let s=cp,u=o;return a.next(l=>de.forEach(l,(c,h)=>(s<h.largestBatchId&&(s=h.largestBatchId),o.get(c)?de.resolve():this.remoteDocumentCache.getEntry(e,c).next(d=>{u=u.insert(c,d)}))).next(()=>this.populateOverlays(e,l,o)).next(()=>this.computeViews(e,u,l,yt())).next(c=>({batchId:s,changes:nP(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new He(t)).next(r=>{let i=_f();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const o=t.collectionGroup;let a=_f();return this.indexManager.getCollectionParents(e,o).next(s=>de.forEach(s,u=>{const l=function(h,d){return new e0(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(o));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(c=>{c.forEach((h,d)=>{a=a.insert(h,d)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((u,l)=>{const c=l.getKey();a.get(c)===null&&(a=a.insert(c,kr.newInvalidDocument(c)))});let s=_f();return a.forEach((u,l)=>{const c=o.get(u);c!==void 0&&Bf(c.mutation,l,bo.empty(),Gn.now()),n0(t,l)&&(s=s.insert(u,l))}),s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xH{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return de.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:sa(i.createTime)}}(t)),de.resolve()}getNamedQuery(e,t){return de.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(i){return{name:i.name,query:uH(i.bundledQuery),readTime:sa(i.readTime)}}(t)),de.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wH{constructor(){this.overlays=new dn(He.comparator),this.Rr=new Map}getOverlay(e,t){return de.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Sl();return de.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.Et(e,t,o)}),de.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Rr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Rr.delete(r)),de.resolve()}getOverlaysForCollection(e,t,r){const i=Sl(),o=t.length+1,a=new He(t.child("")),s=this.overlays.getIteratorFrom(a);for(;s.hasNext();){const u=s.getNext().value,l=u.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===o&&u.largestBatchId>r&&i.set(u.getKey(),u)}return de.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new dn((l,c)=>l-c);const a=this.overlays.getIterator();for(;a.hasNext();){const l=a.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let c=o.get(l.largestBatchId);c===null&&(c=Sl(),o=o.insert(l.largestBatchId,c)),c.set(l.getKey(),l)}}const s=Sl(),u=o.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,c)=>s.set(l,c)),!(s.size()>=i)););return de.resolve(s)}Et(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.Rr.get(i.largestBatchId).delete(r.key);this.Rr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new B5(t,r));let o=this.Rr.get(t);o===void 0&&(o=yt(),this.Rr.set(t,o)),this.Rr.set(t,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _H{constructor(){this.sessionToken=gr.EMPTY_BYTE_STRING}getSessionToken(e){return de.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,de.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iE{constructor(){this.Vr=new qn(er.mr),this.gr=new qn(er.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const r=new er(e,t);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.wr(new er(e,t))}br(e,t){e.forEach(r=>this.removeReference(r,t))}Sr(e){const t=new He(new bn([])),r=new er(t,e),i=new er(t,e+1),o=[];return this.gr.forEachInRange([r,i],a=>{this.wr(a),o.push(a.key)}),o}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new He(new bn([])),r=new er(t,e),i=new er(t,e+1);let o=yt();return this.gr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){const t=new er(e,0),r=this.Vr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class er{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return He.comparator(e.key,t.key)||wt(e.Cr,t.Cr)}static pr(e,t){return wt(e.Cr,t.Cr)||He.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bH{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new qn(er.mr)}checkEmpty(e){return de.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const o=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new L5(o,t,r,i);this.mutationQueue.push(a);for(const s of i)this.Mr=this.Mr.add(new er(s.key,o)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return de.resolve(a)}lookupMutationBatch(e,t){return de.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Nr(r),o=i<0?0:i;return de.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return de.resolve(this.mutationQueue.length===0?Kb:this.Fr-1)}getAllMutationBatches(e){return de.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new er(t,0),i=new er(t,Number.POSITIVE_INFINITY),o=[];return this.Mr.forEachInRange([r,i],a=>{const s=this.Or(a.Cr);o.push(s)}),de.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new qn(wt);return t.forEach(i=>{const o=new er(i,0),a=new er(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([o,a],s=>{r=r.add(s.Cr)})}),de.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let o=r;He.isDocumentKey(o)||(o=o.child(""));const a=new er(new He(o),0);let s=new qn(wt);return this.Mr.forEachWhile(u=>{const l=u.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(s=s.add(u.Cr)),!0)},a),de.resolve(this.Br(s))}Br(e){const t=[];return e.forEach(r=>{const i=this.Or(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Ft(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return de.forEach(t.mutations,i=>{const o=new er(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Mr=r})}qn(e){}containsKey(e,t){const r=new er(t,0),i=this.Mr.firstAfterOrEqual(r);return de.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,de.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EH{constructor(e){this.kr=e,this.docs=function(){return new dn(He.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.kr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return de.resolve(r?r.document.mutableCopy():kr.newInvalidDocument(t))}getEntries(e,t){let r=ss();return t.forEach(i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():kr.newInvalidDocument(i))}),de.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=ss();const a=t.path,s=new He(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:l,value:{document:c}}=u.getNext();if(!a.isPrefixOf(l.path))break;l.path.length>a.length+1||J6(Y6(c),r)<=0||(i.has(c.key)||n0(t,c))&&(o=o.insert(c.key,c.mutableCopy()))}return de.resolve(o)}getAllFromCollectionGroup(e,t,r,i){Qe()}qr(e,t){return de.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new CH(this)}getSize(e){return de.resolve(this.size)}}class CH extends vH{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Ir.addEntry(e,i)):this.Ir.removeEntry(r)}),de.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TH{constructor(e){this.persistence=e,this.Qr=new ic(t=>Yb(t),Jb),this.lastRemoteSnapshotVersion=tt.min(),this.highestTargetId=0,this.$r=0,this.Kr=new iE,this.targetCount=0,this.Ur=Kh.Kn()}forEachTarget(e,t){return this.Qr.forEach((r,i)=>t(i)),de.resolve()}getLastRemoteSnapshotVersion(e){return de.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return de.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),de.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.$r&&(this.$r=t),de.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ur=new Kh(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,de.resolve()}updateTargetData(e,t){return this.zn(t),de.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.Sr(t.targetId),this.targetCount-=1,de.resolve()}removeTargets(e,t,r){let i=0;const o=[];return this.Qr.forEach((a,s)=>{s.sequenceNumber<=t&&r.get(s.targetId)===null&&(this.Qr.delete(a),o.push(this.removeMatchingKeysForTargetId(e,s.targetId)),i++)}),de.waitFor(o).next(()=>i)}getTargetCount(e){return de.resolve(this.targetCount)}getTargetData(e,t){const r=this.Qr.get(t)||null;return de.resolve(r)}addMatchingKeys(e,t,r){return this.Kr.yr(t,r),de.resolve()}removeMatchingKeys(e,t,r){this.Kr.br(t,r);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),de.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Kr.Sr(t),de.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Kr.vr(t);return de.resolve(r)}containsKey(e,t){return de.resolve(this.Kr.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new Yy(0),this.zr=!1,this.zr=!0,this.jr=new _H,this.referenceDelegate=e(this),this.Hr=new TH(this),this.indexManager=new lH,this.remoteDocumentCache=function(i){return new EH(i)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new sH(t),this.Yr=new xH(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new wH,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Wr[e.toKey()];return r||(r=new bH(t,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,r){Re("MemoryPersistence","Starting transaction:",e);const i=new IH(this.Gr.next());return this.referenceDelegate.Zr(),r(i).next(o=>this.referenceDelegate.Xr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}ei(e,t){return de.or(Object.values(this.Wr).map(r=>()=>r.containsKey(e,t)))}}class IH extends e5{constructor(e){super(),this.currentSequenceNumber=e}}class oE{constructor(e){this.persistence=e,this.ti=new iE,this.ni=null}static ri(e){return new oE(e)}get ii(){if(this.ni)return this.ni;throw Qe()}addReference(e,t,r){return this.ti.addReference(r,t),this.ii.delete(r.toString()),de.resolve()}removeReference(e,t,r){return this.ti.removeReference(r,t),this.ii.add(r.toString()),de.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),de.resolve()}removeTarget(e,t){this.ti.Sr(t.targetId).forEach(i=>this.ii.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.ii.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return de.forEach(this.ii,r=>{const i=He.fromPath(r);return this.si(e,i).next(o=>{o||t.removeEntry(i,tt.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(r=>{r?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return de.or([()=>de.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class Hg{constructor(e,t){this.persistence=e,this.oi=new ic(r=>r5(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=mH(this,t)}static ri(e,t){return new Hg(e,t)}Zr(){}Xr(e){return de.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}sr(e){let t=0;return this.rr(e,r=>{t++}).next(()=>t)}rr(e,t){return de.forEach(this.oi,(r,i)=>this.ar(e,r,i).next(o=>o?de.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.qr(e,a=>this.ar(e,a,t).next(s=>{s||(r++,o.removeEntry(a,tt.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),de.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),de.resolve()}removeReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),de.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),de.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Qv(e.data.value)),t}ar(e,t,r){return de.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.oi.get(t);return de.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Hi=r,this.Ji=i}static Yi(e,t){let r=yt(),i=yt();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new aE(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SH{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RH{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return sj()?8:t5(Or())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,r,i){const o={result:null};return this.rs(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ss(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new SH;return this._s(e,t,a).next(s=>{if(o.result=s,this.Xi)return this.us(e,t,a,s.size)})}).next(()=>o.result)}us(e,t,r,i){return r.documentReadCount<this.es?($c()<=gt.DEBUG&&Re("QueryEngine","SDK will not create cache indexes for query:",Hc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),de.resolve()):($c()<=gt.DEBUG&&Re("QueryEngine","Query:",Hc(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ts*i?($c()<=gt.DEBUG&&Re("QueryEngine","The SDK decides to create cache indexes for query:",Hc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,aa(t))):de.resolve())}rs(e,t){if(KI(t))return de.resolve(null);let r=aa(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Pw(t,null,"F"),r=aa(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const a=yt(...o);return this.ns.getDocuments(e,a).next(s=>this.indexManager.getMinOffset(e,r).next(u=>{const l=this.cs(t,s);return this.ls(t,l,a,u.readTime)?this.rs(e,Pw(t,null,"F")):this.hs(e,l,t,u)}))})))}ss(e,t,r,i){return KI(t)||i.isEqual(tt.min())?de.resolve(null):this.ns.getDocuments(e,r).next(o=>{const a=this.cs(t,o);return this.ls(t,a,r,i)?de.resolve(null):($c()<=gt.DEBUG&&Re("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Hc(t)),this.hs(e,a,t,Q6(i,cp)).next(s=>s))})}cs(e,t){let r=new qn(eP(e));return t.forEach((i,o)=>{n0(e,o)&&(r=r.add(o))}),r}ls(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}_s(e,t,r){return $c()<=gt.DEBUG&&Re("QueryEngine","Using full collection scan to execute query:",Hc(t)),this.ns.getDocumentsMatchingQuery(e,t,Tu.min(),r)}hs(e,t,r,i){return this.ns.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE="LocalStore",kH=3e8;class AH{constructor(e,t,r,i){this.persistence=e,this.Ps=t,this.serializer=i,this.Ts=new dn(wt),this.Is=new ic(o=>Yb(o),Jb),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yH(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}}function NH(n,e,t,r){return new AH(n,e,t,r)}async function CP(n,e){const t=it(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.As(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{const a=[],s=[];let u=yt();for(const l of i){a.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}for(const l of o){s.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}return t.localDocuments.getDocuments(r,u).next(l=>({Rs:l,removedBatchIds:a,addedBatchIds:s}))})})}function DH(n,e){const t=it(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),o=t.ds.newChangeBuffer({trackRemovals:!0});return function(s,u,l,c){const h=l.batch,d=h.keys();let f=de.resolve();return d.forEach(p=>{f=f.next(()=>c.getEntry(u,p)).next(m=>{const g=l.docVersions.get(p);Ft(g!==null),m.version.compareTo(g)<0&&(h.applyToRemoteDocument(m,l),m.isValidDocument()&&(m.setReadTime(l.commitVersion),c.addEntry(m)))})}),f.next(()=>s.mutationQueue.removeMutationBatch(u,h))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(s){let u=yt();for(let l=0;l<s.mutationResults.length;++l)s.mutationResults[l].transformResults.length>0&&(u=u.add(s.batch.mutations[l].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function TP(n){const e=it(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function PH(n,e){const t=it(n),r=e.snapshotVersion;let i=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=t.ds.newChangeBuffer({trackRemovals:!0});i=t.Ts;const s=[];e.targetChanges.forEach((c,h)=>{const d=i.get(h);if(!d)return;s.push(t.Hr.removeMatchingKeys(o,c.removedDocuments,h).next(()=>t.Hr.addMatchingKeys(o,c.addedDocuments,h)));let f=d.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(gr.EMPTY_BYTE_STRING,tt.min()).withLastLimboFreeSnapshotVersion(tt.min()):c.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(c.resumeToken,r)),i=i.insert(h,f),function(m,g,y){return m.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-m.snapshotVersion.toMicroseconds()>=kH?!0:y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size>0}(d,f,c)&&s.push(t.Hr.updateTargetData(o,f))});let u=ss(),l=yt();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&s.push(t.persistence.referenceDelegate.updateLimboDocument(o,c))}),s.push(OH(o,a,e.documentUpdates).next(c=>{u=c.Vs,l=c.fs})),!r.isEqual(tt.min())){const c=t.Hr.getLastRemoteSnapshotVersion(o).next(h=>t.Hr.setTargetsMetadata(o,o.currentSequenceNumber,r));s.push(c)}return de.waitFor(s).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,u,l)).next(()=>u)}).then(o=>(t.Ts=i,o))}function OH(n,e,t){let r=yt(),i=yt();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=ss();return t.forEach((s,u)=>{const l=o.get(s);u.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(s)),u.isNoDocument()&&u.version.isEqual(tt.min())?(e.removeEntry(s,u.readTime),a=a.insert(s,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||u.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(u),a=a.insert(s,u)):Re(sE,"Ignoring outdated watch update for ",s,". Current version:",l.version," Watch version:",u.version)}),{Vs:a,fs:i}})}function MH(n,e){const t=it(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Kb),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function FH(n,e){const t=it(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Hr.getTargetData(r,e).next(o=>o?(i=o,de.resolve(i)):t.Hr.allocateTargetId(r).next(a=>(i=new nu(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Hr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(r.targetId,r),t.Is.set(e,r.targetId)),r})}async function Bw(n,e,t){const r=it(n),i=r.Ts.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!yd(a))throw a;Re(sE,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ts=r.Ts.remove(e),r.Is.delete(i.target)}function sS(n,e,t){const r=it(n);let i=tt.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,l,c){const h=it(u),d=h.Is.get(c);return d!==void 0?de.resolve(h.Ts.get(d)):h.Hr.getTargetData(l,c)}(r,a,aa(e)).next(s=>{if(s)return i=s.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(a,s.targetId).next(u=>{o=u})}).next(()=>r.Ps.getDocumentsMatchingQuery(a,e,t?i:tt.min(),t?o:yt())).next(s=>(LH(r,b5(e),s),{documents:s,gs:o})))}function LH(n,e,t){let r=n.Es.get(e)||tt.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Es.set(e,r)}class uS{constructor(){this.activeTargetIds=R5()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class BH{constructor(){this.ho=new uS,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,r){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new uS,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VH{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lS="ConnectivityMonitor";class cS{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Re(lS,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){Re(lS,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dv=null;function Vw(){return dv===null?dv=function(){return 268435456+Math.round(2147483648*Math.random())}():dv++,"0x"+dv.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P1="RestConnection",UH={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class WH{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${r}/databases/${i}`,this.wo=this.databaseId.database===Bg?`project_id=${r}`:`project_id=${r}&database_id=${i}`}bo(e,t,r,i,o){const a=Vw(),s=this.So(e,t.toUriEncodedString());Re(P1,`Sending RPC '${e}' ${a}:`,s,r);const u={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(u,i,o),this.vo(e,s,u,r).then(l=>(Re(P1,`Received RPC '${e}' ${a}: `,l),l),l=>{throw $h(P1,`RPC '${e}' ${a} failed with error: `,l,"url: ",s,"request:",r),l})}Co(e,t,r,i,o,a){return this.bo(e,t,r,i,o)}Do(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+vd}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}So(e,t){const r=UH[e];return`${this.po}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jH{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr="WebChannelConnection";class zH extends WH{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,r,i){const o=Vw();return new Promise((a,s)=>{const u=new kD;u.setWithCredentials(!0),u.listenOnce(AD.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Xv.NO_ERROR:const c=u.getResponseJson();Re(Cr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(c)),a(c);break;case Xv.TIMEOUT:Re(Cr,`RPC '${e}' ${o} timed out`),s(new $e(ge.DEADLINE_EXCEEDED,"Request time out"));break;case Xv.HTTP_ERROR:const h=u.getStatus();if(Re(Cr,`RPC '${e}' ${o} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);const f=d==null?void 0:d.error;if(f&&f.status&&f.message){const p=function(g){const y=g.toLowerCase().replace(/_/g,"-");return Object.values(ge).indexOf(y)>=0?y:ge.UNKNOWN}(f.status);s(new $e(p,f.message))}else s(new $e(ge.UNKNOWN,"Server responded with status "+u.getStatus()))}else s(new $e(ge.UNAVAILABLE,"Connection failed."));break;default:Qe()}}finally{Re(Cr,`RPC '${e}' ${o} completed.`)}});const l=JSON.stringify(i);Re(Cr,`RPC '${e}' ${o} sending request:`,i),u.send(t,"POST",l,r,15)})}Wo(e,t,r){const i=Vw(),o=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=PD(),s=DD(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const c=o.join("");Re(Cr,`Creating RPC '${e}' stream ${i}: ${c}`,u);const h=a.createWebChannel(c,u);let d=!1,f=!1;const p=new jH({Fo:g=>{f?Re(Cr,`Not sending because RPC '${e}' stream ${i} is closed:`,g):(d||(Re(Cr,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),Re(Cr,`RPC '${e}' stream ${i} sending:`,g),h.send(g))},Mo:()=>h.close()}),m=(g,y,x)=>{g.listen(y,_=>{try{x(_)}catch(b){setTimeout(()=>{throw b},0)}})};return m(h,wf.EventType.OPEN,()=>{f||(Re(Cr,`RPC '${e}' stream ${i} transport opened.`),p.Qo())}),m(h,wf.EventType.CLOSE,()=>{f||(f=!0,Re(Cr,`RPC '${e}' stream ${i} transport closed`),p.Ko())}),m(h,wf.EventType.ERROR,g=>{f||(f=!0,$h(Cr,`RPC '${e}' stream ${i} transport errored:`,g),p.Ko(new $e(ge.UNAVAILABLE,"The operation could not be completed")))}),m(h,wf.EventType.MESSAGE,g=>{var y;if(!f){const x=g.data[0];Ft(!!x);const _=x,b=(_==null?void 0:_.error)||((y=_[0])===null||y===void 0?void 0:y.error);if(b){Re(Cr,`RPC '${e}' stream ${i} received error:`,b);const C=b.status;let k=function(I){const R=Pn[I];if(R!==void 0)return dP(R)}(C),T=b.message;k===void 0&&(k=ge.INTERNAL,T="Unknown error status: "+C+" with message "+b.message),f=!0,p.Ko(new $e(k,T)),h.close()}else Re(Cr,`RPC '${e}' stream ${i} received:`,x),p.Uo(x)}}),m(s,ND.STAT_EVENT,g=>{g.stat===Rw.PROXY?Re(Cr,`RPC '${e}' stream ${i} detected buffering proxy`):g.stat===Rw.NOPROXY&&Re(Cr,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{p.$o()},0),p}}function O1(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a0(n){return new q5(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Ti=e,this.timerId=t,this.Go=r,this.zo=i,this.jo=o,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),i=Math.max(0,t-r);i>0&&Re("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hS="PersistentStream";class SP{constructor(e,t,r,i,o,a,s,u){this.Ti=e,this.n_=r,this.r_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new IP(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===ge.RESOURCE_EXHAUSTED?(as(t.toString()),as("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===ge.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.i_===t&&this.V_(r,i)},r=>{e(()=>{const i=new $e(ge.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(i)})})}V_(e,t){const r=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{r(()=>this.m_(i))}),this.stream.onMessage(i=>{r(()=>++this.__==1?this.g_(i):this.onNext(i))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return Re(hS,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(Re(hS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $H extends SP{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=Q5(this.serializer,e),r=function(o){if(!("targetChange"in o))return tt.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?tt.min():a.readTime?sa(a.readTime):tt.min()}(e);return this.listener.p_(t,r)}y_(e){const t={};t.database=Lw(this.serializer),t.addTarget=function(o,a){let s;const u=a.target;if(s=Dw(u)?{documents:Z5(o,u)}:{query:eH(o,u).ht},s.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){s.resumeToken=mP(o,a.resumeToken);const l=Ow(o,a.expectedCount);l!==null&&(s.expectedCount=l)}else if(a.snapshotVersion.compareTo(tt.min())>0){s.readTime=$g(o,a.snapshotVersion.toTimestamp());const l=Ow(o,a.expectedCount);l!==null&&(s.expectedCount=l)}return s}(this.serializer,e);const r=nH(this.serializer,e);r&&(t.labels=r),this.I_(t)}w_(e){const t={};t.database=Lw(this.serializer),t.removeTarget=e,this.I_(t)}}class HH extends SP{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return Ft(!!e.streamToken),this.lastStreamToken=e.streamToken,Ft(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){Ft(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=J5(e.writeResults,e.commitTime),r=sa(e.commitTime);return this.listener.v_(r,t)}C_(){const e={};e.database=Lw(this.serializer),this.I_(e)}S_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Y5(this.serializer,r))};this.I_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GH{}class qH extends GH{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new $e(ge.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,t,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.bo(e,Mw(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ge.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new $e(ge.UNKNOWN,o.toString())})}Co(e,t,r,i,o){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,s])=>this.connection.Co(e,Mw(t,r),i,a,s,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ge.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new $e(ge.UNKNOWN,a.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class KH{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(as(t),this.N_=!1):Re("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kl="RemoteStore";class XH{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=o,this.z_.To(a=>{r.enqueueAndForget(async()=>{ac(this)&&(Re(Kl,"Restarting streams for network reachability change."),await async function(u){const l=it(u);l.W_.add(4),await Up(l),l.j_.set("Unknown"),l.W_.delete(4),await s0(l)}(this))})}),this.j_=new KH(r,i)}}async function s0(n){if(ac(n))for(const e of n.G_)await e(!0)}async function Up(n){for(const e of n.G_)await e(!1)}function RP(n,e){const t=it(n);t.U_.has(e.targetId)||(t.U_.set(e.targetId,e),hE(t)?cE(t):xd(t).c_()&&lE(t,e))}function uE(n,e){const t=it(n),r=xd(t);t.U_.delete(e),r.c_()&&kP(t,e),t.U_.size===0&&(r.c_()?r.P_():ac(t)&&t.j_.set("Unknown"))}function lE(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(tt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xd(n).y_(e)}function kP(n,e){n.H_.Ne(e),xd(n).w_(e)}function cE(n){n.H_=new z5({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.U_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),xd(n).start(),n.j_.B_()}function hE(n){return ac(n)&&!xd(n).u_()&&n.U_.size>0}function ac(n){return it(n).W_.size===0}function AP(n){n.H_=void 0}async function QH(n){n.j_.set("Online")}async function YH(n){n.U_.forEach((e,t)=>{lE(n,e)})}async function JH(n,e){AP(n),hE(n)?(n.j_.q_(e),cE(n)):n.j_.set("Unknown")}async function ZH(n,e,t){if(n.j_.set("Online"),e instanceof pP&&e.state===2&&e.cause)try{await async function(i,o){const a=o.cause;for(const s of o.targetIds)i.U_.has(s)&&(await i.remoteSyncer.rejectListen(s,a),i.U_.delete(s),i.H_.removeTarget(s))}(n,e)}catch(r){Re(Kl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Gg(n,r)}else if(e instanceof Zv?n.H_.We(e):e instanceof fP?n.H_.Ze(e):n.H_.je(e),!t.isEqual(tt.min()))try{const r=await TP(n.localStore);t.compareTo(r)>=0&&await function(o,a){const s=o.H_.ot(a);return s.targetChanges.forEach((u,l)=>{if(u.resumeToken.approximateByteSize()>0){const c=o.U_.get(l);c&&o.U_.set(l,c.withResumeToken(u.resumeToken,a))}}),s.targetMismatches.forEach((u,l)=>{const c=o.U_.get(u);if(!c)return;o.U_.set(u,c.withResumeToken(gr.EMPTY_BYTE_STRING,c.snapshotVersion)),kP(o,u);const h=new nu(c.target,u,l,c.sequenceNumber);lE(o,h)}),o.remoteSyncer.applyRemoteEvent(s)}(n,t)}catch(r){Re(Kl,"Failed to raise snapshot:",r),await Gg(n,r)}}async function Gg(n,e,t){if(!yd(e))throw e;n.W_.add(1),await Up(n),n.j_.set("Offline"),t||(t=()=>TP(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Re(Kl,"Retrying IndexedDB access"),await t(),n.W_.delete(1),await s0(n)})}function NP(n,e){return e().catch(t=>Gg(n,t,e))}async function u0(n){const e=it(n),t=ku(e);let r=e.K_.length>0?e.K_[e.K_.length-1].batchId:Kb;for(;eG(e);)try{const i=await MH(e.localStore,r);if(i===null){e.K_.length===0&&t.P_();break}r=i.batchId,tG(e,i)}catch(i){await Gg(e,i)}DP(e)&&PP(e)}function eG(n){return ac(n)&&n.K_.length<10}function tG(n,e){n.K_.push(e);const t=ku(n);t.c_()&&t.b_&&t.S_(e.mutations)}function DP(n){return ac(n)&&!ku(n).u_()&&n.K_.length>0}function PP(n){ku(n).start()}async function nG(n){ku(n).C_()}async function rG(n){const e=ku(n);for(const t of n.K_)e.S_(t.mutations)}async function iG(n,e,t){const r=n.K_.shift(),i=tE.from(r,e,t);await NP(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await u0(n)}async function oG(n,e){e&&ku(n).b_&&await async function(r,i){if(function(a){return U5(a)&&a!==ge.ABORTED}(i.code)){const o=r.K_.shift();ku(r).h_(),await NP(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),await u0(r)}}(n,e),DP(n)&&PP(n)}async function dS(n,e){const t=it(n);t.asyncQueue.verifyOperationInProgress(),Re(Kl,"RemoteStore received new credentials");const r=ac(t);t.W_.add(3),await Up(t),r&&t.j_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),await s0(t)}async function aG(n,e){const t=it(n);e?(t.W_.delete(2),await s0(t)):e||(t.W_.add(2),await Up(t),t.j_.set("Unknown"))}function xd(n){return n.J_||(n.J_=function(t,r,i){const o=it(t);return o.M_(),new $H(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{xo:QH.bind(null,n),No:YH.bind(null,n),Lo:JH.bind(null,n),p_:ZH.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),hE(n)?cE(n):n.j_.set("Unknown")):(await n.J_.stop(),AP(n))})),n.J_}function ku(n){return n.Y_||(n.Y_=function(t,r,i){const o=it(t);return o.M_(),new HH(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:nG.bind(null,n),Lo:oG.bind(null,n),D_:rG.bind(null,n),v_:iG.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await u0(n)):(await n.Y_.stop(),n.K_.length>0&&(Re(Kl,`Stopping write stream with ${n.K_.length} pending writes`),n.K_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new wu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){const a=Date.now()+r,s=new dE(e,t,a,i,o);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $e(ge.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fE(n,e){if(as("AsyncQueue",`${e}: ${n}`),yd(n))return new $e(ge.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{static emptySet(e){return new Eh(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||He.comparator(t.key,r.key):(t,r)=>He.comparator(t.key,r.key),this.keyedMap=_f(),this.sortedSet=new dn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Eh)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Eh;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fS{constructor(){this.Z_=new dn(He.comparator)}track(e){const t=e.doc.key,r=this.Z_.get(t);r?e.type!==0&&r.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&r.type!==1?this.Z_=this.Z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Z_=this.Z_.remove(t):e.type===1&&r.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):Qe():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Xh{constructor(e,t,r,i,o,a,s,u,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=s,this.excludesMetadataChanges=u,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,o){const a=[];return t.forEach(s=>{a.push({type:0,doc:s})}),new Xh(e,t,Eh.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&t0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sG{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class uG{constructor(){this.queries=pS(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,r){const i=it(t),o=i.queries;i.queries=pS(),o.forEach((a,s)=>{for(const u of s.ta)u.onError(r)})})(this,new $e(ge.ABORTED,"Firestore shutting down"))}}function pS(){return new ic(n=>ZD(n),t0)}async function lG(n,e){const t=it(n);let r=3;const i=e.query;let o=t.queries.get(i);o?!o.na()&&e.ra()&&(r=2):(o=new sG,r=e.ra()?0:1);try{switch(r){case 0:o.ea=await t.onListen(i,!0);break;case 1:o.ea=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const s=fE(a,`Initialization of query '${Hc(e.query)}' failed`);return void e.onError(s)}t.queries.set(i,o),o.ta.push(e),e.sa(t.onlineState),o.ea&&e.oa(o.ea)&&pE(t)}async function cG(n,e){const t=it(n),r=e.query;let i=3;const o=t.queries.get(r);if(o){const a=o.ta.indexOf(e);a>=0&&(o.ta.splice(a,1),o.ta.length===0?i=e.ra()?0:1:!o.na()&&e.ra()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function hG(n,e){const t=it(n);let r=!1;for(const i of e){const o=i.query,a=t.queries.get(o);if(a){for(const s of a.ta)s.oa(i)&&(r=!0);a.ea=i}}r&&pE(t)}function dG(n,e,t){const r=it(n),i=r.queries.get(e);if(i)for(const o of i.ta)o.onError(t);r.queries.delete(e)}function pE(n){n.ia.forEach(e=>{e.next()})}var Uw,mS;(mS=Uw||(Uw={}))._a="default",mS.Cache="cache";class fG{constructor(e,t,r){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Xh(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;const r=t!=="Offline";return(!this.options.Ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=Xh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==Uw.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(e){this.key=e}}class MP{constructor(e){this.key=e}}class pG{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=yt(),this.mutatedKeys=yt(),this.ya=eP(e),this.wa=new Eh(this.ya)}get ba(){return this.fa}Sa(e,t){const r=t?t.Da:new fS,i=t?t.wa:this.wa;let o=t?t.mutatedKeys:this.mutatedKeys,a=i,s=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((c,h)=>{const d=i.get(c),f=n0(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),m=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let g=!1;d&&f?d.data.isEqual(f.data)?p!==m&&(r.track({type:3,doc:f}),g=!0):this.va(d,f)||(r.track({type:2,doc:f}),g=!0,(u&&this.ya(f,u)>0||l&&this.ya(f,l)<0)&&(s=!0)):!d&&f?(r.track({type:0,doc:f}),g=!0):d&&!f&&(r.track({type:1,doc:d}),g=!0,(u||l)&&(s=!0)),g&&(f?(a=a.add(f),o=m?o.add(c):o.delete(c)):(a=a.delete(c),o=o.delete(c)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const c=this.query.limitType==="F"?a.last():a.first();a=a.delete(c.key),o=o.delete(c.key),r.track({type:1,doc:c})}return{wa:a,Da:r,ls:s,mutatedKeys:o}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const o=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const a=e.Da.X_();a.sort((c,h)=>function(f,p){const m=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qe()}};return m(f)-m(p)}(c.type,h.type)||this.ya(c.doc,h.doc)),this.Ca(r),i=i!=null&&i;const s=t&&!i?this.Fa():[],u=this.pa.size===0&&this.current&&!i?1:0,l=u!==this.ga;return this.ga=u,a.length!==0||l?{snapshot:new Xh(this.query,e.wa,o,a,e.mutatedKeys,u===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:s}:{Ma:s}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new fS,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=yt(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const t=[];return e.forEach(r=>{this.pa.has(r)||t.push(new MP(r))}),this.pa.forEach(r=>{e.has(r)||t.push(new OP(r))}),t}Oa(e){this.fa=e.gs,this.pa=yt();const t=this.Sa(e.documents);return this.applyChanges(t,!0)}Na(){return Xh.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const mE="SyncEngine";class mG{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class vG{constructor(e){this.key=e,this.Ba=!1}}class gG{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.La={},this.ka=new ic(s=>ZD(s),t0),this.qa=new Map,this.Qa=new Set,this.$a=new dn(He.comparator),this.Ka=new Map,this.Ua=new iE,this.Wa={},this.Ga=new Map,this.za=Kh.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function yG(n,e,t=!0){const r=WP(n);let i;const o=r.ka.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Na()):i=await FP(r,e,t,!0),i}async function xG(n,e){const t=WP(n);await FP(t,e,!0,!1)}async function FP(n,e,t,r){const i=await FH(n.localStore,aa(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let s;return r&&(s=await wG(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&RP(n.remoteStore,i),s}async function wG(n,e,t,r,i){n.Ha=(h,d,f)=>async function(m,g,y,x){let _=g.view.Sa(y);_.ls&&(_=await sS(m.localStore,g.query,!1).then(({documents:T})=>g.view.Sa(T,_)));const b=x&&x.targetChanges.get(g.targetId),C=x&&x.targetMismatches.get(g.targetId)!=null,k=g.view.applyChanges(_,m.isPrimaryClient,b,C);return gS(m,g.targetId,k.Ma),k.snapshot}(n,h,d,f);const o=await sS(n.localStore,e,!0),a=new pG(e,o.gs),s=a.Sa(o.documents),u=Vp.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=a.applyChanges(s,n.isPrimaryClient,u);gS(n,t,l.Ma);const c=new mG(e,t,a);return n.ka.set(e,c),n.qa.has(t)?n.qa.get(t).push(e):n.qa.set(t,[e]),l.snapshot}async function _G(n,e,t){const r=it(n),i=r.ka.get(e),o=r.qa.get(i.targetId);if(o.length>1)return r.qa.set(i.targetId,o.filter(a=>!t0(a,e))),void r.ka.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Bw(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&uE(r.remoteStore,i.targetId),Ww(r,i.targetId)}).catch(gd)):(Ww(r,i.targetId),await Bw(r.localStore,i.targetId,!0))}async function bG(n,e){const t=it(n),r=t.ka.get(e),i=t.qa.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),uE(t.remoteStore,r.targetId))}async function EG(n,e,t){const r=AG(n);try{const i=await function(a,s){const u=it(a),l=Gn.now(),c=s.reduce((f,p)=>f.add(p.key),yt());let h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let p=ss(),m=yt();return u.ds.getEntries(f,c).next(g=>{p=g,p.forEach((y,x)=>{x.isValidDocument()||(m=m.add(y))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,p)).next(g=>{h=g;const y=[];for(const x of s){const _=M5(x,h.get(x.key).overlayedDocument);_!=null&&y.push(new oc(x.key,_,GD(_.value.mapValue),Ja.exists(!0)))}return u.mutationQueue.addMutationBatch(f,l,y,s)}).next(g=>{d=g;const y=g.applyToLocalDocumentSet(h,m);return u.documentOverlayCache.saveOverlays(f,g.batchId,y)})}).then(()=>({batchId:d.batchId,changes:nP(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,s,u){let l=a.Wa[a.currentUser.toKey()];l||(l=new dn(wt)),l=l.insert(s,u),a.Wa[a.currentUser.toKey()]=l}(r,i.batchId,t),await Wp(r,i.changes),await u0(r.remoteStore)}catch(i){const o=fE(i,"Failed to persist write");t.reject(o)}}async function LP(n,e){const t=it(n);try{const r=await PH(t.localStore,e);e.targetChanges.forEach((i,o)=>{const a=t.Ka.get(o);a&&(Ft(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ba=!0:i.modifiedDocuments.size>0?Ft(a.Ba):i.removedDocuments.size>0&&(Ft(a.Ba),a.Ba=!1))}),await Wp(t,r,e)}catch(r){await gd(r)}}function vS(n,e,t){const r=it(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.ka.forEach((o,a)=>{const s=a.view.sa(e);s.snapshot&&i.push(s.snapshot)}),function(a,s){const u=it(a);u.onlineState=s;let l=!1;u.queries.forEach((c,h)=>{for(const d of h.ta)d.sa(s)&&(l=!0)}),l&&pE(u)}(r.eventManager,e),i.length&&r.La.p_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function CG(n,e,t){const r=it(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Ka.get(e),o=i&&i.key;if(o){let a=new dn(He.comparator);a=a.insert(o,kr.newNoDocument(o,tt.min()));const s=yt().add(o),u=new o0(tt.min(),new Map,new dn(wt),a,s);await LP(r,u),r.$a=r.$a.remove(o),r.Ka.delete(e),vE(r)}else await Bw(r.localStore,e,!1).then(()=>Ww(r,e,t)).catch(gd)}async function TG(n,e){const t=it(n),r=e.batch.batchId;try{const i=await DH(t.localStore,e);VP(t,r,null),BP(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Wp(t,i)}catch(i){await gd(i)}}async function IG(n,e,t){const r=it(n);try{const i=await function(a,s){const u=it(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return u.mutationQueue.lookupMutationBatch(l,s).next(h=>(Ft(h!==null),c=h.keys(),u.mutationQueue.removeMutationBatch(l,h))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,c,s)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>u.localDocuments.getDocuments(l,c))})}(r.localStore,e);VP(r,e,t),BP(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Wp(r,i)}catch(i){await gd(i)}}function BP(n,e){(n.Ga.get(e)||[]).forEach(t=>{t.resolve()}),n.Ga.delete(e)}function VP(n,e,t){const r=it(n);let i=r.Wa[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Wa[r.currentUser.toKey()]=i}}function Ww(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.qa.get(e))n.ka.delete(r),t&&n.La.Ja(r,t);n.qa.delete(e),n.isPrimaryClient&&n.Ua.Sr(e).forEach(r=>{n.Ua.containsKey(r)||UP(n,r)})}function UP(n,e){n.Qa.delete(e.path.canonicalString());const t=n.$a.get(e);t!==null&&(uE(n.remoteStore,t),n.$a=n.$a.remove(e),n.Ka.delete(t),vE(n))}function gS(n,e,t){for(const r of t)r instanceof OP?(n.Ua.addReference(r.key,e),SG(n,r)):r instanceof MP?(Re(mE,"Document no longer in limbo: "+r.key),n.Ua.removeReference(r.key,e),n.Ua.containsKey(r.key)||UP(n,r.key)):Qe()}function SG(n,e){const t=e.key,r=t.path.canonicalString();n.$a.get(t)||n.Qa.has(r)||(Re(mE,"New document in limbo: "+t),n.Qa.add(r),vE(n))}function vE(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const t=new He(bn.fromString(e)),r=n.za.next();n.Ka.set(r,new vG(t)),n.$a=n.$a.insert(t,r),RP(n.remoteStore,new nu(aa(Zb(t.path)),r,"TargetPurposeLimboResolution",Yy.ae))}}async function Wp(n,e,t){const r=it(n),i=[],o=[],a=[];r.ka.isEmpty()||(r.ka.forEach((s,u)=>{a.push(r.Ha(u,e,t).then(l=>{var c;if((l||t)&&r.isPrimaryClient){const h=l?!l.fromCache:(c=t==null?void 0:t.targetChanges.get(u.targetId))===null||c===void 0?void 0:c.current;r.sharedClientState.updateQueryState(u.targetId,h?"current":"not-current")}if(l){i.push(l);const h=aE.Yi(u.targetId,l);o.push(h)}}))}),await Promise.all(a),r.La.p_(i),await async function(u,l){const c=it(u);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>de.forEach(l,d=>de.forEach(d.Hi,f=>c.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>de.forEach(d.Ji,f=>c.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!yd(h))throw h;Re(sE,"Failed to update sequence numbers: "+h)}for(const h of l){const d=h.targetId;if(!h.fromCache){const f=c.Ts.get(d),p=f.snapshotVersion,m=f.withLastLimboFreeSnapshotVersion(p);c.Ts=c.Ts.insert(d,m)}}}(r.localStore,o))}async function RG(n,e){const t=it(n);if(!t.currentUser.isEqual(e)){Re(mE,"User change. New user:",e.toKey());const r=await CP(t.localStore,e);t.currentUser=e,function(o,a){o.Ga.forEach(s=>{s.forEach(u=>{u.reject(new $e(ge.CANCELLED,a))})}),o.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Wp(t,r.Rs)}}function kG(n,e){const t=it(n),r=t.Ka.get(e);if(r&&r.Ba)return yt().add(r.key);{let i=yt();const o=t.qa.get(e);if(!o)return i;for(const a of o){const s=t.ka.get(a);i=i.unionWith(s.view.ba)}return i}}function WP(n){const e=it(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=LP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=kG.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=CG.bind(null,e),e.La.p_=hG.bind(null,e.eventManager),e.La.Ja=dG.bind(null,e.eventManager),e}function AG(n){const e=it(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=TG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=IG.bind(null,e),e}class qg{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=a0(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return NH(this.persistence,new RH,e.initialUser,this.serializer)}Xa(e){return new EP(oE.ri,this.serializer)}Za(e){return new BH}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}qg.provider={build:()=>new qg};class NG extends qg{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){Ft(this.persistence.referenceDelegate instanceof Hg);const r=this.persistence.referenceDelegate.garbageCollector;return new fH(r,e.asyncQueue,t)}Xa(e){const t=this.cacheSizeBytes!==void 0?Jr.withCacheSize(this.cacheSizeBytes):Jr.DEFAULT;return new EP(r=>Hg.ri(r,t),this.serializer)}}class jw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>vS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=RG.bind(null,this.syncEngine),await aG(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new uG}()}createDatastore(e){const t=a0(e.databaseInfo.databaseId),r=function(o){return new zH(o)}(e.databaseInfo);return function(o,a,s,u){return new qH(o,a,s,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,o,a,s){return new XH(r,i,o,a,s)}(this.localStore,this.datastore,e.asyncQueue,t=>vS(this.syncEngine,t,0),function(){return cS.D()?new cS:new VH}())}createSyncEngine(e,t){return function(i,o,a,s,u,l,c){const h=new gG(i,o,a,s,u,l);return c&&(h.ja=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const o=it(i);Re(Kl,"RemoteStore shutting down."),o.W_.add(5),await Up(o),o.z_.shutdown(),o.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}jw.provider={build:()=>new jw};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DG{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):as("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Au="FirestoreClient";class PG{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Tr.UNAUTHENTICATED,this.clientId=MD.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async a=>{Re(Au,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(Re(Au,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=fE(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function M1(n,e){n.asyncQueue.verifyOperationInProgress(),Re(Au,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await CP(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function yS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await OG(n);Re(Au,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>dS(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>dS(e.remoteStore,i)),n._onlineComponents=e}async function OG(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Re(Au,"Using user provided OfflineComponentProvider");try{await M1(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===ge.FAILED_PRECONDITION||i.code===ge.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;$h("Error using user provided cache. Falling back to memory cache: "+t),await M1(n,new qg)}}else Re(Au,"Using default OfflineComponentProvider"),await M1(n,new NG(void 0));return n._offlineComponents}async function jP(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Re(Au,"Using user provided OnlineComponentProvider"),await yS(n,n._uninitializedComponentsProvider._online)):(Re(Au,"Using default OnlineComponentProvider"),await yS(n,new jw))),n._onlineComponents}function MG(n){return jP(n).then(e=>e.syncEngine)}async function FG(n){const e=await jP(n),t=e.eventManager;return t.onListen=yG.bind(null,e.syncEngine),t.onUnlisten=_G.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=xG.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=bG.bind(null,e.syncEngine),t}function LG(n,e,t={}){const r=new wu;return n.asyncQueue.enqueueAndForget(async()=>function(o,a,s,u,l){const c=new DG({next:d=>{c.su(),a.enqueueAndForget(()=>cG(o,h));const f=d.docs.has(s);!f&&d.fromCache?l.reject(new $e(ge.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?l.reject(new $e(ge.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(d)},error:d=>l.reject(d)}),h=new fG(Zb(s.path),c,{includeMetadataChanges:!0,Ta:!0});return lG(o,h)}(await FG(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BG(n,e,t){if(!t)throw new $e(ge.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function VG(n,e,t,r){if(e===!0&&r===!0)throw new $e(ge.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function wS(n){if(!He.isDocumentKey(n))throw new $e(ge.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function gE(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Qe()}function vp(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new $e(ge.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=gE(n);throw new $e(ge.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P="firestore.googleapis.com",_S=!0;class bS{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new $e(ge.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=$P,this.ssl=_S}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:_S;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=bP;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<hH)throw new $e(ge.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}VG("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=zP((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new $e(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new $e(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new $e(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class yE{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $e(ge.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new $e(ge.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new j6;switch(r.type){case"firstParty":return new G6(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new $e(ge.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=xS.get(t);r&&(Re("ComponentProvider","Removing Datastore"),xS.delete(t),r.terminate())}(this),Promise.resolve()}}function UG(n,e,t,r={}){var i;const o=(n=vp(n,yE))._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),s=`${e}:${t}`;o.host!==$P&&o.host!==s&&$h("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},o),{host:s,ssl:!1,emulatorOptions:r});if(!zl(u,a)&&(n._setSettings(u),r.mockUserToken)){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=Tr.MOCK_USER;else{l=ej(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new $e(ge.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Tr(h)}n._authCredentials=new z6(new OD(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new xE(this.firestore,e,this._query)}}class Xi{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xi(this.firestore,e,this._key)}}class gp extends xE{constructor(e,t,r){super(e,t,Zb(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xi(this.firestore,null,new He(e))}withConverter(e){return new gp(this.firestore,e,this._path)}}function wE(n,e,...t){if(n=Ji(n),arguments.length===1&&(e=MD.newId()),BG("doc","path",e),n instanceof yE){const r=bn.fromString(e,...t);return wS(r),new Xi(n,null,new He(r))}{if(!(n instanceof Xi||n instanceof gp))throw new $e(ge.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bn.fromString(e,...t));return wS(r),new Xi(n.firestore,n instanceof gp?n.converter:null,new He(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ES="AsyncQueue";class CS{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new IP(this,"async_queue_retry"),this.bu=()=>{const r=O1();r&&Re(ES,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.Su=e;const t=O1();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=O1();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const t=new wu;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!yd(e))throw e;Re(ES,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const t=this.Su.then(()=>(this.pu=!0,e().catch(r=>{this.gu=r,this.pu=!1;const i=function(a){let s=a.message||"";return a.stack&&(s=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),s}(r);throw as("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.pu=!1,r))));return this.Su=t,t}enqueueAfterDelay(e,t,r){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const i=dE.createAndSchedule(this,e,t,r,o=>this.Fu(o));return this.fu.push(i),i}Du(){this.gu&&Qe()}verifyOperationInProgress(){}async Mu(){let e;do e=this.Su,await e;while(e!==this.Su)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}class _E extends yE{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new CS,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new CS(e),this._firestoreClient=void 0,await e}}}function WG(n,e){const t=typeof n=="object"?n:HN(),r=typeof n=="string"?n:Bg,i=Mb(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=JW("firestore");o&&UG(i,...o)}return i}function HP(n){if(n._terminated)throw new $e(ge.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||jG(n),n._firestoreClient}function jG(n){var e,t,r;const i=n._freezeSettings(),o=function(s,u,l,c){return new a5(s,u,l,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,zP(c.experimentalLongPollingOptions),c.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new PG(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(s){const u=s==null?void 0:s._online.build();return{_offline:s==null?void 0:s._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qh(gr.fromBase64String(e))}catch(t){throw new $e(ge.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Qh(gr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new $e(ge.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new $e(ge.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new $e(ge.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return wt(this._lat,e._lat)||wt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zG=/^__.*__$/;class $G{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new oc(e,this.data,this.fieldMask,t,this.fieldTransforms):new Bp(e,this.data,t,this.fieldTransforms)}}function qP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qe()}}class TE{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Bu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new TE(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:r,Qu:!1});return i.$u(e),i}Ku(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:r,Qu:!1});return i.Bu(),i}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Kg(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(qP(this.Lu)&&zG.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class HG{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||a0(e)}ju(e,t,r,i=!1){return new TE({Lu:e,methodName:t,zu:r,path:fr.emptyPath(),Qu:!1,Gu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function GG(n){const e=n._freezeSettings(),t=a0(n._databaseId);return new HG(n._databaseId,!!e.ignoreUndefinedProperties,t)}function qG(n,e,t,r,i,o={}){const a=n.ju(o.merge||o.mergeFields?2:0,e,t,i);YP("Data must be an object, but it was:",a,r);const s=XP(r,a);let u,l;if(o.merge)u=new bo(a.fieldMask),l=a.fieldTransforms;else if(o.mergeFields){const c=[];for(const h of o.mergeFields){const d=KG(e,h,t);if(!a.contains(d))throw new $e(ge.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);QG(c,d)||c.push(d)}u=new bo(c),l=a.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,l=a.fieldTransforms;return new $G(new ji(s),u,l)}function KP(n,e){if(QP(n=Ji(n)))return YP("Unsupported field value:",e,n),XP(n,e);if(n instanceof GP)return function(r,i){if(!qP(i.Lu))throw i.Wu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Wu(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(r,i){const o=[];let a=0;for(const s of r){let u=KP(s,i.Uu(a));u==null&&(u={nullValue:"NULL_VALUE"}),o.push(u),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=Ji(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return k5(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Gn.fromDate(r);return{timestampValue:$g(i.serializer,o)}}if(r instanceof Gn){const o=new Gn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$g(i.serializer,o)}}if(r instanceof EE)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qh)return{bytesValue:mP(i.serializer,r._byteString)};if(r instanceof Xi){const o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Wu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:rE(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof CE)return function(a,s){return{mapValue:{fields:{[zD]:{stringValue:HD},[Vg]:{arrayValue:{values:a.toArray().map(l=>{if(typeof l!="number")throw s.Wu("VectorValues must only contain numeric values.");return eE(s.serializer,l)})}}}}}}(r,i);throw i.Wu(`Unsupported field value: ${gE(r)}`)}(n,e)}function XP(n,e){const t={};return LD(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):rc(n,(r,i)=>{const o=KP(i,e.qu(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function QP(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Gn||n instanceof EE||n instanceof Qh||n instanceof Xi||n instanceof GP||n instanceof CE)}function YP(n,e,t){if(!QP(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=gE(t);throw r==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+r)}}function KG(n,e,t){if((e=Ji(e))instanceof bE)return e._internalPath;if(typeof e=="string")return JP(n,e);throw Kg("Field path arguments must be of type string or ",n,!1,void 0,t)}const XG=new RegExp("[~\\*/\\[\\]]");function JP(n,e,t){if(e.search(XG)>=0)throw Kg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new bE(...e.split("."))._internalPath}catch{throw Kg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Kg(n,e,t,r,i){const o=r&&!r.isEmpty(),a=i!==void 0;let s=`Function ${e}() called with invalid data`;t&&(s+=" (via `toFirestore()`)"),s+=". ";let u="";return(o||a)&&(u+=" (found",o&&(u+=` in field ${r}`),a&&(u+=` in document ${i}`),u+=")"),new $e(ge.INVALID_ARGUMENT,s+n+u)}function QG(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Xi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new YG(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(eO("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class YG extends ZP{data(){return super.data()}}function eO(n,e){return typeof e=="string"?JP(n,e):e instanceof bE?e._internalPath:e._delegate._internalPath}class JG{convertValue(e,t="none"){switch(Ru(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Sn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Su(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Qe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return rc(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;const o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Vg].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>Sn(a.doubleValue));return new CE(o)}convertGeoPoint(e){return new EE(Sn(e.latitude),Sn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Zy(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(hp(e));default:return null}}convertTimestamp(e){const t=Iu(e);return new Gn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=bn.fromString(e);Ft(_P(r));const i=new dp(r.get(1),r.get(3)),o=new He(r.popFirst(5));return i.isEqual(t)||as(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZG(n,e,t){let r;return r=n?n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eq{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class tO extends ZP{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new tq(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(eO("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class tq extends tO{data(e={}){return super.data(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nq(n){n=vp(n,Xi);const e=vp(n.firestore,_E);return LG(HP(e),n._key).then(t=>oq(e,n,t))}class rq extends JG{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xi(this.firestore,null,t)}}function nO(n,e,t){n=vp(n,Xi);const r=vp(n.firestore,_E),i=ZG(n.converter,e);return iq(r,[qG(GG(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ja.none())])}function iq(n,e){return function(r,i){const o=new wu;return r.asyncQueue.enqueueAndForget(async()=>EG(await MG(r),i,o)),o.promise}(HP(n),e)}function oq(n,e,t){const r=t.docs.get(e._key),i=new rq(n);return new tO(n,i,e._key,r,new eq(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){vd=i})(pd),jh(new $l("firestore",(r,{instanceIdentifier:i,options:o})=>{const a=r.getProvider("app").getImmediate(),s=new _E(new $6(r.getProvider("auth-internal")),new q6(a,r.getProvider("app-check-internal")),function(l,c){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new $e(ge.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dp(l.options.projectId,c)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),s._setSettings(o),s},"PUBLIC").setMultipleInstances(!0)),yu(DI,PI,e),yu(DI,PI,"esm2017")})();const aq={apiKey:"AIzaSyByWPD2J8YkQaE3xCJWZWKXinzpuUqi3G4",authDomain:"code-tracker-56a43.firebaseapp.com",databaseURL:"https://code-tracker-56a43-default-rtdb.firebaseio.com",projectId:"code-tracker-56a43",storageBucket:"code-tracker-56a43.firebasestorage.app",messagingSenderId:"378279949183",appId:"1:378279949183:web:bbee82ad80b063d8a7e04a",measurementId:"G-N57GLMY5MR"},sq=$N(aq),Yh=B6(),IE=WG(sq);function rO(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=rO(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Pl(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=rO(n))&&(r&&(r+=" "),r+=e);return r}function uq(n){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t),t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n))}uq(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var jp=n=>typeof n=="number"&&!isNaN(n),Xl=n=>typeof n=="string",us=n=>typeof n=="function",lq=n=>Xl(n)||jp(n),zw=n=>Xl(n)||us(n)?n:null,cq=(n,e)=>n===!1||jp(n)&&n>0?n:e,$w=n=>fe.isValidElement(n)||Xl(n)||us(n)||jp(n);function hq(n,e,t=300){let{scrollHeight:r,style:i}=n;requestAnimationFrame(()=>{i.minHeight="initial",i.height=r+"px",i.transition=`all ${t}ms`,requestAnimationFrame(()=>{i.height="0",i.padding="0",i.margin="0",setTimeout(e,t)})})}function dq({enter:n,exit:e,appendPosition:t=!1,collapse:r=!0,collapseDuration:i=300}){return function({children:o,position:a,preventExitTransition:s,done:u,nodeRef:l,isIn:c,playToast:h}){let d=t?`${n}--${a}`:n,f=t?`${e}--${a}`:e,p=fe.useRef(0);return fe.useLayoutEffect(()=>{let m=l.current,g=d.split(" "),y=x=>{x.target===l.current&&(h(),m.removeEventListener("animationend",y),m.removeEventListener("animationcancel",y),p.current===0&&x.type!=="animationcancel"&&m.classList.remove(...g))};m.classList.add(...g),m.addEventListener("animationend",y),m.addEventListener("animationcancel",y)},[]),fe.useEffect(()=>{let m=l.current,g=()=>{m.removeEventListener("animationend",g),r?hq(m,u,i):u()};c||(s?g():(p.current=1,m.className+=` ${f}`,m.addEventListener("animationend",g)))},[c]),Rt.createElement(Rt.Fragment,null,o)}}function TS(n,e){return{content:iO(n.content,n.props),containerId:n.props.containerId,id:n.props.toastId,theme:n.props.theme,type:n.props.type,data:n.props.data||{},isLoading:n.props.isLoading,icon:n.props.icon,reason:n.removalReason,status:e}}function iO(n,e,t=!1){return fe.isValidElement(n)&&!Xl(n.type)?fe.cloneElement(n,{closeToast:e.closeToast,toastProps:e,data:e.data,isPaused:t}):us(n)?n({closeToast:e.closeToast,toastProps:e,data:e.data,isPaused:t}):n}function fq({closeToast:n,theme:e,ariaLabel:t="close"}){return Rt.createElement("button",{className:`Toastify__close-button Toastify__close-button--${e}`,type:"button",onClick:r=>{r.stopPropagation(),n(!0)},"aria-label":t},Rt.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Rt.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function pq({delay:n,isRunning:e,closeToast:t,type:r="default",hide:i,className:o,controlledProgress:a,progress:s,rtl:u,isIn:l,theme:c}){let h=i||a&&s===0,d={animationDuration:`${n}ms`,animationPlayState:e?"running":"paused"};a&&(d.transform=`scaleX(${s})`);let f=Pl("Toastify__progress-bar",a?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${c}`,`Toastify__progress-bar--${r}`,{"Toastify__progress-bar--rtl":u}),p=us(o)?o({rtl:u,type:r,defaultClassName:f}):Pl(f,o),m={[a&&s>=1?"onTransitionEnd":"onAnimationEnd"]:a&&s<1?null:()=>{l&&t()}};return Rt.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":h},Rt.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${c} Toastify__progress-bar--${r}`}),Rt.createElement("div",{role:"progressbar","aria-hidden":h?"true":"false","aria-label":"notification timer",className:p,style:d,...m}))}var mq=1,oO=()=>`${mq++}`;function vq(n,e,t){let r=1,i=0,o=[],a=[],s=e,u=new Map,l=new Set,c=x=>(l.add(x),()=>l.delete(x)),h=()=>{a=Array.from(u.values()),l.forEach(x=>x())},d=({containerId:x,toastId:_,updateId:b})=>{let C=x?x!==n:n!==1,k=u.has(_)&&b==null;return C||k},f=(x,_)=>{u.forEach(b=>{var C;(_==null||_===b.props.toastId)&&((C=b.toggle)==null||C.call(b,x))})},p=x=>{var _,b;(b=(_=x.props)==null?void 0:_.onClose)==null||b.call(_,x.removalReason),x.isActive=!1},m=x=>{if(x==null)u.forEach(p);else{let _=u.get(x);_&&p(_)}h()},g=()=>{i-=o.length,o=[]},y=x=>{var _,b;let{toastId:C,updateId:k}=x.props,T=k==null;x.staleId&&u.delete(x.staleId),x.isActive=!0,u.set(C,x),h(),t(TS(x,T?"added":"updated")),T&&((b=(_=x.props).onOpen)==null||b.call(_))};return{id:n,props:s,observe:c,toggle:f,removeToast:m,toasts:u,clearQueue:g,buildToast:(x,_)=>{if(d(_))return;let{toastId:b,updateId:C,data:k,staleId:T,delay:E}=_,I=C==null;I&&i++;let R={...s,style:s.toastStyle,key:r++,...Object.fromEntries(Object.entries(_).filter(([O,M])=>M!=null)),toastId:b,updateId:C,data:k,isIn:!1,className:zw(_.className||s.toastClassName),progressClassName:zw(_.progressClassName||s.progressClassName),autoClose:_.isLoading?!1:cq(_.autoClose,s.autoClose),closeToast(O){u.get(b).removalReason=O,m(b)},deleteToast(){let O=u.get(b);if(O!=null){if(t(TS(O,"removed")),u.delete(b),i--,i<0&&(i=0),o.length>0){y(o.shift());return}h()}}};R.closeButton=s.closeButton,_.closeButton===!1||$w(_.closeButton)?R.closeButton=_.closeButton:_.closeButton===!0&&(R.closeButton=$w(s.closeButton)?s.closeButton:!0);let N={content:x,props:R,staleId:T};s.limit&&s.limit>0&&i>s.limit&&I?o.push(N):jp(E)?setTimeout(()=>{y(N)},E):y(N)},setProps(x){s=x},setToggle:(x,_)=>{let b=u.get(x);b&&(b.toggle=_)},isToastActive:x=>{var _;return(_=u.get(x))==null?void 0:_.isActive},getSnapshot:()=>a}}var Wr=new Map,yp=[],Hw=new Set,gq=n=>Hw.forEach(e=>e(n)),aO=()=>Wr.size>0;function yq(){yp.forEach(n=>uO(n.content,n.options)),yp=[]}var xq=(n,{containerId:e})=>{var t;return(t=Wr.get(e||1))==null?void 0:t.toasts.get(n)};function sO(n,e){var t;if(e)return!!((t=Wr.get(e))!=null&&t.isToastActive(n));let r=!1;return Wr.forEach(i=>{i.isToastActive(n)&&(r=!0)}),r}function wq(n){if(!aO()){yp=yp.filter(e=>n!=null&&e.options.toastId!==n);return}if(n==null||lq(n))Wr.forEach(e=>{e.removeToast(n)});else if(n&&("containerId"in n||"id"in n)){let e=Wr.get(n.containerId);e?e.removeToast(n.id):Wr.forEach(t=>{t.removeToast(n.id)})}}var _q=(n={})=>{Wr.forEach(e=>{e.props.limit&&(!n.containerId||e.id===n.containerId)&&e.clearQueue()})};function uO(n,e){$w(n)&&(aO()||yp.push({content:n,options:e}),Wr.forEach(t=>{t.buildToast(n,e)}))}function bq(n){var e;(e=Wr.get(n.containerId||1))==null||e.setToggle(n.id,n.fn)}function lO(n,e){Wr.forEach(t=>{(e==null||!(e!=null&&e.containerId)||(e==null?void 0:e.containerId)===t.id)&&t.toggle(n,e==null?void 0:e.id)})}function Eq(n){let e=n.containerId||1;return{subscribe(t){let r=vq(e,n,gq);Wr.set(e,r);let i=r.observe(t);return yq(),()=>{i(),Wr.delete(e)}},setProps(t){var r;(r=Wr.get(e))==null||r.setProps(t)},getSnapshot(){var t;return(t=Wr.get(e))==null?void 0:t.getSnapshot()}}}function Cq(n){return Hw.add(n),()=>{Hw.delete(n)}}function Tq(n){return n&&(Xl(n.toastId)||jp(n.toastId))?n.toastId:oO()}function zp(n,e){return uO(n,e),e.toastId}function l0(n,e){return{...e,type:e&&e.type||n,toastId:Tq(e)}}function c0(n){return(e,t)=>zp(e,l0(n,t))}function At(n,e){return zp(n,l0("default",e))}At.loading=(n,e)=>zp(n,l0("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...e}));function Iq(n,{pending:e,error:t,success:r},i){let o;e&&(o=Xl(e)?At.loading(e,i):At.loading(e.render,{...i,...e}));let a={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},s=(l,c,h)=>{if(c==null){At.dismiss(o);return}let d={type:l,...a,...i,data:h},f=Xl(c)?{render:c}:c;return o?At.update(o,{...d,...f}):At(f.render,{...d,...f}),h},u=us(n)?n():n;return u.then(l=>s("success",r,l)).catch(l=>s("error",t,l)),u}At.promise=Iq;At.success=c0("success");At.info=c0("info");At.error=c0("error");At.warning=c0("warning");At.warn=At.warning;At.dark=(n,e)=>zp(n,l0("default",{theme:"dark",...e}));function Sq(n){wq(n)}At.dismiss=Sq;At.clearWaitingQueue=_q;At.isActive=sO;At.update=(n,e={})=>{let t=xq(n,e);if(t){let{props:r,content:i}=t,o={delay:100,...r,...e,toastId:e.toastId||n,updateId:oO()};o.toastId!==n&&(o.staleId=n);let a=o.render||i;delete o.render,zp(a,o)}};At.done=n=>{At.update(n,{progress:1})};At.onChange=Cq;At.play=n=>lO(!0,n);At.pause=n=>lO(!1,n);function Rq(n){var e;let{subscribe:t,getSnapshot:r,setProps:i}=fe.useRef(Eq(n)).current;i(n);let o=(e=fe.useSyncExternalStore(t,r,r))==null?void 0:e.slice();function a(s){if(!o)return[];let u=new Map;return n.newestOnTop&&o.reverse(),o.forEach(l=>{let{position:c}=l.props;u.has(c)||u.set(c,[]),u.get(c).push(l)}),Array.from(u,l=>s(l[0],l[1]))}return{getToastToRender:a,isToastActive:sO,count:o==null?void 0:o.length}}function kq(n){let[e,t]=fe.useState(!1),[r,i]=fe.useState(!1),o=fe.useRef(null),a=fe.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:s,pauseOnHover:u,closeToast:l,onClick:c,closeOnClick:h}=n;bq({id:n.toastId,containerId:n.containerId,fn:t}),fe.useEffect(()=>{if(n.pauseOnFocusLoss)return d(),()=>{f()}},[n.pauseOnFocusLoss]);function d(){document.hasFocus()||y(),window.addEventListener("focus",g),window.addEventListener("blur",y)}function f(){window.removeEventListener("focus",g),window.removeEventListener("blur",y)}function p(T){if(n.draggable===!0||n.draggable===T.pointerType){x();let E=o.current;a.canCloseOnClick=!0,a.canDrag=!0,E.style.transition="none",n.draggableDirection==="x"?(a.start=T.clientX,a.removalDistance=E.offsetWidth*(n.draggablePercent/100)):(a.start=T.clientY,a.removalDistance=E.offsetHeight*(n.draggablePercent===80?n.draggablePercent*1.5:n.draggablePercent)/100)}}function m(T){let{top:E,bottom:I,left:R,right:N}=o.current.getBoundingClientRect();T.nativeEvent.type!=="touchend"&&n.pauseOnHover&&T.clientX>=R&&T.clientX<=N&&T.clientY>=E&&T.clientY<=I?y():g()}function g(){t(!0)}function y(){t(!1)}function x(){a.didMove=!1,document.addEventListener("pointermove",b),document.addEventListener("pointerup",C)}function _(){document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",C)}function b(T){let E=o.current;if(a.canDrag&&E){a.didMove=!0,e&&y(),n.draggableDirection==="x"?a.delta=T.clientX-a.start:a.delta=T.clientY-a.start,a.start!==T.clientX&&(a.canCloseOnClick=!1);let I=n.draggableDirection==="x"?`${a.delta}px, var(--y)`:`0, calc(${a.delta}px + var(--y))`;E.style.transform=`translate3d(${I},0)`,E.style.opacity=`${1-Math.abs(a.delta/a.removalDistance)}`}}function C(){_();let T=o.current;if(a.canDrag&&a.didMove&&T){if(a.canDrag=!1,Math.abs(a.delta)>a.removalDistance){i(!0),n.closeToast(!0),n.collapseAll();return}T.style.transition="transform 0.2s, opacity 0.2s",T.style.removeProperty("transform"),T.style.removeProperty("opacity")}}let k={onPointerDown:p,onPointerUp:m};return s&&u&&(k.onMouseEnter=y,n.stacked||(k.onMouseLeave=g)),h&&(k.onClick=T=>{c&&c(T),a.canCloseOnClick&&l(!0)}),{playToast:g,pauseToast:y,isRunning:e,preventExitTransition:r,toastRef:o,eventHandlers:k}}var Aq=typeof window<"u"?fe.useLayoutEffect:fe.useEffect,h0=({theme:n,type:e,isLoading:t,...r})=>Rt.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:n==="colored"?"currentColor":`var(--toastify-icon-color-${e})`,...r});function Nq(n){return Rt.createElement(h0,{...n},Rt.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function Dq(n){return Rt.createElement(h0,{...n},Rt.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function Pq(n){return Rt.createElement(h0,{...n},Rt.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function Oq(n){return Rt.createElement(h0,{...n},Rt.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function Mq(){return Rt.createElement("div",{className:"Toastify__spinner"})}var Gw={info:Dq,warning:Nq,success:Pq,error:Oq,spinner:Mq},Fq=n=>n in Gw;function Lq({theme:n,type:e,isLoading:t,icon:r}){let i=null,o={theme:n,type:e};return r===!1||(us(r)?i=r({...o,isLoading:t}):fe.isValidElement(r)?i=fe.cloneElement(r,o):t?i=Gw.spinner():Fq(e)&&(i=Gw[e](o))),i}var Bq=n=>{let{isRunning:e,preventExitTransition:t,toastRef:r,eventHandlers:i,playToast:o}=kq(n),{closeButton:a,children:s,autoClose:u,onClick:l,type:c,hideProgressBar:h,closeToast:d,transition:f,position:p,className:m,style:g,progressClassName:y,updateId:x,role:_,progress:b,rtl:C,toastId:k,deleteToast:T,isIn:E,isLoading:I,closeOnClick:R,theme:N,ariaLabel:O}=n,M=Pl("Toastify__toast",`Toastify__toast-theme--${N}`,`Toastify__toast--${c}`,{"Toastify__toast--rtl":C},{"Toastify__toast--close-on-click":R}),q=us(m)?m({rtl:C,position:p,type:c,defaultClassName:M}):Pl(M,m),J=Lq(n),ee=!!b||!u,Q={closeToast:d,type:c,theme:N},$=null;return a===!1||(us(a)?$=a(Q):fe.isValidElement(a)?$=fe.cloneElement(a,Q):$=fq(Q)),Rt.createElement(f,{isIn:E,done:T,position:p,preventExitTransition:t,nodeRef:r,playToast:o},Rt.createElement("div",{id:k,tabIndex:0,onClick:l,"data-in":E,className:q,...i,style:g,ref:r,...E&&{role:_,"aria-label":O}},J!=null&&Rt.createElement("div",{className:Pl("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!I})},J),iO(s,n,!e),$,!n.customProgressBar&&Rt.createElement(pq,{...x&&!ee?{key:`p-${x}`}:{},rtl:C,theme:N,delay:u,isRunning:e,isIn:E,closeToast:d,hide:h,type:c,className:y,controlledProgress:ee,progress:b||0})))},Vq=(n,e=!1)=>({enter:`Toastify--animate Toastify__${n}-enter`,exit:`Toastify--animate Toastify__${n}-exit`,appendPosition:e}),Uq=dq(Vq("bounce",!0)),Wq={position:"top-right",transition:Uq,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:n=>n.altKey&&n.code==="KeyT"};function cO(n){let e={...Wq,...n},t=n.stacked,[r,i]=fe.useState(!0),o=fe.useRef(null),{getToastToRender:a,isToastActive:s,count:u}=Rq(e),{className:l,style:c,rtl:h,containerId:d,hotKeys:f}=e;function p(g){let y=Pl("Toastify__toast-container",`Toastify__toast-container--${g}`,{"Toastify__toast-container--rtl":h});return us(l)?l({position:g,rtl:h,defaultClassName:y}):Pl(y,zw(l))}function m(){t&&(i(!0),At.play())}return Aq(()=>{var g;if(t){let y=o.current.querySelectorAll('[data-in="true"]'),x=12,_=(g=e.position)==null?void 0:g.includes("top"),b=0,C=0;Array.from(y).reverse().forEach((k,T)=>{let E=k;E.classList.add("Toastify__toast--stacked"),T>0&&(E.dataset.collapsed=`${r}`),E.dataset.pos||(E.dataset.pos=_?"top":"bot");let I=b*(r?.2:1)+(r?0:x*T);E.style.setProperty("--y",`${_?I:I*-1}px`),E.style.setProperty("--g",`${x}`),E.style.setProperty("--s",`${1-(r?C:0)}`),b+=E.offsetHeight,C+=.025})}},[r,u,t]),fe.useEffect(()=>{function g(y){var x;let _=o.current;f(y)&&((x=_.querySelector('[tabIndex="0"]'))==null||x.focus(),i(!1),At.pause()),y.key==="Escape"&&(document.activeElement===_||_!=null&&_.contains(document.activeElement))&&(i(!0),At.play())}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[f]),Rt.createElement("section",{ref:o,className:"Toastify",id:d,onMouseEnter:()=>{t&&(i(!1),At.pause())},onMouseLeave:m,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":e["aria-label"]},a((g,y)=>{let x=y.length?{...c}:{...c,pointerEvents:"none"};return Rt.createElement("div",{tabIndex:-1,className:p(g),"data-stacked":t,style:x,key:`c-${g}`},y.map(({content:_,props:b})=>Rt.createElement(Bq,{...b,stacked:t,collapseAll:m,isIn:s(b.toastId,b.containerId),key:`t-${b.key}`},_)))}))}function jq(){function n(){const e=new Ua;q$(Yh,e).then(async t=>{console.log(t);const r=t.user;t.user&&(await nO(wE(IE,"Users",r.uid),{email:r.email,firstName:r.displayName,photo:r.photoURL,lastName:""}),At.success("User logged in Successfully",{position:"top-center"}),window.location.href="/profile")})}return P.jsxs("div",{children:[P.jsx("p",{className:"continue-p",children:"--Or continue with--"}),P.jsx("div",{style:{display:"flex",justifyContent:"center",cursor:"pointer"},onClick:n,children:P.jsx("img",{src:"./google.png",width:"60%"})})]})}function IS(){const[n,e]=fe.useState(""),[t,r]=fe.useState(""),i=async o=>{o.preventDefault();try{await E$(Yh,n,t),console.log("User logged in Successfully"),window.location.href="/profile",At.success("User logged in Successfully",{position:"top-center"})}catch(a){console.log(a.message),At.error(a.message,{position:"bottom-center"})}};return P.jsx("form",{onSubmit:i,children:P.jsx("div",{className:"App",children:P.jsx("div",{className:"auth-wrapper",children:P.jsxs("div",{className:"auth-inner",children:[P.jsx("h3",{children:"Login"}),P.jsxs("div",{className:"mb-3",children:[P.jsx("label",{children:"Email address"}),P.jsx("input",{type:"email",className:"form-control",placeholder:"Enter email",value:n,onChange:o=>e(o.target.value)})]}),P.jsxs("div",{className:"mb-3",children:[P.jsx("label",{children:"Password"}),P.jsx("input",{type:"password",className:"form-control",placeholder:"Enter password",value:t,onChange:o=>r(o.target.value)})]}),P.jsx("div",{className:"d-grid",children:P.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})}),P.jsxs("p",{className:"forgot-password text-right",children:["New user ",P.jsx("a",{href:"/register",children:"Register Here"})]}),P.jsx(jq,{})]})})})})}function zq(){const[n,e]=fe.useState(""),[t,r]=fe.useState(""),[i,o]=fe.useState(""),[a,s]=fe.useState(""),u=async l=>{l.preventDefault();try{const h=(await b$(Yh,n,t)).user;console.log(h),await T$(h,{displayName:`${i} ${a}`}),h&&(await nO(wE(IE,"Users",h.uid),{email:h.email,firstName:i,lastName:a,photo:h.photoURL||""}),console.log("User Registered Successfully!!"),At.success("User Registered Successfully!!",{position:"top-center"}))}catch(c){console.log(c.message),At.error(c.message,{position:"bottom-center"})}};return P.jsxs(P.Fragment,{children:[P.jsx("form",{onSubmit:u,children:P.jsx("div",{className:"App",children:P.jsx("div",{className:"auth-wrapper",children:P.jsxs("div",{className:"auth-inner",children:[P.jsx("h3",{children:"Sign Up"}),P.jsxs("div",{className:"mb-3",children:[P.jsx("label",{children:"First name"}),P.jsx("input",{type:"text",className:"form-control",placeholder:"First name",onChange:l=>o(l.target.value),required:!0})]}),P.jsxs("div",{className:"mb-3",children:[P.jsx("label",{children:"Last name"}),P.jsx("input",{type:"text",className:"form-control",placeholder:"Last name",onChange:l=>s(l.target.value)})]}),P.jsxs("div",{className:"mb-3",children:[P.jsx("label",{children:"Email address"}),P.jsx("input",{type:"email",className:"form-control",placeholder:"Enter email",onChange:l=>e(l.target.value),required:!0})]}),P.jsxs("div",{className:"mb-3",children:[P.jsx("label",{children:"Password"}),P.jsx("input",{type:"password",className:"form-control",placeholder:"Enter password",onChange:l=>r(l.target.value),required:!0})]}),P.jsx("div",{className:"d-grid",children:P.jsx("button",{type:"submit",className:"btn btn-primary",children:"Sign Up"})}),P.jsxs("p",{className:"forgot-password text-right",children:["Already registered? ",P.jsx("a",{href:"/login",children:"Login"})]})]})})})}),P.jsx(cO,{})," "]})}function $q(){const n=Np(),[e,t]=fe.useState(null),r=async()=>{Yh.onAuthStateChanged(async o=>{if(o){console.log(o);const a=wE(IE,"Users",o.uid),s=await nq(a);s.exists()?(t(s.data()),console.log(s.data())):console.log("User is not logged in")}})};fe.useEffect(()=>{r();const o=setTimeout(()=>{n("/home")},8e3);return()=>clearTimeout(o)},[n]);async function i(){try{await Yh.signOut(),window.location.href="/login",console.log("User logged out successfully!")}catch(o){console.error("Error logging out:",o.message)}}return P.jsx("div",{className:"App",children:P.jsx("div",{className:"auth-wrapper",children:P.jsx("div",{className:"auth-inner",children:P.jsx("div",{children:e?P.jsxs(P.Fragment,{children:[P.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.photo?P.jsx("img",{src:e.photo,width:"50%",style:{borderRadius:"50%"},alt:"User"}):P.jsx("div",{style:{width:"50%",textAlign:"center"},children:"No profile image"})}),P.jsx("br",{}),P.jsxs("h3",{children:["Welcome ",e.firstName," 🙏🙏"]}),P.jsxs("div",{children:[P.jsxs("p",{children:["Email: ",e.email]}),P.jsxs("p",{children:["User: ",e.firstName]})]}),P.jsxs("div",{className:"Website",children:[P.jsx("button",{className:"btn btn-primary",onClick:()=>n("/home"),children:"Go to Codetracker"}),P.jsx("button",{className:"btn btn-primary",onClick:i,children:"Logout"})]}),P.jsxs("div",{children:[P.jsx("br",{}),P.jsx("p",{children:"You will be redirected to the home page shortly..."})]})]}):P.jsx("p",{children:"Loading..."})})})})})}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var qw=function(n,e){return qw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},qw(n,e)};function ht(n,e){qw(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Za=function(){return Za=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Za.apply(this,arguments)};function Je(n,e,t,r){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(c){try{l(r.next(c))}catch(h){a(h)}}function u(c){try{l(r.throw(c))}catch(h){a(h)}}function l(c){c.done?o(c.value):i(c.value).then(s,u)}l((r=r.apply(n,[])).next())})}function Ze(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hO=function(n,e){return(hO=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function fs(n,e){function t(){this.constructor=n}hO(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ht(n,e,t,r){return new(t||(t=Promise))(function(i,o){function a(l){try{u(r.next(l))}catch(c){o(c)}}function s(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(a,s)}u((r=r.apply(n,[])).next())})}function Gt(n,e){var t,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(h){c=[6,h],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var _l={},F1={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Hq(n,e){_l[n]=e}function pa(n){n in _l||(_l[n]=Gq(n));var e=_l[n];return e.isContextLost()?(delete _l[n],pa(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),_l[n])}function Gq(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return e.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete _l[n]},!1),n===1?e.getContext("webgl",F1)||e.getContext("experimental-webgl",F1):e.getContext("webgl2",F1)}function qq(){var n=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}function Kw(n,e,t){return Math.max(n,Math.min(e,t))}function Jh(n){return n%2==0?n:n+1}function Kq(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function Xq(n,e){var t=Math.random();return e*t+(1-t)*n}function H(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function qt(n,e,t){t===void 0&&(t=""),H($r(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function wd(n){H(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Zh(n,e){if(e===void 0&&(e=[]),e==null&&(e=[]),Array.isArray(n)||ls(n))for(var t=0;t<n.length;++t)Zh(n[t],e);else e.push(n);return e}function ze(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function $r(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function eo(n){return n%1==0}function Qq(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function SS(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Ch(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function RS(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,a=function(){if(n())r();else{var s=e(++o);t!=null&&o>=t?i():setTimeout(a,s)}};a()})}function Yq(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function yr(n,e){var t=e.length;return H((n=n==null?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),H(n.every(function(r){return eo(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function sc(n,e){for(var t=[],r=[],i=e==null?null:yr(e,n).sort(),o=0,a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Xw(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function Xg(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function Jq(n,e,t){if(e==="float32")for(var r=0;r<n.length;r++){var i=n[r];if(isNaN(i)||!isFinite(i))throw Error("The result of the '"+t+"' is "+i+".")}}function Zq(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function e9(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function ls(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function dO(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function t9(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=2*t.length}),e}function fO(n){return typeof n=="string"||n instanceof String}function n9(n){return typeof n=="boolean"}function r9(n){return typeof n=="number"}function $p(n){return Array.isArray(n)?$p(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":r9(n)?"float32":fO(n)?"string":n9(n)?"bool":"float32"}function Qw(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Yw(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function uc(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function pO(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Zh(n)),t&&Zq(n,e),i9(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function mO(n,e,t){var r=new Array;if(e.length===1)for(var i=e[0],o=0;o<i;o++)r[o]=t[n+o];else{i=e[0];var a=e.slice(1),s=a.reduce(function(u,l){return u*l});for(o=0;o<i;o++)r[o]=mO(n+o*s,a,t)}return r}function kS(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return mO(0,n,e)}function i9(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function vO(n,e){for(var t=Hp(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Hp(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Qg(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function gO(n){n.forEach(function(e){H(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}var o9=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new a9)}return n.prototype.profileKernel=function(e,t){var r,i=this,o=this.backendTimer.time(function(){r=t()});return(Array.isArray(r)?r:[r]).forEach(function(a){var s=a.dataSync();Jq(s,a.dtype,e),o.then(function(u){var l="";u.getExtraProfileInfo!=null&&(l=u.getExtraProfileInfo()),i.logger.logKernelProfile(e,a,s,u.kernelMs,l)})}),r},n}(),a9=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o){var a=Ch(i+"ms",9),s=Ch(e,25),u=t.rank,l=t.size,c=Ch(t.shape.toString(),14);console.log("%c"+s+"	%c"+a+"	%c"+u+"D "+c+"	%c"+l+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},n}(),AS=20,lf=3,L1=7;function s9(n,e,t,r){var i=uc(e),o=u9(n,e,t,i),a=e.length,s=eg(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function u9(n,e,t,r){var i=ze(e),o=r[r.length-1],a=new Array(o).fill(0),s=e.length,u=t==="complex64"?Cf(n):n;if(s>1)for(var l=0;l<i/o;l++)for(var c=l*o,h=0;h<o;h++)a[h]=Math.max(a[h],Ef(u[c+h],0,t).length);return a}function Ef(n,e,t){return Ch(Array.isArray(n)?parseFloat(n[0].toFixed(L1))+" + "+parseFloat(n[1].toFixed(L1))+"j":fO(n)?"'"+n+"'":t==="bool"?yO(n):parseFloat(n.toFixed(L1)).toString(),e)}function yO(n){return n===0?"false":"true"}function eg(n,e,t,r,i,o){o===void 0&&(o=!0);var a=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0)return t==="complex64"?[Ef(Cf(n)[0],0,t)]:t==="bool"?[yO(n[0])]:[n[0].toString()];if(u===1){if(s>AS){var l=lf*a,c=Array.from(n.slice(0,l)),h=Array.from(n.slice(s-lf*a,s));return t==="complex64"&&(c=Cf(c),h=Cf(h)),["["+c.map(function(C,k){return Ef(C,i[k],t)}).join(", ")+", ..., "+h.map(function(C,k){return Ef(C,i[s-lf+k],t)}).join(", ")+"]"]}return["["+(t==="complex64"?Cf(n):Array.from(n)).map(function(C,k){return Ef(C,i[k],t)}).join(", ")+"]"]}var d=e.slice(1),f=r.slice(1),p=r[0]*a,m=[];if(s>AS){for(var g=0;g<lf;g++){var y=(x=g*p)+p;m.push.apply(m,eg(n.slice(x,y),d,t,f,i,!1))}for(m.push("..."),g=s-lf;g<s;g++)y=(x=g*p)+p,m.push.apply(m,eg(n.slice(x,y),d,t,f,i,g===s-1))}else for(g=0;g<s;g++){var x;y=(x=g*p)+p,m.push.apply(m,eg(n.slice(x,y),d,t,f,i,g===s-1))}var _=u===2?",":"";for(m[0]="["+m[0]+_,g=1;g<m.length-1;g++)m[g]=" "+m[g]+_;var b=`,
`;for(g=2;g<u;g++)b+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":b),m}function Cf(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var xp=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=ze(e),r!=null){var o=r.length;H(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Xg(t,this.size),this.strides=uc(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),H(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Te.make(this.shape,{values:this.values},this.dtype)},n}(),Ui=null,oe=null,xO=null;function l9(n){Ui=n}function c9(n){oe=n}function h9(n){xO=n}var Te=function(){function n(e,t,r,i,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ze(e),this.strides=uc(e),this.dataId=i??{},this.id=Ui().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Ui().registerTensor(this,o),r!=null&&Ui().write(this.dataId,r)}return n.make=function(e,t,r,i){return new n(e,r,t.values,t.dataId,i)},n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),H(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),oe.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Ht(this,void 0,void 0,function(){var e;return Gt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,oe.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return oe.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Ht(this,void 0,void 0,function(){var e;return Gt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,kS(this.shape,e)]}})})},n.prototype.arraySync=function(){return kS(this.shape,this.dataSync())},n.prototype.data=function(){return Ht(this,void 0,void 0,function(){return Gt(this,function(e){return this.throwIfDisposed(),[2,Ui().read(this.dataId)]})})},n.prototype.dataSync=function(){return this.throwIfDisposed(),Ui().readSync(this.dataId)},n.prototype.dispose=function(){this.isDisposed||(Ui().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),oe.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),oe.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),oe.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),oe.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),oe.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),oe.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),oe.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),s9(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),oe.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),oe.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),oe.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),oe.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),oe.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),oe.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),oe.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),oe.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),oe.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),oe.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),oe.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),oe.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),xO("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.batchNorm=function(e,t,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),oe.batchNorm(this,e,t,r,i,o)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),oe.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),oe.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),oe.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),oe.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),oe.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),oe.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),oe.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),oe.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),oe.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),oe.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),oe.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),oe.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),oe.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),oe.div(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),oe.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),oe.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),oe.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),oe.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),oe.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),oe.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),oe.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),oe.modStrict(this,e)},n.prototype.squaredDifference=function(e){return this.throwIfDisposed(),oe.squaredDifference(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),oe.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),oe.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),oe.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),oe.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),oe.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),oe.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),oe.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),oe.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),oe.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),oe.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),oe.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),oe.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),oe.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),oe.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),oe.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),oe.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),oe.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),oe.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),oe.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),oe.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),oe.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),oe.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),oe.sign(this)},n.prototype.exp=function(){return this.throwIfDisposed(),oe.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),oe.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),oe.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),oe.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),oe.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),oe.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),oe.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),oe.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),oe.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),oe.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),oe.relu(this)},n.prototype.elu=function(){return this.throwIfDisposed(),oe.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),oe.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),oe.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),oe.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),oe.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),oe.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),oe.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),oe.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),oe.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),oe.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),oe.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),oe.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),oe.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),oe.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),oe.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),oe.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),oe.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),oe.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),oe.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),oe.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),oe.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),oe.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),oe.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),oe.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),oe.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),oe.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),oe.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),oe.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),oe.conv1d(this,e,t,r,i,o,a)},n.prototype.conv2d=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),oe.conv2d(this,e,t,r,i,o,a)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),oe.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),oe.depthwiseConv2d(this,e,t,r,i,o,a)},n.prototype.separableConv2d=function(e,t,r,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),oe.separableConv2d(this,e,t,r,i,o,a)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),oe.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),oe.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),oe.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),oe.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Gp.variable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),oe.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),oe.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),oe.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),oe.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),oe.stridedSlice(this,e,t,r,i,o,a,s,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),oe.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),oe.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),oe.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),oe.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),oe.spectral.irfft(this)},n}();Object.defineProperty(Te,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var Gp=function(n){function e(t,r,i){r===void 0&&(r=!0);var o=n.call(this,t.shape,t.dtype,null,t.dataId)||this;o.trainable=r,o.name=i,o.name==null&&(o.name=Ui().nextVariableId().toString());try{Ui().registerVariable(o)}catch(a){throw Ui().disposeTensor(o),a}return o}return fs(e,n),e.variable=function(t,r,i,o){return r===void 0&&(r=!0),o!=null&&o!==t.dtype&&(t=t.asType(o)),new e(t,r,i)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!$r(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Ui().disposeTensor(this),this.dataId=t.dataId,Ui().registerTensor(this)},e}(Te);Object.defineProperty(Gp,Symbol.hasInstance,{value:function(n){return n instanceof Te&&n.assign!=null&&n.assign instanceof Function}});var NS,Jw,Zw,e_,t_;Gp.variable;function d9(n,e,t){for(var r={},i={},o=0;o<e.length;o++)r[e[o].id]=!0;for(o=0;o<n.length;o++){var a=(p=n[o]).inputs;for(var s in a){for(var u=a[s],l=!1,c=0;c<e.length;c++)if(r[u.id]){p.outputs.forEach(function(x){return r[x.id]=!0}),l=!0,i[p.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;var d={};for(o=n.length-1;o>=0;o--)for(a=(p=n[o]).inputs,c=0;c<p.outputs.length;c++)if(h[p.outputs[c].id]){for(var s in a)h[a[s].id]=!0,d[p.id]=!0;break}var f=[];for(o=0;o<n.length;o++){var p;if(i[(p=n[o]).id]&&d[p.id]){var m={};for(var s in p.inputs){var g=p.inputs[s];r[g.id]&&(m[s]=g)}var y=Object.assign({},p);y.inputs=m,y.outputs=p.outputs,f.push(y)}}return f}function f9(n,e,t){for(var r=function(o){var a=e[o],s=[];if(a.outputs.forEach(function(h){var d=n[h.id];if(d!=null)s.push(d);else{var f=Te.make(h.shape,{values:Hp(h.size,h.dtype)},h.dtype);s.push(f)}}),a.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+a.name+".");var u=a.gradient(a.outputs.length===1?s[0]:s),l=function(h){if(!(h in u))throw new Error("Cannot backprop through input "+h+". Available gradients found: "+Object.keys(u)+".");var d=t(function(){return u[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op "+a.name+". The gradient of input "+h+" must have 'float32' dtype, but has '"+d.dtype+"'");var f=a.inputs[h];if(!$r(d.shape,f.shape))throw new Error("Error in gradient for op "+a.name+". The gradient of input '"+h+"' has shape '"+d.shape+"', which does not match the shape of the input '"+f.shape+"'");if(n[f.id]==null)n[f.id]=d;else{var p=n[f.id];n[f.id]=p.add(d),p.dispose()}};for(var c in a.inputs)l(c)},i=e.length-1;i>=0;i--)r(i)}(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(NS||(NS={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(Jw||(Jw={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(Zw||(Zw={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(e_||(e_={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(t_||(t_={}));var p9={float32:e_,int32:Jw,bool:Zw,complex64:t_};function nr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return p9[n][e]}function B1(n){return nr(n,"int32")}function Kn(n,e){if(n.dtype===e.dtype)return[n,e];var t=nr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function m9(n,e){H(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function wO(n){var e=[];return _O(n,e,new Set),e}function _O(n,e,t){if(n!=null){if(n instanceof Te)e.push(n);else if(v9(n)){var r=n;for(var i in r){var o=r[i];t.has(o)||(t.add(o),_O(o,e,t))}}}}function v9(n){return Array.isArray(n)||typeof n=="object"}var It,g9=function(){function n(e,t,r){this.backend=e,this.safeMode=t,this.debugMode=r,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new o9(e),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.moveData=function(e){this.write(e,this.readSync(e))},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=Te.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(r){return[r.toFloat()]}),t},n.prototype.runKernel=function(e,t,r){var i,o=this,a=[],s=this.isTapeOn(),u=this.activeScope!=null?this.activeScope.name:"",l=function(f){s&&(a=f.map(function(p){return o.keep(o.clone(p))}))},c=this.numBytes,h=this.numTensors;if(this.scopedRun(function(){return o.kernelDepth++},function(){return o.kernelDepth--},function(){i=o.debugMode()?o.profiler.profileKernel(u,function(){return e(o.backend,l)}):e(o.backend,l)}),s){var d={id:this.nextTapeNodeId++,name:u,inputs:t,outputs:Array.isArray(i)?i:[i],saved:a};r!=null&&(d.gradient=function(f){return r(f,a)}),this.activeTape.push(d)}return this.profiling&&this.activeProfile.kernels.push({name:u,bytesAdded:this.numBytes-c,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-h,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(t).map(function(f){return t[f].shape}),outputShape:Array.isArray(i)?i.map(function(f){return f.shape}):i.shape}),i},n.prototype.registerTensor=function(e,t){var r=this.tensorInfo.has(e.dataId)?this.tensorInfo.get(e.dataId).refCount:0;if(this.numTensors++,e.dtype==="string"&&this.numStringTensors++,r===0){this.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*dO(e.dtype)),this.tensorInfo.set(e.dataId,{backend:t??this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.numBytes+=i,t!=null?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.tensorInfo.get(e.dataId).refCount++,e instanceof Gp||this.track(e)},n.prototype.registerVariable=function(e){if(this.registeredVariables[e.name]!=null)throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},n.prototype.disposeTensor=function(e){if(this.tensorInfo.has(e.dataId)){this.numTensors--,e.dtype==="string"&&this.numStringTensors--;var t=this.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.numBytes-=t.bytes),this.numDataBuffers--,t.backend.disposeData(e.dataId),this.tensorInfo.delete(e.dataId)):this.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.registeredVariables){var t=this.registeredVariables[e];this.disposeTensor(t),delete this.registeredVariables[e]}},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,this.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Ht(this,void 0,void 0,function(){var t,r;return Gt(this,function(i){return this.profiling=!0,t=this.numBytes,r=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=e(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-t,this.activeProfile.newTensors=this.numTensors-r,[2,this.activeProfile]})})},n.prototype.isTapeOn=function(){return this.gradientDepth>0&&this.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r){var i={};e.forEach(function(a,s){i[s]=a});var o={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:i,outputs:[t],gradient:function(a){var s={};return r(a).forEach(function(u,l){s[l]=function(){return u}}),s}};this.activeTape.push(o)},n.prototype.keep=function(e){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return e.kept=!0,e},n.prototype.startTape=function(){this.gradientDepth===0&&(this.activeTape=[]),this.gradientDepth++},n.prototype.endTape=function(){this.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.nextScopeId++};e&&(t.name=e),this.scopeStack.push(t),this.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=wO(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.activeScope.track.length;o++){var a=this.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.scopeStack.pop();this.activeScope=this.scopeStack.length===0?null:this.scopeStack[this.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),H(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});H(a instanceof Te,function(){return"The result y returned by f() must be a tensor."});var s=d9(this.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[a.id]=r??y9(a.shape),f9(u,s,function(c){return o.tidy(c)});var l=t.map(function(c){return u[c.id]});return o.gradientDepth===0&&(o.activeTape.forEach(function(c){for(var h in c.saved)c.saved[h].dispose()}),o.activeTape=null),{value:a,grads:l}})},n.prototype.customGrad=function(e){var t=this;return H(Qw(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];H(i.every(function(s){return s instanceof Te}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),t.runKernel(function(s,u){return H((r=e.apply(void 0,i.concat([u]))).value instanceof Te,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),H(Qw(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];H(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),H(c.every(function(d){return d instanceof Te}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(d,f){h[f]=function(){return d}}),h})}},n.prototype.write=function(e,t){var r=this.tensorInfo.get(e);if(r.dtype==="string"){var i=t9(t);this.numBytes+=i-r.bytes,r.bytes=i}this.backend!==r.backend&&(r.backend.disposeData(e),r.backend=this.backend,this.backend.register(e,r.shape,r.dtype)),this.backend.write(e,t)},n.prototype.readSync=function(e){return this.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.tensorInfo.get(e).backend.read(e)},n.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},n.prototype.time=function(e){return Ht(this,void 0,void 0,function(){var t,r;return Gt(this,function(i){switch(i.label){case 0:return t=Qg(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Qg()-t,[2,r]}})})},n.prototype.track=function(e){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope!=null&&(e.scopeId=this.activeScope.id,this.activeScope.track.push(e)),e},n.nextTensorId=0,n.nextVariableId=0,n}();function y9(n){var e=vO(ze(n),"float32");return Te.make(n,{values:e})}(function(n){n[n.NUMBER=0]="NUMBER",n[n.BOOLEAN=1]="BOOLEAN",n[n.STRING=2]="STRING"})(It||(It={}));var V1,U1,x9=[{name:"DEBUG",type:It.BOOLEAN},{name:"IS_BROWSER",type:It.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:It.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:It.BOOLEAN},{name:"WEBGL_PACK",type:It.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:It.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:It.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:It.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:It.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:It.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:It.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:It.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:It.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:It.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:It.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:It.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:It.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:It.BOOLEAN},{name:"WEBGL_VERSION",type:It.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:It.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:It.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:It.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:It.NUMBER},{name:"BACKEND",type:It.STRING},{name:"EPSILON",type:It.NUMBER},{name:"PROD",type:It.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:It.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:It.BOOLEAN}];function DS(n){try{if(pa(n)!=null)return!0}catch{return!1}return!1}function w9(n){if(V1==null){var e=pa(n);V1=e.getParameter(e.MAX_TEXTURE_SIZE)}return V1}function _9(n){if(U1==null){var e=pa(n);U1=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,U1)}function b9(n){if(n===0)return 0;var e=pa(n);return Ol(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Ol(e,"EXT_disjoint_timer_query")?1:0}function E9(n){if(n===0)return!1;var e=pa(n);if(n===1){if(!Ol(e,"OES_texture_float"))return!1}else if(!Ol(e,"EXT_color_buffer_float"))return!1;return EO(e,n)}function C9(n){if(n===0)return!1;var e=pa(n);if(n===1){if(!Ol(e,"OES_texture_float")||!Ol(e,"WEBGL_color_buffer_float"))return!1}else if(!Ol(e,"EXT_color_buffer_float"))return!1;return EO(e,n)}function T9(n){return n===2&&pa(n).fenceSync!=null}function I9(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}var PS="tfjsflags";function bO(){var n={};if(typeof window>"u"||window.location===void 0||window.location.search===void 0)return n;var e=S9(window.location.search);if(PS in e){var t={};e[PS].split(",").forEach(function(r){var i=r.split(":"),o=i[0],a=i[1];t[o]=a}),x9.forEach(function(r){r.name in t&&(console.log("Setting feature override from URL "+r.name+": "+t[r.name]),r.type===It.NUMBER?n[r.name]=+t[r.name]:r.type===It.BOOLEAN?n[r.name]=t[r.name]==="true":r.type===It.STRING?n[r.name]=t[r.name]:console.warn("Unknown URL param: "+r.name+"."))})}return n}function Ol(n,e){return n.getExtension(e)!=null}function EO(n,e){var t=n.createFramebuffer(),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r);var i=e===2?n.RGBA32F:n.RGBA;n.texImage2D(n.TEXTURE_2D,0,i,1,1,0,n.RGBA,n.FLOAT,null),n.bindFramebuffer(n.FRAMEBUFFER,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(t),o}function S9(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return R9(e,r[0],r[1]),r.join("=")}),e}function R9(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}var k9=600;function A9(){return window.screen.height*window.screen.width*window.devicePixelRatio*k9/1024}var W1,N9=1e-4,D9=.1,P9=1e-7,O9=.001,ma=function(){function n(e){this.features={},this.registry={},this.registryFactory={},e!=null&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return n.setBackend=function(e,t){if(!(e in z.registry))throw new Error("Backend name '"+e+"' not found in registry");z.engine.backend=z.findBackend(e),z.backendName=e},n.getBackend=function(){return z.initEngine(),z.backendName},n.disposeVariables=function(){z.engine.disposeVariables()},n.memory=function(){return z.engine.memory()},n.profile=function(e){return z.engine.profile(e)},n.tidy=function(e,t){return z.engine.tidy(e,t)},n.dispose=function(e){wO(e).forEach(function(t){return t.dispose()})},n.keep=function(e){return z.engine.keep(e)},n.time=function(e){return z.engine.time(e)},n.prototype.get=function(e){return e in this.features?this.features[e]:(this.features[e]=this.evaluateFeature(e),this.features[e])},n.prototype.getFeatures=function(){return this.features},n.prototype.set=function(e,t){this.features[e]=t},n.prototype.getBestBackendName=function(){var e=this;if(Object.keys(this.registry).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(t){return{name:t,entry:e.registry[t]}}).sort(function(t,r){return r.entry.priority-t.entry.priority})[0].name},n.prototype.evaluateFeature=function(e){if(e==="DEBUG")return!1;if(e==="IS_BROWSER")return typeof window<"u";if(e==="IS_NODE")return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0;if(e==="IS_CHROME")return I9();if(e==="WEBGL_CPU_FORWARD")return!0;if(e==="WEBGL_PACK")return this.get("WEBGL_VERSION")!==0;if(e==="WEBGL_PACK_BATCHNORMALIZATION")return this.get("WEBGL_PACK");if(e==="WEBGL_PACK_CLIP")return this.get("WEBGL_PACK");if(e==="WEBGL_PACK_DEPTHWISECONV")return this.get("WEBGL_PACK");if(e==="WEBGL_PACK_BINARY_OPERATIONS")return this.get("WEBGL_PACK");if(e==="WEBGL_PACK_ARRAY_OPERATIONS")return this.get("WEBGL_PACK");if(e==="WEBGL_PACK_IMAGE_OPERATIONS")return this.get("WEBGL_PACK");if(e==="WEBGL_PACK_REDUCE")return this.get("WEBGL_PACK");if(e==="WEBGL_LAZILY_UNPACK")return this.get("WEBGL_PACK");if(e==="WEBGL_CONV_IM2COL")return this.get("WEBGL_PACK");if(e==="WEBGL_NUM_MB_BEFORE_PAGING")return this.get("PROD")||!this.get("IS_BROWSER")?Number.POSITIVE_INFINITY:A9();if(e==="WEBGL_MAX_TEXTURE_SIZE")return w9(this.get("WEBGL_VERSION"));if(e==="WEBGL_MAX_TEXTURES_IN_SHADER")return _9(this.get("WEBGL_VERSION"));if(e==="IS_TEST")return!1;if(e==="BACKEND")return this.getBestBackendName();if(e==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"){var t=this.get("WEBGL_VERSION");return t===0?0:b9(t)}if(e==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!qq();if(e==="HAS_WEBGL")return this.get("WEBGL_VERSION")>0;if(e==="WEBGL_VERSION")return DS(2)?2:DS(1)?1:0;if(e==="WEBGL_RENDER_FLOAT32_ENABLED")return E9(this.get("WEBGL_VERSION"));if(e==="WEBGL_DOWNLOAD_FLOAT_ENABLED")return C9(this.get("WEBGL_VERSION"));if(e==="WEBGL_FENCE_API_ENABLED")return T9(this.get("WEBGL_VERSION"));if(e==="WEBGL_SIZE_UPLOAD_UNIFORM")return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if(e==="TEST_EPSILON")return this.backend.floatPrecision()===32?O9:D9;if(e==="EPSILON")return this.backend.floatPrecision()===32?P9:N9;if(e==="PROD")return!1;if(e==="TENSORLIKE_CHECK_SHAPE_CONSISTENCY")return!this.get("PROD");if(e==="DEPRECATION_WARNINGS_ENABLED")return!0;throw new Error("Unknown feature "+e+".")},n.prototype.setFeatures=function(e){this.features=Object.assign({},e)},n.prototype.reset=function(){this.features=bO(),this.globalEngine!=null&&(this.globalEngine=null)},Object.defineProperty(n.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),n.prototype.findBackend=function(e){return e in this.registry?this.registry[e].backend:null},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e]:null},n.prototype.registerBackend=function(e,t,r){var i=this;if(r===void 0&&(r=1),e in this.registry)return console.warn(e+" backend was already registered. Reusing existing backend"),!1;try{var o=t();return o.setDataMover({moveData:function(a){return i.engine.moveData(a)}}),this.registry[e]={backend:o,priority:r},this.registryFactory[e]=t,!0}catch(a){return console.warn("Registration of backend "+e+" failed"),console.warn(a.stack||a.message),!1}},n.prototype.removeBackend=function(e){if(!(e in this.registry))throw new Error(e+" backend not found in registry");this.registry[e].backend.dispose(),delete this.registry[e]},Object.defineProperty(n.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),n.prototype.initEngine=function(){var e=this;if(this.globalEngine==null){this.backendName=this.get("BACKEND");var t=this.findBackend(this.backendName);this.globalEngine=new g9(t,!1,function(){return e.get("DEBUG")})}},Object.defineProperty(n.prototype,"global",{get:function(){return CO()},enumerable:!0,configurable:!0}),n}();function CO(){if(W1==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else{if(typeof process>"u")throw new Error("Could not find a global object");n=process}W1=n}return W1}function M9(){var n=CO();return n.ENV==null&&(n.ENV=new ma(bO())),l9(function(){return n.ENV.engine}),n.ENV}function TO(n){z.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}h9(TO);var z=M9();function zu(n){var e=n;if(ls(n))return[n.length];if(!Array.isArray(n))return[];for(var t=[];Array.isArray(e)||ls(e);)t.push(e.length),e=e[0];return Array.isArray(n)&&z.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&IO(n,t,[]),t}function IO(n,e,t){if(t=t||[],Array.isArray(n)||ls(n)){H(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, but is an array of "+n.length+" elements"}),H(n.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" elements, but has "+n.length+" elements"});for(var r=e.slice(1),i=0;i<n.length;++i)IO(n[i],r,t.concat(i))}else H(e.length===0,function(){return"Element arr["+t.join("][")+"] is a primitive, but should be an array/TypedArray of "+e[0]+" elements"})}function OS(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function W(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Te)return OS(r,n.dtype,e,t),n;var i=$p(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),OS(r,i,e,t),n==null||!ls(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=zu(n);ls(n)||Array.isArray(n)||(n=[n]);var s=i!=="string"?pO(n,i,z.get("DEBUG")):Zh(n);return Te.make(a,{values:s},i)}function Yg(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return W(i,e+"["+o+"]",t)},r)}function F9(n,e){if(H(Qw(n),function(){return"The f passed in variableGrads(f) must be a function"}),H(e==null||Array.isArray(e)&&e.every(function(u){return u instanceof Gp}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),e==null)for(var t in e=[],z.engine.registeredVariables)e.push(z.engine.registeredVariables[t]);var r=e.length;H((e=e.filter(function(u){return u.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable."});var i=z.engine.gradients(n,e,null,!0),o=i.value,a=i.grads;H(a.some(function(u){return u!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),H(o.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+o.rank+" tensor"});var s={};return e.forEach(function(u,l){a[l]!=null&&(s[u.name]=a[l])}),{value:o,grads:s}}function qp(n){return z.engine.customGrad(n)}var Ve=ma.tidy,Jt=ma.keep,L9=ma.dispose;ma.time;ma.profile;function n_(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];z.get("IS_TEST")||console.warn.apply(console,n)}function Jg(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([n[a+1]/e[a],e[a]]);i=i.concat(n.slice(o+1))}return i}function Zg(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function ey(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function SO(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function RO(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function kO(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function B9(n,e,t){for(var r=n.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?i.push(n[o++]):i.push(e[a++]);return i}function Ir(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function to(n,e){return B9(n,e.map(function(t){return 1}),e)}function pi(n,e,t){H(kO(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function va(n,e){if(kO(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function SE(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function ga(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function V9(n,e){var t=n[0].length;n.forEach(function(i,o){H(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),H(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var a=0;a<t;a++)H(a===e||i[a]===r[a],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function ed(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function AO(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=n.shape,s=t.slice();s.pop();var u=1;for(o=r;o<n.rank;++o)u*=a[o],s.push(a[o]);var l=uc(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,i,u,l]}var NO=30;function j1(n){return n<=NO?n:Yw(n,Math.floor(Math.sqrt(n)))}function U9(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var a=0;a<i;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-i;++a)if(t.shape[a+i]!==n[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+t.shape[a+i]+") != shape["+(a+i)+"] ("+n[a+i]+")")}function W9(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}U9(t,e,n)}function ty(n,e,t){for(var r=e.rank>1?e.shape[e.rank-1]:1,i=t.length,o=1,a=r;a<i;++a)o*=t[a];var s=r<1?1:r;return{sliceRank:r,numUpdates:e.size/s,sliceSize:o,strides:uc(t.slice(0,r)).concat([1]),outputSize:ze(t)}}function j9(n,e){var t,r=!1;for(n<=NO?(t=n,r=!0):t=Yw(n,Math.floor(Math.sqrt(n)));!r;)t>e||t===n?r=!0:t=Yw(n,t+1);return t}function z9(n,e,t){for(var r=[],i=n.length,o=0;o<i;o++)o!==e?r.push(n[o]):r.push(t);return r}function $9(n,e,t){for(var r=n.shape[t],i=[],o=1,a=1,s=0;s<t;s++)i.push(n.shape[s]),o*=n.shape[s];for(s=0;s<e.rank;s++)i.push(e.shape[s]);for(s=t+1;s<n.rank;s++)i.push(n.shape[s]),a*=n.shape[s];return{batchSize:o,sliceSize:a,dimSize:r,outputShape:i}}function H9(n,e,t){H(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),H(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){H(e[o]+t[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},i=0;i<n.rank;++i)r(i)}function RE(n,e,t,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),a!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],h=[],d=0;d<n.length;d++)l[d]=G9(i,e,r,n,d),c[d]=q9(o,t,r,n,d),u&1<<d&&(c[d]=l[d]+1,h.push(d));var f=new Array(n.length).fill(0);return f=f.map(function(p,m){for(var g=0,y=r[m]||1,x=l[m];!(y>0?x>=c[m]:x<=c[m]);x+=y)g+=1;return g}),[l,f,h]}function G9(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=Kw(0,o,s-1)}function q9(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=a>0?Kw(0,o,s):Kw(-1,o,s-1)}function DO(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function PO(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Y(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];z.engine.startScope(t);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),z.engine.endScope(s),s}catch(u){throw z.engine.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}function K9(n,e){e===void 0&&(e=-1);var t=W(n,"logits","softmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return qp(function(r,i){var o=r.logSumExp([e],!0),a=r.toFloat().sub(o).exp();return i([a]),{value:a,gradFunc:function(s,u){var l=u[0],c=s.mul(l);return c.sub(c.sum([e],!0).mul(l))}}})(t)}function X9(n,e){e===void 0&&(e=-1);var t=W(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return qp(function(r,i){var o=r.max(e,!0),a=r.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}var $u=Y({softmax_:K9}),Q9=Y({logSoftmax_:X9});function Y9(n,e){var t=W(n,"real","complex"),r=W(e,"imag","complex");return qt(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),z.engine.runKernel(function(i){return i.complex(t,r)},{$real:t,$imag:r})}function J9(n){var e=W(n,"input","real");return z.engine.runKernel(function(t){return t.real(e)},{$input:e})}function Z9(n){var e=W(n,"input","imag");return z.engine.runKernel(function(t){return t.imag(e)},{$input:e})}var Ur=Y({complex_:Y9}),ea=Y({real_:J9}),ru=Y({imag_:Z9});function On(n,e,t){if(t==null&&(t=$p(n)),t==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ls(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=zu(n);if(e!=null){gO(e);var i=ze(e),o=ze(r);H(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<r.length;++a){var s=r[a],u=a!==r.length-1||s!==ze(e.slice(a));H(r[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+e+"). "})}}return ls(n)||Array.isArray(n)||(n=[n]),e=e||r,n=t!=="string"?pO(n,t,z.get("DEBUG")):Zh(n),Te.make(e,{values:n},t)}function ye(n,e){if((ls(n)||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return On(n,[],e)}function yi(n,e){wd(n);var t=zu(n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return On(n,t,e)}function d0(n,e,t){if(wd(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=zu(n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return On(n,e=e||r,t)}function kE(n,e,t){if(wd(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=zu(n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return On(n,e=e||r,t)}function wo(n,e,t){if(wd(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=zu(n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return On(n,e=e||r,t)}function eK(n,e,t){if(wd(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=zu(n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return On(n,e=e||r,t)}function tK(n,e,t){if(wd(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=zu(n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return On(n,e=e||r,t)}function Ql(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Ql(n,"float32"),r=Ql(n,"float32");return Ur(t,r)}var i=vO(ze(n),e);return Te.make(n,{values:i},e)}function In(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=In(n,"float32"),r=In(n,"float32");return Ur(t,r)}var i=Hp(ze(n),e);return Te.make(n,{values:i},e)}function Vf(n,e,t){return z.engine.runKernel(function(r){return r.fill(n,e,t)},{})}function nK(n){var e=W(n,"x","onesLike");if(e.dtype==="complex64"){var t=MO(ea(e)),r=Mt(ru(e));return Ur(t,r)}return z.engine.runKernel(function(i){return i.onesLike(e)},{$x:e},null)}function rK(n){var e=W(n,"x","zerosLike");return z.engine.runKernel(function(t){return t.zerosLike(e)},{$x:e},null)}function iK(n,e,t){if(t===0)throw new Error("Cannot request zero samples");var r=(e-n)/(t-1),i=Hp(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return yi(i,"float32")}function OO(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return In([0],r);var i=Hp(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return yi(i,r)}var MO=Y({onesLike_:nK}),Mt=Y({zerosLike_:rK}),FO=function(){function n(e){this.dataMover=e,this.data=new WeakMap}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(e),this.data.get(e)},n.prototype.set=function(e,t){this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.data.delete(e)},n}();function LO(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=In(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!e9(n.dtype,e))return Te.make(n.shape,{dataId:n.dataId},e);if(n.dtype==="complex64"){var a=t.real(n);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var s=ye(0,n.dtype);return o=t.notEqual(n,s),s.dispose(),o}throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function r_(n,e){return Te.make(e,{dataId:n.dataId},n.dtype)}function BO(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function oK(n){for(var e=new Float32Array(n.length/2),t=new Float32Array(n.length/2),r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function aK(n){for(var e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e),i=0;i<n.length;i+=4)t[Math.floor(i/4)]=n[i],r[Math.floor(i/4)]=n[i+1];return{real:t,imag:r}}function sK(n){for(var e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e),i=2;i<n.length;i+=4)t[Math.floor(i/4)]=n[i],r[Math.floor(i/4)]=n[i+1];return{real:t,imag:r}}function MS(n,e){return{real:n[2*e],imag:n[2*e+1]}}function uK(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function lK(n,e){for(var t=new Float32Array(n/2),r=new Float32Array(n/2),i=0;i<Math.ceil(n/2);i++){var o=(e?2:-2)*Math.PI*(i/n);t[i]=Math.cos(o),r[i]=Math.sin(o)}return{real:t,imag:r}}function cK(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function AE(n,e,t,r,i){for(var o=Array.from(e).map(function(f,p){return{score:f,boxIndex:p}}).filter(function(f){return f.score>i}).sort(function(f,p){return p.score-f.score}),a=[],s=0;s<o.length;s++){var u=o[s],l=u.score,c=u.boxIndex;if(l<i)break;for(var h=!1,d=a.length-1;d>=0;--d)if(hK(n,c,a[d])>=r){h=!0;break}if(!h&&(a.push(c),a.length>=t))break}return yi(a,"int32")}function hK(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),f=(s-o)*(u-a),p=(h-l)*(d-c);if(f<=0||p<=0)return 0;var m=Math.max(o,l),g=Math.max(a,c),y=Math.min(s,h),x=Math.min(u,d),_=Math.max(y-m,0)*Math.max(x-g,0);return _/(f+p-_)}function VO(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var a=n.slice(r,i);return r[t]+=o,a})}function UO(n,e,t,r,i){for(var o=e[e.length-1],a=[n.length/o,o],s=a[0],u=a[1],l=Xw(t,s*r),c=Xw("int32",s*r),h=0;h<s;h++){for(var d=h*u,f=n.subarray(d,d+u),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(b,C){return C.value-b.value});var g=h*r,y=l.subarray(g,g+r),x=c.subarray(g,g+r);for(m=0;m<r;m++)y[m]=p[m].value,x[m]=p[m].index}var _=e.slice();return _[_.length-1]=r,[On(l,_,t),On(c,_,"int32")]}var dK=function(){return function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,a=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}();function WO(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function xi(n,e){return e===1?[n]:WO(n,e)}function fK(n,e){if(n===1)return"rc";for(var t="",r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}function fh(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,a=n[o]||1;(e[e.length-1-i]||1)>1&&a===1&&r.unshift(o)}return r}function Xn(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function Et(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function ya(){var n,e,t,r,i,o,a,s,u,l;return z.get("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      const float NAN = uintBitsToFloat(uint(0x7fc00000));
    `,u=`
      const float INFINITY = uintBitsToFloat(uint(0x7f800000));
    `,l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s=`
      uniform float NAN;

      bool isnan(float val) {
        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
      }
      bvec4 isnan(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Kp(n,e,t){t===void 0&&(t="index");var r=uc(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function fv(n){return n.length===1?""+n[0]:"vec"+n.length+"("+n.join(",")+")"}function pK(n,e){if(n.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -got "+n.length+" and "+e.length);for(var t=[],r=Math.floor(n.length/4),i=n.length%4,o=0;o<r;o++){var a=n.slice(4*o,4*o+4),s=e.slice(4*o,4*o+4);t.push(fv(a)+", "+fv(s))}return i!==0&&(a=n.slice(4*r),s=e.slice(4*r),a.length===1&&(a=a.map(function(u){return"float("+u+")"}),s=s.map(function(u){return"float("+u+")"})),t.push(fv(a)+", "+fv(s))),t.map(function(u,l){return"dot("+u+")"}).join("+")}function mK(n,e,t,r){var i=[];n.forEach(function(f){var p=ze(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))});var o,a,s=i.join(`
`),u=n.map(function(f){return vK(f,e,r)}).join(`
`),l=e.texShape,c=ya(),h=xK(c),d=bK(c);return e.isPacked?(o=gK(e.logicalShape,l),a=_K(c)):(o=yK(e.logicalShape,l),a=wK(c)),r&&(d+=IK),[d,h,a,s,o,u,t].join(`
`)}function _d(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return BK(n);case 1:return UK(n);case 2:return jK(n);case 3:return $K(n);case 4:return GK(n);case 5:return qK(n);case 6:return KK(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function jO(n){switch(n.shapeInfo.logicalShape.length){case 0:return LK(n);case 1:return VK(n);case 2:return WK(n);case 3:return zK(n);default:return HK(n)}}function vK(n,e,t){t===void 0&&(t=!1);var r="";r+=t?jO(n):_d(n);var i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(r+=t?XK(n,e):QK(n,e)),r}function gK(n,e){switch(n.length){case 0:return zO();case 1:return SK(n,e);case 2:return MK(n,e);case 3:return kK(n,e);default:return NK(n,e)}}function yK(n,e){switch(n.length){case 0:return zO();case 1:return RK(n,e);case 2:return FK(n,e);case 3:return AK(n,e);case 4:return DK(n,e);case 5:return PK(n,e);case 6:return OK(n,e);default:throw new Error(n.length+"-D output sampling is not yet supported")}}function xK(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+n.texture2D+`(textureSampler, uv).r;
    }
  `}function wK(n){return`
    void setOutput(float val) {
      `+n.output+` = vec4(val, 0, 0, 0);
    }
  `}function _K(n){return`
    void setOutput(vec4 val) {
      `+n.output+` = val;
    }
  `}function bK(n){return n.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+n.varyingFs+` vec2 resultUV;
    `+n.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    `+n.defineSpecialNaN+`
    `+n.defineSpecialInf+`
    `+n.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+EK+`
    `+CK+`
    `+TK+`
  `}var EK=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,CK=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,TK=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,IK=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function zO(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function SK(n,e){var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return t[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+t[1]+`.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+t[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      return resTexRC.x * `+t[1]+` + resTexRC.y;
    }
  `}function RK(n,e){return e[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+e[1]+`.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+e[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      return resTexRC.x * `+e[1]+` + resTexRC.y;
    }
  `}function kK(n,e){var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      int b = index / `+i+`;
      index -= b * `+i+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec3(b, r, c);
    }
  `}function AK(n,e){var t=Kp(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      `+t+`
      return ivec3(r, c, d);
    }
  `}function NK(n,e){for(var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2),o=i,a="",s="b, r, c",u=2;u<n.length-1;u++)a=`
      int b`+u+" = index / "+(o*=n[n.length-u-1])+`;
      index -= b`+u+" * "+o+`;
    `+a,s="b"+u+", "+s;return`
    ivec`+n.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+a+`

      int b = index / `+i+`;
      index -= b * `+i+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec`+n.length+"("+s+`);
    }
  `}function DK(n,e){var t=Kp(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      `+t+`
      return ivec4(r, c, d, d2);
    }
  `}function PK(n,e){var t=Kp(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+e[0]+`,
                             `+e[1]+`));

      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+t+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function OK(n,e){var t=Kp(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+t+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function MK(n,e){var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if($r(n,e))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+t[0]+", "+t[1]+`));
      }
    `;var r=Math.ceil(n[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));

      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec2(r, c);
    }
  `}function FK(n,e){return $r(n,e)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+e[0]+", "+e[1]+`));
      }
    `:n[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+e[0]+", "+e[1]+`));
        int index = resTexRC.x * `+e[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+e[0]+", "+e[1]+`));
        int index = resTexRC.x * `+e[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      int r = index / `+n[1]+`;
      int c = index - r * `+n[1]+`;
      return ivec2(r, c);
    }
  `}function lc(n){return"offset"+n}function LK(n){var e=n.name;return`
    vec4 `+("get"+e.charAt(0).toUpperCase()+e.slice(1))+`() {
      return `+ya().texture2D+"("+e+`, halfCR);
    }
  `}function BK(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return"float "+t+"() {return "+e+";}";var r=n.shapeInfo.texShape,i=r[0],o=r[1];if(i===1&&o===1)return`
      float `+t+`() {
        return sampleTexture(`+e+`, halfCR);
      }
    `;var a=n.shapeInfo.texShape;return`
    float `+t+`() {
      vec2 uv = uvFromFlat(`+a[0]+", "+a[1]+", "+lc(e)+`);
      return sampleTexture(`+e+`, uv);
    }
  `}function VK(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=n.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=ya();return`
    vec4 `+t+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+i[0]+", "+i[1]+`, index);
      return `+o.texture2D+"("+e+`, uv);
    }
  `}function UK(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`
      float `+t+`(int index) {
        `+bd(n)+`
      }
    `;var r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float `+t+`(int index) {
        return sampleTexture(`+e+`, halfCR);
      }
    `;var a=lc(e);return o===1?`
      float `+t+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+a+") + 0.5) / "+i+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:i===1?`
      float `+t+`(int index) {
        vec2 uv = vec2((float(index + `+a+") + 0.5) / "+o+`.0, 0.5);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+t+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+o+", index + "+a+`);
      return sampleTexture(`+e+`, uv);
    }
  `}function WK(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],s=ya();if(i!=null&&$r(e,i))return`
      vec4 `+r+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+a+".0, "+o+`.0);

        return `+s.texture2D+"("+t+`, uv);
      }
    `;var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 `+r+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+`, row, col);
      return `+s.texture2D+"("+t+`, uv);
    }
  `}function jK(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),i=n.shapeInfo.texShape;if(i!=null&&$r(e,i)){var o=i[0];return`
    float `+r+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+i[1]+".0, "+o+`.0);
      return sampleTexture(`+t+`, uv);
    }
  `}var a=sc(e),s=a.newShape,u=a.keptDims,l=s;if(l.length<e.length)return`
      `+_d(Ed(n,l))+`
      float `+r+`(int row, int col) {
        return `+r+"("+Cd(["row","col"],u)+`);
      }
    `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+e[1]+`, 1)));
        `+bd(n)+`
      }
    `;var c=i[0],h=i[1],d=lc(t);return h===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec3(row, col, `+d+"), vec3("+e[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+c+`.0);
      return sampleTexture(`+t+`, uv);
    }
  `:c===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec3(row, col, `+d+"), vec3("+e[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+h+`.0, 0.5);
      return sampleTexture(`+t+`, uv);
    }
  `:`
  float `+r+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+e[1]+" + col + "+d+`;
    vec2 uv = uvFromFlat(`+c+", "+h+`, index);
    return sampleTexture(`+t+`, uv);
  }
`}function zK(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(e[0]===1)return`
        `+jO(Ed(n,e.slice(1)))+`
        vec4 `+r+`(int b, int row, int col) {
          return `+r+"("+Cd(["b","row","col"],[1,2])+`);
        }
      `;var a=o[0],s=o[1],u=Math.ceil(e[2]/2);return`
    vec4 `+r+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+a+", "+s+", "+u*Math.ceil(e[1]/2)+", "+u+`, b, row, col);
      return `+ya().texture2D+"("+t+`, uv);
    }
  `}function $K(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),i=e[1]*e[2],o=e[2],a=sc(e),s=a.newShape,u=a.keptDims,l=s;if(l.length<e.length)return`
        `+_d(Ed(n,l))+`
        float `+r+`(int row, int col, int depth) {
          return `+r+"("+Cd(["row","col","depth"],u)+`);
        }
      `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+o+`, 1)));
        `+bd(n)+`
      }
    `;var c=n.shapeInfo.texShape,h=c[0],d=c[1],f=n.shapeInfo.flatOffset;return d===i&&f==null?`
        float `+r+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+o+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+d+".0, "+h+`.0);
          return sampleTexture(`+t+`, uv);
        }
      `:d===o&&f==null?`
    float `+r+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+e[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+".0, "+h+`.0);
      return sampleTexture(`+t+`, uv);
    }
  `:`
      float `+r+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+o+" + depth + "+lc(t)+`;
        vec2 uv = uvFromFlat(`+h+", "+d+`, index);
        return sampleTexture(`+t+`, uv);
      }
  `}function HK(n){for(var e=n.shapeInfo.logicalShape,t=e.length,r=n.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],s=a[0],u=a[1],l=Math.ceil(e[t-1]/2),c=l*Math.ceil(e[t-2]/2),h="int b, int row, int col",d="b * "+c+" + (row / 2) * "+l+" + (col / 2)",f=2;f<t-1;f++)h="int b"+f+", "+h,d="b"+f+" * "+(c*=e[t-f-1])+" + "+d;return`
    vec4 `+i+"("+h+`) {
      int index = `+d+`;
      int texR = index / `+u+`;
      int texC = index - texR * `+u+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+u+", "+s+`);
      return `+ya().texture2D+"("+r+`, uv);
    }
  `}function GK(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),i=e[3],o=e[2]*i,a=e[1]*o,s=sc(e),u=s.newShape,l=s.keptDims;if(u.length<e.length)return`
      `+_d(Ed(n,u))+`
      float `+r+`(int row, int col, int depth, int depth2) {
        return `+r+"("+Cd(["row","col","depth","depth2"],l)+`);
      }
    `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+a+", "+o+", "+i+`, 1)));
        `+bd(n)+`
      }
    `;var c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],f=h[1];return f===a&&c==null?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+o+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+f+".0, "+d+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:f===i&&c==null?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+e[1]*e[2]+", "+e[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+f+".0, "+d+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+a+" + col * "+o+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+d+", "+f+", index + "+lc(t)+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function qK(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),i=e[4],o=e[3]*i,a=e[2]*o,s=e[1]*a,u=sc(e),l=u.newShape,c=u.keptDims;if(l.length<e.length)return`
      `+_d(Ed(n,l))+`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        return `+r+"("+Cd(["row","col","depth","depth2","depth3"],c)+`);
      }
    `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+s+", "+a+", "+o+", "+i+`)) +
          depth3;
        `+bd(n)+`
      }
    `;var h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],p=d[1];return p===s&&h==null?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+a+", "+o+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+p+".0, "+f+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:p===i&&h==null?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]+`,
               `+e[2]*e[3]+", "+e[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+p+".0, "+f+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+s+" + col * "+a+" + depth * "+o+` +
          depth2 * `+i+" + depth3 + "+lc(t)+`;
      vec2 uv = uvFromFlat(`+f+", "+p+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function KK(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),i=sc(e),o=i.newShape,a=i.keptDims;if(o.length<e.length)return`
      `+_d(Ed(n,o))+`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+r+"("+Cd(["row","col","depth","depth2","depth3","depth4"],a)+`);
      }
    `;var s=e[5],u=e[4]*s,l=e[3]*u,c=e[2]*l,h=e[1]*c;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+c+", "+l+", "+u+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+s+`, 1)));
        `+bd(n)+`
      }
    `;var d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],m=f[1];return m===h&&d==null?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+c+", "+l+", "+u+", "+s+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+p+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:m===s&&d==null?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]*e[4]+`,
               `+e[2]*e[3]*e[4]+`,
               `+e[3]*e[4]+`,
               `+e[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+p+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+c+" + depth * "+l+` +
          depth2 * `+u+" + depth3 * "+s+" + depth4 + "+lc(t)+`;
      vec2 uv = uvFromFlat(`+p+", "+m+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function bd(n){var e=n.name,t=ze(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function XK(n,e){var t,r=n.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"AtOutCoords",a=n.shapeInfo.logicalShape.length,s=e.logicalShape.length,u=fh(n.shapeInfo.logicalShape,e.logicalShape),l=on(s),c=s-a,h=["x","y","z","w","u","v"];t=a===0?"":s<2&&u.length>=1?"coords = 0;":u.map(function(g){return"coords."+h[g+c]+" = 0;"}).join(`
`);var d="";d=s<2&&a>0?"coords":n.shapeInfo.logicalShape.map(function(g,y){return"coords."+h[y+c]}).join(", ");var f="return outputValue;";if(a===1&&s>1)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(a===0&&s>0)f=s===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(u.length){var p=a-2,m=a-1;u.indexOf(p)>-1&&u.indexOf(m)>-1?f="return vec4(outputValue.x);":u.indexOf(p)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(m)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `+o+`() {
      `+l+` coords = getOutputCoords();
      `+t+`
      vec4 outputValue = get`+i+"("+d+`);
      `+f+`
    }
  `}function QK(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),i="get"+r+"AtOutCoords",o=e.texShape,a=n.shapeInfo.texShape,s=n.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!n.shapeInfo.isUniform&&s===u&&n.shapeInfo.flatOffset==null&&$r(a,o))return`
      float `+i+`() {
        return sampleTexture(`+t+`, resultUV);
      }
    `;var l=on(u),c=fh(n.shapeInfo.logicalShape,e.logicalShape),h=u-s,d=["x","y","z","w","u","v"];return`
    float `+i+`() {
      `+l+` coords = getOutputCoords();
      `+(s===0?"":u<2&&c.length>=1?"coords = 0;":c.map(function(f){return"coords."+d[f+h]+" = 0;"}).join(`
`))+`
      return get`+r+"("+(u<2&&s>0?"coords":n.shapeInfo.logicalShape.map(function(f,p){return"coords."+d[p+h]}).join(", "))+`);
    }
  `}function on(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Ed(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Cd(n,e){return e.map(function(t){return n[t]}).join(", ")}var YK=function(){return function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,H(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=on(l),h=xi("coords",l);if(o===1){var d=on(s=l+1);a=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map(function(E){return"int "+E}),g=xi("sourceLocR",s-1).concat("inIdx.r"),y=xi("sourceLocG",s-1).concat("inIdx.g"),x=xi("sourceLocB",s-1).concat("inIdx.b"),_=xi("sourceLocA",s-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",C=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",k=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",T=r?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+k+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+C+`
          vec4 candidate = `+k+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}(),JK=function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}(),ZK=function(){return function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Et(n,e),Et(n,t);var a="0.0";r!=null&&(Et(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(Et(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),e8=function(){return function(n,e,t,r,i,o){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],Et(n,e),Et(n,t);var a="vec4(0.0)";r!=null&&(Et(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(Et(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),FS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},LS=function(){return function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Et(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),NE=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,z1="return a + b;",$1="return a - b;",BS="return a * b;",t8=`if (a == b) return 1.0;
  return a / b;`,n8=`
  float resultSign = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  int result = ia / ib;
  int amodb = ia - ib * result;

  if (resultSign < 0.0 && amodb != 0) {
    result -= 1;
  }
  return float(result);
`,r8=`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,VS="return (a - b) * (a - b);",i8="return float(a == b);",o8="return float(a != b);",a8="return float(a < b);",s8="return float(a <= b);",u8="return float(a > b);",l8="return float(a >= b);",c8="return float(a >= 1.0 && b >= 1.0);",h8="return float(a >= 1.0 || b >= 1.0);",d8=NE+`
  return max(a, b);
`,f8=NE+`
  return min(a, b);
`,p8=`if (b == 0.0) return NAN;
  return mod(a, b);`,m8=NE+`
  return atan(a, b);
`,v8="return (b >= 1.0) ? a : a * (b + 1.0);",g8="return (a < 0.) ? b * a : a;",gn=function(){return function(n,e,t){this.variableNames=["A","B"],this.outputShape=Et(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}(),Xp=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`,y8=`
  vec4 resultSign = sign(a) * sign(b);
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  ivec4 result = ia / ib;
  ivec4 amodb = ia - ib * result;

  // Vectorize INT_DIV
  // if (resultSign < 0.0 && amodb != 0) result -= 1;
  // return float(result);
  return vec4(result -
     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));
`,x8=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+Xp+`
  return result;
`,w8=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,_8=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,b8=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Xp+`
  return result;
`,E8=`
  return vec4(equal(a, b));
`,C8=`
  return vec4(notEqual(a, b));
`,T8=`
  return vec4(lessThan(a, b));
`,I8=`
  return vec4(lessThanEqual(a, b));
`,S8=`
  return vec4(greaterThan(a, b));
`,R8=`
  return vec4(greaterThanEqual(a, b));
`,k8=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,A8=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,N8=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Xp+`
  return result;
`,D8=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Xp+`
  return result;
`,P8=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+Xp+`
  return result;
`,Oa=function(){return function(n,e,t){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=Et(e,t),this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}(),O8=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, min, max));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"min"),r.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),M8=function(){function n(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(min), vec4(max)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"min"),r.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),F8=function(){return function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),L8=function(){return function(n){this.outputShape=[],this.outputShape=ed(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `}}(),B8=function(){return function(n,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=ed(n,e);var t=this.outputShape,r=t.length,i=on(r),o=xi("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(m,g){return"T"+g});var s=new Array(n.length-1);s[0]=n[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][e];var l=a[e],c="vec2("+a.slice(-2).join()+")",h=a.join(),d="if ("+l+" < "+s[0]+`)
          return getChannel(getT0(`+h+"), "+c+");";for(u=1;u<s.length;u++){var f=s[u-1];d+=`
        else if (`+l+" < "+s[u]+`) {
          `+l+" -= "+f+`;
          return getChannel(getT`+u+"("+h+"), "+c+`);
        }`}var p=s.length;d+=`
        else {
          `+l+" -= "+s[s.length-1]+`;
          return getChannel(getT`+p+"("+h+"), "+c+`);
        }`,this.userCode=`
      float getValue(`+a.map(function(m){return"int "+m})+`) {
        `+d+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);
        if (++`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }
        if (++`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }
        if (`+o[r-2]+" < "+t[r-2]+` &&
            --`+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `}}(),V8=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),U8=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,a=t-1-n.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),W8=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),j8=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),z8=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),$8=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,a=t-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),H8=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.top,t=n.padInfo.left,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.filterHeight,u=n.filterWidth,l=4*Math.floor(n.inChannels/4),c=n.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+r+", "+i+`);
      const ivec2 pads = ivec2(`+e+", "+t+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`; wR++) {
          int xR = xRCorner + wR * `+o+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+u+`; wC++) {
            int xC = xCCorner + wC * `+a+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+l+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(c===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+l+`) *
                getW(wR, wC, `+l+`, d2);
            } else if (`+(c===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(c===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1),
                getX(batch, xR, xC, `+l+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2),
                getW(wR, wC, `+l+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),G8=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,d=n.filterWidth,f=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),q8=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.inHeight,t=n.inWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+r+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+h+`;
        int q = d2 - d1 * `+h+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+s+`;

          if (xR < 0 || xR >= `+e+`) {
            continue;
          }

          for (int wC = 0; wC < `+c+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+t+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}}(),K8=function(){return function(n){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=n.outShape;for(var e=n.inHeight,t=n.inWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=c,d="int xR; int xC; int xCOffset;",f=0;f<l;f++)for(var p=0;p<c;p++)d+=`
          vec4 xTexelR`+f+"C"+2*p+` = vec4(0.);
          vec4 wR`+f+"C"+p+` = vec4(0.);
          vec4 xR`+f+"C"+p+" = vec4(0.);";for(f=0;f<l;f++)for(var m=0;m<h;m++){if(d+=`
          xR = xRCorner + `+f*s+`;
          xC = xCCorner + `+(p=2*m)*u+`;
        `,a===1){if(p<c&&(d+=i%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  xTexelR`+f+"C"+p+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+f+"C"+p+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+f+"C"+p+" = vec4(previous.zw, xTexelR"+f+"C"+p+`.xy);
                } else {
                  xR`+f+"C"+p+" = vec4(0, 0, xTexelR"+f+"C"+p+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+e+" && xC >= 0 && xC < "+t+`) {
                  xTexelR`+f+"C"+p+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+f+"C"+p+` = vec4(0.);
                }

                xR`+f+"C"+p+" = xTexelR"+f+"C"+p+`;
              `,p+1<c)){var g=i%2==0?Jh(u):u;u%2==0&&i%2==1||u%2!=0&&i%2!=1?(d+=`
                  xCOffset = xC + `+i%2+" + "+g+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+f+"C"+(p+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,u>1&&(d+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+e+` &&
                      xCOffset >= 0 && xCOffset < `+t+`) {
                      xTexelR`+f+"C"+p+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+f+"C"+p+` = vec4(0.);
                    }
                  `),d+=`
                  xR`+f+"C"+(p+1)+` = vec4(
                    xTexelR`+f+"C"+p+".zw, xTexelR"+f+"C"+(p+2)+`.xy);
                `):d+=`
                  xCOffset = xC + `+g+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+f+"C"+(p+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+f+"C"+(p+1)+" = xTexelR"+f+"C"+(p+2)+`;
                `}}else p<c&&(d+=`
              if(xR >= 0 && xR < `+e+`) {
            `,i%2==1?(d+=`
                xCOffset = xC + 1 - `+a+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+f+"C"+p+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+f+"C"+p+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+t+`) {
                  xTexelR`+f+"C"+(p+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+f+"C"+(p+2)+` = vec4(0.);
                }

                xR`+f+"C"+p+` = vec4(
                  xTexelR`+f+"C"+p+".zw, xTexelR"+f+"C"+(p+2)+`.zw);
              `,p+1<c&&(d+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+a+`;
                  if(xCOffset >= 0 && xCOffset < `+t+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+f+"C"+(p+1)+" = vec4(xTexelR"+f+"C"+(p+2)+`.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < `+t+`) {
                  xTexelR`+f+"C"+p+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+f+"C"+p+` = vec4(0.);
                }

                xCOffset = xC + `+a+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+f+"C"+(p+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+f+"C"+(p+2)+` = vec4(0.);
                }

                xR`+f+"C"+p+` = vec4(
                  xTexelR`+f+"C"+p+".xy, xTexelR"+f+"C"+(p+2)+`.xy);
              `,p+1<c&&(d+=`
                  xR`+f+"C"+(p+1)+` = vec4(
                    xTexelR`+f+"C"+p+".zw, xTexelR"+f+"C"+(p+2)+`.zw);
                `)),d+="}");p<c&&(d+=`
            vec4 wTexelR`+f+"C"+p+" = getW("+f+", "+p+`, d1, q);
            wR`+f+"C"+p+" = vec4(wTexelR"+f+"C"+p+".xz, wTexelR"+f+"C"+p+`.xz);
          `,p+1<c&&(d+=`
              vec4 wTexelR`+f+"C"+(p+1)+" = getW("+f+", "+(p+1)+`, d1, q);
              wR`+f+"C"+(p+1)+` =
                vec4(wTexelR`+f+"C"+(p+1)+".xz, wTexelR"+f+"C"+(p+1)+".xz);"))}for(f=0;f<l;f++)for(p=0;p<c;p++)d+="result += xR"+f+"C"+p+" * wR"+f+"C"+p+";";this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+r+", "+i+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+d+`

        setOutput(result);
      }
    `}}(),X8=function(){return function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],a=n[1],s=n[2],u=n[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var d=r==="bilinear"?1:0,f=[a-1+".0",s-1+".0"],p=f[0],m=f[1],g=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],y=g[0],x=g[1],_=g[2],b=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],C=b[0],k=b[1],T=b[2];this.userCode=`
      const float height_ratio = float(`+y+`);
      const float width_ratio = float(`+C+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+k+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}(),Q8=function(){return function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+on(r)+` coords = getOutputCoords();
        int end = `+US(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+US(r,"coords")+` = idx;
          val += getX(`+Y8(r,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function Y8(n,e){if(n===1)return""+e;if(n===2)return e+".x, "+e+".y";if(n===3)return e+".x, "+e+".y, "+e+".z";if(n===4)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}function US(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var J8=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),Z8=function(){return function(n){this.variableNames=["A"];var e=ya();this.outputShape=n,this.userCode=`
      const float FLOAT_MAX = 1.70141184e38;
      const float FLOAT_MIN = 1.17549435e-38;

      lowp vec4 encode_float(highp float v) {
        if (isnan(v)) {
          return vec4(255, 255, 255, 255);
        }

        highp float av = abs(v);

        if(av < FLOAT_MIN) {
          return vec4(0.0, 0.0, 0.0, 0.0);
        } else if(v > FLOAT_MAX) {
          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
        } else if(v < -FLOAT_MAX) {
          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
        }

        highp vec4 c = vec4(0,0,0,0);

        highp float e = floor(log2(av));
        highp float m = exp2(fract(log2(av))) - 1.0;

        c[2] = floor(128.0 * m);
        m -= c[2] / 128.0;
        c[1] = floor(32768.0 * m);
        m -= c[1] / 32768.0;
        c[0] = floor(8388608.0 * m);

        highp float ebias = e + 127.0;
        c[3] = floor(ebias / 2.0);
        ebias -= c[3] * 2.0;
        c[2] += floor(ebias) * 128.0;

        c[3] += 128.0 * step(0.0, -v);

        return c / 255.0;
      }

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `}}(),WS={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},jS=function(){return function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),e7=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),t7=function(){return function(n){this.variableNames=["A"];var e=ya(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),n7=function(){return function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=on(this.rank),o=r7(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}}();function r7(n,e){var t=n.length;if(t>4)throw Error("Gather for rank "+t+" is not yet supported");if(t===1)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<n.length;o++)o===e?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}var ta,Zr,i7=function(){return function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=on(e.length),i=on(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function Td(n,e){return[e,n]}function Qp(n,e){return n*e}function o7(n,e){if(n%e!=0)throw new Error("unpackedSize ("+n+") must be a multiple of "+e);return n/e}function a7(n,e,t){var r=Qp(n.length,t);if(e.length<r)throw new Error("unpackedArray length ("+e.length+") must be >= "+r);for(var i=0,o=0;o<n.length;++o)e[i]=n[o],i+=t}function $O(n,e,t){var r=o7(n.length,t);if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var i=0,o=0;o<n.length;o+=t)e[i++]=n[o]}function cc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function DE(n,e){var t=cc(n,e);return t[0]*t[1]*4}function s7(n,e,t,r,i){for(var o=r%2==1,a=t%2==1,s=Math.floor(r/2),u=Math.floor(t/2),l=Math.ceil(r/2),c=l*Math.ceil(t/2),h=Jh(t)*Jh(r),d=0;d<e;d++){for(var f=d*t*r,p=d*h,m=o?4:0,g=r,y=p,x=0;x<u;++x){for(var _=2*x*r,b=0;b<s;++b){var C=f+_+2*b;i[y]=n[C],i[y+1]=n[C+1],i[y+2]=n[C+g],i[y+3]=n[C+g+1],y+=4}y+=m}if(o){C=f+r-1,y=p+4*(l-1);var k=2*r;for(m=4*l,x=0;x<u;++x)i[y]=n[C],i[y+2]=n[C+r],C+=k,y+=m}if(a){for(C=f+(t-1)*r,y=p+4*(c-l),b=0;b<s;++b)i[y++]=n[C++],i[y++]=n[C++],y+=2;o&&a&&(i[p+h-4]=n[C])}}return i}function HO(n,e,t,r,i){var o=t*r;if(i.length<o)throw new Error("matrix length ("+i.length+") must be >= "+o);for(var a=r%2==1,s=t%2==1,u=Math.floor(r/2),l=Math.floor(t/2),c=Math.ceil(r/2),h=c*Math.ceil(t/2),d=Jh(t)*Jh(r),f=0;f<e;f++){for(var p=f*t*r,m=f*d,g=a?4:0,y=r+(a?1:0),x=m,_=p,b=p+r,C=0;C<l;++C){for(var k=0;k<u;++k)i[_++]=n[x++],i[_++]=n[x++],i[b++]=n[x++],i[b++]=n[x++];x+=g,_+=y,b+=y}if(a){x=m+4*(c-1);var T=p+r-1;for(g=4*c,y=2*r,C=0;C<l;++C)i[T]=n[x],i[T+r]=n[x+2],x+=g,T+=y}if(s){for(x=m+4*(h-c),T=p+(t-1)*r,k=0;k<u;++k)i[T++]=n[x++],i[T++]=n[x++],x+=2;a&&(i[p+t*r-1]=n[x])}}return i}function Me(n,e,t){var r=t();return e&&u7(n),r}function u7(n){var e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+d7(n,e))}(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ta||(ta={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Zr||(Zr={}));var l7=596e-10,c7=65504;function h7(n){return!!(z.get("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||l7<Math.abs(n)&&Math.abs(n)<c7)}function d7(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function pv(n,e,t){return ps(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function f7(n,e,t){var r=ps(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Me(n,e,function(){return n.shaderSource(r,t)}),Me(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function p7(n,e,t){var r=ps(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Me(n,e,function(){return n.shaderSource(r,t)}),Me(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw v7(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var m7=/ERROR: [0-9]+:([0-9]+):/g;function v7(n,e){var t=m7.exec(e);if(t==null)return console.log("Couldn't parse line number in error: "+e),void console.log(n);for(var r=+t[1],i=n.split(`
`),o=i.length.toString().length+2,a=i.map(function(d,f){return Ch((f+1).toString(),o)+d}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var l=a.slice(0,r-1),c=a.slice(r-1,r),h=a.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c "+Ch(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function g7(n,e){return ps(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function y7(n,e,t){if(Me(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function H1(n,e,t){if(Me(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function x7(n,e,t){var r=ps(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Me(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Me(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function w7(n,e,t){var r=ps(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Me(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Me(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function _7(){return z.get("WEBGL_VERSION")===2?1:4}function b7(n,e){return ps(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function GO(n,e){var t=z.get("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function E7(n,e){return ps(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function zS(n,e,t,r,i,o,a,s){var u=n.getAttribLocation(t,r);return u!==-1&&(Me(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),Me(n,e,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,a,s)}),Me(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function C7(n,e,t,r){k7(n,r),Me(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),Me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function T7(n,e,t,r){return ps(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function I7(n,e,t){return n.getUniformLocation(e,t)}function S7(n,e,t,r,i,o){Me(n,e,function(){return C7(n,e,r,o)}),Me(n,e,function(){return n.uniform1i(i,o)})}function G1(n,e,t,r){Me(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Me(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function $S(n,e,t){Me(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Me(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function mv(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+R7(n,e))}function R7(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function ps(n,e,t,r){var i=Me(n,e,function(){return t()});if(i==null)throw new Error(r);return i}function k7(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Kc(n,e){return e===void 0&&(e=2),ze(n.slice(0,n.length-e))}function Xc(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function A7(n,e){var t;e===void 0&&(e=!1);var r=z.get("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?Jh(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var i=sc(n);n=i.newShape}var o=ze(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var a=Kc(n),s=2,u=2;return n.length&&(s=(t=Xc(n))[0],u=t[1]),SS(o=a*(s/2)*(u/2)).map(function(l){return 2*l})}return SS(o)}function vv(n){return n%2==0}function gv(n,e){if($r(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||vv(t)&&vv(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&vv(n[0])&&vv(e[0])}function N7(n,e){var t=ya();return f7(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function D7(n,e){return x7(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function P7(n,e){return w7(n,e,new Uint16Array([0,1,2,2,1,3]))}function O7(n,e){var t,r,i,o,a,s,u,l,c=n;return z.get("WEBGL_VERSION")===2?(t=c.R32F,r=c.R16F,i=c.RGBA16F,o=c.RGBA32F,a=c.RED,s=4,u=1,l=c.HALF_FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=c.RGBA,a=n.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function Yp(n,e,t,r,i,o,a){GO(t,r);var s=b7(n,e),u=n.TEXTURE_2D;return Me(n,e,function(){return n.bindTexture(u,s)}),Me(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Me(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Me(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Me(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Me(n,e,function(){return n.texImage2D(u,0,i,t,r,0,o,a,null)}),Me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function M7(n,e,t,r,i){var o=Td(t,r);return Yp(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function F7(n,e,t,r,i){var o=Td(t,r);return Yp(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function L7(n,e,t,r,i){var o=Td(t,r);return Yp(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function B7(n,e,t,r,i){var o=cc(t,r);return Yp(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function V7(n,e,t,r,i){var o=cc(t,r);return Yp(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function U7(n,e,t,r){return Me(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),zS(n,e,t,"clipSpacePos",r,3,20,0)&&zS(n,e,t,"uv",r,2,20,12)}function W7(n,e,t,r){Me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),Me(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function qO(n,e,t,r,i,o,a){GO(r,i),Me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),Me(n,e,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,r,i,a,n.FLOAT,o)}),Me(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function j7(n,e,t,r,i,o,a,s){var u,l=Td(r,i),c=l[0],h=l[1],d=r*i;s.defaultNumChannels===1&&d===o.length?u=o:a7(o,u=new Float32Array(d*a),a),qO(n,e,t,c,h,u,s.textureFormatFloat)}function z7(n,e,t,r,i,o,a,s,u,l){var c=cc(a,s),h=c[0],d=c[1],f=new Float32Array(DE(a,s));s7(u,r,i,o,f),qO(n,e,t,h,d,f,n.RGBA)}function $7(n,e,t,r,i,o){var a=t;if(z.get("WEBGL_VERSION")===2){var s=n,u=s.createBuffer();Me(n,e,function(){return n.bindBuffer(s.PIXEL_PACK_BUFFER,u)});var l=4*Qp(r*i,o.downloadUnpackNumChannels);Me(n,e,function(){return n.bufferData(s.PIXEL_PACK_BUFFER,l,s.STREAM_READ)}),Me(n,e,function(){return s.readPixels(0,0,i,r,n.RGBA,n.FLOAT,0)}),Me(n,e,function(){return n.bindBuffer(s.PIXEL_PACK_BUFFER,null)}),a=u}return a}function H7(n,e,t,r,i){var o=n,a=new Float32Array(Qp(t*r,i.downloadUnpackNumChannels));o.bindBuffer(o.PIXEL_PACK_BUFFER,e),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,a),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);var s=new Float32Array(t*r);return $O(a,s,i.downloadUnpackNumChannels),s}function G7(n,e,t,r,i){var o=Td(t,r),a=o[0],s=o[1],u=new Float32Array(Qp(t*r,i.downloadUnpackNumChannels));Me(n,e,function(){return n.readPixels(0,0,a,s,i.downloadTextureFormat,n.FLOAT,u)});var l=new Float32Array(t*r);return $O(u,l,i.downloadUnpackNumChannels),l}function q7(n,e,t,r,i){var o=Td(t,r),a=o[0],s=o[1],u=new Uint8Array(Qp(t*r,4));return Me(n,e,function(){return n.readPixels(0,0,a,s,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function K7(n,e,t,r,i,o,a,s){var u=n,l=new Float32Array(DE(o,a));u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);var c=new Float32Array(ze([t,r,i]));return HO(l,t,r,i,c),c}function X7(n,e,t,r,i,o,a,s){var u=cc(o,a),l=u[0],c=u[1],h=new Float32Array(DE(o,a));Me(n,e,function(){return n.readPixels(0,0,l,c,n.RGBA,n.FLOAT,h)});var d=new Float32Array(ze([t,r,i]));return HO(h,t,r,i,d)}var Q7=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=z.get("WEBGL_VERSION");e!=null?(this.gl=e,Hq(t,e)):this.gl=pa(t),z.get("WEBGL_VERSION")===1?(this.textureFloatExtension=pv(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),z.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=pv(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=pv(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=D7(this.gl,this.debug),this.indexBuffer=P7(this.gl,this.debug),this.framebuffer=E7(this.gl,this.debug),this.textureConfig=O7(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return z.get("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Me(t,this.debug,function(){return t.finish()}),Me(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Me(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Me(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Me(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Me(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),M7(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),F7(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),L7(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),W7(this.gl,this.debug,e,t)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),V7(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),B7(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&($S(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Me(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.uploadMatrixToTexture=function(e,t,r,i){this.throwIfDisposed();var o=_7();return j7(this.gl,this.debug,e,t,r,i,o,this.textureConfig)},n.prototype.uploadMatrixToPackedTexture=function(e,t,r,i,o,a,s){return this.throwIfDisposed(),z7(this.gl,this.debug,e,t,r,i,o,a,s,this.textureConfig)},n.prototype.downloadFloat32MatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return G7(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return q7(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,a){return K7(this.gl,e,t,r,i,o,a,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t,r){return H7(this.gl,e,t,r,this.textureConfig)},n.prototype.maybeCreateBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=$7(this.gl,this.debug,e,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(z.get("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r,i,o,a){var s=this;return this.downloadMatrixDriver(e,function(){return X7(s.gl,s.debug,t,r,i,o,a,s.textureConfig)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=p7(t,this.debug,e),i=N7(t,this.debug),o=g7(t,this.debug);return Me(t,this.debug,function(){return t.attachShader(o,i)}),Me(t,this.debug,function(){return t.attachShader(o,r)}),y7(t,this.debug,o),this.debug&&H1(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=U7(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Me(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&H1(this.gl,this.debug,this.program),Me(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?T7(this.gl,this.debug,e,t):I7(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Me(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),S7(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=cc(t,r),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&H1(this.gl,this.debug,this.program),mv(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Me(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Me(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=pv(this.gl,this.debug,z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Ht(this,void 0,void 0,function(){var t=this;return Gt(this,function(r){switch(r.label){case 0:return[4,RS(function(){return t.disposed||t.isQueryAvailable(e,z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=Y7(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||RS(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),G1(this.gl,this.debug,e,this.framebuffer),this.debug&&mv(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(G1(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&mv(this.gl)):$S(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;G1(i,this.debug,e,this.framebuffer),this.debug&&mv(i),this.outputTexture=e,Me(i,this.debug,function(){return i.viewport(0,0,t,r)}),Me(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),Me(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function Y7(n){for(var e=0;e<n.length&&n[e]();++e);return e-1}function J7(n,e,t,r){var i=e.userCode,o=t.map(function(m,g){var y={logicalShape:m.shape,texShape:m.isUniform?null:m.texData.texShape,isUniform:m.isUniform,isPacked:!m.isUniform&&m.texData.isPacked,flatOffset:null};return m.texData!=null&&m.texData.slice!=null&&m.texData.slice.flatOffset>0&&(y.flatOffset=m.texData.slice.flatOffset),{name:e.variableNames[g],shapeInfo:y}}),a=o.map(function(m){return m.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=mK(o,s,i,e.usesPackedTextures),l=n.createProgram(u),c=null,h=null;z.get("WEBGL_VERSION")===1&&(c=n.getUniformLocation(l,"INFINITY",!1),h=n.getUniformLocation(l,"NAN",!1));for(var d={},f=0;f<e.variableNames.length;f++){var p=e.variableNames[f];d[p]=n.getUniformLocation(l,p,!1),d["offset"+p]=n.getUniformLocation(l,"offset"+p,!1)}return{program:e,source:u,webGLProgram:l,uniformLocations:d,inShapeInfos:a,outShapeInfo:s,infLoc:c,nanLoc:h}}function HS(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],a=o.shape;if(!$r(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!$r(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}function Z7(n,e,t,r,i){HS(e.inShapeInfos,t),HS([e.outShapeInfo],[r]);var o=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(o,a[0],a[1]):n.setOutputMatrixTexture(o,a[0],a[1]),n.setProgram(e.webGLProgram),z.get("WEBGL_VERSION")===1&&(e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN)),t.forEach(function(s,u){var l=e.program.variableNames[u],c=e.uniformLocations[l],h=e.uniformLocations["offset"+l];if(c!=null)if(s.isUniform)if(ze(s.shape)<2)n.gl.uniform1f(c,s.uniformValues[0]);else{var d=s.uniformValues;d instanceof Float32Array||(d=new Float32Array(d)),n.gl.uniform1fv(c,d)}else s.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,s.texData.slice.flatOffset),n.setInputMatrixTexture(s.texData.texture,c,u)}),i!=null&&i(n,e.webGLProgram),n.executeProgram()}function eX(n,e,t){var r="";e.concat(t).forEach(function(a){var s=a.texData!=null&&a.texData.slice!=null&&a.texData.slice.flatOffset>0,u=a.isUniform?"uniform":a.texData.texShape;r+=a.shape+"_"+u+"_"+s});var i=n.userCode,o=n.constructor.name;return o+="_"+r+"_"+i}var tX=function(){return function(n,e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=s.left,d=s.top,f=i*r,p=ya();this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+n[1]+" || pos >= "+n[0]+`) continue;

            int offsetY = int(blockIndex / (`+u+")) * "+a+" - "+d+`;
            int d0 = offsetY + `+c+" * (pos / "+f+`);

            if(d0 >= `+e[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+h+`.);
            int d1 = offsetX + `+l+" * (int(mod(float(pos), "+f+".) / "+i+`.));

            if(d1 >= `+e[1]+` || d1 < 0) continue;

            vec2 innerDims = vec2(d1, int(mod(float(pos), `+i+`.)));
            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),
                                              int(innerDims.y)), innerDims);
          }
        }

        `+p.output+` = result;
      }
    `}}(),nX=function(){return function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `}}(),rX=function(){return function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),iX=function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,a=i-1-n.padInfo.top,s=o-1-n.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),q1=function(){return function(n,e,t,r,i,o){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var a=t?n[1]:n[2],s=Math.ceil(a/2),u=t?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",f="";o&&(d=`vec4 activation(vec4 x) {
        `+o+`
      }`,f="result = activation(result);");var p=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),this.userCode=`
      `+d+`

      const float sharedDimension = `+s+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+s+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          result += (`+c[0]+" * "+h[0]+") + ("+c[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+p+`

        `+f+`

        setOutput(result);
      }
    `}}(),oX=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),aX=function(){return function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `}}(),sX=function(){return function(n){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=xi("rc",e),r=on(e),i=lX(e,n,t),o=cX(e,n[n.length-1],n[n.length-2],t),a=hX(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}}}();function uX(n,e){for(var t=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var o=(r===0?"r":"rp1")+", "+(i===0?"c":"cp1"),a=2;a<n;a++)o=e[e.length-1-a]+","+o;t.push(o)}return t}function lX(n,e,t){if(n===1)return"rc > "+e[0];for(var r="",i=n-2;i<n;i++)r+=t[i]+" >= "+e[i],i<n-1&&(r+="||");return r}function cX(n,e,t,r){if(n===1)return"";var i=r.slice(-2);return`
    int r = `+i[0]+`;
    int c = `+i[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+e+`;
    bool rEdge = rp1 >= `+t+`;
  `}function hX(n,e){var t=n.length,r=uX(t,e);return t===1?`getA(rc),
            rc + 1 >= `+n[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+r[0]+`),
          cEdge ? 0. : getA(`+r[1]+`),
          rEdge ? 0. : getA(`+r[2]+`),
          rEdge || cEdge ? 0. : getA(`+r[3]+")"}var dX=function(){return function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=on(r),o=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,l){return u[0]+n[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),fX=function(){return function(n,e,t){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(g,y){return g[0]+n[y]+g[1]});for(var r=n.length,i=on(r),o=e.map(function(g){return g[0]}).join(","),a=e.map(function(g,y){return g[0]+n[y]}).join(","),s=xi("rc",r),u=xi("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=r===1?2:4;p<m;p++)f+=`
        `+h[p]+`
        if (`+d+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `}}(),K1=function(){return function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var d=e==="avg",f="0.0";if(d||(f="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,y=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+y+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+y+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+y+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+y+`
          }
        }
        setOutput(`+p+`);
      }
    `}}}(),pX=function(){return function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var f="";i%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `}}(),mX=function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      `+gX(e)+`
      `+vX(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `}}();function vX(n){return`
    int getFlatIndex(ivec3 coords) {
      return round(`+pK(["coords.x","coords.y","coords.z"],uc(n).map(function(e){return e.toString()}).concat(["1."]))+`);
    }
  `}function gX(n){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Kp(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  `}var yX=function(){return function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),xX=function(){return function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),wX=function(){return function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));
        
        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`; 
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}(),_X=function(){return function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),bX=function(){return function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),EX=function(){return function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(o,a){return function(s){return e.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),i=on(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `}}(),CX=function(){return function(n,e){this.variableNames=["x"],this.usesPackedTextures=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=xi("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],a=on(t);function s(u){var l=n.map(function(c,h){return function(d,f){return e.indexOf(d)!==-1&&n[d]!==1?n[d]+" - "+f[d]+" - 1":""+f[d]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1), rc);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1), rc + 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `}}(),GS=function(){return function(n,e,t,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=on(i.length),u=on(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var d="getUpdates("+h+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),TX=function(){return function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,a=o*Math.ceil(i/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `}}(),IX=function(){return function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<n&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=on(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}}(),SX=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=on(this.rank),i="uniform int start["+this.rank+"];",o=RX(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+i_[s]+" = start["+s+"] + coords."+i_[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),i_=["x","y","z","w","u","v"];function RX(n){if(n===1)return"sourceLoc";if(n<=6)return i_.slice(0,n).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+n+" is not yet supported")}var kX=function(){function n(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=on(this.rank),r=xi("coords",this.rank),i=xi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+` 
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),AX=function(){return function(n,e,t,r){this.variableNames=["x"];var i=t.filter(function(c,h){return r.indexOf(h)===-1});this.outputShape=i;var o=t.length,a=on(t.length),s=on(i.length),u="";if(o===1)u="coords * strides + begin";else{var l=0;u=t.map(function(c,h){return r.indexOf(h)===-1?(l++,i.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(l-1)+"] * strides["+h+"] + begin["+h+"]"):"begin["+h+"]"}).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+n+`);
      `+a+" strides = "+a+"("+e+`);

      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+u+`));
      }
    `}}(),NX=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=qS(t,r),a=KS(e,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===Zr.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Zr.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Zr.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Zr.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Zr.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=KS(t,qS(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function qS(n,e){if(n===ta.UPLOAD)return e?Zr.PACKED_2X2_FLOAT32:Zr.UNPACKED_FLOAT32;if(n===ta.RENDER||n==null)return e?z.get("WEBGL_RENDER_FLOAT32_ENABLED")?Zr.PACKED_2X2_FLOAT32:Zr.PACKED_2X2_FLOAT16:z.get("WEBGL_RENDER_FLOAT32_ENABLED")?Zr.UNPACKED_FLOAT32:Zr.UNPACKED_FLOAT16;if(n===ta.DOWNLOAD||n===ta.PIXELS)return Zr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function KS(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var DX=function(){return function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=on(this.rank),o=PX(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}}();function PX(n){var e=n.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(e===1)return"imod(resRC, "+n[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<n.length;i++)r.push("imod("+t[i]+", "+n[i]+")");return r.join()}var OX=function(){return function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=on(this.rank),o=MX(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `}}();function MX(n){var e=n.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),i=0;i<n.length;i++)r[n[i]]=t[i];return r.join()}var FX=function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=on(this.rank),o=WO("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }  
      setOutput(result);
    }
    `}}(),KO=.3275911,XO=.254829592,QO=-.284496736,YO=1.421413741,JO=-1.453152027,ZO=1.061405429,PE=1.7580993408473768,OE=1.0507009873554805,ct=function(){return function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),hc="if (isnan(x)) return x;",LX="return abs(x);",BX=hc+`
  return (x < 0.0) ? 0.0 : x;
`,VX="return (x >= 0.0) ? x : (exp(x) - 1.0);",UX=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+PE+`;
  float scale = `+OE+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`;function WX(n){return n===void 0&&(n=0),hc+`
    return x > 0.0 ? 1.0 : float(`+n+`);
  `}var jX="return -x;",zX="return ceil(x);",$X="return floor(x);",HX=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,GX="return float(isnan(x));",qX="return float(isinf(x));",KX="return float(!isnan(x) && !isinf(x));",XX=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,XS="return exp(x);",QX="return exp(x) - 1.0;",YX=`if (x < 0.0) return NAN;
  return log(x);`,JX="return log(1.0 + x);",ZX="return sqrt(x);",eQ="return inversesqrt(x);",tQ="return 1.0 / (1.0 + exp(-1.0 * x));",nQ=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,rQ=hc+`
  return sin(x);
`,iQ=hc+`
  return cos(x);
`,oQ="return tan(x);",aQ="return asin(x);",sQ="return acos(x);",uQ=hc+`
  return atan(x);
`,lQ=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,cQ=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,hQ=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,dQ="return log(x + sqrt(x * x + 1.0));",fQ=hc+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,pQ=hc+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,mQ=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+KO+`;
  float a1 = `+XO+`;
  float a2 = `+QO+`;
  float a3 = `+YO+`;
  float a4 = `+JO+`;
  float a5 = `+ZO+`;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`,vQ="return x * x;",gQ="return 1.0 / x;",yQ="return float(!(x >= 1.0));",xQ="return float(int(x));",QS="return x;",wQ="return x;",_Q=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,eM=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,X1=function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),bQ=function(){return function(n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var e=n.length,t=xi("rc",e),r=on(e),i=fK(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `}}();function EQ(n){return ai(n,0)}function CQ(n,e){return ai(n,e)}function TQ(n,e){return ai(n,e)}function IQ(n,e){return ai(n,e)}function SQ(n,e){e===void 0&&(e=0),H(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Yg(n,"tensors","concat");e=yr(e,t[0].shape)[0];var r=ed(t.map(function(a){return a.shape}),e);if(ze(r)===0)return On([],r);if((t=t.filter(function(a){return a.size>0})).length===1)return t[0];var i=t.map(function(a){return a.shape});V9(i,e);var o=t;return z.engine.runKernel(function(a){return a.concat(t,e)},o,function(a){var s=i.map(function(u){return u[e]});return ME(a,s,e).map(function(u){return function(){return u}})})}function RQ(n,e,t){t===void 0&&(t=0);var r,i=W(n,"x","split");return t=yr(t,i.shape)[0],typeof e=="number"?(H(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(H(i.shape[t]===e.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),z.engine.runKernel(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return ai(o,t)}}})}var ai=Y({concat_:SQ}),kQ=Y({concat1d_:EQ}),AQ=Y({concat2d_:CQ}),NQ=Y({concat3d_:TQ}),DQ=Y({concat4d_:IQ}),ME=Y({split_:RQ});function dc(n,e){return n(e={exports:{}},e.exports),e.exports}var PQ=dc(function(n){(function(e,t,r){function i(a,s){return s.c=a.c,s.s0=a.s0,s.s1=a.s1,s.s2=a.s2,s}function o(a,s){var u=new function(h){var d,f=this,p=(d=4022871197,function(m){m=m.toString();for(var g=0;g<m.length;g++){var y=.02519603282416938*(d+=m.charCodeAt(g));y-=d=y>>>0,d=(y*=d)>>>0,d+=4294967296*(y-=d)}return 23283064365386963e-26*(d>>>0)});f.next=function(){var m=2091639*f.s0+23283064365386963e-26*f.c;return f.s0=f.s1,f.s1=f.s2,f.s2=m-(f.c=0|m)},f.c=1,f.s0=p(" "),f.s1=p(" "),f.s2=p(" "),f.s0-=p(h),f.s0<0&&(f.s0+=1),f.s1-=p(h),f.s1<0&&(f.s1+=1),f.s2-=p(h),f.s2<0&&(f.s2+=1),p=null}(a),l=s&&s.state,c=u.next;return c.int32=function(){return 4294967296*u.next()|0},c.double=function(){return c()+11102230246251565e-32*(2097152*c()|0)},c.quick=c,l&&(typeof l=="object"&&i(l,u),c.state=function(){return i(u,{})}),c}t&&t.exports?t.exports=o:this.alea=o})(0,n)}),OQ=dc(function(n){(function(e,t,r){function i(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s}function o(a,s){var u=new function(h){var d=this,f="";d.x=0,d.y=0,d.z=0,d.w=0,d.next=function(){var m=d.x^d.x<<11;return d.x=d.y,d.y=d.z,d.z=d.w,d.w^=d.w>>>19^m^m>>>8},h===(0|h)?d.x=h:f+=h;for(var p=0;p<f.length+64;p++)d.x^=0|f.charCodeAt(p),d.next()}(a),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&i(l,u),c.state=function(){return i(u,{})}),c}t&&t.exports?t.exports=o:this.xor128=o})(0,n)}),MQ=dc(function(n){(function(e,t,r){function i(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s.v=a.v,s.d=a.d,s}function o(a,s){var u=new function(h){var d=this,f="";d.next=function(){var m=d.x^d.x>>>2;return d.x=d.y,d.y=d.z,d.z=d.w,d.w=d.v,(d.d=d.d+362437|0)+(d.v=d.v^d.v<<4^m^m<<1)|0},d.x=0,d.y=0,d.z=0,d.w=0,d.v=0,h===(0|h)?d.x=h:f+=h;for(var p=0;p<f.length+64;p++)d.x^=0|f.charCodeAt(p),p==f.length&&(d.d=d.x<<10^d.x>>>4),d.next()}(a),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&i(l,u),c.state=function(){return i(u,{})}),c}t&&t.exports?t.exports=o:this.xorwow=o})(0,n)}),FQ=dc(function(n){(function(e,t,r){function i(a,s){return s.x=a.x.slice(),s.i=a.i,s}function o(a,s){a==null&&(a=+new Date);var u=new function(h){var d=this;d.next=function(){var f,p,m=d.x,g=d.i;return f=m[g],p=(f^=f>>>7)^f<<24,p^=(f=m[g+1&7])^f>>>10,p^=(f=m[g+3&7])^f>>>3,p^=(f=m[g+4&7])^f<<7,f=m[g+7&7],p^=(f^=f<<13)^f<<9,m[g]=p,d.i=g+1&7,p},function(f,p){var m,g=[];if(p===(0|p))g[0]=p;else for(p=""+p,m=0;m<p.length;++m)g[7&m]=g[7&m]<<15^p.charCodeAt(m)+g[m+1&7]<<13;for(;g.length<8;)g.push(0);for(m=0;m<8&&g[m]===0;++m);for(m==8?g[7]=-1:g[m],f.x=g,f.i=0,m=256;m>0;--m)f.next()}(d,h)}(a),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(l.x&&i(l,u),c.state=function(){return i(u,{})}),c}t&&t.exports?t.exports=o:this.xorshift7=o})(0,n)}),LQ=dc(function(n){(function(e,t,r){function i(a,s){return s.i=a.i,s.w=a.w,s.X=a.X.slice(),s}function o(a,s){a==null&&(a=+new Date);var u=new function(h){var d=this;d.next=function(){var f,p,m=d.w,g=d.X,y=d.i;return d.w=m=m+1640531527|0,p=g[y+34&127],f=g[y=y+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=g[y]=p^f,d.i=y,p+(m^m>>>16)|0},function(f,p){var m,g,y,x,_,b=[],C=128;for(p===(0|p)?(g=p,p=null):(p+="\0",g=0,C=Math.max(C,p.length)),y=0,x=-32;x<C;++x)p&&(g^=p.charCodeAt((x+32)%p.length)),x===0&&(_=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,x>=0&&(_=_+1640531527|0,y=(m=b[127&x]^=g+_)==0?y+1:0);for(y>=128&&(b[127&(p&&p.length||0)]=-1),y=127,x=512;x>0;--x)g=b[y+34&127],m=b[y=y+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,b[y]=g^m;f.w=_,f.X=b,f.i=y}(d,h)}(a),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(l.X&&i(l,u),c.state=function(){return i(u,{})}),c}t&&t.exports?t.exports=o:this.xor4096=o})(0,n)}),BQ=dc(function(n){(function(e,t,r){function i(a,s){return s.a=a.a,s.b=a.b,s.c=a.c,s.d=a.d,s}function o(a,s){var u=new function(h){var d=this,f="";d.next=function(){var m=d.b,g=d.c,y=d.d,x=d.a;return m=m<<25^m>>>7^g,g=g-y|0,y=y<<24^y>>>8^x,x=x-m|0,d.b=m=m<<20^m>>>12^g,d.c=g=g-y|0,d.d=y<<16^g>>>16^x,d.a=x-m|0},d.a=0,d.b=0,d.c=-1640531527,d.d=1367130551,h===Math.floor(h)?(d.a=h/4294967296|0,d.b=0|h):f+=h;for(var p=0;p<f.length+20;p++)d.b^=0|f.charCodeAt(p),d.next()}(a),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&i(l,u),c.state=function(){return i(u,{})}),c}t&&t.exports?t.exports=o:this.tychei=o})(0,n)}),yl=dc(function(n){(function(e,t){var r,i=this,o=256,a=6,s="random",u=t.pow(o,a),l=t.pow(2,52),c=2*l,h=o-1;function d(g,y,x){var _=[],b=p(function T(E,I){var R,N=[],O=typeof E;if(I&&O=="object")for(R in E)try{N.push(T(E[R],I-1))}catch{}return N.length?N:O=="string"?E:E+"\0"}((y=y==1?{entropy:!0}:y||{}).entropy?[g,m(e)]:g??function(){try{var T;return r&&(T=r.randomBytes)?T=T(o):(T=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(T)),m(T)}catch{var E=i.navigator,I=E&&E.plugins;return[+new Date,i,I,i.screen,m(e)]}}(),3),_),C=new function(T){var E,I=T.length,R=this,N=0,O=R.i=R.j=0,M=R.S=[];for(I||(T=[I++]);N<o;)M[N]=N++;for(N=0;N<o;N++)M[N]=M[O=h&O+T[N%I]+(E=M[N])],M[O]=E;(R.g=function(q){for(var J,ee=0,Q=R.i,$=R.j,K=R.S;q--;)J=K[Q=h&Q+1],ee=ee*o+K[h&(K[Q]=K[$=h&$+J])+(K[$]=J)];return R.i=Q,R.j=$,ee})(o)}(_),k=function(){for(var T=C.g(a),E=u,I=0;T<l;)T=(T+I)*o,E*=o,I=C.g(1);for(;T>=c;)T/=2,E/=2,I>>>=1;return(T+I)/E};return k.int32=function(){return 0|C.g(4)},k.quick=function(){return C.g(4)/4294967296},k.double=k,p(m(C.S),e),(y.pass||x||function(T,E,I,R){return R&&(R.S&&f(R,C),T.state=function(){return f(C,{})}),I?(t[s]=T,E):T})(k,b,"global"in y?y.global:this==t,y.state)}function f(g,y){return y.i=g.i,y.j=g.j,y.S=g.S.slice(),y}function p(g,y){for(var x,_=g+"",b=0;b<_.length;)y[h&b]=h&(x^=19*y[h&b])+_.charCodeAt(b++);return m(y)}function m(g){return String.fromCharCode.apply(0,g)}if(t["seed"+s]=d,p(t.random(),e),n.exports){n.exports=d;try{r=require("crypto")}catch{}}})([],Math)});yl.alea=PQ,yl.xor128=OQ,yl.xorwow=MQ,yl.xorshift7=FQ,yl.xor4096=LQ,yl.tychei=BQ;var VQ=yl,tM=VQ.alea,nM=function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=tM(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}();function UQ(n){var e=W(n,"x","clone",null);return z.engine.runKernel(function(t){return Te.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}function WQ(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=vt([n,e],r),o=n<=e?n:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(n,e);if(t==null)return s;if(t.length===1)return Th(Wi(s,0),[t[0],1,1]);if(t.length===2)return Th(Wi(Wi(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Th(Wi(Wi(Wi(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}function jQ(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new nM(e,t,r,!1,i),a=vt(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}function zQ(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new nM(e,t,r,!0,i),a=vt(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}function $Q(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var i=vt(n,r),o=0;o<i.values.length;o++)i.values[o]=Xq(e,t);return i.toTensor()}function HQ(n,e,t){var r=ze(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return Te.make(n,{values:i},t)}function GQ(n,e,t,r){r===void 0&&(r=!1);var i=W(n,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=z.engine.runKernel(function(l){return l.multinomial(s,r,e,t)},{logits2D:s});return a===1?u.as1D():u}function qQ(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=W(n,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),z.engine.runKernel(function(a){return a.oneHot(i,e,t,r)},{$indices:i},function(a){return{$indices:function(){return In(i.shape,"float32")}}}).reshape(o)}function KQ(n,e){var t=W(n,"x","reshape",null);return e=Yq(e,t.size),H(t.size===ze(e),function(){return"new shape and old shape must have the same number of elements."}),z.engine.runKernel(function(r){return r.reshape(t,e)},{$x:t},function(r){return{$x:function(){return r.reshape(t.shape)}}})}function XQ(n,e){var t=W(n,"x","squeeze");return Eo(t,sc(t.shape,e).newShape)}function QQ(n,e){var t=W(n,"x","cast");return z.engine.runKernel(function(r){return r.cast(t,e)},{$x:t},function(r){return{$x:function(){return r.clone()}}})}function YQ(n,e){var t=W(n,"x","tile");return H(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),z.engine.runKernel(function(r,i){var o=r.tile(t,e);return i([t]),o},{$x:t},function(r,i){var o=i[0];return{$x:function(){var a=Mt(o);if(o.rank===1)for(var s=0;s<e[0];++s)a=a.add(r.slice([s*o.shape[0]],[o.shape[0]]));else if(o.rank===2)for(s=0;s<e[0];++s)for(var u=0;u<e[1];++u)a=a.add(r.slice([s*o.shape[0],u*o.shape[1]],[o.shape[0],o.shape[1]]));else if(o.rank===3)for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(var l=0;l<e[2];++l)a=a.add(r.slice([s*o.shape[0],u*o.shape[1],l*o.shape[2]],[o.shape[0],o.shape[1],o.shape[2]]));else{if(o.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+o.rank+" tensors yet.");for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(l=0;l<e[2];++l)for(var c=0;c<e[3];++c)a=a.add(r.slice([s*o.shape[0],u*o.shape[1],l*o.shape[2],c*o.shape[3]],[o.shape[0],o.shape[1],o.shape[2],o.shape[3]]))}return a}}})}function JQ(n,e,t){return t===void 0&&(t=0),H(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Jp(n,[e],t)}function ZQ(n,e,t){return t===void 0&&(t=0),H(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jp(n,e,t)}function eY(n,e,t){return t===void 0&&(t=0),H(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jp(n,e,t)}function tY(n,e,t){return t===void 0&&(t=0),H(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jp(n,e,t)}function nY(n,e,t){t===void 0&&(t=0);var r=W(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=e.map(function(o){return o[0]});return z.engine.runKernel(function(o){return o.pad(r,e,t)},{$x:r},function(o){return{$x:function(){return o.slice(i,r.shape)}}})}function rY(n,e){e===void 0&&(e=0);var t=Yg(n,"tensors","stack");if(H(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;H(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){qt(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){H(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return ai(a,e)}function iY(n,e,t){var r=W(n,"x","batchToSpaceND"),i=e.reduce(function(o,a){return o*a});return H(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),H(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),H(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),z.engine.runKernel(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}function oY(n,e,t){var r=W(n,"x","spaceToBatchND");return H(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),H(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),H(r.shape.reduce(function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),z.engine.runKernel(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}function aY(n,e){e===void 0&&(e=0),e=e||0;var t=W(n,"x","unstack");return H(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),z.engine.runKernel(function(r){return r.unstack(t,e)},{$x:t},function(r){return{$x:function(){return So(r,e)}}})}function sY(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=W(n,"x","cumsum"),o=va([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=ga(1,i.rank)[0],u=z.engine.runKernel(function(l){return l.cumsum(a,s,t,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return o!=null&&(u=u.transpose(o)),u}function uY(n,e){e===void 0&&(e=0);var t=W(n,"x","expandDims");H(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(H(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),Eo(t,r)}function lY(n,e,t){t===void 0&&(t="NHWC");var r=W(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return H(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),H(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),H(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),z.engine.runKernel(function(s){return s.depthToSpace(r,e,t)},{$x:r})}function cY(n,e){return Ht(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h;return Gt(this,function(d){switch(d.label){case 0:return t=W(n,"x","setdiff1d"),r=W(e,"y","setdiff1d"),H(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),H(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),H(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=d.sent(),[4,r.data()];case 2:for(o=d.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new xp([s],t.dtype),l=new xp([s],"int32"),c=0,h=0;c<i.length;c++)a.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})}function vt(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",gO(n),new xp(n,e,t)}function hY(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var rM=Y({batchToSpaceND_:iY}),dY=Y({cast_:QQ}),fY=Y({clone_:UQ}),pY=Y({cumsum_:sY}),mY=Y({depthToSpace_:lY}),Wi=Y({expandDims_:uY}),iM=Y({eye_:WQ}),vY=Y({multinomial_:GQ}),o_=Y({oneHot_:qQ}),Jp=Y({pad_:nY}),gY=Y({pad1d_:JQ}),yY=Y({pad2d_:ZQ}),xY=Y({pad3d_:eY}),wY=Y({pad4d_:tY}),_Y=Y({rand_:HQ}),bY=Y({randomNormal_:jQ}),EY=Y({randomUniform_:$Q}),Eo=Y({reshape_:KQ}),oM=Y({spaceToBatchND_:oY}),aM=Y({squeeze_:XQ}),So=Y({stack_:rY}),Th=Y({tile_:YQ}),CY=Y({truncatedNormal_:zQ}),mr=Y({unstack_:aY}),TY=cY;function FE(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=vt(n,"int32"),o=vt([t.length,n.length],"int32");for(r=0;r<t.length;r++){var a=i.indexToLoc(t[r]),s=r*n.length;o.values.set(a,s)}return o.toTensor()}var yv={};function IY(n){return n in yv||(yv[n]={}),yv[n]}function SY(n,e){if(n==="linear")return wQ;if(n==="relu")return eM;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var RY=128,YS=1e3,kY=function(){function n(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,z.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(e==null){var t=pa(z.get("WEBGL_VERSION"));this.binaryCache=IY(z.get("WEBGL_VERSION")),this.gpgpu=new Q7(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new NX(this.gpgpu)}return n.prototype.register=function(e,t,r){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:r})},n.prototype.setDataMover=function(e){this.texData=new FO(e)},n.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=[e.height,e.width],i=[e.height,e.width,t];if(z.get("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var o=this.makeTensorHandle(r,"int32");this.texData.get(o.dataId).usage=ta.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(o.dataId),e);var a=new t7(i),s=this.compileAndRun(a,[o]);return this.disposeData(o.dataId),s},n.prototype.makeTensorHandle=function(e,t){var r={};return this.register(r,e,t),{dataId:r,shape:e,dtype:t}},n.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendWebGL.write(): values can not be null");if(z.get("DEBUG"))for(var r=0;r<t.length;r++){var i=t[r];if(!h7(i))throw Error("The value "+i+" cannot be represented on this device.")}var o=this.texData.get(e),a=o.texture,s=o.texShape,u=o.usage,l=o.dtype,c=o.isPacked;if(l==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");a!=null&&(this.releaseTexture(e,a,s,u,l,c),o.texture=null,o.texShape=null),o.usage=ta.UPLOAD,o.values=t},n.prototype.readSync=function(e){var t=this.texData.get(e),r=t.values,i=t.dtype,o=t.complexTensors,a=t.slice,s=t.shape;if(a!=null){var u=new ct(s,QS),l=this.compileAndRun(u,[{dataId:e,shape:s,dtype:i}]),c=this.readSync(l.dataId);return l.dispose(),c}if(r!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return r;var h,d,f=this.activeTimers!=null;return f&&(h=performance.now()),i==="complex64"?d=BO(o.real.dataSync(),o.imag.dataSync()):d=this.getValuesFromTexture(e),f&&(this.downloadWaitMs+=performance.now()-h),this.convertAndCacheOnCPU(e,d)},n.prototype.read=function(e){return Ht(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,d,f,p,m,g,y,x,_,b,C,k,T,E,I;return Gt(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(e))return i=this.pendingRead.get(e),[2,new Promise(function(N){return i.push(N)})];if(o=this.texData.get(e),a=o.texture,s=o.values,u=o.texShape,l=o.isPacked,c=o.shape,h=o.slice,d=o.dtype,h!=null)return f=new ct(c,QS),p=this.compileAndRun(f,[{dataId:e,shape:c,dtype:d}]),m=this.read(p.dataId),p.dispose(),[2,m];if(s!=null)return[2,this.convertAndCacheOnCPU(e)];if(this.pendingRead.set(e,[]),!z.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&z.get("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return g=u[1],y=u[0],l&&(t=cc(u[0],u[1]),g=t[0],y=t[1]),x=this.gpgpu.maybeCreateBufferFromTexture(a,y,g),[4,this.gpgpu.createAndWaitForFence()];case 1:return R.sent(),x instanceof WebGLTexture?_=this.getValuesFromTexture(e):(b=ze(c),l?(C=Kc(c),k=1,T=1,c.length&&(r=Xc(c),k=r[0],T=r[1]),_=this.gpgpu.downloadPackedMatrixFromBuffer(x,C,k,T,u[0],u[1]).subarray(0,b)):_=this.gpgpu.downloadFloat32MatrixFromBuffer(x,u[0],u[1]).subarray(0,b)),E=this.convertAndCacheOnCPU(e,_),I=this.pendingRead.get(e),this.pendingRead.delete(e),I.forEach(function(N){return N(E)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,E]}})})},n.prototype.getValuesFromTexture=function(e){var t,r=this,i=this.texData.get(e),o=i.shape,a=i.dtype,s=i.texture,u=i.texShape,l=ze(o);if(z.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(e).isPacked){var c=Kc(o),h=1,d=1;return o.length&&(h=(t=Xc(o))[0],d=t[1]),this.gpgpu.downloadMatrixFromPackedTexture(s,c,h,d,u[0],u[1]).subarray(0,l)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(s,u[0],u[1]).subarray(0,l)}var f=this.makeTensorHandle(o,"float32");f.size=ze(o),this.texData.get(f.dataId).usage=ta.DOWNLOAD;var p=Ve(function(){var y=new Z8(o);return r.compileAndRun(y,[{shape:o,dtype:a,dataId:e}],f,null,!1)}),m=this.texData.get(p.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,l);return this.disposeData(f.dataId),g},n.prototype.time=function(e){return Ht(this,void 0,void 0,function(){var t,r,i,o,a,s,u;return Gt(this,function(l){switch(l.label){case 0:return t=this.activeTimers,r=[],i=!1,this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,e(),o=Zh(this.activeTimers.map(function(c){return c.query})).filter(function(c){return c!=null}),a=Zh(this.activeTimers.map(function(c){return c.name})).filter(function(c){return c!=null}),this.activeTimers=t,i&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return s=l.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:Kq(s),getExtraProfileInfo:function(){return s.map(function(c,h){return{name:a[h],ms:c}}).map(function(c){return c.name+": "+c.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},n.prototype.endTimer=function(e){return z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},n.prototype.getQueryTime=function(e){return Ht(this,void 0,void 0,function(){var t;return Gt(this,function(r){return z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){var t=this.texData.get(e),r=t.texture,i=t.dtype,o=t.texShape,a=t.usage,s=t.complexTensors,u=t.isPacked,l=t.slice;if(r!=null){var c=l&&l.origDataId||e,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),this.releaseTexture(e,r,o,a,i,u),this.texData.delete(e))}s!=null&&(s.real.dispose(),s.imag.dispose())}}},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getCPUBackend=function(){return z.get("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=z.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,t){var r=this;return t===void 0&&(t=RY),this.getCPUBackend()!=null&&e.every(function(i){return r.texData.get(i.dataId).texture==null&&i.size<t})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.getCanvas=function(){return this.canvas},n.prototype.complex=function(e,t){var r=this.makeOutputArray(e.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:z.engine.keep(e.clone()),imag:z.engine.keep(t.clone())},r},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,r);var i=this.texData.get(e.dataId).isPacked,o=DO(e.shape,t,r);if(i||!o){var a=z.get("WEBGL_PACK_ARRAY_OPERATIONS")?new kX(r):new SX(r),s=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,s)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,r)},n.prototype.shallowSlice=function(e,t,r){var i=this.texData.get(e.dataId),o=Te.make(r,{},e.dtype,this),a=this.texData.get(o.dataId);Object.assign(a,i),a.shape=r,a.dtype=e.dtype;var s=PO(t,e.strides);i.slice&&(s+=i.slice.flatOffset),a.slice={flatOffset:s,origDataId:i.slice&&i.slice.origDataId||e.dataId};var u=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,u+1),o},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u,l){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,r,i,o,a,s,u,l);var c=RE(e.shape,t,r,i,o,a,s,u,l),h=c[0],d=c[1],f=c[2],p=d.filter(function(g,y){return f.indexOf(y)===-1});if(p.some(function(g){return g===0}))return On([],p);var m=new AX(h,i,d,f);return this.compileAndRun(m,[e])},n.prototype.reverse=function(e,t){var r=z.get("WEBGL_PACK_ARRAY_OPERATIONS")?new CX(e.shape,t):new EX(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(e.length===1)return e[0];if(e.length>z.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),i=this.concat(e.slice(0,r),t),o=this.concat(e.slice(r),t);return this.concat([i,o],t)}if(z.get("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new B8(e.map(function(c){return c.shape}),t);return this.compileAndRun(a,e)}var s=ed(e.map(function(c){return c.shape}),t),u=e.map(function(c){return c.as2D(-1,ze(c.shape.slice(t)))}),l=new L8(u.map(function(c){return c.shape}));return this.compileAndRun(l,u).reshape(s)},n.prototype.neg=function(e){var t=new ct(e.shape,jX);return this.compileAndRun(t,[e])},n.prototype.batchMatMul=function(e,t,r,i){var o=r?e.shape[2]:e.shape[1],a=i?t.shape[1]:t.shape[2],s=r?e.shape[1]:e.shape[2],u=e.shape[0];if((o===1||a===1)&&s>YS){r&&(e=e.transpose([0,2,1])),i&&(t=t.transpose([0,2,1]));var l=a===1?e:e.as3D(u,s,1),c=a===1?2:1,h=a===1?t.as3D(u,1,s):t;return this.multiply(l,h).sum(c,!0)}var d=nr(e.dtype,t.dtype),f=new q1(e.shape,[u,o,a],r,i),p=this.makePackedTensor(f.outputShape,d);return this.compileAndRun(f,[e,t],p)},n.prototype.fusedBatchMatMul=function(e,t,r,i,o,a){var s=r?e.shape[2]:e.shape[1],u=i?t.shape[1]:t.shape[2],l=e.shape[0],c=nr(e.dtype,t.dtype),h=new q1(e.shape,[l,s,u],r,i,!!o,a?SY(a):null),d=this.makePackedTensor(h.outputShape,c),f=[e,t];return o&&f.push(o),this.compileAndRun(h,f,d)},n.prototype.multiply=function(e,t){if(e.dtype==="complex64"){var r=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=new LS(FS.REAL,e.shape,t.shape),a=new LS(FS.IMAG,e.shape,t.shape),s=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag),this.makeComplexComponentTensorHandle(t,i.complexTensors.real),this.makeComplexComponentTensorHandle(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l);return u.dispose(),l.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,BS,e.dtype);var h=new gn(BS,e.shape,t.shape),d=this.makeOutputArray(h.outputShape,e.dtype);return this.compileAndRun(h,[e,t],d)},n.prototype.batchNormalization=function(e,t,r,i,o,a){var s=[e,t,r],u=null;a!=null&&(u=a.shape,s.push(a));var l=null;if(o!=null&&(l=o.shape,s.push(o)),z.get("WEBGL_PACK_BATCHNORMALIZATION")){var c=new e8(e.shape,t.shape,r.shape,u,l,i);return this.compileAndRun(c,s)}var h=new ZK(e.shape,t.shape,r.shape,u,l,i);return this.compileAndRun(h,s)},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){var a=new nX(e.shape,t,r,i,o);return this.compileAndRun(a,[e])},n.prototype.LRNGrad=function(e,t,r,i,o,a,s){var u=new rX(t.shape,i,o,a,s);return this.compileAndRun(u,[t,r,e])},n.prototype.tile=function(e,t){var r=new DX(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.pad=function(e,t,r){var i=z.get("WEBGL_PACK_ARRAY_OPERATIONS")?new fX(e.shape,t,r):new dX(e.shape,t,r);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var r=z.get("WEBGL_PACK_ARRAY_OPERATIONS")?new FX(e.shape,t):new OX(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.gather=function(e,t,r){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,r);var i=new n7(e.shape,t.size,r);return this.compileAndRun(i,[e,t])},n.prototype.batchToSpaceND=function(e,t,r){H(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(c,h){return c*h}),o=Jg(e.shape,t,i),a=Zg(o.length,t.length),s=ey(e.shape,t,i),u=SO(r,t.length),l=RO(s,r,t.length);return e.reshape(o).transpose(a).reshape(s).slice(u,l)},n.prototype.spaceToBatchND=function(e,t,r){H(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(h,d){return h*d}),o=[[0,0]];o.push.apply(o,r);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var s=e.pad(o),u=Jg(s.shape,t,i,!1),l=Zg(u.length,t.length,!1),c=ey(s.shape,t,i,!1);return s.reshape(u).transpose(l).reshape(c)},n.prototype.reduce=function(e,t,r){var i=e.shape[0],o=e.shape[1],a=j1(o),s=new pX({windowSize:a,inSize:o,batchSize:i},t),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],r);return this.compileAndRun(s,[e],h),h.shape[1]===1?h:this.reduce(h,t,r)},n.prototype.argReduce=function(e,t,r){r===void 0&&(r=null);var i=e.shape[0],o=e.shape[1];r!=null&&(i=r.shape[0],o=r.shape[1]);var a=j1(o),s=new dK({windowSize:a,inSize:o,batchSize:i},t,r==null),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],"int32"),d=[e];return r!=null&&d.push(r),this.compileAndRun(s,d,h),h.shape[1]===1?h:this.argReduce(e,t,h)},n.prototype.argReducePacked=function(e,t,r){r===void 0&&(r=null);var i=r!=null?r.shape:e.shape,o=j1(i[i.length-1]),a=new YK(i,o,t,r==null),s=this.makePackedTensor(a.outputShape,"int32"),u=r==null?[e]:[e,r];return this.compileAndRun(a,u,s),s.rank===e.rank?this.argReducePacked(e,t,s):s},n.prototype.sum=function(e,t){pi("sum",t,e.rank);var r=Ir(e.shape,t),i=r[0],o=ze(r[1]),a=e.as2D(-1,o),s=B1(e.dtype);return this.reduce(a,"sum",s).reshape(i)},n.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var r=Ir(e.shape,t),i=r[0],o=ze(r[1]),a=e.as2D(-1,o),s=B1(e.dtype);return this.reduce(a,"prod",s).reshape(i)},n.prototype.unsortedSegmentSum=function(e,t,r){var i=0,o=va([i],e.rank),a=e;o!=null&&(a=e.transpose(o),i=ga(1,e.rank)[0]);var s=z9(a.shape,i,r),u=ze([a.shape[i]]),l=a.as2D(-1,u),c=B1(e.dtype),h=this.segOpCompute(l,"unsortedSegmentSum",t,c,r).reshape(s);return o!=null&&(h=h.transpose(SE(o))),h},n.prototype.segOpCompute=function(e,t,r,i,o){var a=e.shape[0],s=e.shape[1],u=j9(s,o),l=new TX({windowSize:u,inSize:s,batchSize:a,numSegments:o},t),c=l.outputShape,h=c[0],d=c[1],f=this.makeOutputArray([h,d],i);return this.compileAndRun(l,[e,r],f),f.shape[1]===o?f:(r=OO(0,o).tile([s/u]),this.segOpCompute(f,t,r,i,o))},n.prototype.argMinMaxReduce=function(e,t,r){var i=[t];if(pi("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.rank),!z.get("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Ir(e.shape,i),a=o[0],s=ze(o[1]),u=e.as2D(-1,s);return this.argReduce(u,r).reshape(a)}return this.argReducePacked(e,r)},n.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},n.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},n.prototype.cumsum=function(e,t,r,i){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new Q8(e.shape,r,i);return this.compileAndRun(o,[e])},n.prototype.equal=function(e,t){if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,E8,"bool");var r=new gn(i8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.notEqual=function(e,t){if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,C8,"bool");var r=new gn(o8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,T8,"bool");var r=new gn(a8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.lessEqual=function(e,t){if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,I8,"bool");var r=new gn(s8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,S8,"bool");var r=new gn(u8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.greaterEqual=function(e,t){if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,R8,"bool");var r=new gn(l8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.logicalNot=function(e){var t=new ct(e.shape,yQ);return this.compileAndRun(t,[e])},n.prototype.logicalAnd=function(e,t){if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,k8,"bool");var r=new gn(c8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.logicalOr=function(e,t){if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,A8,"bool");var r=new gn(h8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.select=function(e,t,r){var i=new IX(e.rank,t.shape,t.rank),o=this.makeOutputArray(i.outputShape,nr(t.dtype,r.dtype));return this.compileAndRun(i,[e,t,r],o)},n.prototype.where=function(e){n_("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return FE(e.shape,t)},n.prototype.topk=function(e,t,r){return UO(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){pi("min",t,e.rank);var r=Ir(e.shape,t),i=r[0],o=ze(r[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(i)},n.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var r=z.get("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(D8,e.shape,t.shape):new gn(f8,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.mod=function(e,t){var r=z.get("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(P8,e.shape,t.shape):new gn(p8,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);pi("max",t,e.rank);var r=Ir(e.shape,t),i=r[0],o=ze(r[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(i)},n.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var r=z.get("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(N8,e.shape,t.shape):new gn(d8,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.all=function(e,t){pi("all",t,e.rank);var r=Ir(e.shape,t),i=r[0],o=ze(r[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(i)},n.prototype.any=function(e,t){pi("any",t,e.rank);var r=Ir(e.shape,t),i=r[0],o=ze(r[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(i)},n.prototype.squaredDifference=function(e,t){var r=z.get("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(VS,e.shape,t.shape):new gn(VS,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.realDivide=function(e,t){var r=new gn(t8,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],i)},n.prototype.floorDiv=function(e,t){var r=n8;if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,y8,"int32");var i=new gn(r,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,"int32");return this.compileAndRun(i,[e,t],o)},n.prototype.add=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,z1);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var r=nr(e.dtype,t.dtype);if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,z1,r);var i=new gn(z1,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[e,t],o)},n.prototype.packedBinaryOp=function(e,t,r,i){var o=new Oa(r,e.shape,t.shape),a=this.makePackedTensor(o.outputShape,i);return this.compileAndRun(o,[e,t],a)},n.prototype.complexSeparableBinaryOp=function(e,t,r){var i=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),s=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(h){var d=h[0],f=h[1],p=i.makeComplexComponentTensorHandle(e,d),m=i.makeComplexComponentTensorHandle(t,f),g=new gn(r,e.shape,t.shape),y=i.makeOutputArray(g.outputShape,nr(d.dtype,f.dtype));return i.compileAndRun(g,[p,m],y)}),u=s[0],l=s[1],c=this.complex(u,l);return u.dispose(),l.dispose(),c},n.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},n.prototype.addN=function(e){for(var t=e[0],r=1;r<e.length;r++)t=this.add(t,e[r]);return t},n.prototype.subtract=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,$1);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var r=nr(e.dtype,t.dtype);if(z.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,$1,e.dtype);var i=new gn($1,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[e,t],o)},n.prototype.pow=function(e,t){var r=z.get("WEBGL_PACK_BINARY_OPERATIONS"),i=r?new Oa(x8,e.shape,t.shape):new gn(r8,e.shape,t.shape),o=nr(e.dtype,t.dtype),a=r?this.makePackedTensor(i.outputShape,o):this.makeOutputArray(i.outputShape,o);return this.compileAndRun(i,[e,t],a)},n.prototype.ceil=function(e){var t=new ct(e.shape,zX);return this.compileAndRun(t,[e])},n.prototype.floor=function(e){var t=new ct(e.shape,$X);return this.compileAndRun(t,[e])},n.prototype.sign=function(e){var t=new ct(e.shape,HX);return this.compileAndRun(t,[e])},n.prototype.isNaN=function(e){var t=new ct(e.shape,GX),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isInf=function(e){var t=new ct(e.shape,qX),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isFinite=function(e){var t=new ct(e.shape,KX),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.round=function(e){var t=new ct(e.shape,XX);return this.compileAndRun(t,[e])},n.prototype.exp=function(e){var t;return t=z.get("WEBGL_PACK")?new X1(e.shape,XS):new ct(e.shape,XS),this.compileAndRun(t,[e])},n.prototype.expm1=function(e){var t=new ct(e.shape,QX);return this.compileAndRun(t,[e])},n.prototype.log=function(e){var t;return t=z.get("WEBGL_PACK")?new X1(e.shape,_Q):new ct(e.shape,YX),this.compileAndRun(t,[e])},n.prototype.log1p=function(e){var t=new ct(e.shape,JX);return this.compileAndRun(t,[e])},n.prototype.sqrt=function(e){var t=new ct(e.shape,ZX);return this.compileAndRun(t,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new ct(e.shape,eQ);return this.compileAndRun(t,[e])},n.prototype.square=function(e){var t=new ct(e.shape,vQ);return this.compileAndRun(t,[e])},n.prototype.reciprocal=function(e){var t=new ct(e.shape,gQ);return this.compileAndRun(t,[e])},n.prototype.relu=function(e){var t;return t=z.get("WEBGL_PACK")?new X1(e.shape,eM):new ct(e.shape,BX),this.compileAndRun(t,[e])},n.prototype.prelu=function(e,t){var r=z.get("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(w8,e.shape,t.shape):new gn(g8,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.elu=function(e){var t=new ct(e.shape,VX);return this.compileAndRun(t,[e])},n.prototype.eluDer=function(e,t){var r=z.get("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(_8,e.shape,t.shape):new gn(v8,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.selu=function(e){var t=new ct(e.shape,UX);return this.compileAndRun(t,[e])},n.prototype.int=function(e){var t=new ct(e.shape,xQ),r=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],r)},n.prototype.clip=function(e,t,r){var i,o=(i=z.get("WEBGL_PACK_CLIP")?new M8(e.shape):new O8(e.shape)).getCustomSetupFunc(t,r);return this.compileAndRun(i,[e],null,o)},n.prototype.abs=function(e){var t=new ct(e.shape,LX);return this.compileAndRun(t,[e])},n.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),r=new F8(e.shape),i=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(r,i)},n.prototype.sigmoid=function(e){var t=new ct(e.shape,tQ);return this.compileAndRun(t,[e])},n.prototype.softplus=function(e){var t=new ct(e.shape,nQ);return this.compileAndRun(t,[e])},n.prototype.sin=function(e){var t=new ct(e.shape,rQ);return this.compileAndRun(t,[e])},n.prototype.cos=function(e){var t=new ct(e.shape,iQ);return this.compileAndRun(t,[e])},n.prototype.tan=function(e){var t=new ct(e.shape,oQ);return this.compileAndRun(t,[e])},n.prototype.asin=function(e){var t=new ct(e.shape,aQ);return this.compileAndRun(t,[e])},n.prototype.acos=function(e){var t=new ct(e.shape,sQ);return this.compileAndRun(t,[e])},n.prototype.atan=function(e){var t=new ct(e.shape,uQ);return this.compileAndRun(t,[e])},n.prototype.atan2=function(e,t){var r=z.get("WEBGL_PACK_BINARY_OPERATIONS")?new Oa(b8,e.shape,t.shape):new gn(m8,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.sinh=function(e){var t=new ct(e.shape,lQ);return this.compileAndRun(t,[e])},n.prototype.cosh=function(e){var t=new ct(e.shape,cQ);return this.compileAndRun(t,[e])},n.prototype.tanh=function(e){var t=new ct(e.shape,hQ);return this.compileAndRun(t,[e])},n.prototype.asinh=function(e){var t=new ct(e.shape,dQ);return this.compileAndRun(t,[e])},n.prototype.acosh=function(e){var t=new ct(e.shape,fQ);return this.compileAndRun(t,[e])},n.prototype.atanh=function(e){var t=new ct(e.shape,pQ);return this.compileAndRun(t,[e])},n.prototype.erf=function(e){var t=new ct(e.shape,mQ);return this.compileAndRun(t,[e])},n.prototype.step=function(e,t){var r=new ct(e.shape,WX(t));return this.compileAndRun(r,[e])},n.prototype.conv2dByMatMul=function(e,t,r){var i=e.shape,o=this.texData.get(e.dataId),a=r.inChannels,s=i[0]*i[1]*i[2],u=r.outChannels,l=(s===1||u===1)&&a>YS,c=i[2]%2!=0&&!!o.isPacked;if(l||!z.get("WEBGL_LAZILY_UNPACK")||!z.get("WEBGL_PACK_BINARY_OPERATIONS")||!c){var h=this.reshape(e,[1,i[0]*i[1]*i[2],r.inChannels]),d=this.reshape(t,[1,r.inChannels,r.outChannels]);return this.reshape(this.batchMatMul(h,d,!1,!1),r.outShape)}var f=Te.make([1,i[0]*i[1]*(i[2]+1),r.inChannels],{dataId:e.dataId},e.dtype,this),p=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,H(gv(o.shape,f.shape),function(){return"packed reshape "+o.shape+" to "+f.shape+" isn't free"});var m=this.reshape(t,[1,r.inChannels,r.outChannels]),g=this.batchMatMul(f,m,!1,!1),y=this.texData.get(g.dataId);return H(y.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=p,y.shape=r.outShape,Te.make(r.outShape,{dataId:g.dataId},g.dtype,this)},n.prototype.conv2dWithIm2Row=function(e,t,r){var i=r.filterWidth,o=r.filterHeight,a=r.inChannels,s=r.outWidth,u=r.outHeight,l=i*o*a,c=u*s,h=[l,c],d=e.squeeze([0]),f=t.reshape([1,l,-1]),p=new tX(h,d.shape,r),m=this.compileAndRun(p,[d]).reshape([1,h[0],h[1]]),g=new q1(m.shape,[1,c,r.outChannels],!0,!1);return this.compileAndRun(g,[m,f]).reshape([1,u,s,r.outChannels])},n.prototype.conv2d=function(e,t,r){if(r.filterHeight===1&&r.filterWidth===1&&r.dilationHeight===1&&r.dilationWidth===1&&r.strideHeight===1&&r.strideWidth===1&&(r.padInfo.type==="SAME"||r.padInfo.type==="VALID"))return this.conv2dByMatMul(e,t,r);if(z.get("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,t,r);var i=new H8(r);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerInput=function(e,t,r){var i=new U8(r);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerFilter=function(e,t,r){var i=new V8(r);return this.compileAndRun(i,[e,t])},n.prototype.depthwiseConv2D=function(e,t,r){var i;return z.get("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(i=new K8(r),this.compileAndRun(i,[e,t],this.makePackedTensor(r.outShape,e.dtype))):(i=new q8(r),this.compileAndRun(i,[e,t]))},n.prototype.depthwiseConv2DDerInput=function(e,t,r){var i=new $8(r);return this.compileAndRun(i,[e,t])},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){var i=new z8(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3d=function(e,t,r){var i=new G8(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerInput=function(e,t,r){var i=new j8(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerFilter=function(e,t,r){var i=new W8(r);return this.compileAndRun(i,[e,t])},n.prototype.maxPool=function(e,t){var r=new K1(t,"max",!1),i=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],i)},n.prototype.avgPool=function(e,t){var r=new K1(t,"avg",!1),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e],i)},n.prototype.maxPoolBackprop=function(e,t,r,i){var o=new K1(i,"max",!0),a=this.compileAndRun(o,[t]),s=new iX(i),u=this.makeOutputArray(s.outputShape,t.dtype),l=this.compileAndRun(s,[e,a],u);return a.dispose(),l},n.prototype.avgPoolBackprop=function(e,t,r){var i=new JK(r),o=this.makeOutputArray(i.outputShape,t.dtype);return this.compileAndRun(i,[e],o)},n.prototype.cast=function(e,t){return LO(e,t,this)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],i=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(i[o++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(r);for(a=0;a<l.length;a++)s[t]=a,l[a]=this.slice(e,s,u).reshape(i);return l},n.prototype.reshape=function(e,t){var r=this.texData.get(e.dataId);return!r.isPacked||gv(e.shape,t)||r.texture!==null&&gv(r.shape,t)?r_(e,t):this.packedReshape(e,t)},n.prototype.resizeBilinear=function(e,t,r,i){var o=z.get("WEBGL_PACK_IMAGE_OPERATIONS")?new wX(e.shape,t,r,i):new xX(e.shape,t,r,i);return this.compileAndRun(o,[e])},n.prototype.resizeBilinearBackprop=function(e,t,r){var i=new yX(e,t,r);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,t,r,i){var o=new bX(e.shape,t,r,i);return this.compileAndRun(o,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){var i=new _X(e,t,r);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,t,r,i){var o=t?e:$u(e),a=o.shape[0],s=o.shape[1],u=new oX(a,s,r),l=this.makeOutputArray(u.outputShape,"int32"),c=u.getCustomSetupFunc(i);return this.compileAndRun(u,[o],l,c)},n.prototype.oneHot=function(e,t,r,i){var o=new aX(e.size,t,r,i);return this.compileAndRun(o,[e])},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return n_("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),AE(e.dataSync(),t.dataSync(),r,i,o)},n.prototype.cropAndResize=function(e,t,r,i,o,a){var s=new X8(e.shape,t.shape,i,o,a);return this.compileAndRun(s,[e,t,r])},n.prototype.depthToSpace=function(e,t,r){H(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var i=e.shape[0],o=r==="NHWC"?e.shape[1]:e.shape[2],a=r==="NHWC"?e.shape[2]:e.shape[3],s=r==="NHWC"?e.shape[3]:e.shape[1],u=o*t,l=a*t,c=s/(t*t),h=new J8(r==="NHWC"?[i,u,l,c]:[i,c,u,l],t,r);return this.compileAndRun(h,[e])},n.prototype.split=function(e,t,r){return VO(e,t,r)},n.prototype.scatterND=function(e,t,r){var i=ty(t,e,r),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,l=i.outputSize,c=[l/s,s],h=e.reshape([a,o]),d=t.reshape([a,s]);if(l===0)return r_(On([]),r);var f=ye(0),p=new GS(a,o,h.rank,d.rank,u,c);return this.compileAndRun(p,[d,h,f]).reshape(r)},n.prototype.sparseToDense=function(e,t,r,i){var o=ty(t,e,r),a=o.sliceRank,s=o.numUpdates,u=o.strides,l=o.outputSize,c=new GS(s,a,e.rank,t.rank,u,[l,1],!1);return this.compileAndRun(c,[t,e,i]).reshape(r)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,t){var r=this.texData.get(e.dataId),i=new jS(WS.REAL,e.shape,t),o=new jS(WS.IMAG,e.shape,t),a=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(i,a),u=this.compileAndRun(o,a),l=this.complex(s,u).as2D(e.shape[0],e.shape[1]);return s.dispose(),u.dispose(),l},n.prototype.gatherND=function(e,t){var r=t.shape,i=r[r.length-1],o=AO(e,t),a=o[0],s=o[1],u=o[2],l=o[3],c=t.reshape([s,i]),h=e.reshape([e.size/u,u]),d=new i7(i,l,[s,u]);return this.compileAndRun(d,[h,c]).reshape(a)},n.prototype.fill=function(e,t,r){if((r=r||$p(t))==="string"){var i=Xg(r,ze(e));return i.fill(t),Te.make(e,{values:i},r)}var o=new e7(e,t),a=o.getCustomSetupFunc(t),s=this.makeOutputArray(e,r);return this.compileAndRun(o,[],s,a)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},n.prototype.makeOutputArray=function(e,t){return Te.make(e,{},t,this)},n.prototype.makePackedTensor=function(e,t){var r=Te.make(e,{},t,this);return this.texData.get(r.dataId).isPacked=!0,r},n.prototype.unpackTensor=function(e){var t=new bQ(e.shape);return this.compileAndRun(t,[e],Te.make(t.outputShape,{},e.dtype,this))},n.prototype.packTensor=function(e){var t=new sX(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype))},n.prototype.packedReshape=function(e,t){var r=e.reshape([Kc(e.shape)].concat(Xc(e.shape))),i=[Kc(t)].concat(Xc(t)),o=new mX(i,r.shape);return this.compileAndRun(o,[r]).reshape(t)},n.prototype.compileAndRun=function(e,t,r,i,o){var a=this;if(o===void 0&&(o=!0),r==null&&(r=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),r.size===0)return this.texData.get(r.dataId).values=Xw(r.dtype,0),r;var s=t.map(function(_){if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=a.texData.get(_.dataId);if(b.texture==null){if(!e.usesPackedTextures&&ze(_.shape)<=z.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:a.readSync(_.dataId)};e.usesPackedTextures&&(b.isPacked=!0,b.shape=_.shape)}else if(!!b.isPacked!=!!e.usesPackedTextures)_=b.isPacked?a.unpackTensor(_):a.packTensor(_),b=a.texData.get(_.dataId);else if(b.isPacked&&!gv(b.shape,_.shape)){var C=_,k=_.shape;_.shape=b.shape,_=a.packedReshape(_,k),b=a.texData.get(_.dataId),C.shape=k}return a.uploadToGPU(_.dataId),{shape:_.shape,texData:b,isUniform:!1}});this.uploadToGPU(r.dataId);var u,l={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},c=eX(e,s,l),h=this.getAndSaveBinary(c,function(){return J7(a.gpgpu,e,s,l)}),d=this.activeTimers!=null;d&&(u=this.startTimer()),Z7(this.gpgpu,h,s,l,i);var f=1024*z.get("WEBGL_NUM_MB_BEFORE_PAGING");if(o&&this.numBytesInGPU>f)for(var p=this.numBytesInGPU-f;p>0&&this.lruDataGPU.length>0;){var m=this.lruDataGPU.shift(),g=this.texData.get(m),y=g.texShape,x=g.dtype;p-=this.computeBytes(y,x),this.read(m)}return d&&(u=this.endTimer(u),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(u)})),z.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(r.dataId).isPacked||e.isPackShader?r:this.unpackTensor(r)},n.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return Ve(function(){var t=z.get("DEBUG");z.set("DEBUG",!1);var r=e.abs(ye(1e-8)).dataSync()[0];return z.set("DEBUG",t),r>0?32:16})},n.prototype.uploadToGPU=function(e){var t,r=this.texData.get(e),i=r.shape,o=r.dtype,a=r.values,s=r.texture,u=r.usage,l=r.isPacked;if(s==null){var c,h=this.activeTimers!=null;h&&(c=performance.now());var d=A7(i,l);r.texShape=d;var f=this.acquireTexture(e,d,u,o,l);if(r.texture=f,a!=null){if(l){var p=Kc(i),m=1,g=1;i.length&&(m=(t=Xc(i))[0],g=t[1]),this.gpgpu.uploadMatrixToPackedTexture(f,p,m,g,d[0],d[1],JS(a))}else this.gpgpu.uploadMatrixToTexture(f,d[0],d[1],JS(a));r.values=null,h&&(this.uploadWaitMs+=performance.now()-c)}}else z.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.indexOf(e)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(e),1),this.lruDataGPU.push(e))},n.prototype.convertAndCacheOnCPU=function(e,t){var r=this.texData.get(e),i=r.texture,o=r.texShape,a=r.dtype,s=r.usage,u=r.isPacked;return i!=null&&(this.releaseTexture(e,i,o,s,a,u),r.texture=null,r.texShape=null,r.isPacked=!1),r.usage=ta.UPLOAD,t!=null&&(r.values=AY(t,a)),r.values},n.prototype.releaseTexture=function(e,t,r,i,o,a){if(z.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY){var s=this.lruDataGPU.indexOf(e);s>=0&&this.lruDataGPU.splice(s,1)}this.numBytesInGPU-=this.computeBytes(r,o),this.textureManager.releaseTexture(t,r,i,a)},n.prototype.acquireTexture=function(e,t,r,i,o){return z.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.push(e),this.numBytesInGPU+=this.computeBytes(t,i),this.textureManager.acquireTexture(t,r,o)},n.prototype.computeBytes=function(e,t){return e[0]*e[1]*dO(t)},n}();function AY(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length),r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}throw new Error("Unknown dtype "+e)}function JS(n){return n instanceof Float32Array?n:new Float32Array(n)}function NY(n){var e=W(n,"x","neg");return z.engine.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}function DY(n){var e=W(n,"x","ceil");return z.engine.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Mt(t)}}})}function PY(n){var e=W(n,"x","floor");return z.engine.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Mt(t)}}})}function OY(n){var e=W(n,"x","sign");return z.engine.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Mt(t)}}})}function MY(n){var e=W(n,"x","isNaN");return z.engine.runKernel(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Mt(t)}}})}function FY(n){var e=W(n,"x","isInf");return z.engine.runKernel(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Mt(t)}}})}function LY(n){var e=W(n,"x","isFinite");return z.engine.runKernel(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Mt(t)}}})}function BY(n){var e=W(n,"x","round");return z.engine.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Mt(t)}}})}function VY(n){var e=W(n,"x","exp");return z.engine.runKernel(function(t,r){var i=t.exp(e);return r([i]),i},{$x:e},function(t,r){return{$x:function(){return t.mulStrict(r[0])}}})}function UY(n){var e=W(n,"x","expm1");return z.engine.runKernel(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}function WY(n){var e=W(n,"x","log");return z.engine.runKernel(function(t,r){var i=t.log(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat())}}})}function jY(n){var e=W(n,"x","log1p");return z.engine.runKernel(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}function zY(n){var e=W(n,"x","sqrt");return z.engine.runKernel(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}function $Y(n){var e=W(n,"x","rsqrt");return z.engine.runKernel(function(t,r){var i=t.rsqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.pow(1.5).mul(2)).neg()}}})}function HY(n){var e=W(n,"x","square");return z.engine.runKernel(function(t,r){return r([e]),t.square(e)},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.toFloat().mul(2))}}})}function GY(n){var e=W(n,"x","reciprocal");return z.engine.runKernel(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}function qY(n){var e=W(n,"x","abs");return e.dtype==="complex64"?z.engine.runKernel(function(t){return t.complexAbs(e)},{$x:e}):z.engine.runKernel(function(t,r){var i=t.abs(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.toFloat().step(-1))}}})}function KY(n,e,t){var r=W(n,"x","clipByValue");return H(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),z.engine.runKernel(function(i,o){var a=i.clip(r,e,t);return o([r]),a},{$x:r},function(i,o){var a=o[0];return{$x:function(){return i.where(a.greaterEqual(e).logicalAnd(a.lessEqual(t)),Mt(i))}}})}function XY(n){var e=W(n,"x","sigmoid");return z.engine.runKernel(function(t,r){var i=t.sigmoid(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.mul(ye(1).sub(i)))}}})}function QY(n){var e=W(n,"x","logSigmoid");return z.engine.runKernel(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}function YY(n){var e=W(n,"x","softplus");return z.engine.runKernel(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}function JY(n){var e=W(n,"x","sin");return z.engine.runKernel(function(t,r){var i=t.sin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cos().mul(t)}}})}function ZY(n){var e=W(n,"x","cos");return z.engine.runKernel(function(t,r){var i=t.cos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sin().neg().mul(t)}}})}function eJ(n){var e=W(n,"x","tan");return z.engine.runKernel(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}function tJ(n){var e=W(n,"x","asin");return z.engine.runKernel(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(ye(1).sub(i.toFloat().square()).sqrt())}}})}function nJ(n){var e=W(n,"x","acos");return z.engine.runKernel(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(ye(1).sub(i.toFloat().square()).sqrt()).neg()}}})}function rJ(n){var e=W(n,"x","atan");return z.engine.runKernel(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}function iJ(n){var e=W(n,"x","sinh");return z.engine.runKernel(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}function oJ(n){var e=W(n,"x","cosh");return z.engine.runKernel(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}function aJ(n){var e=W(n,"x","tanh");return z.engine.runKernel(function(t,r){var i=t.tanh(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return ye(1).sub(i.square()).mulStrict(t)}}})}function sJ(n){var e=W(n,"x","asinh");return z.engine.runKernel(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(ye(1).add(i.toFloat().square()).sqrt())}}})}function uJ(n){var e=W(n,"x","acosh");return z.engine.runKernel(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}function lJ(n){var e=W(n,"x","atanh");return z.engine.runKernel(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(ye(1).sub(i.toFloat().square()))}}})}function cJ(n){var e=W(n,"x","erf");return H(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),z.engine.runKernel(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}function hJ(n,e){e===void 0&&(e=0);var t=W(n,"x","step");return z.engine.runKernel(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Mt(r)}}})}z.get("IS_BROWSER")&&z.registerBackend("webgl",function(){return new kY},2);var dJ=Y({abs_:qY}),fJ=Y({acos_:nJ}),pJ=Y({acosh_:uJ}),mJ=Y({asin_:tJ}),vJ=Y({asinh_:sJ}),gJ=Y({atan_:rJ}),yJ=Y({atanh_:lJ}),xJ=Y({ceil_:DY}),LE=Y({clipByValue_:KY}),wJ=Y({cos_:ZY}),_J=Y({cosh_:oJ}),bJ=Y({erf_:cJ}),a_=Y({exp_:VY}),EJ=Y({expm1_:UY}),CJ=Y({floor_:PY}),TJ=Y({log_:WY}),IJ=Y({log1p_:jY}),SJ=Y({logSigmoid_:QY}),ny=Y({neg_:NY}),RJ=Y({reciprocal_:GY}),kJ=Y({round_:BY}),sM=Y({rsqrt_:$Y}),uM=Y({sigmoid_:XY}),AJ=Y({sign_:OY}),NJ=Y({isNaN_:MY}),DJ=Y({isInf_:FY}),PJ=Y({isFinite_:LY}),OJ=Y({sin_:JY}),MJ=Y({sinh_:iJ}),FJ=Y({softplus_:YY}),LJ=Y({sqrt_:zY}),BJ=Y({square_:HY}),VJ=Y({step_:hJ}),UJ=Y({tan_:eJ}),WJ=Y({tanh_:aJ});function lM(n,e,t,r,i,o){var a,s,u=W(n,"x","batchNorm"),l=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");return i!=null&&(a=W(i,"scale","batchNorm")),r!=null&&(s=W(r,"offset","batchNorm")),H(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),H(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),H(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&H(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&H(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Zp(u,l,c,s,a,o)}function cM(n,e,t,r,i,o){var a,s,u=W(n,"x","batchNorm"),l=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");return i!=null&&(a=W(i,"scale","batchNorm")),r!=null&&(s=W(r,"offset","batchNorm")),H(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),H(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),H(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&H(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&H(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Zp(u,l,c,s,a,o)}function hM(n,e,t,r,i,o){var a,s,u=W(n,"x","batchNorm"),l=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");return i!=null&&(a=W(i,"scale","batchNorm")),r!=null&&(s=W(r,"offset","batchNorm")),H(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),H(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),H(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&H(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&H(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Zp(u,l,c,s,a,o)}function jJ(n,e,t,r,i,o){return r===void 0&&(r=.001),f0(),Zp(n,e,t,o,i,r)}function Zp(n,e,t,r,i,o){o==null&&(o=.001);var a,s,u,l=W(n,"x","batchNorm"),c=W(e,"mean","batchNorm"),h=W(t,"variance","batchNorm");return i!=null&&(a=W(i,"scale","batchNorm")),r!=null&&(s=W(r,"offset","batchNorm")),H(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),H(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),H(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,z.engine.runKernel(function(d,f){var p=d.batchNormalization(u,xv(c),xv(h),o,xv(a),xv(s));return f([l,c,h,a]),p},{$x:l,$mean:c,$variance:h,$scale:a,$offset:s},function(d,f){var p=f[0],m=f[1],g=f[2],y=f[3],x=y??ye(1),_=Xn(m.shape,u.shape),b=[];if(m.rank===1){for(var C=0;C<u.shape.length-1;++C)b.push(u.shape[C]);b.push(1)}var k=p.sub(m),T=d.mul(x),E=sM(g.add(ye(o))),I=E.mul(E).mul(E).mul(ye(-.5));return{$x:function(){return m.rank===1?d.mul(Th(E.as4D(1,1,1,m.shape[0]),b)).mul(x).reshape(p.shape):d.mul(E).mul(x).reshape(p.shape)},$mean:function(){var R=E.mul(ye(-1)).mul(T);return m.rank===1&&(R=R.sum(_)),R.reshape(m.shape)},$variance:function(){var R=I.mul(k).mul(T);return m.rank===1&&(R=R.sum(_)),R.reshape(m.shape)},$scale:function(){var R=k.mul(E),N=d.mul(R);return m.rank===1&&(N=N.sum(_)),N.reshape(m.shape)},$offset:function(){var R=d;return m.rank===1&&(R=R.sum(_)),R.reshape(m.shape)}}}).reshape(l.shape)}function xv(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function zJ(n,e,t,r,i,o){return r===void 0&&(r=.001),f0(),lM(n,e,t,o,i,r)}function $J(n,e,t,r,i,o){return r===void 0&&(r=.001),f0(),cM(n,e,t,o,i,r)}function HJ(n,e,t,r,i,o){return r===void 0&&(r=.001),f0(),hM(n,e,t,o,i,r)}function f0(){TO("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var GJ=Y({batchNormalization2d_:zJ}),qJ=Y({batchNormalization3d_:$J}),KJ=Y({batchNormalization4d_:HJ}),XJ=Y({batchNormalization_:jJ}),dM=Y({batchNorm_:Zp}),QJ=Y({batchNorm2d_:lM}),YJ=Y({batchNorm3d_:cM}),JJ=Y({batchNorm4d_:hM});function em(n,e,t,r,i,o,a){a===void 0&&(a="channelsLast");var s,u=ry(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,n[3],n[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,n[1],n[1]]}return tm(n,s,t,r,i,o,!1,a)}function tm(n,e,t,r,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],d=n[1],c=n[2],h=n[3]}var f,p=e[0],m=e[1],g=e[3],y=ry(t),x=y[0],_=y[1],b=ry(r),C=b[0],k=b[1],T=Ih(p,C),E=Ih(m,k),I=tZ(i,c,h,x,_,T,E,o),R=I.padInfo,N=I.outHeight,O=I.outWidth,M=a?g*d:g;return s==="channelsFirst"?f=[l,M,N,O]:s==="channelsLast"&&(f=[l,N,O,M]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:d,outHeight:N,outWidth:O,outChannels:M,padInfo:R,strideHeight:x,strideWidth:_,filterHeight:p,filterWidth:m,effectiveFilterHeight:T,effectiveFilterWidth:E,dilationHeight:C,dilationWidth:k,inShape:n,outShape:f,filterShape:e}}function BE(n,e,t,r,i,o,a){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],h=s[3],d=s[4];if(a==="channelsLast")u=n[0],l=n[1],c=n[2],h=n[3],d=n[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);u=n[0],d=n[1],l=n[2],c=n[3],h=n[4]}var f,p=e[0],m=e[1],g=e[2],y=e[4],x=ZS(t),_=x[0],b=x[1],C=x[2],k=ZS(r),T=k[0],E=k[1],I=k[2],R=nZ(i,l,c,h,_,b,C,Ih(p,T),Ih(m,E),Ih(g,I)),N=R.padInfo,O=R.outDepth,M=R.outHeight,q=R.outWidth,J=o?y*d:y;return a==="channelsFirst"?f=[u,J,O,M,q]:a==="channelsLast"&&(f=[u,O,M,q,J]),{batchSize:u,dataFormat:a,inDepth:l,inHeight:c,inWidth:h,inChannels:d,outDepth:O,outHeight:M,outWidth:q,outChannels:J,padInfo:N,strideDepth:_,strideHeight:b,strideWidth:C,filterDepth:p,filterHeight:m,filterWidth:g,dilationDepth:T,dilationHeight:E,dilationWidth:I,inShape:n,outShape:f,filterShape:e}}function ZJ(n,e,t,r,i,o){i==null&&(i=eZ(n,e,r));var a=n[0],s=n[1],u=eR((a-e+2*i)/r+1,o);H(eo(u),function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=eR((s-e+2*i)/r+1,o);return H(eo(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,t]}function eZ(n,e,t,r){r===void 0&&(r=1);var i=Ih(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function ry(n){return typeof n=="number"?[n,n]:n}function ZS(n){return typeof n=="number"?[n,n,n]:n}function Ih(n,e){return e<=1?n:n+(n-1)*(e-1)}function tZ(n,e,t,r,i,o,a,s){var u,l,c;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};var h=ZJ([e,t,1],o,1,r,n,s);l=h[0],c=h[1]}else if(n==="same"){l=Math.ceil(e/r),c=Math.ceil(t/i);var d=Math.max(0,(l-1)*r+o-e),f=Math.max(0,(c-1)*i+a-t),p=Math.floor(d/2),m=d-p,g=Math.floor(f/2);u={top:p,bottom:m,left:g,right:f-g,type:"SAME"}}else{if(n!=="valid")throw Error("Unknown padding parameter: "+n);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),c=Math.ceil((t-a+1)/i)}return{padInfo:u,outHeight:l,outWidth:c}}function nZ(n,e,t,r,i,o,a,s,u,l){var c,h,d,f;if(n==="same"){var p=((h=Math.ceil(e/i))-1)*i+s-e,m=((d=Math.ceil(t/o))-1)*o+u-t,g=((f=Math.ceil(r/a))-1)*a+l-r,y=Math.floor(p/2),x=p-y,_=Math.floor(m/2),b=m-_,C=Math.floor(g/2);c={top:_,bottom:b,left:C,right:g-C,front:y,back:x,type:"SAME"}}else{if(n!=="valid")throw Error("Unknown padding parameter: "+n);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-s+1)/i),d=Math.ceil((t-u+1)/o),f=Math.ceil((r-l+1)/a)}return{padInfo:c,outDepth:h,outHeight:d,outWidth:f}}function eR(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function iy(n){var e=ry(n),t=e[0],r=e[1];return t===1&&r===1}function Hu(n,e){return iy(n)||iy(e)}function rZ(n,e,t,r,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=W(n,"x","conv1d"),u=W(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),H(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),H(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&H(eo(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),H(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),H(Hu(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),H(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=ms(d,h,[1,t],r,"NHWC",[1,o],a);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}function iZ(n,e,t,r,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=W(n,"x","conv2d"),u=W(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),H(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),H(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&H(eo(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),H(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),H(Hu(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),H(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var h=tm(l.shape,u.shape,t,o,r,a),d=z.engine.runKernel(function(f,p){var m=f.conv2d(l,u,h);return p([u,l]),m},{x:l,$filter:u},function(f,p){var m=p,g=m[0],y=m[1];return H(iy(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return fM(y.shape,f,g,t,r)},$filter:function(){return pM(y,f,g.shape,t,r)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function fM(n,e,t,r,i,o){H(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,s=e,u=!1;e.rank===3&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]);var l=a[3],c=s.shape[3];H(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),H(s.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),H(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}),H(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),H(c===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&H(eo(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var h=tm(a,t.shape,r,1,i,o),d=z.engine.runKernel(function(f,p){var m=f.conv2dDerInput(s,t,h);return p([t,s]),m},{dy4D:s,filter:t},function(f,p){var m=p[0],g=p[1];return{dy4D:function(){return ms(f,m,r,i,"NHWC",1,o)},filter:function(){return mM(f,g,m.shape,r,i,o)}}});return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function pM(n,e,t,r,i,o){var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e;s.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),H(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),H(s.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),H(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}),H(a.shape[3]===t[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+t[2]+"."}),H(s.shape[3]===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+t[3]+")."}),o!=null&&H(eo(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var u=tm(a.shape,t,r,1,i,o);return z.engine.runKernel(function(l){return l.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}function oZ(n,e,t,r,i,o){return fM(t,W(n,"x","conv2dTranspose"),W(e,"filter","conv2dTranspose"),r,i,o)}function aZ(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]);var s=W(n,"x","depthwiseConv2d"),u=W(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),H(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),H(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),H(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),H(Hu(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),a!=null&&H(eo(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=tm(l.shape,u.shape,t,o,r,a,!0),d=z.engine.runKernel(function(f,p){var m=f.depthwiseConv2D(l,u,h);return p([l,u]),m},{x:l,$filter:u},function(f,p){H(iy(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var m=p[0],g=p[1];return{x:function(){return cZ(m.shape,f,g,h)},$filter:function(){return hZ(m,f,g.shape,h)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function sZ(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=W(n,"x","separableConv2d"),u=W(e,"depthwiseFilter","separableConv2d"),l=W(t,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");H(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),H(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),H(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),H(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),H(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],f=u.shape[3];H(l.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+l.shape[2]+"."});var p=VE(c,u,r,i,a,o),m=ms(p,l,1,"valid",a);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function uZ(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function s_(n){var e=uZ(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function lZ(n,e){return s_(n)||s_(e)}function cZ(n,e,t,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=z.engine.runKernel(function(s){return s.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}function hZ(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),z.engine.runKernel(function(a){return a.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}function dZ(n,e,t,r,i,o){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1,1]);var a=W(n,"x","conv3d"),s=W(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),H(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),H(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),H(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),H(lZ(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),H(i==="NHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NHWC is currently supported."});var c=BE(u.shape,s.shape,t,o,r),h=z.engine.runKernel(function(d,f){var p=d.conv3d(u,s,c);return f([u,s]),p},{x:u,$filter:s},function(d,f){H(s_(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=f[0],m=f[1];return{x:function(){return fZ(p.shape,d,m,t,r)},$filter:function(){return pZ(p,d,m.shape,t,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}function fZ(n,e,t,r,i){H(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var o=n,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],l=a.shape[4];H(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),H(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),H(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),H(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),H(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."});var c=BE(o,t.shape,r,1,i),h=z.engine.runKernel(function(d){return d.conv3dDerInput(a,t,c)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}function pZ(n,e,t,r,i){var o=n;n.rank===4&&(o=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]));var a=e;a.rank===4&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),H(o.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+o.shape+"."}),H(a.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),H(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+t+"."}),H(o.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input "+o.shape[4]+") must match input depth in filter ("+t[3]+"."}),H(a.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+t[4]+")."});var s=BE(o.shape,t,r,1,i);return z.engine.runKernel(function(u){return u.conv3dDerFilter(o,a,s)},{x5D:o,dy5D:a})}var mZ=Y({conv1d_:rZ}),ms=Y({conv2d_:iZ}),vZ=Y({conv3d_:dZ}),mM=Y({conv2dDerFilter_:pM}),VE=Y({depthwiseConv2d_:aZ}),vM=Y({separableConv2d_:sZ}),gZ=Y({conv2dTranspose_:oZ});function yZ(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=W(n,"a","matMul"),a=W(e,"b","matMul");i=Kn(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),d=a.shape.slice(0,-2),f=ze(h),p=ze(d);H(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),H($r(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),H(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var m=o.shape.slice(0,-2).concat([l,c]),g=t?o.as3D(f,s,l):o.as3D(f,l,s),y=r?a.as3D(p,c,u):a.as3D(p,u,c);return z.engine.runKernel(function(x,_){var b=x.batchMatMul(g,y,t,r);return _([g,y]),b},{$a:g,$b:y},function(x,_){var b=_,C=b[0],k=b[1];return t||r?!t&&r?{$a:function(){return x.matMul(k,!1,!1)},$b:function(){return x.matMul(C,!0,!1)}}:t&&!r?{$a:function(){return k.matMul(x,!1,!0)},$b:function(){return C.matMul(x,!1,!1)}}:{$a:function(){return k.matMul(x,!0,!0)},$b:function(){return x.matMul(C,!0,!0)}}:{$a:function(){return x.matMul(k,!1,!0)},$b:function(){return C.matMul(x,!0,!1)}}}).reshape(m)}function xZ(n,e){var t=W(n,"v1","outerProduct"),r=W(e,"v2","outerProduct");return H(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}function wZ(n,e){var t=W(n,"t1","dot"),r=W(e,"t2","dot");H(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return H(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}var UE=Y({matMul_:yZ}),_Z=Y({dot_:wZ}),bZ=Y({outerProduct_:xZ});function EZ(n){var e=W(n,"x","reverse");return H(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),nm(e,0)}function CZ(n,e){var t=W(n,"x","reverse");return H(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),nm(t,e)}function TZ(n,e){var t=W(n,"x","reverse");return H(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),nm(t,e)}function IZ(n,e){var t=W(n,"x","reverse");return H(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),nm(t,e)}function SZ(n,e){var t=W(n,"x","reverse");if(t.rank===0)return t.clone();var r=yr(e,t.shape);return z.engine.runKernel(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}var nm=Y({reverse_:SZ}),RZ=Y({reverse1d_:EZ}),kZ=Y({reverse2d_:CZ}),AZ=Y({reverse3d_:TZ}),NZ=Y({reverse4d_:IZ});function gM(n,e,t,r,i,o){var a=W(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),H(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),H(Hu(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),o!=null&&H(eo(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=em(s.shape,e,t,r,i,o),c=z.engine.runKernel(function(h,d){var f=h.maxPool(s,l);return d([s,f]),f},{x:s},function(h,d){var f=d[0],p=d[1];return{x:function(){return MZ(h,f,p,e,t,r,i)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function DZ(n,e,t,r,i){return gM(n,e,t,1,r,i)}function yM(n,e,t,r,i,o){var a=W(n,"x","avgPool","float32");H(Hu(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),H(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&H(eo(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=em(s.shape,e,t,r,i,o),c=z.engine.runKernel(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return FZ(h,s,e,t,r,i)}}});return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function PZ(n,e,t,r,i){return yM(n,e,t,1,r,i)}function OZ(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var a=W(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),H(Hu(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=em(s.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?BZ([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,f=LZ([c.inHeight,c.inWidth],h,l),p=f[0],m=f[1],g=d?r:"valid",y=d?s:oM(s,h,p),x=(t==="avg"?function(){return yM(y,e,o,1,g)}:function(){return gM(y,e,o,1,g)})(),_=d?x:rM(x,h,m);return u?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}function MZ(n,e,t,r,i,o,a,s){var u=W(n,"dy","maxPoolBackprop"),l=W(e,"input","maxPoolBackprop"),c=W(t,"output","maxPoolBackprop");H(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),H(Hu(i,o),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}),H(u.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),H(l.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var h=em(l.shape,r,i,o,a,s);return z.engine.runKernel(function(d){return d.maxPoolBackprop(u,l,c,h)},{$dy:u,$input:l})}function FZ(n,e,t,r,i,o){var a=W(n,"dy","avgPoolBackprop"),s=W(e,"input","avgPoolBackprop");H(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),H(Hu(r,i),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"});var u=s,l=a,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),H(l.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),H(u.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var h=em(u.shape,t,r,i,o),d=z.engine.runKernel(function(f){return f.avgPoolBackprop(l,u,h)},{dy4D:l,input4D:u});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function LZ(n,e,t){var r=t.map(function(u){return u[0]}),i=t.map(function(u){return u[1]}),o=n.concat(r,i),a=e.map(function(u,l){return(u-o[l]%u)%u}),s=i.map(function(u,l){return u+a[l]});return[e.map(function(u,l){return[r[l],s[l]]}),e.map(function(u,l){return[0,a[l]]})]}function BZ(n,e){var t=n.map(function(o,a){return o+(o-1)*(e[a]-1)}).map(function(o){return o-1}),r=t.map(function(o){return Math.floor(o/2)}),i=t.map(function(o,a){return o-r[a]});return t.map(function(o,a){return[r[a],i[a]]})}var td=Y({maxPool_:DZ}),rm=Y({avgPool_:PZ}),VZ=Y({pool_:OZ});function UZ(n,e,t){var r=W(n,"x","slice1d");return H(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Nu(r,[e],[t])}function WZ(n,e,t){var r=W(n,"x","slice2d");return H(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Nu(r,e,t)}function jZ(n,e,t){var r=W(n,"x","slice3d");return H(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Nu(r,e,t)}function zZ(n,e,t){var r=W(n,"x","slice4d");return H(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Nu(r,e,t)}function $Z(n,e,t){var r,i,o=W(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice(),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(s,u){return s>=0?s:(H(s===-1,function(){return"Bad value in size"}),o.shape[u]-r[u])}),H9(o,r,i);var a=o.shape;return z.engine.runKernel(function(s){return s.slice(o,r,i)},{$x:o},function(s){for(var u=[],l=0;l<s.rank;l++)u.push([r[l],a[l]-r[l]-i[l]]);return{$x:function(){return s.pad(u)}}})}var Nu=Y({slice_:$Z}),HZ=Y({slice1d_:UZ}),GZ=Y({slice2d_:WZ}),xM=Y({slice3d_:jZ}),qZ=Y({slice4d_:zZ});function KZ(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","logSumExp"),i=yr(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=to(s.shape,i);return s.reshape(u)}return s}function XZ(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=yr(e,r.shape);return qp(function(o){var a=va(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=ga(s.length,o.rank));var l=z.engine.runKernel(function(h){return h.sum(u,s)},{permutedX:u});if(t){var c=to(l.shape,i);l=l.reshape(c)}return{value:l,gradFunc:function(h){var d=o.shape.slice();return i.forEach(function(f){d[f]=1}),h.reshape(d).mul(Ql(o.shape,"float32"))}}})(r)}function QZ(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=yr(e,r.shape),o=va(i,r.rank),a=i,s=r;o!=null&&(s=r.transpose(o),a=ga(a.length,r.rank));var u=z.engine.runKernel(function(c){return c.prod(s,a)},{permutedX:s});if(t){var l=to(u.shape,i);u=u.reshape(l)}return u}function YZ(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","mean"),i=yr(e,r.shape),o=ze(Ir(r.shape,i)[1]);return qp(function(a){var s=ye(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var l=a.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Ql(a.shape,"float32")).div(o)}}})(r)}function wM(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(to(e.shape,r))),n.rank<t.rank&&(n=n.reshape(to(n.shape,r))),{$x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}function JZ(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","min"),i=r,o=yr(e,r.shape),a=o,s=va(a,r.rank);s!=null&&(r=r.transpose(s),a=ga(a.length,r.rank));var u=z.engine.runKernel(function(c,h){var d=c.min(r,a);return h([i,d]),d},{$x:r},function(c,h){return wM(c,h[1],h[0],o,s)});if(t){var l=to(u.shape,o);u=u.reshape(l)}return u}function ZZ(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","max"),i=r,o=yr(e,r.shape),a=o,s=va(a,r.rank);s!=null&&(r=r.transpose(s),a=ga(a.length,r.rank));var u=z.engine.runKernel(function(c,h){var d=c.max(r,a);return h([i,d]),d},{$x:r},function(c,h){return wM(c,h[1],h[0],o,s)});if(t){var l=to(u.shape,o);u=u.reshape(l)}return u}function eee(n,e){e===void 0&&(e=0);var t=W(n,"x","argMin");e==null&&(e=0);var r=yr(e,t.shape),i=va(r,t.rank);return i!=null&&(t=t.transpose(i),r=ga(r.length,t.rank)),z.engine.runKernel(function(o,a){var s=o.argMin(t,r[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return Mt(s)}}})}function tee(n,e){e===void 0&&(e=0);var t=W(n,"x","argMax");e==null&&(e=0);var r=yr(e,t.shape),i=va(r,t.rank);return i!=null&&(t=t.transpose(i),r=ga(r.length,t.rank)),z.engine.runKernel(function(o,a){var s=o.argMax(t,r[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return Mt(s)}}})}function nee(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","all","bool"),i=yr(e,r.shape),o=i,a=va(o,r.rank);a!=null&&(r=r.transpose(a),o=ga(o.length,r.rank));var s=z.engine.runKernel(function(l){return l.all(r,o)},{$x:r});if(t){var u=to(s.shape,i);return s.reshape(u)}return s}function ree(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=W(n,"x","any","bool"),i=yr(e,r.shape),o=i,a=va(o,r.rank);a!=null&&(r=r.transpose(a),o=ga(o.length,r.rank));var s=z.engine.runKernel(function(l){return l.any(r,o)},{$x:r});if(t){var u=to(s.shape,i);return s.reshape(u)}return s}function iee(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=yr(e,(n=W(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;return t||(o=to(i.shape,r)),{mean:i,variance:n.toFloat().sub(i.reshape(o)).square().mean(r,t)}}var oee=Y({all_:nee}),aee=Y({any_:ree}),see=Y({argMax_:tee}),uee=Y({argMin_:eee}),lee=Y({logSumExp_:KZ}),p0=Y({max_:ZZ}),cee=Y({mean_:YZ}),hee=Y({min_:JZ}),dee=Y({moments_:iee}),_M=Y({sum_:XZ}),fee=Y({prod_:QZ});function pee(n,e){var t,r=W(n,"a","notEqual"),i=W(e,"b","notEqual");return t=Kn(r,i),r=t[0],i=t[1],Et(r.shape,i.shape),z.engine.runKernel(function(o){return o.notEqual(r,i)},{$a:r,$b:i})}function mee(n,e){var t=W(n,"a","notEqualStrict"),r=W(e,"b","notEqualStrict");return qt(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}function vee(n,e){var t,r=W(n,"a","less"),i=W(e,"b","less");return t=Kn(r,i),r=t[0],i=t[1],Et(r.shape,i.shape),z.engine.runKernel(function(o){return o.less(r,i)},{$a:r,$b:i})}function gee(n,e){var t=W(n,"a","lessStrict"),r=W(e,"b","lessStrict");return qt(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}function yee(n,e){var t,r=W(n,"a","equal"),i=W(e,"b","equal");return t=Kn(r,i),r=t[0],i=t[1],Et(r.shape,i.shape),z.engine.runKernel(function(o){return o.equal(r,i)},{$a:r,$b:i})}function xee(n,e){var t=W(n,"a","equalStrict"),r=W(e,"b","equalStrict");return qt(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}function wee(n,e){var t,r=W(n,"a","lessEqual"),i=W(e,"b","lessEqual");return t=Kn(r,i),r=t[0],i=t[1],Et(r.shape,i.shape),z.engine.runKernel(function(o){return o.lessEqual(r,i)},{$a:r,$b:i})}function _ee(n,e){var t=W(n,"a","lessEqualStrict"),r=W(e,"b","lessEqualStrict");return qt(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}function bee(n,e){var t,r=W(n,"a","greater"),i=W(e,"b","greater");return t=Kn(r,i),r=t[0],i=t[1],Et(r.shape,i.shape),z.engine.runKernel(function(o){return o.greater(r,i)},{$a:r,$b:i})}function Eee(n,e){var t=W(n,"a","greaterStrict"),r=W(e,"b","greaterStrict");return qt(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}function Cee(n,e){var t,r=W(n,"a","greaterEqual"),i=W(e,"b","greaterEqual");return t=Kn(r,i),r=t[0],i=t[1],Et(r.shape,i.shape),z.engine.runKernel(function(o,a){var s=o.greaterEqual(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return Mt(s)},$b:function(){return Mt(u)}}})}function Tee(n,e){var t=W(n,"a","greaterEqualStrict"),r=W(e,"b","greaterEqualStrict");return qt(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}var bM=Y({equal_:yee}),Iee=Y({equalStrict_:xee}),See=Y({greater_:bee}),EM=Y({greaterEqual_:Cee}),Ree=Y({greaterEqualStrict_:Tee}),kee=Y({greaterStrict_:Eee}),Aee=Y({less_:vee}),Nee=Y({lessEqual_:wee}),Dee=Y({lessEqualStrict_:_ee}),Pee=Y({lessStrict_:gee}),Oee=Y({notEqual_:pee}),Mee=Y({notEqualStrict_:mee});function Fee(n,e){var t,r=W(n,"a","add"),i=W(e,"b","add");t=Kn(r,i),r=t[0],i=t[1];var o=Et(r.shape,i.shape);return z.engine.runKernel(function(a){return a.add(r,i)},{$a:r,$b:i},function(a){return{$a:function(){var s=a,u=Xn(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=a,u=Xn(i.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(i.shape)}}})}function Lee(n){H(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),H(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return W(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!$r(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return z.engine.runKernel(function(i){return i.addN(e)},r,function(i){var o={};return e.forEach(function(a,s){o[s]=function(){return i.clone()}}),o})}function Bee(n,e){var t=W(n,"a","addStrict"),r=W(e,"b","addStrict");return qt(t.shape,r.shape,"Error in addStrict: "),t.add(r)}function Vee(n,e){var t,r=W(n,"a","sub"),i=W(e,"b","sub");t=Kn(r,i),r=t[0],i=t[1];var o=Et(r.shape,i.shape);return z.engine.runKernel(function(a){return a.subtract(r,i)},{$a:r,$b:i},function(a){return{$a:function(){var s=a,u=Xn(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=a,u=Xn(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}})}function Uee(n,e){var t=W(n,"a","subStrict"),r=W(e,"b","subStrict");return qt(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}function Wee(n,e){var t=W(n,"base","pow"),r=W(e,"exp","pow"),i=Et(t.shape,r.shape);return n=t.cast(nr(t.dtype,r.dtype)),e=r.cast(nr(t.dtype,r.dtype)),z.engine.runKernel(function(o,a){var s=o.pow(t,r);return a([t,r,s]),s},{$base:t,$exp:r},function(o,a){var s=a[0],u=a[1],l=a[2];return{$base:function(){var c=u.toFloat(),h=o.mul(c.mul(s.pow(c.sub(ye(1))))),d=Xn(s.shape,i);return d.length>0&&(h=h.sum(d)),h.reshape(s.shape)},$exp:function(){var c=s.greater(0),h=s.log().where(c,Mt(s)),d=o.mul(l.mul(h)),f=Xn(u.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)}}})}function jee(n,e){return qt(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}function zee(n,e){var t,r=W(n,"a","mul"),i=W(e,"b","mul");t=Kn(r,i),r=t[0],i=t[1];var o=Et(r.shape,i.shape);return z.engine.runKernel(function(a,s){var u=a.multiply(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.mul(l.toFloat()),h=Xn(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=Xn(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}function $ee(n,e){var t=W(n,"a","mul"),r=W(e,"b","mul");return qt(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}function Hee(n,e){var t,r=W(n,"a","div"),i=W(e,"b","div");if(t=Kn(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return CM(r,i);var o=Et(r.shape,i.shape);return z.engine.runKernel(function(a,s){var u=a.realDivide(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.div(l.toFloat()),h=Xn(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=Xn(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}})}function Gee(n,e){var t,r=W(n,"a","floorDiv"),i=W(e,"b","floorDiv");t=Kn(r,i),r=t[0],i=t[1];var o=Et(r.shape,i.shape);return z.engine.runKernel(function(a,s){var u=a.floorDiv(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.div(l.toFloat()),h=Xn(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=Xn(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}})}function qee(n,e){var t=W(n,"a","div"),r=W(e,"b","div");return qt(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}function Kee(n,e){var t,r=W(n,"a","mod"),i=W(e,"b","mod");t=Kn(r,i),r=t[0],i=t[1];var o=Et(r.shape,i.shape);return z.engine.runKernel(function(a,s){var u=a.mod(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Xn(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=Xn(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}function Xee(n,e){var t=W(n,"a","modStrict"),r=W(e,"b","modStrict");return qt(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}function Qee(n,e){var t,r=W(n,"a","minimum"),i=W(e,"b","minimum");return t=Kn(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Et(r.shape,i.shape),z.engine.runKernel(function(o,a){var s=o.minimum(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.lessEqual(u).toFloat())},$b:function(){return o.mul(s.greater(u).toFloat())}}})}function Yee(n,e){var t=W(n,"a","minimumStrict"),r=W(e,"b","minimumStrict");return qt(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}function Jee(n,e){var t,r=W(n,"a","maximum"),i=W(e,"b","maximum");return t=Kn(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Et(r.shape,i.shape),z.engine.runKernel(function(o,a){var s=o.maximum(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.greaterEqual(u).toFloat())},$b:function(){return o.mul(s.less(u).toFloat())}}})}function Zee(n,e){var t=W(n,"a","maximumStrict"),r=W(e,"b","maximumStrict");return qt(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}function ete(n,e){var t,r=W(n,"a","squaredDifference"),i=W(e,"b","squaredDifference");return t=Kn(r,i),r=t[0],i=t[1],Et(r.shape,i.shape),z.engine.runKernel(function(o,a){var s=o.squaredDifference(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1],l=ye(2);return{$a:function(){return o.mul(s.sub(u).mul(l))},$b:function(){return o.mul(u.sub(s).mul(l))}}})}function tte(n,e){var t=W(n,"a","squaredDifferenceStrict"),r=W(e,"b","squaredDifferenceStrict");return qt(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}function nte(n,e){var t,r=W(n,"a","atan2"),i=W(e,"b","atan2");t=Kn(r,i),r=t[0],i=t[1];var o=Et(r.shape,i.shape);return z.engine.runKernel(function(a,s){var u=a.atan2(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Pt(u.square(),l.square()),h=a.mul(l.div(c)),d=Xn(u.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)},$b:function(){var c=Pt(u.square(),l.square()),h=ny(a.mul(u.div(c))),d=Xn(l.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(l.shape)}}})}var Pt=Y({add_:Fee}),rte=Y({addN_:Lee}),ite=Y({addStrict_:Bee}),ote=Y({atan2_:nte}),Ba=Y({div_:Hee}),ate=Y({divStrict_:qee}),CM=Y({floorDiv_:Gee}),WE=Y({maximum_:Jee}),ste=Y({maximumStrict_:Zee}),TM=Y({minimum_:Qee}),ute=Y({minimumStrict_:Yee}),lte=Y({mod_:Kee}),cte=Y({modStrict_:Xee}),Ka=Y({mul_:zee}),hte=Y({mulStrict_:$ee}),IM=Y({pow_:Wee}),dte=Y({powStrict_:jee}),fte=Y({squaredDifference_:ete}),pte=Y({squaredDifferenceStrict_:tte}),ha=Y({sub_:Vee}),mte=Y({subStrict_:Uee});function vte(n){var e=W(n,"x","logicalNot","bool");return z.engine.runKernel(function(t){return t.logicalNot(e)},{$x:e})}function gte(n,e){var t=W(n,"a","logicalAnd","bool"),r=W(e,"b","logicalAnd","bool");return Et(t.shape,r.shape),z.engine.runKernel(function(i){return i.logicalAnd(t,r)},{$a:t,$b:r})}function yte(n,e){var t=W(n,"a","logicalOr","bool"),r=W(e,"b","logicalOr","bool");return Et(t.shape,r.shape),z.engine.runKernel(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}function xte(n,e){var t=W(n,"a","logicalXor","bool"),r=W(e,"b","logicalXor","bool");return Et(t.shape,r.shape),SM(n,e).logicalAnd(jE(n,e).logicalNot())}function wte(n,e,t){var r=W(e,"a","where"),i=W(t,"b","where"),o=W(n,"condition","where","bool");return qt(r.shape,i.shape,"Error in where: "),o.rank===1?H(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):qt(o.shape,i.shape,"Error in where: "),z.engine.runKernel(function(a,s){var u=a.select(o,r,i);return s([o]),u},{$condition:o,$a:r,$b:i},function(a,s){var u=s[0];return{$condition:function(){return Mt(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}function _te(n){return Ht(this,void 0,void 0,function(){var e,t,r;return Gt(this,function(i){switch(i.label){case 0:return[4,(e=W(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=FE(e.shape,t),n!==e&&e.dispose(),[2,r]}})})}var jE=Y({logicalAnd_:gte}),bte=Y({logicalNot_:vte}),SM=Y({logicalOr_:yte}),Ete=Y({logicalXor_:xte}),wp=Y({where_:wte}),Cte=_te;function Tte(n){var e=W(n,"x","relu");return e.dtype==="bool"?e.toInt():z.engine.runKernel(function(t,r){var i=t.relu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mulStrict(i.step().toFloat())}}})}function Ite(n){var e=W(n,"x","elu");return z.engine.runKernel(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return z.engine.runKernel(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}function Ste(n){var e=W(n,"x","selu");return z.engine.runKernel(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(ye(0)),a=ye(PE),s=ye(OE),u=t.mul(s),l=t.mul(a).mul(i.toFloat().exp());return wp(o,u,l)}}})}function Rte(n,e){e===void 0&&(e=.2);var t=W(n,"x","leakyRelu");return WE(ye(e).mul(t),t)}function kte(n,e){var t=W(n,"x","prelu"),r=W(e,"alpha","prelu");return z.engine.runKernel(function(i,o){var a=i.prelu(t,r);return o([t,r]),a},{$x:t,$alpha:r},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{$x:function(){return wp(u,i,i.mul(s))},$alpha:function(){var l=wp(u,Mt(i),i.mul(a)),c=Xn(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}})}var Ate=Y({elu_:Ite}),Nte=Y({leakyRelu_:Rte}),Dte=Y({prelu_:kte}),Fn=Y({relu_:Tte}),Pte=Y({selu_:Ste});function Ote(n,e){var t=W(n,"x","transpose");return e==null&&(e=t.shape.map(function(r,i){return i}).reverse()),H(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(r){H(r>=0&&r<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():z.engine.runKernel(function(r){return r.transpose(t,e)},{$x:t},function(r){var i=SE(e);return{$x:function(){return r.transpose(i)}}})}var Du=Y({transpose_:Ote});function Mte(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=W(n,"x","localResponseNormalization");H(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),H(eo(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=z.engine.runKernel(function(l,c){var h=l.localResponseNormalization4D(a,e,t,r,i);return c([a,h]),h},{x4D:a},function(l,c){var h=c[0],d=c[1];return{x4D:function(){return z.engine.runKernel(function(f){return f.LRNGrad(l,h,d,e,t,r,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}var Fte=Y({localResponseNormalization_:Mte});function Lte(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=RM(n=W(n,"x","norm"),e,t),o=i.shape;if(r){var a=yr(t,n.shape);o=to(i.shape,a)}return i.reshape(o)}function RM(n,e,t){if(t===void 0&&(t=null),n.rank===0)return n.abs();if(n.rank!==1&&t===null)return RM(n.reshape([-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return n.abs().sum(t);if(e===1/0)return n.abs().max(t);if(e===-1/0)return n.abs().min(t);if(e==="euclidean"||e===2)return n.abs().pow(ye(2,"int32")).sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&t.length===2){if(e===1)return n.abs().sum(t[0]).max(t[1]-1);if(e===1/0)return n.abs().sum(t[1]).max(t[0]);if(e===-1/0)return n.abs().sum(t[1]).min(t[0]);if(e==="fro"||e==="euclidean")return n.square().sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var kM=Y({norm_:Lte});function Bte(n,e,t){var r=W(n,"x","unsortedSegmentSum"),i=W(e,"segmentIds","unsortedSegmentSum","int32");return H(eo(t),function(){return"numSegments must be of dtype int"}),z.engine.runKernel(function(o,a){var s=o.unsortedSegmentSum(r,i,t);return a([i]),s},{$x:r},function(o,a){var s=a[0];return{$x:function(){return Ute(o,s)}}})}function Vte(n,e,t){t===void 0&&(t=0);var r=W(n,"x","gather"),i=W(e,"indices","gather","int32");t=yr(t,r.shape)[0];var o=$9(r,i,t);return z.engine.runKernel(function(a,s){var u=a.gather(r,i.flatten(),t);return s([i]),u},{$x:r},function(a,s){var u=s[0];return{$x:function(){var l=r.shape,c=u.size,h=l.slice(0,t),d=h.length,f=l.slice(t,l.length).slice(1),p=f.length,m=tR(0,d),g=tR(d+1,d+1+p),y=nR([h,[c],f]),x=a.reshape(y),_=u.reshape([c]),b=nR([[d],m,g]),C=x.transpose(b),k=NM(C,_,r.shape[t]),T=SE(b);return k=k.transpose(T)}}}).reshape(o.outputShape)}function tR(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function nR(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}function Ute(n,e){for(var t=WE(e,Mt(e)),r=AM(n,t),i=EM(e,ye(0,"int32")),o=r.rank-i.rank,a=0;a<o;++a)i=Wi(i,a+1);i=jE(i,Ql(r.shape,"bool"));var s=Mt(r);return wp(i,r,s)}var AM=Y({gather_:Vte}),NM=Y({unsortedSegmentSum_:Bte});function Wte(n,e,t,r){for(var i=W(e,"data","multiRNNCell"),o=Yg(t,"c","multiRNNCell"),a=Yg(r,"h","multiRNNCell"),s=i,u=[],l=0;l<n.length;l++){var c=n[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],d=[];for(l=0;l<u.length;l+=2)h.push(u[l]),d.push(u[l+1]);return[h,d]}function jte(n,e,t,r,i,o){var a=W(n,"forgetBias","basicLSTMCell"),s=W(e,"lstmKernel","basicLSTMCell"),u=W(t,"lstmBias","basicLSTMCell"),l=W(r,"data","basicLSTMCell"),c=W(i,"c","basicLSTMCell"),h=W(o,"h","basicLSTMCell"),d=l.concat(h,1).matMul(s).add(u),f=d.shape[0],p=d.shape[1]/4,m=[f,p],g=d.slice([0,0],m),y=d.slice([0,p],m),x=d.slice([0,2*p],m),_=d.slice([0,3*p],m),b=g.sigmoid().mulStrict(y.tanh()).addStrict(c.mulStrict(a.add(x).sigmoid()));return[b,b.tanh().mulStrict(_.sigmoid())]}var zte=Y({basicLSTMCell_:jte}),$te=Y({multiRNNCell_:Wte});function Hte(n,e,t,r,i){i===void 0&&(i=!0);var o=W(n,"v","movingAverage"),a=W(e,"x","movingAverage"),s=W(t,"decay","movingAverage");m9(o,a),H($r(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=ye(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){H(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=W(r,"step","movingAverage");c=c.div(u.sub(IM(s,h)))}return o.add(c)}var Gte=Y({movingAverage_:Hte});function qte(n,e,t,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),a!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");var l=W(n,"x","stridedSlice");if(r.every(function(m){return m===1})){var c=RE(l.shape,e,t,r,i,o,a,s,u),h=c[0],d=c[1],f=c[2],p=d.filter(function(m,g){return f.indexOf(g)===-1});return Nu(l,h,d).reshape(p)}return z.engine.runKernel(function(m){return m.stridedSlice(l,e,t,r,i,o,a,s,u)},{$x:l})}var Kte=Y({stridedSlice_:qte});function Xte(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=W(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=z.engine.runKernel(function(a){return a.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}var Qte=Y({topk_:Xte});function Yte(n,e,t){var r=W(n,"indices","scatterND","int32"),i=W(e,"updates","scatterND");return W9(i,r,t),z.engine.runKernel(function(o){return o.scatterND(r,i,t)},{$indices:r,$updates:i})}var Jte=Y({scatterND_:Yte});function Zte(n){H(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return z.engine.runKernel(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}function ene(n){H(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return z.engine.runKernel(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}function tne(n){H(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.zerosLike(),i=Ur(n,r).as2D(t,e),o=zE(i),a=Math.floor(e/2)+1,s=ea(o),u=ru(o),l=s.split([a,e-a],s.shape.length-1),c=u.split([a,e-a],u.shape.length-1),h=n.shape.slice();return h[n.shape.length-1]=a,Ur(l[0],c[0]).reshape(h)}function nne(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=oy(r);return ea(i)}var o=[t,2*(e-1)],a=ea(n).as2D(t,e),s=ru(n).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),l=s.slice([0,1],[t,e-2]).reverse(1).mul(ye(-1)),c=a.concat(u,1),h=s.concat(l,1);return r=Ur(c,h).as2D(o[0],o[1]),i=oy(r),ea(i)}var zE=Y({fft_:Zte}),oy=Y({ifft_:ene}),DM=Y({rfft_:tne}),PM=Y({irfft_:nne}),rne=Object.freeze({fft:zE,ifft:oy,rfft:DM,irfft:PM});function ine(n,e,t,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+n.shape+".");var i=n.rank>0?n.shape[0]:1,o=n.rank>1?n.shape[1]:1;if(t.length!==o)throw new Error("outputShape has incorrect number of elements:, "+t.length+", should be: "+o+".");var a=e.size;if(e.rank!==0&&(e.rank!==1||a!==i))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+i+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function one(n,e,t,r){r===void 0&&(r=0);var i=W(n,"sparseIndices","sparseToDense","int32"),o=W(e,"sparseValues","sparseToDense"),a=W(r,"defaultValue","sparseToDense",o.dtype);return ine(i,o,t,a),z.engine.runKernel(function(s){return s.sparseToDense(i,o,t,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}var ane=Y({sparseToDense_:one});function sne(n,e){var t=W(e,"indices","gatherND","int32"),r=W(n,"x","gatherND");return z.engine.runKernel(function(i){return i.gatherND(r,t)},{$x:r,$indices:t})}var Ar,une=Y({gatherND_:sne});function lne(n,e,t){t===void 0&&(t=Ar.SUM_BY_NONZERO_WEIGHTS);var r=W(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=W(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===Ar.NONE)return o;if(t===Ar.SUM)return o.sum();if(t===Ar.MEAN){if(i==null)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(ye(a)):s}if(t===Ar.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(ye(r.size));var u=i.mul(Ql(r.shape)).notEqual(ye(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}function cne(n,e,t,r){r===void 0&&(r=Ar.SUM_BY_NONZERO_WEIGHTS);var i=W(n,"labels","absoluteDifference"),o=W(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=W(t,"weights","absoluteDifference")),qt(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return vs(s,a,r)}function hne(n,e,t,r){r===void 0&&(r=Ar.SUM_BY_NONZERO_WEIGHTS);var i=W(n,"labels","meanSquaredError"),o=W(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=W(t,"weights","meanSquaredError")),qt(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return vs(s,a,r)}function dne(n,e,t,r,i){i===void 0&&(i=Ar.SUM_BY_NONZERO_WEIGHTS);var o=W(n,"labels","cosineDistance"),a=W(e,"predictions","cosineDistance"),s=null;r!=null&&(s=W(r,"weights","cosineDistance")),qt(o.shape,a.shape,"Error in cosineDistance: ");var u=ye(1).sub(o.mul(a).sum(t,!0));return vs(u,s,i)}function fne(n,e,t,r){r===void 0&&(r=Ar.SUM_BY_NONZERO_WEIGHTS);var i=W(n,"labels","hingeLoss"),o=W(e,"predictions","hingeLoss"),a=null;t!=null&&(a=W(t,"weights","hingeLoss")),qt(i.shape,o.shape,"Error in hingeLoss: ");var s=ye(1);i=ye(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return vs(u,a,r)}function pne(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Ar.SUM_BY_NONZERO_WEIGHTS);var o=W(n,"labels","logLoss"),a=W(e,"predictions","logLoss"),s=null;t!=null&&(s=W(t,"weights","logLoss")),qt(o.shape,a.shape,"Error in logLoss: ");var u=ye(1),l=ye(r),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return vs(c,s,i)}function mne(n,e){var t=W(n,"labels","sigmoidCrossEntropyWithLogits"),r=W(e,"logits","sigmoidCrossEntropyWithLogits");qt(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),o=r.mul(t),a=r.abs().neg().exp().log1p();return i.sub(o).add(a)}function vne(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Ar.SUM_BY_NONZERO_WEIGHTS);var o=W(n,"multiClassLabels","sigmoidCrossEntropy"),a=W(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=W(t,"weights","sigmoidCrossEntropy")),qt(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ye(r),l=ye(1),c=ye(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=mne(o,a);return vs(h,s,i)}function gne(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Ar.SUM_BY_NONZERO_WEIGHTS);var o=W(n,"labels","huberLoss"),a=W(e,"predictions","huberLoss"),s=null;t!=null&&(s=W(t,"weights","huberLoss")),qt(o.shape,a.shape,"Error in huberLoss: ");var u=ye(r),l=a.sub(o).abs(),c=TM(l,u),h=l.sub(c),d=ye(.5).mul(c.square()).add(u.mul(h));return vs(d,s,i)}function yne(n,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+t);return qp(function(r,i,o){var a=i.logSumExp([t],!0),s=i.toFloat().sub(a);return o([r,s]),{value:s.mul(r).neg().sum([t]),gradFunc:function(u,l){var c=l[0],h=l[1],d=to(u.shape,[t]);return[u.reshape(d).mul(c.toFloat().sub(h.exp())),u.reshape(d).mul(h.exp().sub(c.toFloat()))]}}})(n,e)}function xne(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Ar.SUM_BY_NONZERO_WEIGHTS);var o=W(n,"onehotLabels","softmaxCrossEntropy"),a=W(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=W(t,"weights","softmaxCrossEntropy")),qt(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ye(r),l=ye(1),c=ye(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=yne(o,a);return vs(h,s,i)}(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ar||(Ar={}));var wne=Y({absoluteDifference_:cne}),vs=Y({computeWeightedLoss_:lne}),_ne=Y({cosineDistance_:dne}),bne=Y({hingeLoss_:fne}),Ene=Y({huberLoss_:gne}),Cne=Y({logLoss_:pne}),Tne=Y({meanSquaredError_:hne}),Ine=Y({sigmoidCrossEntropy_:vne}),Sne=Y({softmaxCrossEntropy_:xne}),Rne=Object.freeze({get Reduction(){return Ar},absoluteDifference:wne,computeWeightedLoss:vs,cosineDistance:_ne,hingeLoss:bne,huberLoss:Ene,logLoss:Cne,meanSquaredError:Tne,sigmoidCrossEntropy:Ine,softmaxCrossEntropy:Sne});function kne(n){var e;if(Array.isArray(n)){e=!1,H(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){H(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=ME(n,n.shape[0],0).map(function(u){return aM(u,[0])});H(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],a=n,s=function(u){o.push(z.engine.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=_M(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(kM(l,"euclidean"))}))};for(i=0;i<n.length;++i)s(i);return e?So(o,0):o}function Ane(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return rR(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(o,a){return o*a}),r=[],i=[];return mr(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0).forEach(function(o){var a=rR(o,e),s=a[0],u=a[1];r.push(s),i.push(u)}),[So(r,0).reshape(n.shape),So(i,0).reshape(n.shape)]}function rR(n,e){return e===void 0&&(e=!1),z.engine.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=iM(t),o=n.clone(),a=d0([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,l=function(h){var d,f=o,p=s,m=i;d=z.engine.tidy(function(){var g=o.slice([h,h],[t-h,1]),y=g.norm(),x=o.slice([h,h],[1,1]),_=x.sign().neg(),b=x.sub(_.mul(y)),C=g.div(b);s=C.shape[0]===1?a.clone():a.concat(C.slice([1,0],[C.shape[0]-1,C.shape[1]]),0);var k=_.matMul(b).div(y).neg(),T=o.slice([h,0],[t-h,r]),E=k.mul(s);o=h===0?T.sub(E.matMul(s.transpose().matMul(T))):o.slice([0,0],[h,r]).concat(T.sub(E.matMul(s.transpose().matMul(T))),0);var I=i.slice([0,h],[t,i.shape[1]-h]);return i=h===0?I.sub(I.matMul(s).matMul(E.transpose())):i.slice([0,0],[t,h]).concat(I.sub(I.matMul(s).matMul(E.transpose())),1),[s,o,i]}),s=d[0],o=d[1],i=d[2],L9([f,p,m])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var Nne=Y({gramSchmidt_:kne}),Dne=Y({qr_:Ane}),Pne=Object.freeze({gramSchmidt:Nne,qr:Dne});function One(n,e,t){t===void 0&&(t=!1);var r=W(n,"images","resizeBilinear");H(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),H(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=z.engine.runKernel(function(l,c){return c([i]),l.resizeBilinear(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return z.engine.runKernel(function(h){return h.resizeBilinearBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}function Mne(n,e,t){t===void 0&&(t=!1);var r=W(n,"images","resizeNearestNeighbor");H(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),H(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),H(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=z.engine.runKernel(function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return z.engine.runKernel(function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}function Fne(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=W(n,"boxes","nonMaxSuppression"),a=W(e,"scores","nonMaxSuppression"),s=OM(o,a,t,r,i);return t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,z.engine.runKernel(function(u){return u.nonMaxSuppression(o,a,t,r,i)},{$boxes:o})}function Lne(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Ht(this,void 0,void 0,function(){var o,a,s,u,l,c;return Gt(this,function(h){switch(h.label){case 0:return o=W(n,"boxes","nonMaxSuppressionAsync"),a=W(e,"scores","nonMaxSuppressionAsync"),s=OM(o,a,t,r,i),t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,o.data()];case 1:return u=h.sent(),[4,a.data()];case 2:return l=h.sent(),c=AE(u,l,t,r,i),o!==n&&o.dispose(),a!==e&&a.dispose(),[2,c]}})})}function OM(n,e,t,r,i){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY);var o=n.shape[0];return t=Math.min(t,o),H(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),H(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),H(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),H(e.rank===1,function(){return"scores must be a 1D tensor"}),H(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i}}function Bne(n,e,t,r,i,o){var a=W(n,"image","cropAndResize","float32"),s=W(e,"boxes","cropAndResize","float32"),u=W(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return H(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),H(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),H(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),H(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),H(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),H(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),z.engine.runKernel(function(c,h){return c.cropAndResize(a,s,u,r,i,o)},{$image:a,$boxes:s})}var Vne=Y({resizeBilinear_:One}),Une=Y({resizeNearestNeighbor_:Mne}),Wne=Y({nonMaxSuppression_:Fne}),jne=Lne,zne=Y({cropAndResize_:Bne}),MM=Object.freeze({resizeBilinear:Vne,resizeNearestNeighbor:Une,nonMaxSuppression:Wne,nonMaxSuppressionAsync:jne,cropAndResize:zne});function $ne(n,e,t,r,i,o){var a;t===void 0&&(t=!1),r===void 0&&(r=!1),o===void 0&&(o="linear");var s=W(n,"a","fused matMul"),u=W(e,"b","fused matMul");a=Kn(s,u),s=a[0],u=a[1];var l=t?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],h=t?s.shape[s.rank-1]:s.shape[s.rank-2],d=r?u.shape[u.rank-2]:u.shape[u.rank-1],f=s.shape.slice(0,-2),p=u.shape.slice(0,-2),m=ze(f),g=ze(p);H(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),H($r(f,p),function(){return"Error in fused matMul: outer dimensions ("+f+") and ("+p+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),H(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var y,x=s.shape.slice(0,-2).concat([h,d]),_=t?s.as3D(m,l,h):s.as3D(m,h,l),b=r?u.as3D(g,d,c):u.as3D(g,c,d);i!=null&&Et(x,(y=Kn(y=W(i,"bias","fused matMul"),s)[0]).shape);var C={$a:_,$b:b};return i!=null&&(C.$bias=y),z.engine.runKernel(function(k,T){var E=k.fusedBatchMatMul(_,b,t,r,y,o);return T([_,b,E]),E},C,function(k,T){var E,I=T[0],R=T[1],N=T[2];if(o==null||o==="linear")E=k;else{if(o!=="relu")throw new Error("Gradient for activation "+o+" has not been implemented yet.");E=k.mul(N.step())}var O={};return i!=null&&(O={$bias:function(){var M=E,q=Xn(y.shape,E.shape);return q.length>0&&(M=M.sum(q)),M.reshape(y.shape)}}),Object.assign(t||r?!t&&r?{$a:function(){return E.matMul(R,!1,!1)},$b:function(){return E.matMul(I,!0,!1)}}:t&&!r?{$a:function(){return R.matMul(E,!1,!0)},$b:function(){return I.matMul(E,!1,!1)}}:{$a:function(){return R.matMul(E,!0,!0)},$b:function(){return E.matMul(I,!0,!0)}}:{$a:function(){return E.matMul(R,!1,!0)},$b:function(){return I.matMul(E,!0,!1)}},O)}).reshape(x)}var Hne=Y({matMul_:$ne}),Gne=Object.freeze({matMul:Hne}),qne=Object.freeze({image:MM,linalg:Pne,losses:Rne,spectral:rne,fused:Gne,op:Y,batchNormalization2d:GJ,batchNormalization3d:qJ,batchNormalization4d:KJ,batchNormalization:XJ,batchNorm:dM,batchNorm2d:QJ,batchNorm3d:YJ,batchNorm4d:JJ,complex:Ur,real:ea,imag:ru,concat:ai,concat1d:kQ,concat2d:AQ,concat3d:NQ,concat4d:DQ,split:ME,conv1d:mZ,conv2d:ms,conv3d:vZ,conv2dDerFilter:mM,depthwiseConv2d:VE,separableConv2d:vM,conv2dTranspose:gZ,matMul:UE,dot:_Z,outerProduct:bZ,reverse:nm,reverse1d:RZ,reverse2d:kZ,reverse3d:AZ,reverse4d:NZ,maxPool:td,avgPool:rm,pool:VZ,slice:Nu,slice1d:HZ,slice2d:GZ,slice3d:xM,slice4d:qZ,abs:dJ,acos:fJ,acosh:pJ,asin:mJ,asinh:vJ,atan:gJ,atanh:yJ,ceil:xJ,clipByValue:LE,cos:wJ,cosh:_J,erf:bJ,exp:a_,expm1:EJ,floor:CJ,log:TJ,log1p:IJ,logSigmoid:SJ,neg:ny,reciprocal:RJ,round:kJ,rsqrt:sM,sigmoid:uM,sign:AJ,isNaN:NJ,isInf:DJ,isFinite:PJ,sin:OJ,sinh:MJ,softplus:FJ,sqrt:LJ,square:BJ,step:VJ,tan:UJ,tanh:WJ,all:oee,any:aee,argMax:see,argMin:uee,logSumExp:lee,max:p0,mean:cee,min:hee,moments:dee,sum:_M,prod:fee,equal:bM,equalStrict:Iee,greater:See,greaterEqual:EM,greaterEqualStrict:Ree,greaterStrict:kee,less:Aee,lessEqual:Nee,lessEqualStrict:Dee,lessStrict:Pee,notEqual:Oee,notEqualStrict:Mee,add:Pt,addN:rte,addStrict:ite,atan2:ote,div:Ba,divStrict:ate,floorDiv:CM,maximum:WE,maximumStrict:ste,minimum:TM,minimumStrict:ute,mod:lte,modStrict:cte,mul:Ka,mulStrict:hte,pow:IM,powStrict:dte,squaredDifference:fte,squaredDifferenceStrict:pte,sub:ha,subStrict:mte,elu:Ate,leakyRelu:Nte,prelu:Dte,relu:Fn,selu:Pte,logicalAnd:jE,logicalNot:bte,logicalOr:SM,logicalXor:Ete,where:wp,whereAsync:Cte,buffer:vt,print:hY,batchToSpaceND:rM,cast:dY,clone:fY,cumsum:pY,depthToSpace:mY,expandDims:Wi,eye:iM,multinomial:vY,oneHot:o_,pad:Jp,pad1d:gY,pad2d:yY,pad3d:xY,pad4d:wY,rand:_Y,randomNormal:bY,randomUniform:EY,reshape:Eo,spaceToBatchND:oM,squeeze:aM,stack:So,tile:Th,truncatedNormal:CY,unstack:mr,setdiff1dAsync:TY,fill:Vf,linspace:iK,ones:Ql,range:OO,scalar:ye,tensor:On,tensor1d:yi,tensor2d:d0,tensor3d:kE,tensor4d:wo,tensor5d:eK,tensor6d:tK,zeros:In,onesLike:MO,zerosLike:Mt,transpose:Du,softmax:$u,logSoftmax:Q9,localResponseNormalization:Fte,norm:kM,gather:AM,unsortedSegmentSum:NM,basicLSTMCell:zte,multiRNNCell:$te,movingAverage:Gte,stridedSlice:Kte,topk:Qte,scatterND:Jte,fft:zE,ifft:oy,rfft:DM,irfft:PM,sparseToDense:ane,gatherND:une});function Kne(n,e,t){if(e==="linear")return n.linear(t);if(e==="relu")return n.relu(t);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var Xne=function(){function n(){this.blockSize=48,this.firstUse=!0,z.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return n.prototype.setDataMover=function(e){this.data=new FO(e)},n.prototype.register=function(e,t,r){if(this.firstUse&&(this.firstUse=!1,z.get("IS_NODE")&&n_(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:r})},n.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},n.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r,i;if(z.get("IS_NODE")&&e.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(e.getContext!=null)r=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData)r=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),r=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(t===4)i=new Int32Array(r);else{var o=e.width*e.height;i=new Int32Array(o*t);for(var a=0;a<o;a++)for(var s=0;s<t;++s)i[a*t+s]=r[4*a+s]}return kE(i,[e.height,e.width,t],"int32")},n.prototype.read=function(e){return Ht(this,void 0,void 0,function(){return Gt(this,function(t){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var t=this.data.get(e),r=t.dtype,i=t.complexTensors;return r==="complex64"?BO(i.real.dataSync(),i.imag.dataSync()):this.data.get(e).values},n.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return Ht(this,void 0,void 0,function(){var t;return Gt(this,function(r){return t=Qg(),e(),[2,{kernelMs:Qg()-t}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,t){var r=Te.make(e.shape,{},"complex64");return this.data.get(r.dataId).complexTensors={real:z.engine.keep(e.clone()),imag:z.engine.keep(t.clone())},r},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(r){r!=null&&H(r.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})},n.prototype.slice=function(e,t,r){if(this.assertNotComplex(e,"slice"),DO(e.shape,t,r)){var i=PO(t,e.strides),o=ze(r);return On(e.dataSync().subarray(i,i+o),r,e.dtype)}for(var a=vt(r,e.dtype),s=e.bufferSync(),u=0;u<a.size;++u){var l=a.indexToLoc(u).map(function(c,h){return c+t[h]});a.values[u]=s.get.apply(s,l)}return a.toTensor()},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u,l){this.assertNotComplex(e,"stridedSlice");var c=RE(e.shape,t,r,i,o,a,s,u,l),h=c[0],d=c[1],f=c[2],p=d.filter(function(C,k){return f.indexOf(k)===-1});if(p.some(function(C){return C===0}))return On([],p);for(var m=vt(d,e.dtype),g=e.bufferSync(),y=0;y<m.size;y++){for(var x=m.indexToLoc(y),_=new Array(x.length),b=0;b<_.length;b++)_[b]=x[b]*i[b]+h[b];m.set.apply(m,[g.get.apply(g,_)].concat(x))}return m.toTensor().reshape(p)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],i=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(i[o++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(r);for(a=0;a<l.length;a++)s[t]=a,l[a]=this.slice(e,s,u).reshape(i);return l},n.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var r=vt(e.shape,e.dtype),i=e.bufferSync(),o=function(s){var u=r.indexToLoc(s),l=u.slice();t.forEach(function(c){return l[c]=e.shape[c]-1-l[c]}),r.set.apply(r,[i.get.apply(i,l)].concat(u))},a=0;a<r.size;a++)o(a);return r.toTensor()},n.prototype.concat=function(e,t){this.assertNotComplex(e,"concat");var r=e.map(function(l){var c=ze(l.shape.slice(t));return l.as2D(-1,c)}),i=ed(r.map(function(l){return l.shape}),1),o=vt(i,e[0].dtype).values;if(r[0].shape[0]===1){var a=0;r.forEach(function(l){o.set(l.dataSync(),a),a+=l.size})}else{var s=0;r.forEach(function(l){for(var c=l.dataSync(),h=0,d=0;d<l.shape[0];++d)for(var f=d*i[1]+s,p=0;p<l.shape[1];++p)o[f+p]=c[h++];s+=l.shape[1]})}var u=ed(e.map(function(l){return l.shape}),t);return On(o,u,e[0].dtype)},n.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(ye(-1),e)},n.prototype.add=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,a){return{real:r+o,imag:i+a}}):this.broadcastedBinaryOp(e,t,nr(e.dtype,t.dtype),function(r,i){return r+i})},n.prototype.addN=function(e){this.assertNotComplex(e,"addN");for(var t=e.map(function(u){return u.dataSync()}),r=vt(e[0].shape,e[0].dtype),i=r.values,o=0;o<e.length;o++)for(var a=t[o],s=0;s<i.length;s++)i[s]+=a[s];return r.toTensor()},n.prototype.subtract=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,a){return{real:r-o,imag:i-a}}):this.broadcastedBinaryOp(e,t,nr(e.dtype,t.dtype),function(r,i){return r-i})},n.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.pow(r,i)})},n.prototype.batchMatMul=function(e,t,r,i){this.assertNotComplex([e,t],"matMul");for(var o=r?e.shape[1]:e.shape[2],a=r?e.shape[2]:e.shape[1],s=i?t.shape[1]:t.shape[2],u=e.shape[0],l=e.dataSync(),c=t.dataSync(),h=r?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=h[0],f=h[1],p=h[2],m=i?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],g=m[0],y=m[1],x=m[2],_=a*s,b=vt([u,a,s],e.dtype),C=b.values,k=this.blockSize,T=0;T<u;T++)for(var E=0;E<a;E+=k)for(var I=0;I<s;I+=k)for(var R=0;R<o;R+=k)for(var N=Math.min(E+k,a),O=Math.min(I+k,s),M=Math.min(R+k,o),q=E;q<N;q++)for(var J=I;J<O;J++){for(var ee=0,Q=R;Q<M;Q++)ee+=l[T*d+q*f+Q*p]*c[Q*g+J*y+T*x];C[T*_+(q*s+J)]+=ee}return b.toTensor()},n.prototype.fusedBatchMatMul=function(e,t,r,i,o,a){var s=this.batchMatMul(e,t,r,i);return o&&(s=this.add(s,o)),a&&(s=Kne(this,a,s)),s},n.prototype.multiply=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,a){return{real:r*o-i*a,imag:r*a+i*o}}):this.broadcastedBinaryOp(e,t,nr(e.dtype,t.dtype),function(r,i){return r*i})},n.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(r,i){return r/i})},n.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(r,i){return Math.floor(r/i)})},n.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),pi("sum",t,e.rank);for(var r=Ir(e.shape,t),i=r[0],o=r[1],a=In(i,nr(e.dtype,"int32")),s=ze(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=0,f=0;f<s;++f)d+=l[h+f];u[c]=d}return a},n.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var r=Ir(e.shape,t),i=r[0],o=r[1],a=In(i,nr(e.dtype,"int32")),s=ze(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=1,f=0;f<s;++f)d*=l[h+f];u[c]=d}return a},n.prototype.unsortedSegmentSum=function(e,t,r){this.assertNotComplex(e,"unsortedSegmentSum");for(var i=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<r;++a){var s=ye(a,"int32"),u=bM(s,t).asType("float32").mul(e).sum(0);i.push(u)}return So(i)},n.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var r=[t];pi("argMin",r,e.rank);for(var i=Ir(e.shape,r),o=i[0],a=i[1],s=In(o,"int32"),u=ze(a),l=s.dataSync(),c=e.dataSync(),h=0;h<l.length;++h){for(var d=h*u,f=c[d],p=0,m=0;m<u;++m){var g=c[d+m];g<f&&(f=g,p=m)}l[h]=p}return s},n.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var r=[t];pi("argMax",r,e.rank);for(var i=Ir(e.shape,r),o=i[0],a=i[1],s=In(o,"int32"),u=ze(a),l=s.dataSync(),c=e.dataSync(),h=0;h<l.length;++h){for(var d=h*u,f=c[d],p=0,m=0;m<u;++m){var g=c[d+m];g>f&&(f=g,p=m)}l[h]=p}return s},n.prototype.cumsum=function(e,t,r,i){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=nr(e.dtype,"int32"),a=In(e.shape,o),s=a.dataSync(),u=e.dataSync(),l=e.shape[e.rank-1],c=i?function(m,g){return m+l-g-1}:function(m,g){return m+g},h=0;h<u.length;h+=l)for(var d=0;d<l;d++){var f=c(h,d);if(d===0)s[f]=r?0:u[f];else{var p=c(h,d-1);s[f]=r?u[p]+s[p]:u[f]+s[p]}}return a},n.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r===i?1:0})},n.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r!==i?1:0})},n.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r<i?1:0})},n.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r<=i?1:0})},n.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r>i?1:0})},n.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r>=i?1:0})},n.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=e.dataSync(),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t[i]?0:1;return Te.make(e.shape,{values:r},"bool")},n.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r&&i})},n.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r||i})},n.prototype.select=function(e,t,r){this.assertNotComplex([e,t,r],"select");for(var i=e.dataSync(),o=t.dataSync(),a=r.dataSync(),s=In(t.shape,nr(t.dtype,r.dtype)),u=s.dataSync(),l=0,c=e.rank===0||e.rank>1||t.rank===1?1:t.shape[1],h=0;h<i.length;h++)for(var d=0;d<c;d++)i[h]===1?u[l++]=o[h]:u[l++]=a[h];return s},n.prototype.where=function(e){this.assertNotComplex([e],"where");var t=e.dataSync();return FE(e.shape,t)},n.prototype.topk=function(e,t,r){return this.assertNotComplex(e,"topk"),UO(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){this.assertNotComplex(e,"min"),pi("min",t,e.rank);for(var r=Ir(e.shape,t),i=r[0],o=r[1],a=In(i,e.dtype),s=ze(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],f=0;f<s;++f){var p=l[h+f];p<d&&(d=p)}u[c]=d}return a},n.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.min(r,i)})},n.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){var o=r%i;return r<0&&i<0||r>=0&&i>=0?o:(o+i)%i})},n.prototype.max=function(e,t){this.assertNotComplex(e,"max"),pi("max",t,e.rank);for(var r=Ir(e.shape,t),i=r[0],o=r[1],a=In(i,e.dtype),s=ze(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],f=0;f<s;++f){var p=l[h+f];p>d&&(d=p)}u[c]=d}return a},n.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.max(r,i)})},n.prototype.all=function(e,t){this.assertNotComplex(e,"all"),pi("all",t,e.rank);for(var r=Ir(e.shape,t),i=r[0],o=r[1],a=In(i,e.dtype),s=ze(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],f=0;f<s;++f){var p=l[h+f];d=d&&p}u[c]=d}return a},n.prototype.any=function(e,t){this.assertNotComplex(e,"any"),pi("any",t,e.rank);for(var r=Ir(e.shape,t),i=r[0],o=r[1],a=In(i,e.dtype),s=ze(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],f=0;f<s;++f){var p=l[h+f];d=d||p}u[c]=d}return a},n.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){var o=r-i;return o*o})},n.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.ceil(t[i]);return Te.make(e.shape,{values:r})},n.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.floor(t[i]);return Te.make(e.shape,{values:r})},n.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i)t[i]<0?r[i]=-1:t[i]>0?r[i]=1:r[i]=0;return Te.make(e.shape,{values:r})},n.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isNaN(t[i])&&(r[i]=1);return Te.make(e.shape,{values:r},"bool")},n.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Uint8Array(t.length),i=0;i<t.length;++i)Math.abs(t[i])===1/0&&(r[i]=1);return Te.make(e.shape,{values:r},"bool")},n.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isFinite(t[i])&&(r[i]=1);return Te.make(e.shape,{values:r},"bool")},n.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=Math.floor(t[i]);t[i]-o<.5?r[i]=Math.floor(t[i]):t[i]-o>.5?r[i]=Math.ceil(t[i]):r[i]=o%2==0?o:o+1}return Te.make(e.shape,{values:r})},n.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.exp(t[i]);return Te.make(e.shape,{values:r})},n.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.expm1(t[i]);return Te.make(e.shape,{values:r})},n.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.log(o)}return Te.make(e.shape,{values:r})},n.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.log1p(o)}return Te.make(e.shape,{values:r})},n.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.sqrt(o)}return Te.make(e.shape,{values:r})},n.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=1/Math.sqrt(o)}return Te.make(e.shape,{values:r})},n.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=o*o}return Te.make(e.shape,{values:r})},n.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=e.dataSync(),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=1/t[i];return Te.make(e.shape,{values:r})},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=In(e.shape,e.dtype),r=t.dataSync(),i=e.dataSync(),o=0;o<i.length;++o)r[o]=Math.max(0,i[o]);return t},n.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return r<0?i*r:r})},n.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i){var o=r[i];t[i]=o>=0?o:Math.exp(o)-1}return Te.make(e.shape,{values:t})},n.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var r=new Float32Array(t.size),i=t.dataSync(),o=e.dataSync(),a=0;a<i.length;++a){var s=i[a];r[a]=s>=1?o[a]:o[a]*(s+1)}return Te.make(t.shape,{values:r})},n.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=PE,r=OE,i=new Float32Array(e.size),o=e.dataSync(),a=0;a<o.length;++a){var s=o[a];i[a]=s>=0?r*s:t*(Math.exp(s)-1)}return Te.make(e.shape,{values:i})},n.prototype.clip=function(e,t,r){this.assertNotComplex(e,"clip");for(var i=new Float32Array(e.size),o=e.dataSync(),a=0;a<o.length;++a){var s=o[a];i[a]=s>r?r:s<t?t:s}return Te.make(e.shape,{values:i})},n.prototype.abs=function(e){for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.abs(r[i]);return Te.make(e.shape,{values:t})},n.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<e.size;++i){var o=r[2*i],a=r[2*i+1];t[i]=Math.hypot(o,a)}return Te.make(e.shape,{values:t})},n.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=r[i];return Te.make(e.shape,{values:t},"int32")},n.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=1/(1+Math.exp(-r[i]));return Te.make(e.shape,{values:t})},n.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(11920928955078125e-23)+2,r=new Float32Array(e.size),i=e.dataSync(),o=0;o<i.length;++o){var a=i[o]>-t,s=i[o]<t,u=Math.exp(i[o]),l=void 0;l=s?u:a?i[o]:Math.log(1+u),r[o]=l}return Te.make(e.shape,{values:r})},n.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.sin(r[i]);return Te.make(e.shape,{values:t})},n.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.cos(r[i]);return Te.make(e.shape,{values:t})},n.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.tan(r[i]);return Te.make(e.shape,{values:t})},n.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.asin(r[i]);return Te.make(e.shape,{values:t})},n.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.acos(r[i]);return Te.make(e.shape,{values:t})},n.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.atan(r[i]);return Te.make(e.shape,{values:t})},n.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.atan2(r,i)})},n.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.sinh(r[i]);return Te.make(e.shape,{values:t})},n.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.cosh(r[i]);return Te.make(e.shape,{values:t})},n.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Qq(r[i]);return Te.make(e.shape,{values:t})},n.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.asinh(r[i]);return Te.make(e.shape,{values:t})},n.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.acosh(r[i]);return Te.make(e.shape,{values:t})},n.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i)t[i]=Math.atanh(r[i]);return Te.make(e.shape,{values:t})},n.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),r=e.dataSync(),i=KO,o=XO,a=QO,s=YO,u=JO,l=ZO,c=0;c<r.length;++c){var h=r[c],d=1/(1+i*h);t[c]=1-((((l*d+u)*d+s)*d+a)*d+o)*d*Math.exp(-h*h)}return Te.make(e.shape,{values:t})},n.prototype.step=function(e,t){t===void 0&&(t=0),this.assertNotComplex(e,"step");for(var r=new Float32Array(e.size),i=e.dataSync(),o=0;o<i.length;++o){var a=i[o];isNaN(a)?r[o]=NaN:r[o]=a>0?1:t}return Te.make(e.shape,{values:r})},n.prototype.conv2d=function(e,t,r){this.assertNotComplex([e,t],"conv2d");for(var i=r.filterHeight,o=r.filterWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=vt(r.outShape,e.dtype),h=e.dataSync(),d=t.dataSync(),f=c.values,p=0;p<r.batchSize;++p)for(var m=p*e.strides[0],g=p*c.strides[0],y=0;y<r.outHeight;++y)for(var x=g+y*c.strides[1],_=y*r.strideHeight-u,b=0;b<i;b++){var C=_+b*a;if(!(C<0||C>=r.inHeight))for(var k=b*t.strides[0],T=m+C*e.strides[1],E=0;E<r.outWidth;++E)for(var I=x+E*r.outChannels,R=E*r.strideWidth-l,N=0;N<o;N++){var O=R+N*s;if(!(O<0||O>=r.inWidth))for(var M=k+N*t.strides[1],q=T+O*r.inChannels,J=M,ee=0;ee<r.inChannels;++ee){for(var Q=h[q+ee],$=0;$<r.outChannels;++$)f[I+$]+=Q*d[J+$];J+=r.outChannels}}}return c.toTensor()},n.prototype.conv3d=function(e,t,r){for(var i=r.filterDepth,o=r.filterHeight,a=r.filterWidth,s=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,c=r.padInfo.front,h=r.padInfo.left,d=r.padInfo.top,f=vt(r.outShape,e.dtype),p=e.dataSync(),m=t.dataSync(),g=f.values,y=0;y<r.batchSize;++y)for(var x=y*e.strides[0],_=y*f.strides[0],b=0;b<r.outDepth;++b)for(var C=_+b*f.strides[1],k=b*r.strideDepth-c,T=0;T<i;T++){var E=k+T*s;if(!(E<0||E>=r.inDepth))for(var I=T*t.strides[0],R=x+E*e.strides[1],N=0;N<r.outHeight;++N)for(var O=C+N*f.strides[2],M=N*r.strideHeight-d,q=0;q<o;q++){var J=M+q*u;if(!(J<0||J>=r.inHeight))for(var ee=I+q*t.strides[1],Q=R+J*e.strides[2],$=0;$<r.outWidth;++$)for(var K=O+$*r.outChannels,j=$*r.strideWidth-h,ue=0;ue<a;ue++){var he=j+ue*l;if(!(he<0||he>=r.inWidth))for(var ve=ee+ue*t.strides[2],we=Q+he*r.inChannels,Ee=ve,Ce=0;Ce<r.inChannels;++Ce){for(var Ie=p[we+Ce],ce=0;ce<r.outChannels;++ce)g[K+ce]+=Ie*m[Ee+ce];Ee+=r.outChannels}}}}return f.toTensor()},n.prototype.conv2dDerInput=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerInput");for(var i=vt(r.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=e.dataSync(),h=e.strides,d=h[0],f=h[1],p=h[2],m=t.dataSync(),g=t.strides,y=g[0],x=g[1],_=g[2],b=r.batchSize,C=r.filterHeight,k=r.filterWidth,T=r.inChannels,E=r.inHeight,I=r.inWidth,R=r.outChannels,N=r.outHeight,O=r.outWidth,M=r.strideHeight,q=r.strideWidth,J=C-1-r.padInfo.top,ee=k-1-r.padInfo.left,Q=0;Q<b;++Q)for(var $=0;$<T;++$)for(var K=0;K<E;++K)for(var j=K-J,ue=Math.max(0,Math.ceil(j/M)),he=Math.min(N,(C+j)/M),ve=0;ve<I;++ve){for(var we=ve-ee,Ee=Math.max(0,Math.ceil(we/q)),Ce=Math.min(O,(k+we)/q),Ie=0,ce=ue;ce<he;++ce)for(var Ue=ce*M-j,je=Ee;je<Ce;++je)for(var Be=d*Q+f*ce+p*je,Ge=y*(C-1-Ue)+x*(k-1-(je*q-we))+_*$,We=0;We<R;++We)Ie+=c[Be+We]*m[Ge+We];o[s*Q+u*K+l*ve+$]=Ie}return i.toTensor()},n.prototype.conv3dDerInput=function(e,t,r){for(var i=vt(r.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=a[3],h=e.dataSync(),d=e.strides,f=d[0],p=d[1],m=d[2],g=d[3],y=t.dataSync(),x=t.strides,_=x[0],b=x[1],C=x[2],k=x[3],T=r.batchSize,E=r.filterDepth,I=r.filterHeight,R=r.filterWidth,N=r.inChannels,O=r.inDepth,M=r.inHeight,q=r.inWidth,J=r.outChannels,ee=r.outDepth,Q=r.outHeight,$=r.outWidth,K=r.strideDepth,j=r.strideHeight,ue=r.strideWidth,he=E-1-r.padInfo.front,ve=I-1-r.padInfo.top,we=R-1-r.padInfo.left,Ee=0;Ee<T;++Ee)for(var Ce=0;Ce<N;++Ce)for(var Ie=0;Ie<O;++Ie)for(var ce=Ie-he,Ue=Math.max(0,Math.ceil(ce/K)),je=Math.min(ee,(E+ce)/K),Be=0;Be<M;++Be)for(var Ge=Be-ve,We=Math.max(0,Math.ceil(Ge/j)),ut=Math.min(Q,(I+Ge)/j),ot=0;ot<q;++ot){for(var dt=ot-we,Yn=Math.max(0,Math.ceil(dt/ue)),En=Math.min($,(R+dt)/ue),sn=0,Ln=Ue;Ln<je;++Ln)for(var Cn=Ln*K-ce,Bn=We;Bn<ut;++Bn)for(var ar=Bn*j-Ge,Nn=Yn;Nn<En;++Nn)for(var un=f*Ee+p*Ln+m*Bn+g*Nn,tn=_*(E-1-Cn)+b*(I-1-ar)+C*(R-1-(Nn*ue-dt))+k*Ce,Tt=0;Tt<J;++Tt)sn+=h[un+Tt]*y[tn+Tt];o[s*Ee+u*Ie+l*Be+c*ot+Ce]=sn}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerFilter");for(var i=r.strideHeight,o=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=vt(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=e.bufferSync(),d=t.bufferSync(),f=0;f<a;++f)for(var p=Math.max(0,Math.ceil((c-f)/i)),m=Math.min(r.outHeight,(r.inHeight+c-f)/i),g=0;g<s;++g)for(var y=Math.max(0,Math.ceil((l-g)/o)),x=Math.min(r.outWidth,(r.inWidth+l-g)/o),_=0;_<r.inChannels;++_)for(var b=0;b<r.outChannels;++b){for(var C=0,k=0;k<r.batchSize;++k)for(var T=p;T<m;++T)for(var E=f+T*i-c,I=y;I<x;++I){var R=g+I*o-l;C+=h.get(k,E,R,_)*d.get(k,T,I,b)}u.set(C,f,g,_,b)}return u.toTensor()},n.prototype.conv3dDerFilter=function(e,t,r){for(var i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.filterDepth,u=r.filterHeight,l=r.filterWidth,c=vt(r.filterShape,"float32"),h=c.values,d=c.strides,f=d[0],p=d[1],m=d[2],g=d[3],y=t.dataSync(),x=t.strides,_=x[0],b=x[1],C=x[2],k=x[3],T=e.dataSync(),E=e.strides,I=E[0],R=E[1],N=E[2],O=E[3],M=r.padInfo.front,q=r.padInfo.left,J=r.padInfo.top,ee=0;ee<s;++ee)for(var Q=Math.max(0,Math.ceil((M-ee)/i)),$=Math.min(r.outDepth,(r.inDepth+M-ee)/i),K=ee*f,j=0;j<u;++j)for(var ue=Math.max(0,Math.ceil((J-j)/o)),he=Math.min(r.outHeight,(r.inHeight+J-j)/o),ve=j*p+K,we=0;we<l;++we)for(var Ee=Math.max(0,Math.ceil((q-we)/a)),Ce=Math.min(r.outWidth,(r.inWidth+q-we)/a),Ie=we*m+ve,ce=0;ce<r.inChannels;++ce)for(var Ue=ce*g+Ie,je=0;je<r.outChannels;++je){for(var Be=0,Ge=0;Ge<r.batchSize;++Ge)for(var We=Ge*I,ut=Ge*_,ot=Q;ot<$;++ot)for(var dt=(ee+ot*i-M)*R+We,Yn=ot*b+ut,En=ue;En<he;++En)for(var sn=(j+En*o-J)*N+dt,Ln=En*C+Yn,Cn=Ee;Cn<Ce;++Cn){var Bn=Cn*k+Ln;Be+=T[(we+Cn*a-q)*O+sn+ce]*y[Bn+je]}h[Ue+je]=Be}return c.toTensor()},n.prototype.depthwiseConv2D=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2D");for(var i=r.filterHeight,o=r.filterWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=r.outChannels/r.inChannels,h=vt(r.outShape,e.dtype),d=e.dataSync(),f=t.dataSync(),p=h.values,m=0;m<r.batchSize;++m)for(var g=m*e.strides[0],y=m*h.strides[0],x=0;x<r.outHeight;++x)for(var _=y+x*h.strides[1],b=x*r.strideHeight-u,C=0;C<i;++C){var k=b+C*a;if(!(k<0||k>=r.inHeight))for(var T=C*t.strides[0],E=g+k*e.strides[1],I=0;I<r.outWidth;++I)for(var R=_+I*h.strides[2],N=I*r.strideWidth-l,O=0;O<o;++O){var M=N+O*s;if(!(M<0||M>=r.inWidth))for(var q=T+O*t.strides[1],J=E+M*r.inChannels,ee=R,Q=q,$=0;$<r.inChannels;++$){for(var K=d[J+$],j=0;j<c;++j)p[ee+j]+=K*f[Q+j];ee+=c,Q+=c}}}return h.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var i=vt(r.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=e.dataSync(),h=e.strides,d=h[0],f=h[1],p=h[2],m=t.dataSync(),g=t.strides,y=g[0],x=g[1],_=g[2],b=r.batchSize,C=r.filterHeight,k=r.filterWidth,T=r.inChannels,E=r.inHeight,I=r.inWidth,R=r.outChannels,N=r.outHeight,O=r.outWidth,M=r.strideHeight,q=r.strideWidth,J=C-1-r.padInfo.top,ee=k-1-r.padInfo.left,Q=R/T,$=0;$<b;++$)for(var K=0;K<T;++K)for(var j=0;j<E;++j)for(var ue=j-J,he=Math.max(0,Math.ceil(ue/M)),ve=Math.min(N,(C+ue)/M),we=0;we<I;++we){for(var Ee=we-ee,Ce=Math.max(0,Math.ceil(Ee/q)),Ie=Math.min(O,(k+Ee)/q),ce=0,Ue=he;Ue<ve;++Ue)for(var je=Ue*M-ue,Be=Ce;Be<Ie;++Be)for(var Ge=d*$+f*Ue+p*Be,We=y*(C-1-je)+x*(k-1-(Be*q-Ee))+_*K,ut=0;ut<Q;++ut)ce+=c[Ge+(K*Q+ut)]*m[We+ut];o[s*$+u*j+l*we+K]=ce}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var i=r.strideHeight,o=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=vt(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=r.outChannels/r.inChannels,d=e.bufferSync(),f=t.bufferSync(),p=0;p<a;++p)for(var m=Math.max(0,Math.ceil((c-p)/i)),g=Math.min(r.outHeight,(r.inHeight+c-p)/i),y=0;y<s;++y)for(var x=Math.max(0,Math.ceil((l-y)/o)),_=Math.min(r.outWidth,(r.inWidth+l-y)/o),b=0;b<r.outChannels;++b){for(var C=Math.trunc(b/h),k=b%h,T=0,E=0;E<r.batchSize;++E)for(var I=m;I<g;++I)for(var R=p+I*i-c,N=x;N<_;++N){var O=y+N*o-l;T+=d.get(E,R,O,C)*f.get(E,I,N,b)}u.set(T,p,y,C,k)}return u.toTensor()},n.prototype.tile=function(e,t){this.assertNotComplex(e,"tile");for(var r=new Array(e.rank),i=0;i<r.length;i++)r[i]=e.shape[i]*t[i];var o=vt(r,e.dtype),a=e.bufferSync();for(i=0;i<o.values.length;++i){for(var s=o.indexToLoc(i),u=new Array(e.rank),l=0;l<u.length;l++)u[l]=s[l]%e.shape[l];var c=a.locToIndex(u);o.values[i]=a.values[c]}return o.toTensor()},n.prototype.pad=function(e,t,r){this.assertNotComplex(e,"pad");var i=t.map(function(h,d){return h[0]+e.shape[d]+h[1]}),o=t.map(function(h){return h[0]}),a=e.bufferSync(),s=vt(i,e.dtype);r!==0&&s.values.fill(r);for(var u=0;u<e.size;u++){var l=a.indexToLoc(u),c=l.map(function(h,d){return h+o[d]});s.set.apply(s,[a.get.apply(a,l)].concat(c))}return s.toTensor()},n.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var r=new Array(e.rank),i=0;i<r.length;i++)r[i]=e.shape[t[i]];var o=e.dataSync(),a=vt(r,e.dtype),s=e.bufferSync();for(i=0;i<e.size;++i){for(var u=s.indexToLoc(i),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[t[c]];var h=a.locToIndex(l);a.values[h]=o[i]}return a.toTensor()},n.prototype.gather=function(e,t,r){this.assertNotComplex([e,t],"gather");var i=e.shape.slice(),o=t.dataSync();i[r]=o.length;for(var a=vt(i,e.dtype),s=e.bufferSync(),u=0;u<a.size;++u){var l=a.indexToLoc(u),c=l.slice();c[r]=o[l[r]];var h=s.locToIndex(c);a.values[u]=s.values[h]}return a.toTensor()},n.prototype.batchToSpaceND=function(e,t,r){this.assertNotComplex([e],"batchToSpaceND");var i=t.reduce(function(c,h){return c*h}),o=Jg(e.shape,t,i),a=Zg(o.length,t.length),s=ey(e.shape,t,i),u=SO(r,t.length),l=RO(s,r,t.length);return e.reshape(o).transpose(a).reshape(s).slice(u,l)},n.prototype.spaceToBatchND=function(e,t,r){this.assertNotComplex([e],"spaceToBatchND");var i=t.reduce(function(h,d){return h*d}),o=[[0,0]];o.push.apply(o,r);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var s=e.pad(o),u=Jg(s.shape,t,i,!1),l=Zg(u.length,t.length,!1),c=ey(s.shape,t,i,!1);return s.reshape(u).transpose(l).reshape(c)},n.prototype.pool=function(e,t,r){this.assertNotComplex(e,"pool");for(var i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,d=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=e.dataSync(),p=vt(t.outShape,e.dtype),m=p.values,g=t.outShape[1]*t.outShape[2]*t.outShape[3],y=t.outShape[2]*t.outShape[3],x=t.outShape[3],_=0;_<t.batchSize;++_)for(var b=_*g,C=_*e.strides[0],k=0;k<t.inChannels;++k)for(var T=0;T<t.outHeight;++T)for(var E=T*i-c,I=Math.max(0,E),R=Math.min(t.inHeight,u+E),N=b+T*y,O=0;O<t.outWidth;++O){for(var M=O*o-h,q=Math.max(0,M),J=Math.min(t.inWidth,l+M),ee=d,Q=0,$=0,K=I;K<R;K+=a){for(var j=C+K*e.strides[1],ue=q;ue<J;ue+=s){var he=f[j+ue*e.strides[2]+k];r==="max"&&he>ee?ee=he:r==="avg"&&(Q+=he,$++)}if(isNaN(ee))break}m[N+O*x+k]=r==="avg"?Q/$:ee}return p.toTensor()},n.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},n.prototype.maxPoolPositions=function(e,t){for(var r=vt(t.outShape,"int32"),i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,d=e.bufferSync(),f=0;f<t.batchSize;++f)for(var p=0;p<t.inChannels;++p)for(var m=0;m<t.outHeight;++m){for(var g=m*i-c,y=g;y<0;)y+=a;for(var x=Math.min(t.inHeight,u+g),_=0;_<t.outWidth;++_){for(var b=_*o-h,C=b;C<0;)C+=s;for(var k=Math.min(t.inWidth,l+b),T=Number.NEGATIVE_INFINITY,E=-1,I=y;I<x;I+=a)for(var R=I-g,N=C;N<k;N+=s){var O=N-b,M=d.get(f,I,N,p);M>T&&(T=M,E=R*l+O)}r.set(E,f,m,_,p)}}return r.toTensor()},n.prototype.maxPoolBackprop=function(e,t,r,i){this.assertNotComplex([t,r],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,i),a=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=h-1-i.padInfo.left,f=c-1-i.padInfo.top,p=vt(t.shape,"float32"),m=o.bufferSync(),g=e.bufferSync(),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var _=0;_<i.inHeight;++_)for(var b=0;b<i.inWidth;++b){for(var C=_-f,k=b-d,T=0,E=0;E<c;E+=u){var I=(C+E)/a;if(!(I<0||I>=i.outHeight||Math.floor(I)!==I))for(var R=0;R<h;R+=l){var N=(k+R)/s;if(!(N<0||N>=i.outWidth||Math.floor(N)!==N)){var O=c*h-1-m.get(y,I,N,x)===E*h+R?1:0;O!==0&&(T+=g.get(y,I,N,x)*O)}}}p.set(T,y,_,b,x)}return p.toTensor()},n.prototype.avgPoolBackprop=function(e,t,r){this.assertNotComplex([e,t],"avgPoolBackprop");for(var i=r.strideHeight,o=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=h-1-r.padInfo.left,f=c-1-r.padInfo.top,p=vt(t.shape,"float32"),m=1/(a*s),g=e.bufferSync(),y=0;y<r.batchSize;++y)for(var x=0;x<r.inChannels;++x)for(var _=0;_<r.inHeight;++_)for(var b=0;b<r.inWidth;++b){for(var C=_-f,k=b-d,T=0,E=0;E<c;E+=u){var I=(C+E)/i;if(!(I<0||I>=r.outHeight||Math.floor(I)!==I))for(var R=0;R<h;R+=l){var N=(k+R)/o;N<0||N>=r.outWidth||Math.floor(N)!==N||(T+=g.get(y,I,N,x))}}p.set(T*m,y,_,b,x)}return p.toTensor()},n.prototype.cast=function(e,t){return LO(e,t,this)},n.prototype.reshape=function(e,t){return r_(e,t)},n.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},n.prototype.resizeBilinear=function(e,t,r,i){this.assertNotComplex(e,"resizeBilinear");for(var o=e.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=e.dataSync(),h=new Float32Array(ze([a,t,r,l])),d=[i&&t>1?s-1:s,i&&r>1?u-1:u],f=[i&&t>1?t-1:t,i&&r>1?r-1:r],p=0,m=d[0]/f[0],g=d[1]/f[1],y=0;y<a;y++)for(var x=0;x<t;x++)for(var _=m*x,b=Math.floor(_),C=_-b,k=Math.min(s-1,Math.ceil(_)),T=y*e.strides[0]+b*e.strides[1],E=y*e.strides[0]+k*e.strides[1],I=0;I<r;I++)for(var R=g*I,N=Math.floor(R),O=R-N,M=Math.min(u-1,Math.ceil(R)),q=T+N*e.strides[2],J=E+N*e.strides[2],ee=T+ +M*e.strides[2],Q=E+M*e.strides[2],$=0;$<l;$++){var K=c[q+$],j=c[J+$],ue=K+(c[ee+$]-K)*O,he=ue+(j+(c[Q+$]-j)*O-ue)*C;h[p++]=he}return On(h,[a,t,r,l])},n.prototype.resizeBilinearBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],d=new Float32Array(o*a*s*u),f=[r&&c>1?a-1:a,r&&h>1?s-1:s],p=[r&&c>1?c-1:c,r&&h>1?h-1:h],m=f[0]/p[0],g=f[1]/p[1],y=e.dataSync(),x=0,_=0;_<o;_++)for(var b=_*t.strides[0],C=0;C<c;C++)for(var k=C*m,T=Math.floor(k),E=Math.min(Math.ceil(k),a-1),I=b+T*t.strides[1],R=b+E*t.strides[1],N=k-T,O=1-N,M=0;M<h;M++)for(var q=M*g,J=Math.floor(q),ee=Math.min(Math.ceil(q),s-1),Q=q-J,$=1-Q,K=I+J*t.strides[2],j=I+ee*t.strides[2],ue=R+J*t.strides[2],he=R+ee*t.strides[2],ve=O*$,we=O*Q,Ee=N*$,Ce=N*Q,Ie=0;Ie<u;Ie++){var ce=y[x++];d[K+Ie]+=ce*ve,d[j+Ie]+=ce*we,d[ue+Ie]+=ce*Ee,d[he+Ie]+=ce*Ce}return wo(d,[o,s,a,u],t.dtype)},n.prototype.resizeNearestNeighbor=function(e,t,r,i){this.assertNotComplex(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=e.dataSync(),h=new Float32Array(a*t*r*l),d=[i&&t>1?s-1:s,i&&r>1?u-1:u],f=[i&&t>1?t-1:t,i&&r>1?r-1:r],p=d[0]/f[0],m=d[1]/f[1],g=0,y=0;y<a;y++)for(var x=y*e.strides[0],_=0;_<t;_++)for(var b=p*_,C=x+Math.min(s-1,i?Math.round(b):Math.floor(b))*e.strides[1],k=0;k<r;k++)for(var T=m*k,E=C+Math.min(u-1,i?Math.round(T):Math.floor(T))*e.strides[2],I=0;I<l;I++){var R=c[E+I];h[g++]=R}return On(h,[a,t,r,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],d=new Float32Array(o*a*s*u),f=e.dataSync(),p=[r&&c>1?a-1:a,r&&h>1?s-1:s],m=[r&&c>1?c-1:c,r&&h>1?h-1:h],g=p[0]/m[0],y=p[1]/m[1],x=1/g,_=1/y,b=2*Math.ceil(x)+2,C=2*Math.ceil(_)+2,k=0;k<o;k++)for(var T=k*t.strides[0],E=0;E<a;E++)for(var I=T+E*t.strides[1],R=Math.floor(E*x),N=Math.floor(R-b/2),O=0;O<s;O++)for(var M=I+O*t.strides[2],q=Math.floor(O*_),J=Math.floor(q-C/2),ee=0;ee<u;ee++){for(var Q=0,$=0;$<b;$++){var K=$+N;if(!(K<0||K>=c)){var j=T+K*e.strides[1],ue=K*g;if(E===Math.min(a-1,r?Math.round(ue):Math.floor(ue)))for(var he=0;he<C;he++){var ve=he+J;if(!(ve<0||ve>=h)){var we=j+ve*e.strides[2],Ee=ve*y;O===Math.min(s-1,r?Math.round(Ee):Math.floor(Ee))&&(Q+=f[we+ee])}}}}d[M+ee]=Q}return wo(d,t.shape,t.dtype)},n.prototype.batchNormalization=function(e,t,r,i,o,a){this.assertNotComplex([e,t,r,o,a],"batchNorm");for(var s=e.dataSync(),u=t.dataSync(),l=r.dataSync(),c=o?o.dataSync():new Float32Array([1]),h=a?a.dataSync():new Float32Array([0]),d=new Float32Array(s.length),f=h.length,p=c.length,m=l.length,g=u.length,y=0,x=0,_=0,b=0,C=0;C<s.length;++C)d[C]=h[y++]+(s[C]-u[x++])*c[_++]/Math.sqrt(l[b++]+i),y>=f&&(y=0),x>=g&&(x=0),_>=p&&(_=0),b>=m&&(b=0);return wo(d,e.shape)},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],s=a-1,u=e.dataSync(),l=e.size,c=new Float32Array(l);function h(m){for(var g=m%a,y=m-g+Math.max(0,g-t),x=m-g+Math.min(g+t,s),_=0;y<=x;y++){var b=u[y];_+=b*b}return _}for(var d=0;d<l;d++){var f=h(d),p=u[d]*Math.pow(r+i*f,-o);c[d]=p}return wo(c,e.shape)},n.prototype.LRNGrad=function(e,t,r,i,o,a,s){this.assertNotComplex(e,"LRNGrad");for(var u=e.shape[3],l=e.dataSync(),c=t.dataSync(),h=r.dataSync(),d=new Float32Array(e.size),f=e.size,p=0;p<f;p++){for(var m=p%u,g=p-m+Math.max(0,m-i),y=p-m+Math.min(u,m+i+1),x=0,_=g;_<y;_++)x+=Math.pow(c[_],2);for(x=a*x+o,_=g;_<y;_++){var b=-2*a*s*c[_]*h[p]/x;p===_&&(b+=Math.pow(x,-s)),b*=l[p],d[_]+=b}}return wo(d,e.shape)},n.prototype.multinomial=function(e,t,r,i){this.assertNotComplex(e,"multinomial");for(var o=t?e:$u(e),a=o.shape[0],s=o.shape[1],u=In([a,r],"int32"),l=u.dataSync(),c=o.dataSync(),h=0;h<a;++h){var d=h*s,f=new Float32Array(s-1);f[0]=c[d];for(var p=1;p<f.length;++p)f[p]=f[p-1]+c[d+p];for(var m=tM(i.toString()),g=h*r,y=0;y<r;++y){var x=m();l[g+y]=f.length;for(var _=0;_<f.length;_++)if(x<f[_]){l[g+y]=_;break}}}return u},n.prototype.oneHot=function(e,t,r,i){this.assertNotComplex(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(i);for(var a=e.dataSync(),s=0;s<e.size;++s)a[s]>=0&&a[s]<t&&(o[s*t+a[s]]=r);return d0(o,[e.size,t],"int32")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return this.assertNotComplex(e,"nonMaxSuppression"),AE(e.dataSync(),t.dataSync(),r,i,o)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,t){for(var r=e.shape[0],i=e.shape[1],o=vt(e.shape,"float32"),a=vt(e.shape,"float32"),s=ea(e).as2D(r,i),u=ru(e).as2D(r,i),l=0;l<r;l++)for(var c=s.slice([l,0],[1,i]),h=u.slice([l,0],[1,i]),d=Ur(c,h),f=this.fftImpl(d,t).dataSync(),p=0;p<i;p++){var m=MS(f,p);o.values[l*i+p]=m.real,a.values[l*i+p]=m.imag}return Ur(o.toTensor(),a.toTensor()).as2D(r,i)},n.prototype.fftImpl=function(e,t){var r=e.as1D(),i=r.size;if(this.isExponentOf2(i)){var o=this.fftRadix2(r,i,t).as2D(e.shape[0],e.shape[1]);return t&&(o=Ur(ea(o).div(ye(i)),ru(o).div(ye(i)))),o}var a=e.dataSync(),s=oK(this.fourierTransformByMatmul(a,i,t));return Ur(s.real,s.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return(e&e-1)==0},n.prototype.fftRadix2=function(e,t,r){if(t===1)return e;var i=e.dataSync(),o=t/2,a=aK(i),s=Ur(a.real,a.imag).as1D(),u=sK(i),l=Ur(u.real,u.imag).as1D();s=this.fftRadix2(s,o,r),l=this.fftRadix2(l,o,r);var c=lK(t,r),h=Ur(c.real,c.imag).mul(l),d=s.add(h),f=s.sub(h),p=ea(d).concat(ea(f)),m=ru(d).concat(ru(f));return Ur(p,m).as1D()},n.prototype.fourierTransformByMatmul=function(e,t,r){for(var i=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,s=0,u=0;u<t;u++){var l=cK(o*u,t,r),c=MS(e,u);a+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}r&&(a/=t,s/=t),uK(i,a,s,o)}return i},n.prototype.depthToSpace=function(e,t,r){H(r==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r}),H(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var i=e.shape[0],o=e.shape[1],a=e.shape[2],s=e.shape[3],u=o*t,l=a*t,c=s/(t*t),h=e.dataSync(),d=new Float32Array(i*u*l*c),f=0,p=0;p<i;++p)for(var m=0;m<u;++m)for(var g=Math.floor(m/t),y=m%t,x=0;x<l;++x)for(var _=Math.floor(x/t),b=(y*t+x%t)*c,C=0;C<c;++C){var k=C+b+s*(_+a*(g+o*p));d[f++]=h[k]}return wo(d,[i,u,l,c])},n.prototype.broadcastedBinaryOp=function(e,t,r,i){var o=Et(e.shape,t.shape),a=vt(o,r),s=e.dataSync(),u=t.dataSync(),l=fh(e.shape,o),c=fh(t.shape,o),h=a.values;if(l.length+c.length===0)for(var d=0;d<h.length;++d)h[d]=i(s[d%s.length],u[d%u.length]);else{var f=e.bufferSync(),p=t.bufferSync(),m=function(g){var y=a.indexToLoc(g),x=y.slice(-e.rank);l.forEach(function(k){return x[k]=0});var _=f.locToIndex(x),b=y.slice(-t.rank);c.forEach(function(k){return b[k]=0});var C=p.locToIndex(b);h[g]=i(s[_],u[C])};for(d=0;d<h.length;++d)m(d)}return a.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,t,r){var i=Et(e.shape,t.shape),o=vt(i,"float32"),a=vt(i,"float32"),s=e.dataSync(),u=t.dataSync(),l=fh(e.shape,i),c=fh(t.shape,i),h=o.values,d=a.values;if(l.length+c.length===0)for(var f=0;f<h.length;f++){var p=f%s.length,m=f%u.length,g=r(s[2*p],s[2*p+1],u[2*m],u[2*m+1]);h[f]=g.real,d[f]=g.imag}else{var y=this.data.get(e.dataId).complexTensors.real.bufferSync(),x=this.data.get(t.dataId).complexTensors.real.bufferSync(),_=function(b){var C=o.indexToLoc(b),k=C.slice(-e.rank);l.forEach(function(N){return k[N]=0});var T=y.locToIndex(k),E=C.slice(-t.rank);c.forEach(function(N){return E[N]=0});var I=x.locToIndex(E),R=r(s[2*T],s[2*T+1],u[2*I],u[2*I+1]);h[b]=R.real,d[b]=R.imag};for(f=0;f<h.length;f++)_(f)}return this.complex(o.toTensor(),a.toTensor())},n.prototype.split=function(e,t,r){return VO(e,t,r)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.cropAndResize=function(e,t,r,i,o,a){for(var s=e.shape,u=s[0],l=s[1],c=s[2],h=s[3],d=t.shape[0],f=i[0],p=i[1],m=vt([d,f,p,h],e.dtype),g=t.dataSync(),y=r.dataSync(),x=e.dataSync(),_=e.strides,b=m.strides,C=0;C<d;C++){var k=4*C,T=g[k],E=g[k+1],I=g[k+2],R=g[k+3],N=y[C];if(!(N>=u))for(var O=f>1?(I-T)*(l-1)/(f-1):0,M=p>1?(R-E)*(c-1)/(p-1):0,q=0;q<f;q++){var J=f>1?T*(l-1)+q*O:.5*(T+I)*(l-1);if(J<0||J>l-1)for(var ee=0;ee<p;ee++)for(var Q=0;Q<h;Q++){var $=Q+ee*b[2]+q*b[1]+C*b[0];m.values[$]=a}else if(o==="bilinear"){var K=Math.floor(J),j=Math.ceil(J),ue=J-K;for(ee=0;ee<p;ee++)if((je=p>1?E*(c-1)+ee*M:.5*(E+R)*(c-1))<0||je>c-1)for(Q=0;Q<h;Q++)$=Q+ee*b[2]+q*b[1]+C*b[0],m.values[$]=a;else{var he=Math.floor(je),ve=Math.ceil(je),we=je-he;for(Q=0;Q<h;Q++){var Ee=x[$=Q+he*_[2]+K*_[1]+N*_[0]],Ce=x[$=Q+ve*_[2]+K*_[1]+N*_[0]],Ie=x[$=Q+he*_[2]+j*_[1]+N*_[0]],ce=Ee+(Ce-Ee)*we,Ue=Ie+(x[$=Q+ve*_[2]+j*_[1]+N*_[0]]-Ie)*we;$=Q+ee*b[2]+q*b[1]+C*b[0],m.values[$]=ce+(Ue-ce)*ue}}}else for(ee=0;ee<p;++ee){var je;if((je=p>1?E*(c-1)+ee*M:.5*(E+R)*(c-1))<0||je>c-1)for(Q=0;Q<h;Q++)$=Q+ee*b[2]+q*b[1]+C*b[0],m.values[$]=a;else{var Be=Math.round(je),Ge=Math.round(J);for(Q=0;Q<h;Q++){var We=Q+Be*_[2]+Ge*_[1]+N*_[0],ut=Q+ee*b[2]+q*b[1]+C*b[0];m.values[ut]=x[We]}}}}}return m.toTensor()},n.prototype.sparseToDense=function(e,t,r,i){var o=ty(t,e,r),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize;return this.scatter(e,t,r,c,u,s,a,l,i,!1)},n.prototype.gatherND=function(e,t){var r=t.shape,i=r[r.length-1],o=AO(e,t),a=o[0],s=o[1],u=o[2],l=o[3];if(s===0)return On([],a,e.dtype);for(var c=new xp([s,u],e.dtype),h=t.dataSync(),d=e.dataSync(),f=0;f<s;f++){for(var p=[],m=0,g=0;g<i;g++){var y=h[f*i+g];m+=y*l[g],p.push(y)}if(m<0||m>=e.size/u)throw new Error("Invalid indices: "+p+" does not index into "+e.shape);for(var x=0;x<u;x++)c.values[f*u+x]=d[m*u+x]}return c.toTensor().reshape(a)},n.prototype.scatterND=function(e,t,r){var i=ty(t,e,r),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,l=i.outputSize,c=ye(0);return this.scatter(e,t,r,l,s,a,o,u,c,!0)},n.prototype.fill=function(e,t,r){var i=Xg(r=r||$p(t),ze(e));return i.fill(t),Te.make(e,{values:i},r)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var t=Xg(e.dtype,ze(e.shape));return Te.make(e.shape,{values:t},e.dtype)},n.prototype.scatter=function(e,t,r,i,o,a,s,u,l,c){var h=[i/o,o],d=e.dataSync(),f=t.dataSync();if(i===0)return On([],r,t.dtype);var p=new xp(h,t.dtype);p.values.fill(l.dataSync()[0]);for(var m=0;m<a;m++){for(var g=[],y=0,x=0;x<s;x++){var _=d[m*s+x];g.push(_),y+=_*u[x]}if(y<0||y>=i/o)throw new Error("Invalid indices: "+g+" does not index into "+r);for(var b=0;b<o;b++)c?p.values[y*o+b]+=f[m*o+b]:p.values[y*o+b]=t.rank===0?f[0]:f[m*o+b]}return p.toTensor().reshape(r)},n}();z.registerBackend("cpu",function(){return new Xne},1);var $E=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function iR(n){return $E?Buffer.byteLength(n):new Blob([n]).size}function Qne(n){return $E?Buffer.from(n).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(n)))}function Yne(n){if($E){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),i=0;i<t.length;++i)r.set([t.charCodeAt(i)],i);return r.buffer}function Jne(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function m0(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:iR(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:iR(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Yl=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var a=o(e,r);a!==null&&i.push(a)}),i},n}(),oR="://",FM=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){H(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(oR)&&(e=e.slice(0,e.indexOf(oR))),H(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();H(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}(),u_="tensorflowjs",l_=1,Rl="models_store",iu="model_info_store";function LM(){if(!z.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function c_(n){var e=n.result;e.createObjectStore(Rl,{keyPath:"modelPath"}),e.createObjectStore(iu,{keyPath:"modelPath"})}var nd=function(){function n(e){if(this.indexedDB=LM(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Ht(this,void 0,void 0,function(){return Gt(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Ht(this,void 0,void 0,function(){return Gt(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var a=r.indexedDB.open(u_,l_);a.onupgradeneeded=function(){return c_(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(Rl,"readonly"),l=u.objectStore(Rl).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=m0(t),d=s.transaction(iu,"readwrite"),f=d.objectStore(iu),p=f.put({modelPath:r.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var m=(c=s.transaction(Rl,"readwrite")).objectStore(Rl).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});m.onsuccess=function(){return i({modelArtifactsInfo:h})},m.onerror=function(g){var y=(f=d.objectStore(iu)).delete(r.modelPath);y.onsuccess=function(){return s.close(),o(m.error)},y.onerror=function(x){return s.close(),o(m.error)}}},p.onerror=function(m){return s.close(),o(p.error)},d.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},n.URL_SCHEME="indexeddb://",n}(),aR=function(n){return z.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(nd.URL_SCHEME)?Zne(n.slice(nd.URL_SCHEME.length)):null};function Zne(n){return new nd(n)}function ere(n){return n.startsWith(nd.URL_SCHEME)?n.slice(nd.URL_SCHEME.length):n}Yl.registerSaveRouter(aR),Yl.registerLoadRouter(aR);var tre=function(){function n(){this.indexedDB=LM()}return n.prototype.listModels=function(){return Ht(this,void 0,void 0,function(){var e=this;return Gt(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open(u_,l_);o.onupgradeneeded=function(){return c_(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(iu,"readonly"),u=s.objectStore(iu).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var d=h[c];l[d.modelPath]=d.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return Ht(this,void 0,void 0,function(){var t=this;return Gt(this,function(r){return e=ere(e),[2,new Promise(function(i,o){var a=t.indexedDB.open(u_,l_);a.onupgradeneeded=function(){return c_(a)},a.onsuccess=function(){var s,u=a.result,l=u.transaction(iu,"readwrite"),c=l.objectStore(iu),h=c.get(e);h.onsuccess=function(){if(h.result==null)return u.close(),o(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var d=c.delete(e),f=function(){var p=(s=u.transaction(Rl,"readwrite")).objectStore(Rl).delete(e);p.onsuccess=function(){return i(h.result.modelArtifactsInfo)},p.onerror=function(m){return o(h.error)}};d.onsuccess=f,d.onerror=function(p){return f(),u.close(),o(h.error)}},h.onerror=function(d){return u.close(),o(h.error)},l.oncomplete=function(){s==null?u.close():s.oncomplete=function(){return u.close()}}},a.onerror=function(s){return o(a.error)}})]})})},n}();if(z.get("IS_BROWSER"))try{FM.registerManager(nd.URL_SCHEME,new tre)}catch{}var Wa="/",Qc="tensorflowjs_models",BM="info",nre="model_topology",rre="weight_specs",ire="weight_data",ore="model_metadata";function VM(n){return{info:[Qc,n,BM].join(Wa),topology:[Qc,n,nre].join(Wa),weightSpecs:[Qc,n,rre].join(Wa),weightData:[Qc,n,ire].join(Wa),modelMetadata:[Qc,n,ore].join(Wa)}}function are(n){var e=n.split(Wa);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Wa)}function sre(n){return n.startsWith(rd.URL_SCHEME)?n.slice(rd.URL_SCHEME.length):n}var rd=function(){function n(e){if(!z.get("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=VM(this.modelPath)}return n.prototype.save=function(e){return Ht(this,void 0,void 0,function(){var t,r,i;return Gt(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=m0(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Qne(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return Ht(this,void 0,void 0,function(){var e,t,r,i,o,a,s;return Gt(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=Yne(s),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),sR=function(n){return z.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(rd.URL_SCHEME)?ure(n.slice(rd.URL_SCHEME.length)):null};function ure(n){return new rd(n)}Yl.registerSaveRouter(sR),Yl.registerLoadRouter(sR);var lre=function(){function n(){H(z.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),H(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Ht(this,void 0,void 0,function(){var e,t,r,i,o,a;return Gt(this,function(s){for(e={},t=Qc+Wa,r=Wa+BM,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(a=are(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return Ht(this,void 0,void 0,function(){var t,r;return Gt(this,function(i){if(e=sre(e),t=VM(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(z.get("IS_BROWSER"))try{FM.registerManager(rd.URL_SCHEME,new lre)}catch{}var cre="model",hre=".json",dre=".weights.bin",h_=function(){function n(e){if(!z.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=cre),this.modelTopologyFileName=e+hre,this.weightDataFileName=e+dre}return n.prototype.save=function(e){return Ht(this,void 0,void 0,function(){var t,r,i,o,a,s;return Gt(this,function(u){if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,a.click(),e.weightData!=null&&((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,s.click()),[2,{modelArtifactsInfo:m0(e)}]})})},n.URL_SCHEME="downloads://",n}(),fre=function(n){return z.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(h_.URL_SCHEME)?pre(n.slice(h_.URL_SCHEME.length)):null};function pre(n){return n===void 0&&(n="model"),new h_(n)}function uR(n,e,t,r){(function(o){H(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(n),function(o,a){H(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),H(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),H(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})}(t=t??0,r=r??1);var i=0;return Promise.all(n.map(function(o){return o.then(function(a){var s=t+ ++i/n.length*(r-t);return e(s),a}),o}))}function mre(n,e){return Ht(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c;return Gt(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit)}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,uR(r,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,uR(s,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}Yl.registerSaveRouter(fre);var vre="application/octet-stream",gre="application/json",UM=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc==null){var r=z.global.fetch;if(r===void 0)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");t.fetchFunc=r.bind(z.global)}else H(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(i,o){return t.fetchFunc(i,o).catch(function(a){throw new Error("Request for "+i+" failed due to error: "+a)})},H(e!=null&&e.length>0,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(e)&&H(e.length===2,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Ht(this,void 0,void 0,function(){var t,r,i,o;return Gt(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:gre}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:vre}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:m0(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return Ht(this,void 0,void 0,function(){var e,t,r,i,o,a,s,u;return Gt(this,function(l){switch(l.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(e=l.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");l.label=2;case 2:return l.trys.push([2,4,,5]),[4,e.json()];case 3:return t=l.sent(),[3,5];case 4:throw l.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:u=l.sent(),a=u[0],s=u[1],l.label=7;case 7:return[2,{modelTopology:i,weightSpecs:a,weightData:s}]}})})},n.prototype.loadWeights=function(e){return Ht(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,d;return Gt(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=yre(t),i=r[0],o=r[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],e.forEach(function(p){p.paths.forEach(function(m){h.push(a+m+o)})}),[4,mre(h,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return d=f.sent(),[2,[s,Jne(d)]]}})})},n.prototype.getFetchFunc=function(){return this.fetchFunc},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function yre(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?");return[n.substring(0,e)+"/",t>e?n.substring(t):""]}function lR(n){return n.match(UM.URL_SCHEME_REGEX)!=null}var cR=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return lR(t)}):lR(n))?xre(n,{onProgress:e}):null};function xre(n,e){return new UM(n,e)}Yl.registerSaveRouter(cR),Yl.registerLoadRouter(cR);function wre(n,e,t){var r=W(n,"labels","confusionMatrix"),i=W(e,"predictions","confusionMatrix");H(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),H(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),H(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),H(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),H(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=o_(r.asType("int32"),t),a=o_(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}Y({confusionMatrix_:wre});function _re(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return z.engine.fromPixels(n,e)}function bre(n,e){return Ht(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,d,f,p,m,g,y,x,_,b,C;return Gt(this,function(k){switch(k.label){case 0:if(t=W(n,"img","toPixels"),n instanceof Te||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return s=t.min(),u=t.max(),[4,s.data()];case 1:return l=k.sent()[0],[4,u.data()];case 2:if(c=k.sent()[0],s.dispose(),u.dispose(),t.dtype==="float32"){if(l<0||c>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+l+" - "+c+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(l<0||c>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+l+" - "+c+"].")}return[4,t.data()];case 3:for(h=k.sent(),d=t.dtype==="float32"?255:1,f=new Uint8ClampedArray(o*i*4),p=0;p<i*o;++p)m=void 0,g=void 0,y=void 0,x=void 0,a===1?(m=h[p]*d,g=h[p]*d,y=h[p]*d,x=255):a===3?(m=h[3*p]*d,g=h[3*p+1]*d,y=h[3*p+2]*d,x=255):a===4&&(m=h[4*p]*d,g=h[4*p+1]*d,y=h[4*p+2]*d,x=h[4*p+3]*d),f[(_=4*p)+0]=Math.round(m),f[_+1]=Math.round(g),f[_+2]=Math.round(y),f[_+3]=Math.round(x);return e!=null&&(e.width=o,e.height=i,b=e.getContext("2d"),C=new ImageData(f,o,i),b.putImageData(C,0,0)),t!==n&&t.dispose(),[2,f]}})})}var Ere=Y({fromPixels_:_re}),Cre=Object.freeze({toPixels:bre,fromPixels:Ere}),Tre=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),Ire=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function fc(n){H(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),H(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),H(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Ire.register(n)}var pc=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return fs(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;return this.applyGradients(s),Object.keys(s).forEach(function(u){return s[u].dispose()}),r?a:(a.dispose(),null)},e.prototype.computeGradients=function(t,r){return F9(t,r)},e.prototype.dispose=function(){},e}(Tre);Object.defineProperty(pc,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var Sre=function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads={},o.accumulatedUpdates={},o.c=Jt(ye(-t)),o.rhoScalar=Jt(ye(r)),o.oneMinusRho=Jt(ye(1-r)),i===null&&(i=z.get("EPSILON")),o.epsilonScalar=Jt(ye(i)),o}return fs(e,n),e.prototype.applyGradients=function(t){var r=this,i=function(s){var u=z.engine.registeredVariables[s];o.accumulatedGrads[s]==null&&Ve(function(){r.accumulatedGrads[s]=Mt(u).variable(!1)}),o.accumulatedUpdates[s]==null&&Ve(function(){r.accumulatedUpdates[s]=Mt(u).variable(!1)});var l=t[s],c=o.accumulatedGrads[s],h=o.accumulatedUpdates[s];Ve(function(){var d=r.rhoScalar.mul(c).add(r.oneMinusRho.mul(l.square())),f=h.add(r.epsilonScalar).sqrt().div(c.add(r.epsilonScalar).sqrt()).mul(l),p=r.rhoScalar.mul(h).add(r.oneMinusRho.mul(f.square()));r.accumulatedGrads[s].assign(d),r.accumulatedUpdates[s].assign(p);var m=r.c.mul(f).add(u);u.assign(m)})},o=this;for(var a in t)i(a)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),this.accumulatedUpdates!=null&&(Object.keys(this.accumulatedUpdates).forEach(function(r){return t.accumulatedUpdates[r].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(r){return t.accumulatedGrads[r].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="AdadeltaOptimizer",e}(pc);fc(Sre);var Rre=function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads={},i.c=Jt(ye(-t)),i.epsilon=Jt(ye(z.get("EPSILON"))),i}return fs(e,n),e.prototype.applyGradients=function(t){var r=this,i=function(s){var u=z.engine.registeredVariables[s];o.accumulatedGrads[s]==null&&Ve(function(){r.accumulatedGrads[s]=Vf(u.shape,r.initialAccumulatorValue).variable(!1)});var l=t[s],c=o.accumulatedGrads[s];Ve(function(){var h=c.add(l.square());r.accumulatedGrads[s].assign(h);var d=r.c.mul(l.div(h.add(r.epsilon).sqrt())).add(u);u.assign(d)})},o=this;for(var a in t)i(a)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),this.accumulatedGrads!=null&&Object.keys(this.accumulatedGrads).forEach(function(r){return t.accumulatedGrads[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(pc);fc(Rre);var kre=function(n){function e(t,r,i,o){o===void 0&&(o=null);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment={},a.accumulatedSecondMoment={},a.c=Jt(ye(-t)),a.beta1Scalar=Jt(ye(r)),a.beta2Scalar=Jt(ye(i)),Ve(function(){a.accBeta1=ye(r).variable(),a.accBeta2=ye(i).variable()}),a.oneMinusBeta1=Jt(ye(1-r)),a.oneMinusBeta2=Jt(ye(1-i)),a.one=Jt(ye(1)),o===null&&(o=z.get("EPSILON")),a.epsScalar=Jt(ye(o)),a}return fs(e,n),e.prototype.applyGradients=function(t){var r=this;Ve(function(){var i=r.one.sub(r.accBeta1),o=r.one.sub(r.accBeta2);for(var a in t){var s=z.engine.registeredVariables[a];if(r.accumulatedFirstMoment[a]==null){var u=!1;r.accumulatedFirstMoment[a]=Mt(s).variable(u)}r.accumulatedSecondMoment[a]==null&&(u=!1,r.accumulatedSecondMoment[a]=Mt(s).variable(u));var l=t[a],c=r.accumulatedFirstMoment[a],h=r.accumulatedSecondMoment[a],d=r.beta1Scalar.mul(c).add(r.oneMinusBeta1.mul(l)),f=r.beta2Scalar.mul(h).add(r.oneMinusBeta2.mul(l.square())),p=d.div(i),m=f.div(o);r.accumulatedFirstMoment[a].assign(d),r.accumulatedSecondMoment[a].assign(f);var g=r.c.mul(p.div(r.epsScalar.add(m.sqrt()))).add(s);s.assign(g)}r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar)),r.accBeta2.assign(r.accBeta2.mul(r.beta2Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return t.accumulatedFirstMoment[r].dispose()}),this.accumulatedSecondMoment!=null&&Object.keys(this.accumulatedSecondMoment).forEach(function(r){return t.accumulatedSecondMoment[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="AdamOptimizer",e}(pc);fc(kre);var Are=function(n){function e(t,r,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment={},s.accumulatedWeightedInfNorm={},s.c=Jt(ye(-t)),s.beta1Scalar=Jt(ye(r)),s.beta2Scalar=Jt(ye(i)),s.decayScalar=Jt(ye(a)),Ve(function(){s.iteration=ye(0).variable(),s.accBeta1=ye(r).variable()}),s.oneMinusBeta1=Jt(ye(1-r)),s.one=Jt(ye(1)),o===null&&(o=z.get("EPSILON")),s.epsScalar=Jt(ye(o)),s}return fs(e,n),e.prototype.applyGradients=function(t){var r=this;Ve(function(){var i=r.one.sub(r.accBeta1),o=r.c.div(r.one.add(r.decayScalar.mul(r.iteration)));for(var a in t){var s=z.engine.registeredVariables[a];if(r.accumulatedFirstMoment[a]==null){var u=!1;r.accumulatedFirstMoment[a]=Mt(s).variable(u)}r.accumulatedWeightedInfNorm[a]==null&&(u=!1,r.accumulatedWeightedInfNorm[a]=Mt(s).variable(u));var l=t[a],c=r.accumulatedFirstMoment[a],h=r.accumulatedWeightedInfNorm[a],d=r.beta1Scalar.mul(c).add(r.oneMinusBeta1.mul(l)),f=r.beta2Scalar.mul(h),p=l.abs(),m=f.maximum(p);r.accumulatedFirstMoment[a].assign(d),r.accumulatedWeightedInfNorm[a].assign(m);var g=o.div(i).mul(d.div(r.epsScalar.add(m))).add(s);s.assign(g)}r.iteration.assign(r.iteration.add(r.one)),r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return t.accumulatedFirstMoment[r].dispose()}),this.accumulatedWeightedInfNorm!=null&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(r){return t.accumulatedWeightedInfNorm[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="AdamaxOptimizer",e}(pc);fc(Are);var WM=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return fs(e,n),e.prototype.applyGradients=function(t){var r=this;Object.keys(t).forEach(function(i){var o=t[i],a=z.engine.registeredVariables[i];Ve(function(){var s=r.c.mul(o).add(a);a.assign(s)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Jt(ye(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGDOptimizer",e}(pc);fc(WM);var Nre=function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.m=ye(o.momentum),o.accumulations={},o}return fs(e,n),e.prototype.applyGradients=function(t){var r=this,i=function(s){var u=z.engine.registeredVariables[s];o.accumulations[s]==null&&Ve(function(){r.accumulations[s]=Mt(u).variable(!1)});var l=o.accumulations[s],c=t[s];Ve(function(){var h,d=r.m.mul(l).add(c);h=r.useNesterov?r.c.mul(c.add(d.mul(r.m))).add(u):r.c.mul(d).add(u),r.accumulations[s].assign(d),u.assign(h)})},o=this;for(var a in t)i(a)},e.prototype.dispose=function(){if(n.prototype.dispose.call(this),this.m.dispose(),this.accumulations!=null)for(var t in this.accumulations)this.accumulations[t].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="MomentumOptimizer",e}(WM);fc(Nre);var Dre=function(n){function e(t,r,i,o,a){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=n.call(this)||this;return s.learningRate=t,s.decay=r,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares={},s.accumulatedMeanGrads={},s.accumulatedMoments={},s.c=Jt(ye(t)),s.decayScalar=Jt(ye(r)),s.momentumScalar=Jt(ye(i)),s.oneMinusDecay=Jt(ye(1-r)),s.centered=a,o===null&&(o=z.get("EPSILON")),s.epsilonScalar=Jt(ye(o)),s}return fs(e,n),e.prototype.applyGradients=function(t){var r=this,i=function(s){var u=z.engine.registeredVariables[s];o.accumulatedMeanSquares[s]==null&&Ve(function(){r.accumulatedMeanSquares[s]=Mt(u).variable(!1)}),o.accumulatedMeanGrads[s]==null&&o.centered&&Ve(function(){r.accumulatedMeanGrads[s]=Mt(u).variable(!1)}),o.accumulatedMoments[s]==null&&Ve(function(){r.accumulatedMoments[s]=Mt(u).variable(!1)});var l=o.accumulatedMeanSquares[s],c=o.accumulatedMeanGrads[s],h=o.accumulatedMoments[s],d=t[s];Ve(function(){var f=r.decayScalar.mul(l).add(r.oneMinusDecay.mul(d.square()));if(r.centered){var p=r.decayScalar.mul(c).add(r.oneMinusDecay.mul(d)),m=r.momentumScalar.mul(h).add(r.c.mul(d).div(f.sub(p.square().add(r.epsilonScalar)).sqrt()));r.accumulatedMeanSquares[s].assign(f),r.accumulatedMeanGrads[s].assign(p),r.accumulatedMoments[s].assign(m);var g=u.sub(m);u.assign(g)}else{var y=r.decayScalar.mul(l).add(r.oneMinusDecay.mul(d.square()));m=r.momentumScalar.mul(h).add(r.c.mul(d).div(y.add(r.epsilonScalar).sqrt())),r.accumulatedMeanSquares[s].assign(y),r.accumulatedMoments[s].assign(m),g=u.sub(m),u.assign(g)}})},o=this;for(var a in t)i(a)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),this.accumulatedMeanSquares!=null&&Object.keys(this.accumulatedMeanSquares).forEach(function(r){return t.accumulatedMeanSquares[r].dispose()}),this.accumulatedMeanGrads!=null&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(r){return t.accumulatedMeanGrads[r].dispose()}),this.accumulatedMoments!=null&&Object.keys(this.accumulatedMoments).forEach(function(r){return t.accumulatedMoments[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSPropOptimizer",e}(pc);fc(Dre);ma.setBackend;ma.getBackend;ma.disposeVariables;ma.memory;c9(qne);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var d_=function(n,e){return d_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},d_(n,e)};function im(n,e){d_(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ay=function(){return ay=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},ay.apply(this,arguments)};function Hi(n,e,t,r){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(c){try{l(r.next(c))}catch(h){a(h)}}function u(c){try{l(r.throw(c))}catch(h){a(h)}}function l(c){c.done?o(c.value):i(c.value).then(s,u)}l((r=r.apply(n,[])).next())})}function Gi(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Q1(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jM=function(n,e){return(jM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function Do(n,e){function t(){this.constructor=n}jM(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Pe(n,e,t,r){return new(t||(t=Promise))(function(i,o){function a(l){try{u(r.next(l))}catch(c){o(c)}}function s(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(a,s)}u((r=r.apply(n,[])).next())})}function Oe(n,e){var t,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(h){c=[6,h],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var Pre=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return Ore(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var a=o.split(":"),s=a[0],u=a[1];e.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},n}();function Ore(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function le(){return zM}var zM=null,sy=new Map,f_=new Map;function $M(n,e){var t=GM(n,e);return sy.get(t)}function hR(n){return f_.get(n)}function dR(n){for(var e=sy.entries(),t=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===n&&t.push(s)}return t}function HM(n){var e=n.kernelName,t=n.backendName,r=GM(e,t);if(sy.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");sy.set(r,n)}function Mre(n){var e=n.kernelName;f_.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),f_.set(e,n)}function GM(n,e){return e+"_"+n}function p_(n,e,t){return Math.max(n,Math.min(e,t))}function qM(n){return n%2==0?n:n+1}function Fre(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function U(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Lt(n,e,t){t===void 0&&(t=""),U(ir(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function Id(n){U(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function id(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||ua(n)&&!t)for(var r=0;r<n.length;++r)id(n[r],e,t);else e.push(n);return e}function De(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function ir(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function An(n){return n%1==0}function Lre(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function m_(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Sh(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function fR(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,a=function(){if(n())r();else{o++;var s=e(o);t!=null&&o>=t?i():setTimeout(a,s)}};a()})}function Bre(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function Qn(n,e){var t=e.length;return U((n=n==null?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),U(n.every(function(r){return An(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function bl(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:Qn(e,n).sort(),a=0,s=0;s<n.length;++s){if(o!=null){if(o[a]===s&&n[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(o[a]==null||o[a]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),o[a]<=s&&a++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function od(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function uy(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function Vre(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function Ure(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Wre(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function ua(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function KM(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function jre(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function HE(n){return typeof n=="string"||n instanceof String}function zre(n){return typeof n=="boolean"}function $re(n){return typeof n=="number"}function om(n){return Array.isArray(n)?om(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":$re(n)?"float32":HE(n)?"string":zre(n)?"bool":"float32"}function v_(n){return!!(n&&n.constructor&&n.call&&n.apply)}function g_(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Ti(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function XM(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=id(n)),t&&Vre(n,e),function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"}(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function pR(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=a[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce(function(d,f){return d*f});for(l=0;l<u;l++)s[l]=r(i+l*h,c,a)}return s}(0,n,e)}function QM(n,e){for(var t=am(n,e),r=0;r<t.length;r++)t[r]=1;return t}function am(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Xo(){return le().platform.now()}function YM(n){n.forEach(function(e){U(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function Hre(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",le().platform.encode(n,e)}function ly(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",le().platform.decode(n,e)}function y_(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function JM(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var Gre=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new qre)}return n.prototype.profileKernel=function(e,t,r){var i,o=this,a=this.backendTimer.time(function(){i=r()});return i.forEach(function(s){s.data().then(function(u){(function(l,c,h){if(c!=="float32")return!1;for(var d=0;d<l.length;d++){var f=l[d];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+h+"'"),!0}})(u,s.dtype,e),a.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(e,s,u,l.kernelMs,t,c)})})}),i},n}(),qre=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o,a){var s=typeof i=="number"?Sh(i+"ms",9):i.error,u=Sh(e,25),l=t.rank,c=t.size,h=Sh(t.shape.toString(),14),d="";for(var f in o){var p=o[f].shape||t.shape,m=p.length;d+=f+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+h+"	%c"+c+"	%c"+d+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),mR=20,cf=3,Y1=7;function Kre(n,e,t,r){var i=Ti(e),o=function(l,c,h,d){var f=De(c),p=d[d.length-1],m=new Array(p).fill(0),g=c.length,y=h==="complex64"?df(l):l;if(g>1)for(var x=0;x<f/p;x++)for(var _=x*p,b=0;b<p;b++)m[b]=Math.max(m[b],hf(y[_+b],0,h).length);return m}(n,e,t,i),a=e.length,s=function l(c,h,d,f,p,m){m===void 0&&(m=!0);var g=d==="complex64"?2:1,y=h[0],x=h.length;if(x===0)return d==="complex64"?[hf(df(c)[0],0,d)]:d==="bool"?[ZM(c[0])]:[c[0].toString()];if(x===1){if(y>mR){var _=cf*g,b=Array.from(c.slice(0,_)),C=Array.from(c.slice((y-cf)*g,y*g));return d==="complex64"&&(b=df(b),C=df(C)),["["+b.map(function(J,ee){return hf(J,p[ee],d)}).join(", ")+", ..., "+C.map(function(J,ee){return hf(J,p[y-cf+ee],d)}).join(", ")+"]"]}return["["+(d==="complex64"?df(c):Array.from(c)).map(function(J,ee){return hf(J,p[ee],d)}).join(", ")+"]"]}var k=h.slice(1),T=f.slice(1),E=f[0]*g,I=[];if(y>mR){for(var R=0;R<cf;R++){var N=(O=R*E)+E;I.push.apply(I,l(c.slice(O,N),k,d,T,p,!1))}for(I.push("..."),R=y-cf;R<y;R++)N=(O=R*E)+E,I.push.apply(I,l(c.slice(O,N),k,d,T,p,R===y-1))}else for(R=0;R<y;R++){var O;N=(O=R*E)+E,I.push.apply(I,l(c.slice(O,N),k,d,T,p,R===y-1))}var M=x===2?",":"";for(I[0]="["+I[0]+M,R=1;R<I.length-1;R++)I[R]=" "+I[R]+M;var q=`,
`;for(R=2;R<x;R++)q+=`
`;return I[I.length-1]=" "+I[I.length-1]+"]"+(m?"":q),I}(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function hf(n,e,t){return Sh(Array.isArray(n)?parseFloat(n[0].toFixed(Y1))+" + "+parseFloat(n[1].toFixed(Y1))+"j":HE(n)?"'"+n+"'":t==="bool"?ZM(n):parseFloat(n.toFixed(Y1)).toString(),e)}function ZM(n){return n===0?"false":"true"}function df(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var _p=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=De(e),r!=null){var o=r.length;U(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||uy(t,this.size),this.strides=Ti(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),U(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Jo().makeTensor(this.values,this.shape,this.dtype)},n}(),Jo=null,se=null,eF=null,Yt=function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=De(e),this.strides=Ti(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),U(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),se.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Pe(this,void 0,void 0,function(){var e;return Oe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,se.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return se.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Pe(this,void 0,void 0,function(){var e;return Oe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,pR(this.shape,e)]}})})},n.prototype.arraySync=function(){return pR(this.shape,this.dataSync())},n.prototype.data=function(){return Pe(this,void 0,void 0,function(){var e,t;return Oe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Jo().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(i){return ly(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=Jo().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return ly(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Pe(this,void 0,void 0,function(){var e;return Oe(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Jo().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(Jo().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),se.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),se.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),se.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),se.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),se.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),se.clone(this)},n.prototype.toString=function(e){return e===void 0&&(e=!1),Kre(this.dataSync(),this.shape,this.dtype,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),se.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),se.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),se.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),se.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),se.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),se.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),se.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),se.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),se.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),se.unstack(this,e)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),eF("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),se.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),se.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),se.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),se.cast(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),se.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),se.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),se.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),se.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),se.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),se.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),se.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),se.mulStrict(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),se.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),se.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),se.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),se.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),se.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),se.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),se.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),se.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),se.squaredDifferenceStrict(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),se.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),se.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),se.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),se.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),se.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),se.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),se.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),se.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),se.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),se.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),se.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),se.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),se.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),se.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),se.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),se.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),se.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),se.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),se.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),se.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),se.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),se.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),se.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),se.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),se.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),se.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),se.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),se.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),se.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),se.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),se.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),se.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),se.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),se.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),se.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),se.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),se.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),se.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),se.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),se.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),se.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),se.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),se.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),se.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),se.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),se.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),se.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),se.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),se.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),se.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),se.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),se.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),se.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),se.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),se.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),se.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),se.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),se.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),se.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),se.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),se.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),se.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),se.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),se.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),se.conv1d(this,e,t,r,i,o,a)},n.prototype.conv2d=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),se.conv2d(this,e,t,r,i,o,a)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),se.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),se.depthwiseConv2d(this,e,t,r,i,o,a)},n.prototype.separableConv2d=function(e,t,r,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),se.separableConv2d(this,e,t,r,i,o,a)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),se.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),se.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),se.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),se.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Jo().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),se.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),se.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),se.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),se.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),se.stridedSlice(this,e,t,r,i,o,a,s,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),se.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),se.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),se.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),se.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),se.spectral.irfft(this)},n}();Object.defineProperty(Yt,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var vR,x_,w_,__,b_,ad=function(n){function e(t,r,i,o){var a=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=r,a.name=i,a}return Do(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!ir(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Jo().disposeTensor(this),this.dataId=t.dataId,Jo().incRef(this,null)},e.prototype.dispose=function(){Jo().disposeVariable(this),this.isDisposedInternal=!0},e}(Yt);Object.defineProperty(ad,Symbol.hasInstance,{value:function(n){return n instanceof Yt&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(vR||(vR={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(x_||(x_={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(w_||(w_={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(__||(__={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(b_||(b_={}));var Xre={float32:__,int32:x_,bool:w_,complex64:b_};function hr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return Xre[n][e]}function J1(n){return hr(n,"int32")}function fn(n,e){if(n.dtype===e.dtype)return[n,e];var t=hr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Qre(n,e){U(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function tF(n){var e=[];return function t(r,i,o){if(r!=null){if(r instanceof Yt)return void i.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];o.has(l)||(o.add(l),t(l,i,o))}}}}(n,e,new Set),e}var Z1,gR=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),Yre=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new gR}return n.prototype.ready=function(){return Pe(this,void 0,void 0,function(){var e,t,r;return Oe(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Pe(this,void 0,void 0,function(){var t,r,i;return Oe(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Gre(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;dR(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;dR(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),o=i.success,a=i.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],function(i){return{x:function(){return i.toFloat()}}},[],{}),t},n.prototype.runKernel=function(e,t,r,i,o){return this.runKernelFunc(null,t,null,e,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-t-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,o,a,s){var u,l=this,c=[],h=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var d,f=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=$M(i,this.backendName);if(g!=null)d=function(){var x=l.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:o,backend:l.backend});var _=Array.isArray(m)?m:[m];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,_);var b=_.map(function(T){var E=T.dataId,I=T.shape,R=T.dtype;return l.makeTensorFromDataId(E,I,R)});if(h){var C=l.getTensorsForGradient(i,t,b);if(C==null){s==null&&(s=[]);var k=b.filter(function(T,E){return s[E]});C=(a||[]).slice().concat(k)}c=l.saveTensorsForBackwardMode(C)}return b};else{var y=function(x){h&&(c=x.map(function(_){return l.keep(l.clone(_))}))};d=function(){var x=l.backend.numDataIds();m=l.tidy(function(){return e(l.backend,y)});var _=Array.isArray(m)?m:[m];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,_),_}}return this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,t,function(){return d()}):d()}),h&&this.addTapeNode(i,t,u,r,c,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(x){return t[x].shape}),outputShapes:u.map(function(x){return x.shape})}),Array.isArray(m)?u:u[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map(function(r){return t.keep(t.clone(r))})},n.prototype.getTensorsForGradient=function(e,t,r){var i=hR(e);if(i!=null){var o=i.inputsToSave||[],a=i.outputsToSave||[],s=void 0;i.saveAllInputs?(U(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(l){return t[l]})):s=o.map(function(l){return t[l]});var u=r.filter(function(l,c){return a[c]});return s.concat(u)}return null},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&HE(e[0])&&(o=e.map(function(c){return Hre(c)}));var a=i.write(o,t,r),s=new Yt(t,r,a,this.nextTensorId());if(this.incRef(s,i),r==="string"){var u=this.state.tensorInfo.get(a),l=jre(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},n.prototype.makeTensorFromDataId=function(e,t,r,i){var o=new Yt(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new ad(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*KM(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof ad||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Pe(this,void 0,void 0,function(){var t,r;return Oe(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,o,a){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},l=hR(e);l!=null&&(i=l.gradFunc),i!=null&&(u.gradient=function(c){return c=c.map(function(h,d){if(h==null){var f=r[d],p=am(f.size,f.dtype);return s.makeTensor(p,f.shape,f.dtype)}return h}),i(c.length>1?c:c[0],o,a)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=tF(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),U(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});U(a instanceof Yt,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var h={},d={},f=0;f<l.length;f++)h[l[f].id]=!0;for(f=0;f<u.length;f++){var p=(k=u[f]).inputs;for(var m in p){for(var g=p[m],y=!1,x=0;x<l.length;x++)if(h[g.id]){k.outputs.forEach(function(R){return h[R.id]=!0}),y=!0,d[k.id]=!0;break}if(y)break}}var _={};_[c.id]=!0;var b={};for(f=u.length-1;f>=0;f--)for(p=(k=u[f]).inputs,x=0;x<k.outputs.length;x++)if(_[k.outputs[x].id]){for(var m in p)_[p[m].id]=!0,b[k.id]=!0;break}var C=[];for(f=0;f<u.length;f++){var k;if(d[(k=u[f]).id]&&b[k.id]){var T={};for(var m in k.inputs){var E=k.inputs[m];h[E.id]&&(T[m]=E)}var I=Object.assign({},k);I.inputs=T,I.outputs=k.outputs,C.push(I)}}return C}(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=QM(De(u),"float32"),X.makeTensor(l,u,"float32")),function(d,f,p){for(var m=function(y){var x=f[y],_=[];if(x.outputs.forEach(function(T){var E=d[T.id];E!=null?_.push(E):_.push(null)}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var b=x.gradient(_),C=function(T){if(!(T in b))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(b)+".");var E=p(function(){return b[T]()});if(E.dtype!=="float32")throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+E.dtype+"'");var I=x.inputs[T];if(!ir(E.shape,I.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+T+"' has shape '"+E.shape+"', which does not match the shape of the input '"+I.shape+"'");if(d[I.id]==null)d[I.id]=E;else{var R=d[I.id];d[I.id]=R.add(E),R.dispose()}};for(var k in x.inputs)C(k)},g=f.length-1;g>=0;g--)m(g)}(c,s,function(d){return o.tidy(d)});var h=t.map(function(d){return c[d.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(d){for(var f=0,p=d.saved;f<p.length;f++)p[f].dispose()}),o.state.activeTape=null),{value:a,grads:h}})},n.prototype.customGrad=function(e){var t=this;return U(v_(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];U(i.every(function(s){return s instanceof Yt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),t.runKernelFunc(function(s,u){return U((r=e.apply(void 0,i.concat([u]))).value instanceof Yt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),U(v_(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];U(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),U(c.every(function(d){return d instanceof Yt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(d,f){h[f]=function(){return d}}),h})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return Pe(this,void 0,void 0,function(){var t,r;return Oe(this,function(i){switch(i.label){case 0:return t=Xo(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Xo()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new gR,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),X=function(){var n=function(){if(Z1==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Z1=t}return Z1}();if(n._tfengine==null){var e=new Pre(n);n._tfengine=new Yre(e)}return function(t){zM=t}(n._tfengine.ENV),Jo=function(){return n._tfengine},n._tfengine}();function nF(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ma=le();Ma.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ma.registerFlag("IS_BROWSER",function(){return nF()}),Ma.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Ma.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Ma.registerFlag("PROD",function(){return!1}),Ma.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Ma.getBool("DEBUG")}),Ma.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Ma.registerFlag("IS_TEST",function(){return!1});var bp,_i,vi,xl={},ex={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Jre(n,e){xl[n]=e}function xa(n){n in xl||(xl[n]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete xl[t]},!1),t===1?r.getContext("webgl",ex)||r.getContext("experimental-webgl",ex):r.getContext("webgl2",ex)}(n));var e=xl[n];return e.isContextLost()?(delete xl[n],xa(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),xl[n])}function v0(n,e){return[e,n]}function Uf(n){var e=De(n);return m_(Math.ceil(e/4))}function sm(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function GE(n,e){var t,r,i,o,a,s,u,l,c,h=n;return le().getNumber("WEBGL_VERSION")===2?(t=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,s=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=h.RGBA,a=n.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function Fe(n,e,t){var r=t();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+nie(i,o))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(bp||(bp={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(_i||(_i={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(vi||(vi={}));var Zre=596e-10,eie=65504;function tie(n){return!!(le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Zre<Math.abs(n)&&Math.abs(n)<eie)}function nie(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function wv(n,e,t){return gs(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function rie(n,e,t){var r=gs(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Fe(n,e,function(){return n.shaderSource(r,t)}),Fe(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function iie(n,e,t){var r=gs(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Fe(n,e,function(){return n.shaderSource(r,t)}),Fe(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(i,o){var a=oie.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(g,y){return Sh((y+1).toString(),l)+g}),h=0,d=0;d<c.length;d++)h=Math.max(c[d].length,h);var f=c.slice(0,s-1),p=c.slice(s-1,s),m=c.slice(s);console.log(f.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+Sh(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var tx,nx,oie=/ERROR: [0-9]+:([0-9]+):/g;function aie(n,e){return gs(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function sie(n,e,t){if(Fe(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function rx(n,e,t){if(Fe(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function uie(n,e,t){var r=gs(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Fe(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Fe(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function lie(n,e,t){var r=gs(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Fe(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Fe(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function cie(n,e){return gs(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function hie(n,e){var t=le().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function die(n,e){return gs(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function yR(n,e,t,r,i,o,a,s){var u=n.getAttribLocation(t,r);return u!==-1&&(Fe(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),Fe(n,e,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,a,s)}),Fe(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function fie(n,e,t,r){yie(n,r),Fe(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),Fe(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function pie(n,e,t,r){return gs(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function mie(n,e,t){return n.getUniformLocation(e,t)}function vie(n,e,t,r,i,o){Fe(n,e,function(){return fie(n,e,r,o)}),Fe(n,e,function(){return n.uniform1i(i,o)})}function ix(n,e,t,r){Fe(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Fe(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function xR(n,e,t){Fe(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Fe(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function _v(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+gie(n,e))}function gie(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function gs(n,e,t,r){var i=Fe(n,e,function(){return t()});if(i==null)throw new Error(r);return i}function yie(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function cy(n,e){return e===void 0&&(e=2),De(n.slice(0,n.length-e))}function hy(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function ox(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[cy(n)].concat(hy(n))),e}function xie(n,e){var t;e===void 0&&(e=!1);var r=le().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?qM(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var i=bl(n);n=i.newShape}var o=De(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var a=cy(n),s=2,u=2;return n.length&&(s=(t=hy(n))[0],u=t[1]),m_(o=a*(s/2)*(u/2)).map(function(l){return 2*l})}return m_(o)}function bv(n){return n%2==0}function Ev(n,e){if(ir(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||bv(t)&&bv(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&bv(n[0])&&bv(e[0])}function wie(n){if(tx==null){var e=xa(n);tx=e.getParameter(e.MAX_TEXTURE_SIZE)}return tx}function _ie(n){if(nx==null){var e=xa(n);nx=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,nx)}function bie(n){if(n===0)return 0;var e=xa(n);return qi(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:qi(e,"EXT_disjoint_timer_query")?1:0}function qi(n,e){return n.getExtension(e)!=null}function wR(n){try{if(xa(n)!=null)return!0}catch{return!1}return!1}function Eie(n){if(n===0)return!1;var e=xa(n);if(n===1){if(!qi(e,"OES_texture_float"))return!1}else if(!qi(e,"EXT_color_buffer_float"))return!1;return E_(e)}function Cie(n){if(n===0)return!1;var e=xa(n);if(n!==1){if(qi(e,"EXT_color_buffer_float"))return E_(e);if(qi(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=GE(r,i),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(e,t)}return!1}return!!qi(e,"OES_texture_float")&&!!qi(e,"WEBGL_color_buffer_float")&&E_(e)}function E_(n){var e=GE(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function Tie(n){return n===2&&xa(n).fenceSync!=null}var Xe=le();function rF(n){le().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ot(n,e){return X.tidy(n,e)}function si(n){tF(n).forEach(function(e){return e.dispose()})}function Iie(n){return X.keep(n)}function dy(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];le().getBool("IS_TEST")||console.warn.apply(console,n)}function Gu(n,e){var t=n;if(ua(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||ua(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&le().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!ua(o))return void U(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});U(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),U(o.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"});for(var u=a.slice(1),l=0;l<o.length;++l)i(o[l],u,s.concat(l))}(n,r,[]),r}function _R(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function V(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Yt)return _R(r,n.dtype,e,t),n;var i=om(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),_R(r,i,e,t),n==null||!ua(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=Gu(n,i);ua(n)||Array.isArray(n)||(n=[n]);var s=i!=="string"?XM(n,i,le().getBool("DEBUG")):id(n,[],!0);return X.makeTensor(s,a,i)}function fy(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return V(i,e+"["+o+"]",t)},r)}function iF(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function Sie(n,e,t){for(var r=n.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?i.push(n[o++]):i.push(e[a++]);return i}function Sr(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function ui(n,e){return Sie(n,e.map(function(t){return 1}),e)}function mi(n,e,t){U(iF(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function wa(n,e){if(iF(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function qE(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function _a(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function Rie(n,e){var t=n[0].length;n.forEach(function(i,o){U(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),U(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var a=0;a<t;a++)U(a===e||i[a]===r[a],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function sd(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function G(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];X.startScope(t);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),X.endScope(s),s}catch(u){throw X.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}Xe.registerFlag("HAS_WEBGL",function(){return Xe.getNumber("WEBGL_VERSION")>0}),Xe.registerFlag("WEBGL_VERSION",function(){return wR(2)?2:wR(1)?1:0}),Xe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Xe.get("WEBGL_VERSION")===2}),Xe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Xe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Xe.registerFlag("WEBGL_PACK",function(){return Xe.getBool("HAS_WEBGL")}),Xe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_PACK_CLIP",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Xe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_PACK_REDUCE",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_CONV_IM2COL",function(){return Xe.getBool("WEBGL_PACK")}),Xe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return wie(Xe.getNumber("WEBGL_VERSION"))}),Xe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return _ie(Xe.getNumber("WEBGL_VERSION"))}),Xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Xe.getNumber("WEBGL_VERSION");return n===0?0:bie(n)}),Xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Xe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),Xe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Eie(Xe.getNumber("WEBGL_VERSION"))}),Xe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Xe.getBool("WEBGL_FORCE_F16_TEXTURES")&&Xe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Xe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Cie(Xe.getNumber("WEBGL_VERSION"))}),Xe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Tie(Xe.getNumber("WEBGL_VERSION"))}),Xe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Xe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),eF=rF;var lr=G({complex_:function(n,e){var t=V(n,"real","complex"),r=V(e,"imag","complex");return Lt(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),X.runKernelFunc(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),zi=G({real_:function(n){var e=V(n,"input","real");return X.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),Zo=G({imag_:function(n){var e=V(n,"input","imag");return X.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function dr(n,e,t){return qu(n,e,Gu(n,t),t)}function qu(n,e,t,r){if(r==null&&(r=om(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ua(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){YM(e);var i=De(e),o=De(t);U(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==De(e.slice(a));U(t[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return ua(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?XM(n,r,le().getBool("DEBUG")):id(n,[],!0),X.makeTensor(n,e,r)}function Le(n,e){if((ua(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ua(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return qu(n,[],[],e)}function No(n,e){Id(n);var t=Gu(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return qu(n,null,t,e)}function Ml(n,e,t){if(Id(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Gu(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return qu(n,e,r,t)}function oF(n,e,t){if(Id(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Gu(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return qu(n,e,r,t)}function Qo(n,e,t){if(Id(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Gu(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return qu(n,e,r,t)}function kie(n,e,t){if(Id(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Gu(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return qu(n,e,r,t)}function Aie(n,e,t){if(Id(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Gu(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return qu(n,e=e||r,r,t)}function Nie(n,e,t,r){return e===void 0&&(e=!0),X.makeVariable(n,e,t,r)}function Sd(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Sd(n,"float32"),r=wn(n,"float32");return lr(t,r)}var i=QM(De(n),e);return X.makeTensor(i,n,e)}function wn(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=wn(n,"float32"),r=wn(n,"float32");return lr(t,r)}var i=am(De(n),e);return X.makeTensor(i,n,e)}function Fl(n,e,t){return X.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function Die(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return X.runKernelFunc(function(r){return r.linspace(n,e,t)},{})}function py(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return wn([0],r);var i=am(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return No(i,r)}var aF=G({onesLike_:function(n){var e=V(n,"x","onesLike");if(e.dtype==="complex64"){var t=aF(zi(e)),r=Ct(Zo(e));return lr(t,r)}return X.runKernelFunc(function(i){return i.onesLike(e)},{x:e},function(i,o){return{x:function(){return Ct(i)}}},"OnesLike")}}),Ct=G({zerosLike_:function(n){var e=V(n,"x","zerosLike");return X.runKernelFunc(function(t){return t.zerosLike(e)},{x:e},function(t,r){return{x:function(){return Ct(t)}}},"ZerosLike")}}),no=G({concat_:function(n,e){e===void 0&&(e=0),U(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=fy(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),e=Qn(e,t[0].shape)[0];var r=sd(t.map(function(s){return s.shape}),e);if(De(r)===0)return dr([],r);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var i=t.map(function(s){return s.shape});Rie(i,e);var o=t,a={axis:e};return X.runKernelFunc(function(s){return s.concat(t,e)},o,function(s){var u=i.map(function(l){return l[e]});return KE(s,u,e).map(function(l){return function(){return l}})},"Concat",a)}}),Pie=G({concat1d_:function(n){return no(n,0)}}),Oie=G({concat2d_:function(n,e){return no(n,e)}}),Mie=G({concat3d_:function(n,e){return no(n,e)}}),Fie=G({concat4d_:function(n,e){return no(n,e)}}),KE=G({split_:function(n,e,t){t===void 0&&(t=0);var r,i=V(n,"x","split");return t=Qn(t,i.shape)[0],typeof e=="number"?(U(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(U(i.shape[t]===e.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),X.runKernelFunc(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return no(o,t)}}})}});function et(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",YM(n),new _p(n,e,t)}function Lie(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var sF=G({batchToSpaceND_:function(n,e,t){var r=V(n,"x","batchToSpaceND"),i=e.reduce(function(o,a){return o*a});return U(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),U(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),U(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),X.runKernelFunc(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),Bie=G({cast_:function(n,e){var t=V(n,"x","cast");if(!Ure(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return X.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),Vie=G({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=V(n,"x","cumsum"),o=wa([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=_a(1,i.rank)[0],u=X.runKernelFunc(function(l){return l.cumsum(a,s,t,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),Uie=G({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=V(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return U(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),U(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),U(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),X.runKernelFunc(function(s){return s.depthToSpace(r,e,t)},{$x:r})}}),Gs=G({expandDims_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","expandDims",null);U(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(U(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),Va(t,r)}}),Va=G({reshape_:function(n,e){var t=V(n,"x","reshape",null);e=Bre(e,t.size),U(t.size===De(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return X.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",r)}}),uF=G({spaceToBatchND_:function(n,e,t){var r=V(n,"x","spaceToBatchND");return U(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),U(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),U(r.shape.reduce(function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),X.runKernelFunc(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),lF=G({squeeze_:function(n,e){var t=V(n,"x","squeeze");return Va(t,bl(t.shape,e).newShape)}}),Pu=G({stack_:function(n,e){e===void 0&&(e=0);var t=fy(n,"tensors","stack");if(U(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;U(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){Lt(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){U(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return no(a,e)}}),g0=G({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=V(n,"x","unstack");U(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var r={axis:e};return X.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return Pu(i,e)}}},"Unpack",r)}}),Wie=function(n,e){return Pe(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h;return Oe(this,function(d){switch(d.label){case 0:return t=V(n,"x","setdiff1d"),r=V(e,"y","setdiff1d"),U(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),U(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),U(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=d.sent(),[4,r.data()];case 2:for(o=d.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new _p([s],t.dtype),l=new _p([s],"int32"),c=0,h=0;c<i.length;c++)a.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function my(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([n[a+1]/e[a],e[a]]);i=i.concat(n.slice(o+1))}return i}function vy(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function gy(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function cF(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function hF(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}var dF="Add",y0="Div",x0="SquaredDifference",fF="BroadcastTo",pF="OneHot",mF="Identity",vF="Tile",gF="PadV2",ro=G({add_:function(n,e){var t,r=V(n,"a","add"),i=V(e,"b","add");t=fn(r,i),r=t[0],i=t[1];var o={a:r,b:i};return X.runKernelFunc(function(a,s){var u=a.add(r,i);return s([r,i]),u},o,null,dF)}});function ou(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,a=n[o]||1;(e[e.length-1-i]||1)>1&&a===1&&r.unshift(o)}return r}function $n(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function pt(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}var jie=G({abs_:function(n){var e=V(n,"x","abs");return e.dtype==="complex64"?X.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):X.runKernelFunc(function(t,r){var i=t.abs(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),zie=G({acos_:function(n){var e=V(n,"x","acos");return X.runKernelFunc(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Le(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),$ie=G({acosh_:function(n){var e=V(n,"x","acosh");return X.runKernelFunc(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),Hie=G({asin_:function(n){var e=V(n,"x","asin");return X.runKernelFunc(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Le(1).sub(i.toFloat().square()).sqrt())}}})}}),Gie=G({asinh_:function(n){var e=V(n,"x","asinh");return X.runKernelFunc(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Le(1).add(i.toFloat().square()).sqrt())}}})}}),qie=G({atan_:function(n){var e=V(n,"x","atan");return X.runKernelFunc(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),Kie=G({atanh_:function(n){var e=V(n,"x","atanh");return X.runKernelFunc(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(Le(1).sub(i.toFloat().square()))}}})}}),Xie=G({ceil_:function(n){var e=V(n,"x","ceil");return X.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Ct(t)}}})}}),Qie=G({clipByValue_:function(n,e,t){var r=V(n,"x","clipByValue");U(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var i=[r],o={min:e,max:t};return X.runKernelFunc(function(a,s){var u=a.clip(r,e,t);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),Ct(a))}}},"ClipByValue",o,i)}}),Yie=G({cos_:function(n){var e=V(n,"x","cos"),t=[e];return X.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},t)}}),Jie=G({cosh_:function(n){var e=V(n,"x","cosh");return X.runKernelFunc(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),Zie=G({erf_:function(n){var e=V(n,"x","erf");return U(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),X.runKernelFunc(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),eoe=G({exp_:function(n){var e=V(n,"x","exp");return X.runKernelFunc(function(t,r){var i=t.exp(e);return r([i]),i},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),toe=G({expm1_:function(n){var e=V(n,"x","expm1");return X.runKernelFunc(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),noe=G({floor_:function(n){var e=V(n,"x","floor");return X.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Ct(t)}}})}}),roe=G({log_:function(n){var e=V(n,"x","log"),t=[e];return X.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},t)}}),ioe=G({log1p_:function(n){var e=V(n,"x","log1p");return X.runKernelFunc(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),ooe=G({logSigmoid_:function(n){var e=V(n,"x","logSigmoid");return X.runKernelFunc(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),XE=G({neg_:function(n){var e=V(n,"x","neg"),t=[e];return X.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},t)}}),aoe=G({reciprocal_:function(n){var e=V(n,"x","reciprocal");return X.runKernelFunc(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),soe=G({round_:function(n){var e=V(n,"x","round");return X.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Ct(t)}}})}}),yF=G({rsqrt_:function(n){var e=V(n,"x","rsqrt"),t=[e];return X.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),uoe=G({sigmoid_:function(n){var e=V(n,"x","sigmoid");return X.runKernelFunc(function(t,r){var i=t.sigmoid(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(Le(1).sub(i)))}}},"Sigmoid")}}),loe=G({sign_:function(n){var e=V(n,"x","sign");return X.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Ct(t)}}})}}),coe=G({isNaN_:function(n){var e=V(n,"x","isNaN");return X.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Ct(t)}}})}}),hoe=G({isInf_:function(n){var e=V(n,"x","isInf");return X.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Ct(t)}}})}}),doe=G({isFinite_:function(n){var e=V(n,"x","isFinite");return X.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Ct(t)}}})}}),foe=G({sin_:function(n){var e=V(n,"x","sin"),t=[e];return X.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},t)}}),poe=G({sinh_:function(n){var e=V(n,"x","sinh");return X.runKernelFunc(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),moe=G({softplus_:function(n){var e=V(n,"x","softplus");return X.runKernelFunc(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),voe=G({sqrt_:function(n){var e=V(n,"x","sqrt");return X.runKernelFunc(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),goe=G({step_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","step");return X.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Ct(r)}}})}}),yoe=G({tan_:function(n){var e=V(n,"x","tan");return X.runKernelFunc(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),xoe=G({tanh_:function(n){var e=V(n,"x","tanh");return X.runKernelFunc(function(t,r){var i=t.tanh(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return Le(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}}),woe=G({addStrict_:function(n,e){var t=V(n,"a","addStrict"),r=V(e,"b","addStrict");return Lt(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),_oe=G({atan2_:function(n,e){var t,r=V(n,"a","atan2"),i=V(e,"b","atan2");t=fn(r,i),r=t[0],i=t[1];var o=pt(r.shape,i.shape);return X.runKernelFunc(function(a,s){var u=a.atan2(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=ro(u.square(),l.square()),h=a.mul(l.div(c)),d=$n(u.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)},$b:function(){var c=ro(u.square(),l.square()),h=XE(a.mul(u.div(c))),d=$n(l.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(l.shape)}}})}}),boe=G({divStrict_:function(n,e){var t=V(n,"a","div"),r=V(e,"b","div");return Lt(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),xF=G({floorDiv_:function(n,e){var t,r=V(n,"a","floorDiv"),i=V(e,"b","floorDiv");t=fn(r,i),r=t[0],i=t[1];var o=pt(r.shape,i.shape);return X.runKernelFunc(function(a,s){var u=a.floorDiv(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),h=$n(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=$n(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}},"FloorDiv")}}),QE=G({maximum_:function(n,e){var t,r=V(n,"a","maximum"),i=V(e,"b","maximum");return t=fn(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),pt(r.shape,i.shape),X.runKernelFunc(function(o,a){var s=o.maximum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.greaterEqual(u).toFloat())},b:function(){return o.mul(s.less(u).toFloat())}}},"Maximum")}}),Eoe=G({maximumStrict_:function(n,e){var t=V(n,"a","maximumStrict"),r=V(e,"b","maximumStrict");return Lt(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),wF=G({minimum_:function(n,e){var t,r=V(n,"a","minimum"),i=V(e,"b","minimum");return t=fn(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),pt(r.shape,i.shape),X.runKernelFunc(function(o,a){var s=o.minimum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.lessEqual(u).toFloat())},b:function(){return o.mul(s.greater(u).toFloat())}}},"Minimum")}}),Coe=G({minimumStrict_:function(n,e){var t=V(n,"a","minimumStrict"),r=V(e,"b","minimumStrict");return Lt(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),Toe=G({mod_:function(n,e){var t,r=V(n,"a","mod"),i=V(e,"b","mod");t=fn(r,i),r=t[0],i=t[1];var o=pt(r.shape,i.shape);return X.runKernelFunc(function(a,s){var u=a.mod(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=$n(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=$n(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),Ioe=G({modStrict_:function(n,e){var t=V(n,"a","modStrict"),r=V(e,"b","modStrict");return Lt(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),xn=G({mul_:function(n,e){var t,r=V(n,"a","mul"),i=V(e,"b","mul");t=fn(r,i),r=t[0],i=t[1];var o=pt(r.shape,i.shape);return X.runKernelFunc(function(a,s){var u=a.multiply(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),h=$n(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=$n(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}},"Mul")}}),Soe=G({mulStrict_:function(n,e){var t=V(n,"a","mul"),r=V(e,"b","mul");return Lt(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),yy=G({pow_:function(n,e){var t,r=V(n,"base","pow"),i=V(e,"exp","pow");t=fn(r,i),r=t[0],i=t[1];var o=pt(r.shape,i.shape),a=[r,i];return X.runKernelFunc(function(s,u){var l=s.pow(r,i);return u([r,i,l]),l},{a:r,b:i},function(s,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var d=c.toFloat(),f=s.mul(d.mul(l.pow(d.sub(Le(1))))),p=$n(l.shape,o);return p.length>0&&(f=f.sum(p)),f.reshape(l.shape)},b:function(){var d=l.greater(0),f=l.log().where(d,Ct(l)),p=s.mul(h.mul(f)),m=$n(c.shape,o);return m.length>0&&(p=p.sum(m)),p.reshape(c.shape)}}},"Pow",{},a,[!0])}}),Roe=G({powStrict_:function(n,e){return Lt(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),koe=G({squaredDifferenceStrict_:function(n,e){var t=V(n,"a","squaredDifferenceStrict"),r=V(e,"b","squaredDifferenceStrict");return Lt(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Ro=G({sub_:function(n,e){var t,r=V(n,"a","sub"),i=V(e,"b","sub");t=fn(r,i),r=t[0],i=t[1];var o=pt(r.shape,i.shape);return X.runKernelFunc(function(a){return a.subtract(r,i)},{a:r,b:i},function(a){return{a:function(){var s=a,u=$n(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=$n(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}},"Sub")}}),Aoe=G({subStrict_:function(n,e){var t=V(n,"a","subStrict"),r=V(e,"b","subStrict");return Lt(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Ou=G({div_:function(n,e){var t,r=V(n,"a","div"),i=V(e,"b","div");if(t=fn(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return xF(r,i);var o={a:r,b:i};return X.runKernelFunc(function(a,s){var u=a.realDivide(r,i);return s([r,i]),u},o,null,y0,{})}});function _F(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=n.shape,s=t.slice();s.pop();var u=1;for(o=r;o<n.rank;++o)u*=a[o],s.push(a[o]);var l=Ti(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,i,u,l]}var bF=30;function ax(n){return n<=bF?n:g_(n,Math.floor(Math.sqrt(n)))}function Noe(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var a=0;a<i;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-i;++a)if(t.shape[a+i]!==n[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+t.shape[a+i]+") != shape["+(a+i)+"] ("+n[a+i]+")")}function Doe(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}Noe(t,e,n)}function xy(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=t.length,a=1,s=i;s<o;++s)a*=t[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:De(e.shape)/u,sliceSize:a,strides:Ti(t.slice(0,i)).concat([1]),outputSize:De(t)}}function Poe(n,e,t){U(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),U(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){U(e[o]+t[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},i=0;i<n.rank;++i)r(i)}function bR(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function YE(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function Ooe(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=p_(0,o,s-1)}function Moe(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=a>0?p_(0,o,s):p_(-1,o,s-1)}function EF(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function CF(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Foe(n,e){U(v_(n),function(){return"The f passed in variableGrads(f) must be a function"}),U(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof ad}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],X.registeredVariables)e.push(X.registeredVariables[r]);var i=t?e.filter(function(c){return!c.trainable}):null,o=e.length;U((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=X.gradients(n,e,null,!0),s=a.value,u=a.grads;U(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),U(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),i!=null&&i.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function w0(n){return X.customGrad(n)}var _0=G({softmax_:function(n,e){e===void 0&&(e=-1);var t=V(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return X.runKernelFunc(function(r,i){var o=r.softmax(t,e);return i([o]),o},{logits:t},function(r,i){var o=i[0],a=r.mul(o);return{logits:function(){return a.sub(a.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),Loe=G({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=V(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return w0(function(r,i){var o=r.max(e,!0),a=r.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),_o=G({transpose_:function(n,e){var t=V(n,"x","transpose");if(e==null&&(e=t.shape.map(function(i,o){return o}).reverse()),U(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){U(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var r={perm:e};return X.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},null,"Transpose",r)}}),TF=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),IF=function(){function n(){}return n.prototype.time=function(e){return re("time")},n.prototype.read=function(e){return re("read")},n.prototype.readSync=function(e){return re("readSync")},n.prototype.numDataIds=function(){return re("numDataIds")},n.prototype.disposeData=function(e){return re("disposeData")},n.prototype.write=function(e,t,r){return re("write")},n.prototype.move=function(e,t,r,i){return re("move")},n.prototype.memory=function(){return re("memory")},n.prototype.floatPrecision=function(){return re("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return re("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,re("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return re("slice")},n.prototype.stridedSlice=function(e,t,r,i){return re("stridedSlice")},n.prototype.unstack=function(e,t){return re("unstack")},n.prototype.reverse=function(e,t){return re("reverse")},n.prototype.concat=function(e,t){return re("concat")},n.prototype.neg=function(e){return re("neg")},n.prototype.add=function(e,t){return re("add")},n.prototype.addN=function(e){return re("addN")},n.prototype.subtract=function(e,t){return re("subtract")},n.prototype.multiply=function(e,t){return re("multiply")},n.prototype.realDivide=function(e,t){return re("realDivide")},n.prototype.floorDiv=function(e,t){return re("floorDiv")},n.prototype.sum=function(e,t){return re("sum")},n.prototype.prod=function(e,t){return re("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return re("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return re("argMin")},n.prototype.argMax=function(e,t){return re("argMax")},n.prototype.equal=function(e,t){return re("equal")},n.prototype.notEqual=function(e,t){return re("notEqual")},n.prototype.less=function(e,t){return re("less")},n.prototype.lessEqual=function(e,t){return re("lessEqual")},n.prototype.greater=function(e,t){return re("greater")},n.prototype.greaterEqual=function(e,t){return re("greaterEqual")},n.prototype.logicalNot=function(e){return re("logicalNot")},n.prototype.logicalAnd=function(e,t){return re("logicalAnd")},n.prototype.logicalOr=function(e,t){return re("logicalOr")},n.prototype.where=function(e){return re("where")},n.prototype.select=function(e,t,r){return re("select")},n.prototype.topk=function(e,t,r){return re("topk")},n.prototype.min=function(e,t){return re("min")},n.prototype.minimum=function(e,t){return re("minimum")},n.prototype.mod=function(e,t){return re("mod")},n.prototype.max=function(e,t){return re("max")},n.prototype.maximum=function(e,t){return re("maximum")},n.prototype.all=function(e,t){return re("all")},n.prototype.any=function(e,t){return re("any")},n.prototype.squaredDifference=function(e,t){return re("squaredDifference")},n.prototype.ceil=function(e){return re("ceil")},n.prototype.floor=function(e){return re("floor")},n.prototype.round=function(e){return re("round")},n.prototype.sign=function(e){return re("sign")},n.prototype.isNaN=function(e){return re("isNaN")},n.prototype.isInf=function(e){return re("isInf")},n.prototype.isFinite=function(e){return re("isFinite")},n.prototype.pow=function(e,t){return re("pow")},n.prototype.exp=function(e){return re("exp")},n.prototype.expm1=function(e){return re("expm1")},n.prototype.softmax=function(e,t){return re("softmax")},n.prototype.log=function(e){return re("log")},n.prototype.log1p=function(e){return re("log1p")},n.prototype.sqrt=function(e){return re("sqrt")},n.prototype.rsqrt=function(e){return re("rsqrt")},n.prototype.square=function(e){return re("square")},n.prototype.reciprocal=function(e){return re("reciprocal")},n.prototype.relu=function(e){return re("relu")},n.prototype.relu6=function(e){return re("relu6")},n.prototype.prelu=function(e,t){return re("prelu")},n.prototype.elu=function(e){return re("elu")},n.prototype.eluDer=function(e,t){return re("eluDer")},n.prototype.selu=function(e){return re("selu")},n.prototype.int=function(e){return re("int")},n.prototype.clip=function(e,t,r){return re("clip")},n.prototype.abs=function(e){return re("abs")},n.prototype.complexAbs=function(e){return re("complexAbs")},n.prototype.sigmoid=function(e){return re("sigmoid")},n.prototype.softplus=function(e){return re("softplus")},n.prototype.sin=function(e){return re("sin")},n.prototype.cos=function(e){return re("cos")},n.prototype.tan=function(e){return re("tan")},n.prototype.asin=function(e){return re("asin")},n.prototype.acos=function(e){return re("acos")},n.prototype.atan=function(e){return re("atan")},n.prototype.atan2=function(e,t){return re("atan2")},n.prototype.sinh=function(e){return re("sinh")},n.prototype.cosh=function(e){return re("cosh")},n.prototype.tanh=function(e){return re("tanh")},n.prototype.asinh=function(e){return re("asinh")},n.prototype.acosh=function(e){return re("acosh")},n.prototype.atanh=function(e){return re("atanh")},n.prototype.erf=function(e){return re("erf")},n.prototype.step=function(e,t){return re("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,re("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return re("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return re("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return re("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,re("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return re("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return re("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return re("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return re("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return re("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return re("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return re("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return re("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return re("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return re("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return re("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return re("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return re("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return re("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return re("reshape")},n.prototype.cast=function(e,t){return re("cast")},n.prototype.tile=function(e,t){return re("tile")},n.prototype.pad=function(e,t,r){return re("pad")},n.prototype.transpose=function(e,t){return re("transpose")},n.prototype.gather=function(e,t,r){return re("gather")},n.prototype.gatherND=function(e,t){return re("gatherND")},n.prototype.scatterND=function(e,t,r){return re("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return re("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return re("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return re("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return re("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return re("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return re("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,o,a){return re("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){return re("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,o,a,s){return re("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return re("multinomial")},n.prototype.oneHot=function(e,t,r,i){return re("oneHot")},n.prototype.cumsum=function(e,t,r,i){return re("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return re("nonMaxSuppression")},n.prototype.fft=function(e){return re("fft")},n.prototype.ifft=function(e){return re("ifft")},n.prototype.complex=function(e,t){return re("complex")},n.prototype.real=function(e){return re("real")},n.prototype.imag=function(e){return re("imag")},n.prototype.cropAndResize=function(e,t,r,i,o,a){return re("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return re("depthToSpace")},n.prototype.split=function(e,t,r){return re("split")},n.prototype.sparseToDense=function(e,t,r,i){return re("sparseToDense")},n.prototype.diag=function(e){return re("diag")},n.prototype.fill=function(e,t,r){return re("fill")},n.prototype.onesLike=function(e){return re("onesLike")},n.prototype.zerosLike=function(e){return re("zerosLike")},n.prototype.linspace=function(e,t,r){return re("linspace")},n.prototype.dispose=function(){return re("dispose")},n}();function re(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Jl(n,e,t,r,i,o,a){a===void 0&&(a="channelsLast");var s,u=by(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,n[3],n[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,n[1],n[1]]}return mc(n,s,t,r,i,o,!1,a)}function wy(n,e,t,r,i,o,a){a===void 0&&(a="NDHWC");var s,u,l=C_(e),c=l[0],h=l[1],d=l[2];if(a==="NDHWC")u="channelsLast",s=[c,h,d,n[4],n[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,h,d,n[1],n[1]]}return _y(n,s,t,r,i,!1,u,o)}function mc(n,e,t,r,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],d=n[1],c=n[2],h=n[3]}var f,p=e[0],m=e[1],g=e[3],y=by(t),x=y[0],_=y[1],b=by(r),C=b[0],k=b[1],T=Rh(p,C),E=Rh(m,k),I=function(q,J,ee,Q,$,K,j,ue){var he,ve,we;if(typeof q=="number"){he={top:q,bottom:q,left:q,right:q,type:q===0?"VALID":"NUMBER"};var Ee=function(Be,Ge,We,ut,ot){ut==null&&(ut=SF(Be,Ge,We));var dt=Be[0],Yn=Be[1],En=Wf((dt-Ge+2*ut)/We+1,ot);U(An(En),function(){return"The output # of rows ("+En+") must be an integer. Change the stride and/or zero pad parameters"});var sn=Wf((Yn-Ge+2*ut)/We+1,ot);return U(An(sn),function(){return"The output # of columns ("+sn+") must be an integer. Change the stride and/or zero pad parameters"}),[En,sn]}([J,ee],K,Q,q,ue);ve=Ee[0],we=Ee[1]}else if(q==="same"){ve=Math.ceil(J/Q),we=Math.ceil(ee/$);var Ce=Math.max(0,(ve-1)*Q+K-J),Ie=Math.max(0,(we-1)*$+j-ee),ce=Math.floor(Ce/2),Ue=Ce-ce,je=Math.floor(Ie/2);he={top:ce,bottom:Ue,left:je,right:Ie-je,type:"SAME"}}else{if(q!=="valid")throw Error("Unknown padding parameter: "+q);he={top:0,bottom:0,left:0,right:0,type:"VALID"},ve=Math.ceil((J-K+1)/Q),we=Math.ceil((ee-j+1)/$)}return{padInfo:he,outHeight:ve,outWidth:we}}(i,c,h,x,_,T,E,o),R=I.padInfo,N=I.outHeight,O=I.outWidth,M=a?g*d:g;return s==="channelsFirst"?f=[l,M,N,O]:s==="channelsLast"&&(f=[l,N,O,M]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:d,outHeight:N,outWidth:O,outChannels:M,padInfo:R,strideHeight:x,strideWidth:_,filterHeight:p,filterWidth:m,effectiveFilterHeight:T,effectiveFilterWidth:E,dilationHeight:C,dilationWidth:k,inShape:n,outShape:f,filterShape:e}}function _y(n,e,t,r,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3],f=u[4];if(a==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3],f=n[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=n[0],f=n[1],c=n[2],h=n[3],d=n[4]}var p,m=e[0],g=e[1],y=e[2],x=e[4],_=C_(t),b=_[0],C=_[1],k=_[2],T=C_(r),E=T[0],I=T[1],R=T[2],N=Rh(m,E),O=Rh(g,I),M=Rh(y,R),q=function(j,ue,he,ve,we,Ee,Ce,Ie,ce,Ue,je){var Be,Ge,We,ut;if(typeof j=="number"){Be={top:j,bottom:j,left:j,right:j,front:j,back:j,type:j===0?"VALID":"NUMBER"};var ot=function(Nn,un,tn,Tt,pn,li){pn==null&&(pn=SF(Nn,un,Tt));var ba=Nn[0],Rd=Nn[1],oo=Nn[2],Es=Wf((ba-un+2*pn)/Tt+1,li);U(An(Es),function(){return"The output # of depths ("+Es+") must be an integer. Change the stride and/or zero pad parameters"});var Cs=Wf((Rd-un+2*pn)/Tt+1,li);U(An(Cs),function(){return"The output # of rows ("+Cs+") must be an integer. Change the stride and/or zero pad parameters"});var Ea=Wf((oo-un+2*pn)/Tt+1,li);return U(An(Ea),function(){return"The output # of columns ("+Ea+") must be an integer. Change the stride and/or zero pad parameters"}),[Es,Cs,Ea,tn]}([ue,he,ve,1],Ie,1,we,j,je);Ge=ot[0],We=ot[1],ut=ot[2]}else if(j==="same"){Ge=Math.ceil(ue/we),We=Math.ceil(he/Ee),ut=Math.ceil(ve/Ce);var dt=(Ge-1)*we+Ie-ue,Yn=(We-1)*Ee+ce-he,En=(ut-1)*Ce+Ue-ve,sn=Math.floor(dt/2),Ln=dt-sn,Cn=Math.floor(Yn/2),Bn=Yn-Cn,ar=Math.floor(En/2);Be={top:Cn,bottom:Bn,left:ar,right:En-ar,front:sn,back:Ln,type:"SAME"}}else{if(j!=="valid")throw Error("Unknown padding parameter: "+j);Be={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ge=Math.ceil((ue-Ie+1)/we),We=Math.ceil((he-ce+1)/Ee),ut=Math.ceil((ve-Ue+1)/Ce)}return{padInfo:Be,outDepth:Ge,outHeight:We,outWidth:ut}}(i,c,h,d,b,C,k,N,O,M,s),J=q.padInfo,ee=q.outDepth,Q=q.outHeight,$=q.outWidth,K=o?x*f:x;return a==="channelsFirst"?p=[l,K,ee,Q,$]:a==="channelsLast"&&(p=[l,ee,Q,$,K]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:d,inChannels:f,outDepth:ee,outHeight:Q,outWidth:$,outChannels:K,padInfo:J,strideDepth:b,strideHeight:C,strideWidth:k,filterDepth:m,filterHeight:g,filterWidth:y,effectiveFilterDepth:N,effectiveFilterHeight:O,effectiveFilterWidth:M,dilationDepth:E,dilationHeight:I,dilationWidth:R,inShape:n,outShape:p,filterShape:e}}function SF(n,e,t,r){r===void 0&&(r=1);var i=Rh(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function by(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function C_(n){return typeof n=="number"?[n,n,n]:n}function Rh(n,e){return e<=1?n:n+(n-1)*(e-1)}function Wf(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function ud(n){var e=by(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function Hr(n,e){return ud(n)||ud(e)}function JE(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function RF(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=wn(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!Wre(n.dtype,e))return X.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var a=t.real(n);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var s=Le(0,n.dtype);return o=t.notEqual(n,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function T_(n,e){return X.makeTensorFromDataId(n.dataId,e,n.dtype)}function kF(n,e,t){var r=(e-n)/(t-1),i=am(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return No(i,"float32")}function I_(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function ER(n,e){return{real:n[2*e],imag:n[2*e+1]}}function Boe(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function Voe(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function Uoe(n,e,t){var r=function(o,a,s){return function(u,l,c){for(var h=0,d=u.length,f=0,p=!1;h<d;){var m=c(l,u[f=h+(d-h>>>1)]);m>0?h=f+1:(d=f,p=!m)}return p?h:-h-1}(o,a,s||Woe)}(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function Woe(n,e){return n>e?1:n<e?-1:0}function ZE(n,e,t,r,i){return AF(n,e,t,r,i,0).selectedIndices}function e2(n,e,t,r,i,o){var a=AF(n,e,t,r,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function AF(n,e,t,r,i,o,a,s){s===void 0&&(s=!1);for(var u=Array.from(e).map(function(b,C){return{score:b,boxIndex:C,suppressBeginIndex:0}}).filter(function(b){return b.score>i}).sort(CR),l=o>0?-.5/o:0,c=[],h=[];c.length<t&&u.length>0;){var d=u.pop(),f=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(f<i)break;for(var g=!1,y=c.length-1;y>=m;--y){var x=joe(n,p,c[y]);if(x>=r){g=!0;break}if(d.score=d.score*zoe(r,l,x),d.score<=i)break}d.suppressBeginIndex=c.length,g||(d.score===f?(c.push(p),h.push(d.score)):d.score>i&&Uoe(u,d,CR))}var _=c.length;return s&&(c.fill(0,_),h.fill(0,_)),{selectedIndices:No(c,"int32"),selectedScores:No(h,"float32"),numValidOutputs:Le(_,"int32")}}function joe(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),f=(s-o)*(u-a),p=(h-l)*(d-c);if(f<=0||p<=0)return 0;var m=Math.max(o,l),g=Math.max(a,c),y=Math.min(s,h),x=Math.min(u,d),_=Math.max(y-m,0)*Math.max(x-g,0);return _/(f+p-_)}function zoe(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function CR(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function NF(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var a=n.slice(r,i);return r[t]+=o,a})}function DF(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=et(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(n.rank),s=0;s<a.length;s++)a[s]=o[s]%n.shape[s];var u=n.locToIndex(a);i.values[r]=n.values[u]}return i.toTensor()}function PF(n,e,t,r,i){for(var o=e[e.length-1],a=[n.length/o,o],s=a[0],u=a[1],l=od(t,s*r),c=od("int32",s*r),h=0;h<s;h++){for(var d=h*u,f=n.subarray(d,d+u),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(b,C){return C.value-b.value});var g=h*r,y=l.subarray(g,g+r),x=c.subarray(g,g+r);for(m=0;m<r;m++)y[m]=p[m].value,x[m]=p[m].index}var _=e.slice();return _[_.length-1]=r,[dr(l,_,t),dr(c,_,"int32")]}function t2(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=et(n,"int32"),o=et([t.length,n.length],"int32");for(r=0;r<t.length;r++){var a=i.indexToLoc(t[r]),s=r*n.length;o.values.set(a,s)}return o.toTensor()}var $oe=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},Hoe=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},Goe=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,a=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function OF(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function ti(n,e){return e===1?[n]:OF(n,e)}function Nr(){var n,e,t,r,i,o,a,s,u,l;return le().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function kl(n,e,t){t===void 0&&(t="index");var r=Ti(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function n2(n){var e=Ti(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var MF=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function qoe(n,e,t,r){var i=[];n.forEach(function(f){var p=De(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))});var o,a,s=i.join(`
`),u=n.map(function(f){return function(p,m,g){g===void 0&&(g=!1);var y="";y+=g?FF(p):Yc(p);var x=p.shapeInfo.logicalShape,_=m.logicalShape;return x.length<=_.length&&(y+=g?function(b,C){var k,T=b.name,E=T.charAt(0).toUpperCase()+T.slice(1),I="get"+E+"AtOutCoords",R=b.shapeInfo.logicalShape.length,N=C.logicalShape.length,O=ou(b.shapeInfo.logicalShape,C.logicalShape),M=en(N),q=N-R,J=["x","y","z","w","u","v"];k=R===0?"":N<2&&O.length>=1?"coords = 0;":O.map(function(he){return"coords."+J[he+q]+" = 0;"}).join(`
`);var ee="";ee=N<2&&R>0?"coords":b.shapeInfo.logicalShape.map(function(he,ve){return"coords."+J[ve+q]}).join(", ");var Q="return outputValue;",$=De(b.shapeInfo.logicalShape)===1,K=De(C.logicalShape)===1;if(R!==1||$||K){if($&&!K)Q=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(O.length){var j=R-2,ue=R-1;O.indexOf(j)>-1&&O.indexOf(ue)>-1?Q="return vec4(outputValue.x);":O.indexOf(j)>-1?Q="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":O.indexOf(ue)>-1&&(Q="return vec4(outputValue.xx, outputValue.zz);")}}else Q=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+I+`() {
      `+M+` coords = getOutputCoords();
      `+k+`
      vec4 outputValue = get`+E+"("+ee+`);
      `+Q+`
    }
  `}(p,m):function(b,C){var k=b.name,T=k.charAt(0).toUpperCase()+k.slice(1),E="get"+T+"AtOutCoords",I=C.texShape,R=b.shapeInfo.texShape,N=b.shapeInfo.logicalShape.length,O=C.logicalShape.length;if(!b.shapeInfo.isUniform&&N===O&&b.shapeInfo.flatOffset==null&&ir(R,I))return`
      float `+E+`() {
        return sampleTexture(`+k+`, resultUV);
      }
    `;var M,q=en(O),J=ou(b.shapeInfo.logicalShape,C.logicalShape),ee=O-N,Q=["x","y","z","w","u","v"];M=N===0?"":O<2&&J.length>=1?"coords = 0;":J.map(function(K){return"coords."+Q[K+ee]+" = 0;"}).join(`
`);var $="";return $=O<2&&N>0?"coords":b.shapeInfo.logicalShape.map(function(K,j){return"coords."+Q[j+ee]}).join(", "),`
    float `+E+`() {
      `+q+` coords = getOutputCoords();
      `+M+`
      return get`+T+"("+$+`);
    }
  `}(p,m)),y}(f,e,r)}).join(`
`),l=e.texShape,c=Nr(),h=function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `}(c),d=function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Koe+`
    `+Xoe+`
    `+Qoe+`
  `}(c);return e.isPacked?(o=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,C){var k=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)];return k[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+k[1]+`.0);
      }
    `:k[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+k[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+k[0]+", "+k[1]+`));
      return 2 * (resTexRC.x * `+k[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(b,C){var k=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)];if(ir(b,C))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+k[0]+", "+k[1]+`));
      }
    `;var T=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+k[0]+", "+k[1]+`));

      int index = resTexRC.x * `+k[1]+` + resTexRC.y;
      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=f,g=p,y=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],x=Math.ceil(m[2]/2),_=x*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,C){for(var k=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)],T=Math.ceil(b[b.length-1]/2),E=T*Math.ceil(b[b.length-2]/2),I=E,R="",N="b, r, c",O=2;O<b.length-1;O++)I*=b[b.length-O-1],R=`
      int b`+O+" = index / "+I+`;
      index -= b`+O+" * "+I+`;
    `+R,N="b"+O+", "+N;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+k[0]+", "+k[1]+`));
      int index = resTexRC.x * `+k[1]+` + resTexRC.y;

      `+R+`

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec`+b.length+"("+N+`);
    }
  `}(f,p)}var m,g,y,x,_}(e.logicalShape,l),a=function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `}(c)):(o=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(y,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(y,x){return ir(y,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:y[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:y[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+y[1]+`;
      int c = index - r * `+y[1]+`;
      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=p,g=kl(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(y,x){var _=kl(["r","c","d","d2"],y);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+_+`
      return ivec4(r, c, d, d2);
    }
  `}(f,p);case 5:return function(y,x){var _=kl(["r","c","d","d2","d3"],y);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+_+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(f,p);case 6:return function(y,x){var _=kl(["r","c","d","d2","d3","d4"],y);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+_+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(f,p);default:throw new Error(f.length+"-D output sampling is not yet supported")}var m,g}(e.logicalShape,l),a=function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(d+=Yoe),[d,h,a,s,o,u,t].join(`
`)}function Yc(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=fl(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Uc(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=fl(r);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&ir(r,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=bl(r),c=l.newShape,h=l.keptDims,d=c;if(d.length<r.length){var f=Jc(t,d);return`
      `+Yc(f)+`
      float `+o+`(int row, int col) {
        return `+o+"("+Zc(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Uc(t)+`
      }
    `;var p=a[0],m=a[1],g=fl(i);return m===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[1]*r[2],s=r[2],u=bl(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var d=Jc(t,h);return`
        `+Yc(d)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+Zc(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Uc(t)+`
      }
    `;var f=t.shapeInfo.texShape,p=f[0],m=f[1],g=t.shapeInfo.flatOffset;if(m===a&&g==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(m===s&&g==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var y=fl(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+y+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=bl(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var d=Jc(t,c);return`
      `+Yc(d)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+Zc(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Uc(t)+`
      }
    `;var f=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],g=p[1];if(g===u&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===a&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=fl(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+g+", index + "+y+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=bl(r),h=c.newShape,d=c.keptDims;if(h.length<r.length){var f=Jc(t,h);return`
      `+Yc(f)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+Zc(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Uc(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],y=m[1];if(y===l&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===a&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=fl(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=bl(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=Jc(t,s);return`
      `+Yc(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+Zc(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,d=r[3]*h,f=r[2]*d,p=r[1]*f;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+f+", "+d+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Uc(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,y=g[0],x=g[1];if(x===p&&m==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+d+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&m==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var _=fl(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+f+" + depth * "+d+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+_+`;
      vec2 uv = uvFromFlat(`+y+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function FF(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Nr(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=Nr();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `}(n);case 2:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=Nr();if(u!=null&&ir(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],f=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+d[0]+", "+d[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `}(n);case 3:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=Jc(i,c);return`
        `+FF(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+Zc(["b","row","col"],[1,2])+`);
        }
      `}var d=l[0],f=l[1],p=Math.ceil(o[2]/2),m=p*Math.ceil(o[1]/2),g=Nr();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+f+", "+m+", "+p+`, b, row, col);
      return `+g.texture2D+"("+a+`, uv);
    }
  `}(n);default:return function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],d=c[1],f=Math.ceil(o[a-1]/2),p=f*Math.ceil(o[a-2]/2),m="int b, int row, int col",g="b * "+p+" + (row / 2) * "+f+" + (col / 2)",y=2;y<a-1;y++)m="int b"+y+", "+m,p*=o[a-y-1],g="b"+y+" * "+p+" + "+g;var x=Nr();return`
    vec4 `+u+"("+m+`) {
      int index = `+g+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+h+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `}(n)}}var Koe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Xoe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Qoe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Yoe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function fl(n){return"offset"+n}function Uc(n){var e=n.name,t=De(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function en(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Jc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Zc(n,e){return e.map(function(t){return n[t]}).join(", ")}var Joe=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,U(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=en(l),h=ti("coords",l);if(o===1){var d=en(s=l+1);a=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map(function(E){return"int "+E}),g=ti("sourceLocR",s-1).concat("inIdx.r"),y=ti("sourceLocG",s-1).concat("inIdx.g"),x=ti("sourceLocB",s-1).concat("inIdx.b"),_=ti("sourceLocA",s-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",C=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",k=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",T=r?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+k+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+C+`
          vec4 candidate = `+k+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Zoe=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},eae=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,f=c-1-n.padInfo.front,p=h-1-n.padInfo.top,m=d-1-n.padInfo.left,g=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},tae=function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],pt(n,e),pt(n,t);var a="0.0";r!=null&&(pt(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(pt(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},nae=function(n,e,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],pt(n,e),pt(n,t);var a="vec4(0.0)";r!=null&&(pt(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(pt(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},rae="return areal * breal - aimag * bimag;",iae="return areal * bimag + aimag * breal;",TR=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=pt(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},sx="return a + b;",ux="return a - b;",IR="return a * b;",oae=`
if (a == b) {
  return 1.0;
};
return a / b;`,LF="return (a < 0.) ? b * a : a;",yn=function(n,e,t){this.variableNames=["A","B"],this.outputShape=pt(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},aae=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,BF=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Go=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=pt(e,t);var i=this.outputShape.length,o="";if(r)if(i===0||De(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+en(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=ti("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},sae=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),uae=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),lae=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},cae=function(n){this.outputShape=[],this.outputShape=sd(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},hae=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=sd(n,e);var t=this.outputShape,r=t.length,i=en(r),o=ti("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(g,y){return"T"+y});var s=new Array(n.length-1);s[0]=n[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][e];var l=a[e],c=a.slice(-2),h=a.join(),d="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var f=s[u-1];d+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Cv(a,l,f)+`),
            vec2(`+Cv(c,l,f)+`));
        }`}var p=s.length,m=s[s.length-1];d+=`
        return getChannel(
          getT`+p+"("+Cv(a,l,m)+`),
          vec2(`+Cv(c,l,m)+"));",this.userCode=`
      float getValue(`+a.map(function(g){return"int "+g})+`) {
        `+d+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+t[r-2]+` &&
            `+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function Cv(n,e,t){var r=n.indexOf(e);return n.map(function(i,o){return o===r?i+" - "+t:i}).join()}var dae=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},fae=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,s=t-1-n.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},pae=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},mae=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},vae=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},gae=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,a=t-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},SR=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,h=n.filterWidth,d=4*Math.floor(n.inChannels/4),f=n.inChannels%4,p=n.dataFormat==="channelsLast",m=p?1:2,g=p?2:3,y=p?3:1,x="",_="";t&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,_="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+y+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+_+`
        setOutput(result);
      }
    `},yae=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,d=n.filterWidth,f=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},RR=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,f=n.filterWidth,p=n.outChannels/n.inChannels,m="",g="";t&&(m=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,g="result = activation(result);");var y=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+y+`
        `+g+`
        setOutput(result);
      }
    `},kR=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,f=n.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var y=0;y<f;y++)m+=`
          vec4 xTexelR`+g+"C"+2*y+` = vec4(0.);
          vec4 wR`+g+"C"+y+` = vec4(0.);
          vec4 xR`+g+"C"+y+" = vec4(0.);";for(g=0;g<d;g++)for(var x=0;x<p;x++){if(m+=`
          xR = xRCorner + `+g*c+`;
          xC = xCCorner + `+(y=2*x)*h+`;
        `,l===1){if(y<f&&(m+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+g+"C"+y+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+g+"C"+y+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+y+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+y+" = vec4(previous.zw, xTexelR"+g+"C"+y+`.xy);
                } else {
                  xR`+g+"C"+y+" = vec4(0, 0, xTexelR"+g+"C"+y+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+g+"C"+y+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+y+` = vec4(0.);
                }

                xR`+g+"C"+y+" = xTexelR"+g+"C"+y+`;
              `,y+1<f)){var _=s%2==0?qM(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+=`
                  xCOffset = xC + `+s%2+" + "+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+g+"C"+y+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+y+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+g+"C"+(y+1)+` = vec4(
                    xTexelR`+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(y+1)+" = xTexelR"+g+"C"+(y+2)+`;
                `}}else y<f&&(m+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(m+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+y+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+y+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+g+"C"+(y+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(y+2)+` = vec4(0.);
                }

                xR`+g+"C"+y+` = vec4(
                  xTexelR`+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+`.zw);
              `,y+1<f&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(y+1)+" = vec4(xTexelR"+g+"C"+(y+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+g+"C"+y+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+y+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(y+2)+` = vec4(0.);
                }

                xR`+g+"C"+y+` = vec4(
                  xTexelR`+g+"C"+y+".xy, xTexelR"+g+"C"+(y+2)+`.xy);
              `,y+1<f&&(m+=`
                  xR`+g+"C"+(y+1)+` = vec4(
                    xTexelR`+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+`.zw);
                `)),m+="}");y<f&&(m+=`
            vec4 wTexelR`+g+"C"+y+" = getW("+g+", "+y+`, d1, q);
            wR`+g+"C"+y+" = vec4(wTexelR"+g+"C"+y+".xz, wTexelR"+g+"C"+y+`.xz);
          `,y+1<f&&(m+=`
              vec4 wTexelR`+g+"C"+(y+1)+" = getW("+g+", "+(y+1)+`, d1, q);
              wR`+g+"C"+(y+1)+` =
                vec4(wTexelR`+g+"C"+(y+1)+".xz, wTexelR"+g+"C"+(y+1)+".xz);"))}for(g=0;g<d;g++)for(y=0;y<f;y++)m+="dotProd += xR"+g+"C"+y+" * wR"+g+"C"+y+";";var b="",C="";t&&(b=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,C="result = activation(result);");var k=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+k+`
        `+C+`
        setOutput(result);
      }
    `},xae=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],a=n[1],s=n[2],u=n[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var d=r==="bilinear"?1:0,f=[a-1+".0",s-1+".0"],p=f[0],m=f[1],g=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],y=g[0],x=g[1],_=g[2],b=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],C=b[0],k=b[1],T=b[2];this.userCode=`
      const float height_ratio = float(`+y+`);
      const float width_ratio = float(`+C+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+k+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},wae=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+en(r)+` coords = getOutputCoords();
        int end = `+AR(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+AR(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function AR(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var _ae=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=bp.DENSE;var e=Uf(n),t=Nr();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+kl(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},bae=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=bp.DENSE;var e=Uf(n),t=Nr();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+kl(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},Eae=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),Cae=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},Tae=function(n){this.variableNames=["A"],this.outTexUsage=_i.DOWNLOAD;var e=Nr();this.outputShape=n,this.userCode=`
      `+MF+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},Iae=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=_i.DOWNLOAD;var e=Nr();this.outputShape=n,this.userCode=`
      `+MF+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},Sae=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Nr(),i=e[0],o=e[1];this.outputShape=n;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+n2(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},Rae=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Nr(),i=e[0],o=e[1];this.outputShape=n;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+n2(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},kae="return real * expR - imag * expI;",Aae="return real * expI + imag * expR;",NR=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Nae=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),Dae=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=en(this.rank),o=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<a.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()}(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},Pae=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=en(e.length),i=en(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function Oae(n,e){var t=Nr();return rie(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Mae(n,e){return uie(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Fae(n,e){return lie(n,e,new Uint16Array([0,1,2,2,1,3]))}function um(n,e,t,r,i,o,a){hie(t,r);var s=cie(n,e),u=n.TEXTURE_2D;return Fe(n,e,function(){return n.bindTexture(u,s)}),Fe(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Fe(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Fe(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Fe(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Fe(n,e,function(){return n.texImage2D(u,0,i,t,r,0,o,a,null)}),Fe(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function Lae(n,e,t,r,i){var o=v0(t,r);return um(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function Bae(n,e,t,r,i){var o=v0(t,r);return um(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Vae(n,e,t,r,i){var o=v0(t,r);return um(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function Uae(n,e,t,r,i){var o=sm(t,r);return um(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function Wae(n,e,t,r,i){var o=sm(t,r);return um(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function jae(n,e,t,r){return Fe(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),yR(n,e,t,"clipSpacePos",r,3,20,0)&&yR(n,e,t,"uv",r,2,20,12)}function zae(n,e,t,r,i,o,a){var s,u,l;Fe(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(r*i*4),u=n.FLOAT,l=a.internalFormatPackedFloat),s.set(o),Fe(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,s)}),Fe(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function $ae(n,e,t,r){Fe(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?Fe(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):Fe(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Fe(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function Hae(n,e,t,r,i){var o=n.createBuffer();Fe(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var a=16*t*r;return Fe(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)}),Fe(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),Fe(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function Gae(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function qae(n,e,t,r,i){var o=v0(t,r),a=o[0],s=o[1],u=new Uint8Array(t*r*4);return Fe(n,e,function(){return n.readPixels(0,0,a,s,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Kae(n,e,t,r,i,o,a,s){var u=n,l=new Float32Array(function(c,h){var d=sm(c,h);return d[0]*d[1]*4}(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function Xae(n,e,t,r){var i=new Float32Array(t*r*4);return Fe(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}var Qae=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=le().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,Jre(t,e)):this.gl=xa(t);var r="WEBGL_color_buffer_float";if(le().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=wv(this.gl,this.debug,"OES_texture_float"),qi(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=wv(this.gl,this.debug,"OES_texture_half_float");else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),qi(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=wv(this.gl,this.debug,"EXT_color_buffer_half_float");else if(le().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",qi(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!qi(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Mae(this.gl,this.debug),this.indexBuffer=Fae(this.gl,this.debug),this.framebuffer=die(this.gl,this.debug),this.textureConfig=GE(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return le().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Fe(t,this.debug,function(){return t.finish()}),Fe(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Fe(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Fe(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Fe(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Fe(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Lae(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Bae(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Vae(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),$ae(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),zae(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Wae(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Uae(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(xR(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Fe(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return qae(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,a){return Kae(this.gl,e,0,0,0,o,a,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Gae(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=Hae(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(le().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return Xae(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=iie(t,this.debug,e),i=Oae(t,this.debug),o=aie(t,this.debug);return Fe(t,this.debug,function(){return t.attachShader(o,i)}),Fe(t,this.debug,function(){return t.attachShader(o,r)}),sie(t,this.debug,o),this.debug&&rx(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=jae(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Fe(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&rx(this.gl,this.debug,this.program),Fe(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?pie(this.gl,this.debug,e,t):mie(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Fe(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),vie(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=sm(t,r),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&rx(this.gl,this.debug,this.program),_v(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Fe(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Fe(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=wv(this.gl,this.debug,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Pe(this,void 0,void 0,function(){var t=this;return Oe(this,function(r){switch(r.label){case 0:return[4,fR(function(){return t.disposed||t.isQueryAvailable(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||fR(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),ix(this.gl,this.debug,e,this.framebuffer),this.debug&&_v(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(ix(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&_v(this.gl)):xR(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;ix(i,this.debug,e,this.framebuffer),this.debug&&_v(i),this.outputTexture=e,Fe(i,this.debug,function(){return i.viewport(0,0,t,r)}),Fe(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),Fe(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function DR(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],a=o.shape;if(!ir(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!ir(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var Yae=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=t.dataFormat,d=s.left,f=s.top,p=i*r,m=Nr(),g=h==="channelsLast",y=g?0:1,x=g?1:2,_="",b=0;b<=1;b++)for(var C=0;C<=1;C++)_+=`
          blockIndex = rc.y + `+C+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+f+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+e[y]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+d+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+i+`.));

              if(d1 < `+e[x]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+C)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+C)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+_+`

        `+m.output+` = result;
      }
    `},Jae=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},Zae=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},ese=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},tse=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,a=i-1-n.padInfo.top,s=o-1-n.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},nse=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=s-1-n.padInfo.front,h=u-1-n.padInfo.top,d=l-1-n.padInfo.left,f=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},lx=function(n,e,t,r,i,o,a){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=t?n[1]:n[2],u=Math.ceil(s/2),l=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";o&&(f=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+d[0]+`);
          result += (`+h[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},rse=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),ise=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},ose=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=ti("rc",e),r=en(e),i=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c}(e,n,t),o=function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,n[n.length-1],n[n.length-2],t),a=function(s,u){var l=s.length,c=function(h,d){for(var f=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var g=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),y=2;y<h;y++)g=d[d.length-1-y]+","+g;f.push(g)}return f}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},ase=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=en(r),o=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,l){return u[0]+n[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},sse=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(g,y){return g[0]+n[y]+g[1]});for(var r=n.length,i=en(r),o=e.map(function(g){return g[0]}).join(","),a=e.map(function(g,y){return g[0]+n[y]}).join(","),s=ti("rc",r),u=ti("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=r===1?2:4;p<m;p++)f+=`
        `+h[p]+`
        if (`+d+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},jf=function(n,e,t,r,i){if(r===void 0&&(r=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,d=n.padInfo.top,f=n.padInfo.left;this.outputShape=n.outShape;var p=e==="avg",m="((batch  * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + d",g="(xR * "+n.inWidth+" + xC) * "+n.inChannels+" + d",y="0.0";if(p||(y="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+s+`);
        const ivec2 pads = ivec2(`+d+", "+f+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(r?i?m:g:"wR * "+h+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(x="avgValue / count");var _=4*Math.floor(o/4),b=o%4,C=`
      if (`+p+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+d+", "+f+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+u+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+_+`; wC += 4) {
            int xC = xCCorner + wC * `+l+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              getValue(batch, xR, xC + 3 * `+l+`, d)
            );

            `+C+`
          }

          int xC = xCCorner + `+_+`;
          if (`+(b===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(b===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(b===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              initializationValue
            );

            `+C+`
          }
        }
        setOutput(`+x+`);
      }
    `}},cx=function(n,e,t,r,i){if(r===void 0&&(r=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,a=n.strideDepth,s=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=n.padInfo.front,g=n.padInfo.top,y=n.padInfo.left;this.outputShape=n.outShape;var x=e==="avg",_="0.0";if(x||(_="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+s+", "+u+`);
        const ivec3 pads = ivec3(`+m+", "+g+", "+y+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+l+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+f+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+p+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(r?i?"(((batch * "+n.inDepth+" + xD) * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"((xD * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"wD * "+f+" * "+p+` +
                      wR * `+p+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(b="avgValue / count");var C=4*Math.floor(o/4),k=o%4,T=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+s+", "+u+`);
      const ivec3 pads = ivec3(`+m+", "+g+", "+y+`);
      const float initializationValue = `+_+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+_+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+l+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+f+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+C+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+T+`
            }

            int xC = xCCorner + `+C+`;
            if (`+(k===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(k===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(k===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+T+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},use=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var f="";i%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},lse=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+kl(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+n2(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},cse=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},hse=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},dse=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},fse=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},pse=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},mse=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(o,a){return function(s){return e.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),i=en(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},vse=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=ti("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],a=en(t);function s(u){var l=n.map(function(c,h){return function(d,f){return e.indexOf(d)!==-1&&n[d]!==1?n[d]+" - "+f[d]+" - 1":""+f[d]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},PR=function(n,e,t,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=en(i.length),u=en(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var d="getUpdates("+h+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},gse=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,a=o*Math.ceil(i/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},yse=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<n&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=en(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},xse=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=en(this.rank),i="uniform int start["+this.rank+"];",o=function(a){if(a===1)return"sourceLoc";if(a<=6)return hx.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+hx[s]+" = start["+s+"] + coords."+hx[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),hx=["x","y","z","w","u","v"],wse=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=en(this.rank),r=ti("coords",this.rank),i=ti("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),_se=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=en(t.length),o=en(t.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=t.map(function(u,l){return s++,t.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},bse=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=OR(t,r),a=MR(e,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===vi.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===vi.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===vi.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===vi.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===vi.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=MR(t,OR(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function OR(n,e){if(n===_i.UPLOAD)return vi.PACKED_2X2_FLOAT32;if(n===_i.RENDER||n==null)return function(t){return le().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?vi.PACKED_2X2_FLOAT32:vi.UNPACKED_FLOAT32:t?vi.PACKED_2X2_FLOAT16:vi.UNPACKED_FLOAT16}(e);if(n===_i.DOWNLOAD||n===_i.PIXELS)return vi.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function MR(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var Ese=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=en(this.rank),o=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},r2=1.7580993408473768,i2=1.0507009873554805,st=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Po="if (isnan(x)) return x;",Cse="return x;",FR="return abs(x);",VF=Po+`
  return (x < 0.0) ? 0.0 : x;
`,UF=Po+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,WF="return (x >= 0.0) ? x : (exp(x) - 1.0);",Tse=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+r2+`;
  float scale = `+i2+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,LR="return -x;",BR="return ceil(x);",VR="return floor(x);",UR="return exp(x);",WR="return exp(x) - 1.0;",Ise=Po+`
  return sin(x);
`,Sse=Po+`
  return cos(x);
`,Rse=Po+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,kse=Po+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Ase=Po+`
  return atan(x);
`,Nse=Po+"return log(x + sqrt(x * x + 1.0));",Dse=Po+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,Pse=Po+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Tv="return x;",Ose="return x;",jF=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zF=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$F=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ff=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Mse=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=ti("rc",e),r=en(e),i=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},Iv={};function Sv(n,e){if(e===void 0&&(e=!1),n==="linear")return e?Ose:Cse;if(n==="relu")return e?jF:VF;if(n==="elu")return e?$F:WF;if(n==="relu6")return e?zF:UF;if(n==="prelu")return e?BF:LF;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var Fse=600,Lse=function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!le().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=xa(le().getNumber("WEBGL_VERSION"));i.binaryCache=((r=le().getNumber("WEBGL_VERSION"))in Iv||(Iv[r]={}),Iv[r]),i.gpgpu=new Qae(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new bse(i.gpgpu),i.numMBBeforeWarning=le().global.screen==null?1024:le().global.screen.height*le().global.screen.width*window.devicePixelRatio*Fse/1024/1024,i.texData=new TF(i,X),i}return Do(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(le().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:_i.UPLOAD}),o},e.prototype.move=function(t,r,i,o){if(le().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:_i.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new ff(u,Tv):new st(u,Tv);var h=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:o}],o),d=this.readSync(h.dataId);return this.disposeData(h.dataId),d}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var f,p,m=this.activeTimers!=null;return m&&(f=Xo()),o==="complex64"?p=I_(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(t),m&&(this.downloadWaitMs+=Xo()-f),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return Pe(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h,d,f,p,m,g,y,x,_,b,C,k,T,E;return Oe(this,function(I){switch(I.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(R){return r.push(R)})];if(i=this.texData.get(t),o=i.values,a=i.shape,s=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,s!=null)return h=void 0,h=c?new ff(a,Tv):new st(a,Tv),d=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:u}],u),f=this.read(d.dataId),this.disposeData(d.dataId),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&le().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&le().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),g=this.texData.get(m.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[g.texture].concat(Uf(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:I.sent(),I.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return x=I.sent(),_=x[0],b=x[1],y=I_(_,b),[3,5];case 4:p==null?y=this.getValuesFromTexture(t):(C=De(a),y=this.gpgpu.downloadFloat32MatrixFromBuffer(p,C)),I.label=5;case 5:return m!=null&&this.disposeData(m.dataId),k=this.convertAndCacheOnCPU(t,y),T=this.pendingRead.get(t),this.pendingRead.delete(t),T.forEach(function(R){return R(k)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,k]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!tie(i))throw le().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.isPacked,u=De(o);if(le().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Uf(o))).subarray(0,u);return this.disposeData(l.dataId),h}var d=le().getBool("WEBGL_PACK")&&s===!0,f=d?ox(o):o,p=d?new Iae(f):new Tae(f),m=this.runWebGLProgram(p,[{shape:f,dtype:a,dataId:t}],"float32"),g=this.texData.get(m.dataId),y=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),y},e.prototype.time=function(t){return Pe(this,void 0,void 0,function(){var r,i,o,a,s,u,l;return Oe(this,function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),a=id(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),s=id(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=Fre(l),u.getExtraProfileInfo=function(){return l.map(function(h,d){return{name:s[d],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Xo(),endMs:null}},e.prototype.endTimer=function(t){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Xo(),t)},e.prototype.getQueryTime=function(t){return Pe(this,void 0,void 0,function(){var r;return Oe(this,function(i){return le().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||t,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,u)));var d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return le().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=X.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every(function(o){return i.texData.get(o.dataId).texture==null&&De(o.shape)<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:X.keep(t.clone()),imag:X.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(De(i)===0)return dr([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,a=EF(t.shape,r,i);if(o||!a){var s=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wse(i):new xse(i),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),a=this.makeOutput(i,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=t.dtype;var u=CF(r,t.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||t.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},e.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var a=YE(r,i,o);if(a.some(function(u){return u===0}))return dr([],a);var s=new _se(r,o,a);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,r){var i=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vse(t.shape,r):new mse(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map(function(f){return zi(f)}),o=t.map(function(f){return Zo(f)});return lr(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>le().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),r),u=this.concat(t.slice(a),r);return this.concat([s,u],r)}if(le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var l=new hae(t.map(function(f){return f.shape}),r);return this.compileAndRun(l,t)}var c=sd(t.map(function(f){return f.shape}),r),h=t.map(function(f){return f.as2D(-1,De(f.shape.slice(r)))}),d=new cae(h.map(function(f){return f.shape}));return this.compileAndRun(d,h).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,LR,t.dtype);var r=new st(t.shape,LR);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,o){var a=i?t.shape[2]:t.shape[1],s=o?r.shape[1]:r.shape[2],u=i?t.shape[1]:t.shape[2],l=t.shape[0];if((a===1||s===1)&&u>1e3){i&&(t=_o(t,[0,2,1])),o&&(r=_o(r,[0,2,1]));var c=s===1?t:t.as3D(l,u,1),h=s===1?2:1,d=s===1?r.as3D(l,1,u):r;return this.multiply(c,d).sum(h,!0)}var f=hr(t.dtype,r.dtype),p=new lx(t.shape,[l,a,s],i,o);return this.compileAndRun(p,[t,r],f)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=o?r.shape[2]:r.shape[1],h=a?i.shape[1]:i.shape[2],d=r.shape[0],f=hr(r.dtype,i.dtype),p=s!=null,m=l!=null,g=u?Sv(u,!0):null,y=new lx(r.shape,[d,c,h],o,a,p,g,m),x=[r,i];return s&&x.push(s),l&&x.push(l),this.compileAndRun(y,x,f)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),a=new TR(rae,t.shape,r.shape),s=new TR(iae,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,IR,t.dtype);var d=new yn(IR,t.shape,r.shape);return this.compileAndRun(d,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,o,a,s){var u=[t,r,i],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),le().getBool("WEBGL_PACK_NORMALIZATION")){var h=new nae(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(h,u)}var d=new tae(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(d,u)},e.prototype.localResponseNormalization4D=function(t,r,i,o,a){var s=le().getBool("WEBGL_PACK_NORMALIZATION")?new ese(t.shape,r,i,o,a):new Jae(t.shape,r,i,o,a);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,r,i,o,a,s,u){var l=new Zae(r.shape,o,a,s,u);return this.compileAndRun(l,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(a){return ly(a)});return DF(et(t.shape,t.dtype,i),r)}var o=new Ese(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,i){var o=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sse(t.shape,r,i):new ase(t.shape,r,i);return this.compileAndRun(o,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new Dae(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){U(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(h,d){return h*d}),a=my(t.shape,r,o),s=vy(a.length,r.length),u=gy(t.shape,r,o),l=cF(i,r.length),c=hF(u,i,r.length);return _o(t.reshape(a),s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){U(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(d,f){return d*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=my(u.shape,r,o,!1),c=vy(l.length,r.length,!1),h=gy(u.shape,r,o,!1);return _o(u.reshape(l),c).reshape(h)},e.prototype.reduce=function(t,r,i){var o=t.shape[0],a=t.shape[1],s=ax(a),u=new use({windowSize:s,inSize:a,batchSize:o},r),l=this.compileAndRun(u,[t],i);return l.shape[1]===1?l:this.reduce(l,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var o=t.shape[0],a=t.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=ax(a),u=new Goe({windowSize:s,inSize:a,batchSize:o},r,i==null),l=[t];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,a=ax(o[o.length-1]),s=new Joe(o,a,r,i==null),u=i==null?[t]:[t,i],l=this.compileAndRun(s,u,"int32");return l.rank===t.rank?this.argReducePacked(t,r,l):l},e.prototype.sum=function(t,r){mi("sum",r,t.rank);var i=Sr(t.shape,r),o=i[0],a=De(i[1]),s=t.as2D(-1,a),u=J1(t.dtype);return this.reduce(s,"sum",u).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=Sr(t.shape,r),o=i[0],a=De(i[1]),s=t.as2D(-1,a),u=J1(t.dtype);return this.reduce(s,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,i){var o=0,a=wa([o],t.rank),s=t;a!=null&&(s=_o(t,a),o=_a(1,t.rank)[0]);var u=function(f,p,m){for(var g=[],y=f.length,x=0;x<y;x++)x!==p?g.push(f[x]):g.push(m);return g}(s.shape,o,i),l=De([s.shape[o]]),c=s.as2D(-1,l),h=J1(t.dtype),d=this.segOpCompute(c,"unsortedSegmentSum",r,h,i).reshape(u);return a!=null&&(d=_o(d,qE(a))),d},e.prototype.segOpCompute=function(t,r,i,o,a){var s=t.shape[0],u=t.shape[1],l=function(d,f){var p,m=!1;for(d<=bF?(p=d,m=!0):p=g_(d,Math.floor(Math.sqrt(d)));!m;)p>f||p===d?m=!0:p=g_(d,p+1);return p}(u,a),c=new gse({windowSize:l,inSize:u,batchSize:s,numSegments:a}),h=this.compileAndRun(c,[t,i],o);return h.shape[1]===a?h:(i=py(0,a).tile([u/l]),this.segOpCompute(h,r,i,o,a))},e.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(mi("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!le().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=Sr(t.shape,o),s=a[0],u=De(a[1]),l=t.as2D(-1,u);return this.argReduce(l,i).reshape(s)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var a=new wae(t.shape,i,o);return this.compileAndRun(a,[t])},e.prototype.equal=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new yn("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new yn("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new yn("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new yn("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new yn("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new yn("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new st(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new yn("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new yn("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var o=new yse(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],hr(r.dtype,i.dtype))},e.prototype.where=function(t){dy("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return t2(t.shape,r)},e.prototype.topk=function(t,r,i){return PF(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){mi("min",r,t.rank);var i=Sr(t.shape,r),o=i[0],a=De(i[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new yn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new yn(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);mi("max",r,t.rank);var i=Sr(t.shape,r),o=i[0],a=De(i[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new yn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){mi("all",r,t.rank);var i=Sr(t.shape,r),o=i[0],a=De(i[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},e.prototype.any=function(t,r){mi("any",r,t.rank);var i=Sr(t.shape,r),o=i[0],a=De(i[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},e.prototype.floorDiv=function(t,r){if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new yn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,sx);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=hr(t.dtype,r.dtype);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,sx,i);var o=new yn(sx,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var o=new ff(t.shape,r);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,o,a){a===void 0&&(a=!1);var s=new Go(i,t.shape,r.shape,a);return this.compileAndRun(s,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,a=this.texData.get(t.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(d){var f=d[0],p=d[1],m=o.makeComplexComponentTensorInfo(t,f),g=o.makeComplexComponentTensorInfo(r,p),y=new yn(i,t.shape,r.shape);return o.compileAndRun(y,[m,g],hr(f.dtype,p.dtype))}),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>le().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var a=t.map(function(l){return l.dtype}).reduce(function(l,c){return hr(l,c)}),s=t.map(function(l){return l.shape}),u=le().getBool("WEBGL_PACK")?new Hoe(t[0].shape,s):new $oe(t[0].shape,s);return this.compileAndRun(u,t,a)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,ux);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=hr(t.dtype,r.dtype);if(le().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,ux,t.dtype);var o=new yn(ux,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.pow=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new yn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),o=hr(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,BR,t.dtype);var r=new st(t.shape,BR);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,VR,t.dtype);var r=new st(t.shape,VR);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new st(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new st(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new st(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new st(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new st(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,UR,t.dtype);var r=new st(t.shape,UR);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,WR,t.dtype);var r=new st(t.shape,WR);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=Qn([r],t.shape),o=this.max(t,i),a=ui(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return Ou(u,l)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new st(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new st(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new st(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new st(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new st(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=le().getBool("WEBGL_PACK")?new ff(t.shape,jF):new st(t.shape,VF),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=le().getBool("WEBGL_PACK")?new ff(t.shape,zF):new st(t.shape,UF),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go(BF,t.shape,r.shape):new yn(LF,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$F,t.dtype);var r=new st(t.shape,WF);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new yn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new st(t.shape,Tse);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new st(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var o,a=(o=le().getBool("WEBGL_PACK_CLIP")?new uae(t.shape):new sae(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,a)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(le().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,FR,t.dtype);var r=new st(t.shape,FR);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new lae(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var r=new st(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new st(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new st(t.shape,Ise);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new st(t.shape,Sse);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new st(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new st(t.shape,Rse);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new st(t.shape,kse);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new st(t.shape,Ase);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new yn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new st(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new st(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new st(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new st(t.shape,Nse);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new st(t.shape,Dse);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new st(t.shape,Pse);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new st(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new st(t.shape,function(o){return o===void 0&&(o=0),Po+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,o,a,s){var u=t.shape,l=this.texData.get(t.dataId),c=i.inChannels,h=u[0]*u[1]*u[2],d=i.outChannels,f=i.dataFormat==="channelsLast",p=(h===1||d===1)&&c>1e3,m=u[2]%2!=0&&!!l.isPacked;if(p||!le().getBool("WEBGL_LAZILY_UNPACK")||!le().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var g=f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],y=this.reshape(t,[1,g,i.inChannels]),x=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var _=f?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),b={dataId:t.dataId,shape:[1,_,i.inChannels],dtype:t.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,U(Ev(l.shape,b.shape),function(){return"packed reshape "+l.shape+" to "+b.shape+" isn't free"});var k=this.reshape(r,[1,i.inChannels,i.outChannels]),T=this.fusedBatchMatMul({a:b,b:k,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),E=this.texData.get(T.dataId);return U(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=C,E.shape=i.outShape,X.makeTensorFromDataId(T.dataId,i.outShape,T.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,o,a,s){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,h=i.outWidth,d=i.outHeight,f=i.dataFormat==="channelsLast",p=u*l*c,m=d*h,g=[p,m],y=t.squeeze([0]),x=r.reshape([1,p,-1]),_=new Yae(g,y.shape,i),b=this.compileAndRun(_,[y]).reshape([1,g[0],g[1]]),C=o!=null,k=s!=null,T=a?Sv(a,!0):null,E=new lx(b.shape,[1,m,i.outChannels],!0,!1,C,T,k),I=[b,x];o&&I.push(o),k&&I.push(s);var R=this.compileAndRun(E,I);return f?R.reshape([1,d,h,i.outChannels]):R.reshape([1,i.outChannels,d,h])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,a,s,u);if(le().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,a,s,u);var l=a!=null,c=u!=null,h=s?Sv(s,!1):null,d=new SR(o,l,h,c),f=[r,i];return a&&f.push(a),u&&f.push(u),this.compileAndRun(d,f)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(le().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var o=new SR(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var o=new fae(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var o=new dae(i);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,a=t.convInfo,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=le().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,h=u?Sv(u,c):null,d=[i,o],f=s!=null,p=l!=null;return f&&d.push(s),p&&d.push(l),c?(r=new kR(a,f,h,p),this.compileAndRun(r,d)):(r=new RR(a,f,h,p),this.compileAndRun(r,d))},e.prototype.depthwiseConv2D=function(t,r,i){var o;return le().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new kR(i),this.compileAndRun(o,[t,r])):(o=new RR(i),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new gae(i);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new vae(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,i){var o=new yae(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var o=new mae(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var o=new pae(i);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var i=new jf(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new jf(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,o){var a=new jf(o,"max",!0),s=this.compileAndRun(a,[r]),u=new tse(o),l=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),l},e.prototype.avgPoolBackprop=function(t,r,i){var o=new Zoe(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return RF(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.avgPool3d=function(t,r){var i=new cx(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var o=new eae(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new cx(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,o){var a=new cx(o,"max",!0),s=this.compileAndRun(a,[r]),u=new nse(o),l=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),l},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!Ev(t.shape,r)&&(i.texture===null||!Ev(i.shape,r))){var o=this.packedReshape(t,r);return X.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return T_(t,r)},e.prototype.resizeBilinear=function(t,r,i,o){var a=le().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new dse(t.shape,r,i,o):new hse(t.shape,r,i,o);return this.compileAndRun(a,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var o=new cse(t,r,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,o){var a=new pse(t.shape,r,i,o);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new fse(t,r,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,i,o){var a=r?t:_0(t),s=a.shape[0],u=a.shape[1],l=new rse(s,u,i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[a],"int32",c)},e.prototype.oneHot=function(t,r,i,o){var a=new ise(t.size,r,i,o);return this.compileAndRun(a,[t])},e.prototype.diag=function(t){var r=new Cae(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,o,a){return dy("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),ZE(t.dataSync(),r.dataSync(),i,o,a)},e.prototype.cropAndResize=function(t,r,i,o,a,s){var u=new xae(t.shape,r.shape,o,a,s);return this.compileAndRun(u,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){U(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=t.shape[0],a=i==="NHWC"?t.shape[1]:t.shape[2],s=i==="NHWC"?t.shape[2]:t.shape[3],u=i==="NHWC"?t.shape[3]:t.shape[1],l=a*r,c=s*r,h=u/(r*r),d=new Eae(i==="NHWC"?[o,l,c,h]:[o,h,l,c],r,i);return this.compileAndRun(d,[t])},e.prototype.split=function(t,r,i){return NF(t,r,i)},e.prototype.scatterND=function(t,r,i){var o=xy(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=[c/u,u],d=t.reshape([s,a]),f=r.reshape([s,u]);if(c===0)return T_(dr([]),i);var p=Le(0),m=new PR(s,a,d.rank,f.rank,l,h);return this.compileAndRun(m,[f,d,p]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,o){var a=xy(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,h=new PR(u,s,t.rank,r.rank,l,[c,1]);return this.compileAndRun(h,[r,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new NR(kae,t.shape,r),a=new NR(Aae,t.shape,r),s=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=_F(t,r),s=a[0],u=a[1],l=a[2],c=a[3],h=r.reshape([u,o]),d=t.reshape([t.size/l,l]),f=new Pae(o,c,[u,l]);return this.compileAndRun(f,[d,h]).reshape(s)},e.prototype.fill=function(t,r,i){if((i=i||om(r))==="string"){var o=uy(i,De(t));return o.fill(r),X.makeTensor(o,t,i,this)}var a=new Nae(t,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],i,s)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return kF(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return X.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new Mse(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new ose(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[cy(t.shape)].concat(hy(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},a=[cy(r)].concat(hy(r)),s=new lse(a,i),u=this.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,a=i.shape,s=i.dtype,u=ox(a);return r=o?new bae(u):new _ae(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,o,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,i),l=this.texData.get(u.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===bp.DENSE){var c=Uf(t.outputShape);l.texShape=c.map(function(_){return 2*_})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),De(u.shape)===0)return l.values=od(u.dtype,0),u;var h=[],d=r.map(function(_){if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=s.texData.get(_.dataId);if(b.texture==null){if(!t.packedInputs&&De(_.shape)<=le().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=_.shape)}else if(!!b.isPacked!=!!t.packedInputs)_=b.isPacked?s.unpackTensor(_):s.packTensor(_),h.push(_),b=s.texData.get(_.dataId);else if(b.isPacked&&!Ev(b.shape,_.shape)){var C=_,k=_.shape;_.shape=b.shape,_=s.packedReshape(_,k),h.push(_),b=s.texData.get(_.dataId),C.shape=k}return s.uploadToGPU(_.dataId),{shape:_.shape,texData:b,isUniform:!1}});this.uploadToGPU(u.dataId);var f,p={shape:u.shape,texData:l,isUniform:!1},m=function(_,b,C){var k="";b.concat(C).forEach(function(I){var R=I.texData!=null&&I.texData.slice!=null&&I.texData.slice.flatOffset>0,N=I.isUniform?"uniform":I.texData.texShape;k+=I.shape+"_"+N+"_"+R});var T=_.userCode,E=_.constructor.name;return E+="_"+k+"_"+T}(t,d,p),g=this.getAndSaveBinary(m,function(){return function(_,b,C,k){var T=b.userCode,E=C.map(function($,K){var j={logicalShape:$.shape,texShape:$.isUniform?null:$.texData.texShape,isUniform:$.isUniform,isPacked:!$.isUniform&&$.texData.isPacked,flatOffset:null};return $.texData!=null&&$.texData.slice!=null&&$.texData.slice.flatOffset>0&&(j.flatOffset=$.texData.slice.flatOffset),{name:b.variableNames[K],shapeInfo:j}}),I=E.map(function($){return $.shapeInfo}),R={logicalShape:k.shape,texShape:k.texData.texShape,isUniform:!1,isPacked:k.texData.isPacked,flatOffset:null},N=qoe(E,R,T,b.packedInputs),O=_.createProgram(N),M=null,q=_.getUniformLocation(O,"NAN",!1);le().getNumber("WEBGL_VERSION")===1&&(M=_.getUniformLocation(O,"INFINITY",!1));for(var J={},ee=0;ee<b.variableNames.length;ee++){var Q=b.variableNames[ee];J[Q]=_.getUniformLocation(O,Q,!1),J["offset"+Q]=_.getUniformLocation(O,"offset"+Q,!1)}return{program:b,source:N,webGLProgram:O,uniformLocations:J,inShapeInfos:I,outShapeInfo:R,infLoc:M,nanLoc:q}}(s.gpgpu,t,d,p)}),y=this.activeTimers!=null;if(y&&(f=this.startTimer()),function(_,b,C,k,T){DR(b.inShapeInfos,C),DR([b.outShapeInfo],[k]);var E=k.texData.texture,I=k.texData.texShape;k.texData.isPacked?_.setOutputPackedMatrixTexture(E,I[0],I[1]):_.setOutputMatrixTexture(E,I[0],I[1]),_.setProgram(b.webGLProgram),le().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&_.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&_.gl.uniform1f(b.nanLoc,NaN),C.forEach(function(R,N){var O=b.program.variableNames[N],M=b.uniformLocations[O],q=b.uniformLocations["offset"+O];if(M!=null)if(R.isUniform)if(De(R.shape)<2)_.gl.uniform1f(M,R.uniformValues[0]);else{var J=R.uniformValues;J instanceof Float32Array||(J=new Float32Array(J)),_.gl.uniform1fv(M,J)}else R.texData.slice!=null&&q!=null&&_.gl.uniform1i(q,R.texData.slice.flatOffset),_.setInputMatrixTexture(R.texData.texture,M,N)}),T!=null&&T(_,b.webGLProgram),_.executeProgram()}(this.gpgpu,g,d,p,o),h.forEach(function(_){return s.disposeData(_.dataId)}),y&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!le().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},e.prototype.compileAndRun=function(t,r,i,o,a){a===void 0&&(a=!1),i=i||r[0].dtype;var s=this.runWebGLProgram(t,r,i,o,a);return X.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(le().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ot(function(){if(!le().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=le().getBool("DEBUG");le().set("DEBUG",!1);var i=t.abs(Le(1e-8)).dataSync()[0];if(le().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var h,d=this.activeTimers!=null;d&&(h=Xo());var f=i.texShape;if(f==null&&(f=xie(o,c),i.texShape=f),s!=null){var p=ox(o),m=void 0,g=f[1],y=f[0],x=s instanceof Uint8Array;c?(g=(r=sm(f[0],f[1]))[0],y=r[1],m=new Rae(p,[y,g],x)):m=new Sae(p,[y,g],x);var _=this.makeTensorInfo([y,g],a);this.texData.get(_.dataId).usage=x?_i.PIXELS:_i.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(_.dataId),g,y,s);var b=this.runWebGLProgram(m,[_],a,null,!0),C=this.texData.get(b.dataId);i.texture=C.texture,i.texShape=C.texShape,i.isPacked=C.isPacked,i.usage=C.usage,this.disposeData(_.dataId),this.texData.delete(b.dataId),i.values=null,d&&(this.uploadWaitMs+=Xo()-h)}else{var k=this.acquireTexture(f,l,a,c);i.texture=k}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)}(r,o)),i.values},e.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*KM(r)},e}(IF);nF()&&X.registerBackend("webgl",function(){return new Lse},2);function vc(n,e){return n(e={exports:{}},e.exports),e.exports}var Bse=vc(function(n){(function(e,t,r){function i(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var d=0;d<h.length;d++){var f=.02519603282416938*(u+=h.charCodeAt(d));f-=u=f>>>0,u=(f*=u)>>>0,u+=4294967296*(f-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new i(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.alea=a})(0,n)}),Vse=vc(function(n){(function(e,t,r){function i(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor128=a})(0,n)}),Use=vc(function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorwow=a})(0,n)}),Wse=vc(function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.x,d=u.i;return l=h[d],c=(l^=l>>>7)^l<<24,c^=(l=h[d+1&7])^l>>>10,c^=(l=h[d+3&7])^l>>>3,c^=(l=h[d+4&7])^l<<7,l=h[d+7&7],c^=(l^=l<<13)^l<<9,h[d]=c,u.i=d+1&7,c},function(l,c){var h,d=[];if(c===(0|c))d[0]=c;else for(c=""+c,h=0;h<c.length;++h)d[7&h]=d[7&h]<<15^c.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorshift7=a})(0,n)}),jse=vc(function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.w,d=u.X,f=u.i;return u.w=h=h+1640531527|0,c=d[f+34&127],l=d[f=f+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=d[f]=c^l,u.i=f,c+(h^h>>>16)|0},function(l,c){var h,d,f,p,m,g=[],y=128;for(c===(0|c)?(d=c,c=null):(c+="\0",d=0,y=Math.max(y,c.length)),f=0,p=-32;p<y;++p)c&&(d^=c.charCodeAt((p+32)%c.length)),p===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(m=m+1640531527|0,f=(h=g[127&p]^=d+m)==0?f+1:0);for(f>=128&&(g[127&(c&&c.length||0)]=-1),f=127,p=512;p>0;--p)d=g[f+34&127],h=g[f=f+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[f]=d^h;l.w=m,l.X=g,l.i=f}(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor4096=a})(0,n)}),zse=vc(function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.b,d=u.c,f=u.d,p=u.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-f|0,u.d=f<<16^d>>>16^p,u.a=p-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.tychei=a})(0,n)}),wl=vc(function(n){(function(e,t){var r,i=this,o=256,a=6,s="random",u=t.pow(o,a),l=t.pow(2,52),c=2*l,h=o-1;function d(y,x,_){var b=[],C=m(function E(I,R){var N,O=[],M=typeof I;if(R&&M=="object")for(N in I)try{O.push(E(I[N],R-1))}catch{}return O.length?O:M=="string"?I:I+"\0"}((x=x==1?{entropy:!0}:x||{}).entropy?[y,g(e)]:y??function(){try{var E;return r&&(E=r.randomBytes)?E=E(o):(E=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(E)),g(E)}catch{var I=i.navigator,R=I&&I.plugins;return[+new Date,i,R,i.screen,g(e)]}}(),3),b),k=new f(b),T=function(){for(var E=k.g(a),I=u,R=0;E<l;)E=(E+R)*o,I*=o,R=k.g(1);for(;E>=c;)E/=2,I/=2,R>>>=1;return(E+R)/I};return T.int32=function(){return 0|k.g(4)},T.quick=function(){return k.g(4)/4294967296},T.double=T,m(g(k.S),e),(x.pass||_||function(E,I,R,N){return N&&(N.S&&p(N,k),E.state=function(){return p(k,{})}),R?(t[s]=E,I):E})(T,C,"global"in x?x.global:this==t,x.state)}function f(y){var x,_=y.length,b=this,C=0,k=b.i=b.j=0,T=b.S=[];for(_||(y=[_++]);C<o;)T[C]=C++;for(C=0;C<o;C++)T[C]=T[k=h&k+y[C%_]+(x=T[C])],T[k]=x;(b.g=function(E){for(var I,R=0,N=b.i,O=b.j,M=b.S;E--;)I=M[N=h&N+1],R=R*o+M[h&(M[N]=M[O=h&O+I])+(M[O]=I)];return b.i=N,b.j=O,R})(o)}function p(y,x){return x.i=y.i,x.j=y.j,x.S=y.S.slice(),x}function m(y,x){for(var _,b=y+"",C=0;C<b.length;)x[h&C]=h&(_^=19*x[h&C])+b.charCodeAt(C++);return g(x)}function g(y){return String.fromCharCode.apply(0,y)}if(t["seed"+s]=d,m(t.random(),e),n.exports){n.exports=d;try{r=require("crypto")}catch{}}})([],Math)});wl.alea=Bse,wl.xor128=Vse,wl.xorwow=Use,wl.xorshift7=Wse,wl.xor4096=jse,wl.tychei=zse;var b0=wl.alea,$se=G({addN_:function(n){U(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),U(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return V(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!ir(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return X.runKernelFunc(function(i,o){return i.addN(e)},r,null,"AddN")}});function E0(){rF("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function HF(n){return n.rank===0||n.rank===1?n.as4D(1,1,1,n.size):n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function GF(n,e,t,r,i,o){o==null&&(o=.001);var a,s,u=V(n,"x","batchNorm"),l=V(e,"mean","batchNorm"),c=V(t,"variance","batchNorm");i!=null&&(a=V(i,"scale","batchNorm")),r!=null&&(s=V(r,"offset","batchNorm")),U(l.rank===c.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),U(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),U(a==null||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var h={x:u,scale:a,offset:s,mean:l,variance:c},d={varianceEpsilon:o};return X.runKernelFunc(function(f,p){var m=HF(u),g=f.batchNormalization(m,Rv(l),Rv(c),o,Rv(a),Rv(s));return p([u,l,c,a]),g},h,null,"FusedBatchNorm",d).reshape(u.shape)}function Rv(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}var Hse=G({batchNormalization_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),E0(),GF(n,e,t,o,i,r)}}),lm=G({batchNorm_:GF});function qF(n,e,t,r,i,o){var a,s,u=V(n,"x","batchNorm"),l=V(e,"mean","batchNorm"),c=V(t,"variance","batchNorm");return i!=null&&(a=V(i,"scale","batchNorm")),r!=null&&(s=V(r,"offset","batchNorm")),U(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),U(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),U(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&U(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&U(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),lm(u,l,c,s,a,o)}var Gse=G({batchNormalization2d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),E0(),qF(n,e,t,o,i,r)}}),qse=G({batchNorm2d_:qF});function KF(n,e,t,r,i,o){var a,s,u=V(n,"x","batchNorm"),l=V(e,"mean","batchNorm"),c=V(t,"variance","batchNorm");return i!=null&&(a=V(i,"scale","batchNorm")),r!=null&&(s=V(r,"offset","batchNorm")),U(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),U(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),U(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&U(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&U(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),lm(u,l,c,s,a,o)}var Kse=G({batchNormalization3d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),E0(),KF(n,e,t,o,i,r)}}),Xse=G({batchNorm3d_:KF});function XF(n,e,t,r,i,o){var a,s,u=V(n,"x","batchNorm"),l=V(e,"mean","batchNorm"),c=V(t,"variance","batchNorm");return i!=null&&(a=V(i,"scale","batchNorm")),r!=null&&(s=V(r,"offset","batchNorm")),U(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),U(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),U(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&U(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&U(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),lm(u,l,c,s,a,o)}var Qse=G({batchNormalization4d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),E0(),XF(n,e,t,o,i,r)}}),Yse=G({batchNorm4d_:XF}),QF=G({broadcastTo_:function(n,e){var t=V(n,"broadcastTo","x"),r=t.shape;if(e.some(function(h){return!(h>0)||h%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=t.shape,a=Array.from(e),s=e.length-1;s>=0;s--)if(o[s]===e[s])a[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=a.map(function(h,d){return h>1?d:-1}).filter(function(h){return h>=0});if(u.length===0)return t.clone();var l={x:t},c={shape:e,inputShape:o};return X.runKernelFunc(function(h){return h.tile(t,a)},l,function(h){return{x:function(){return h.sum(u,!0)}}},fF,c)}}),Jse=G({clone_:function(n){var e=V(n,"x","clone",null);return X.runKernelFunc(function(){return X.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{x:e},null,mF)}}),C0=G({logicalAnd_:function(n,e){var t=V(n,"a","logicalAnd","bool"),r=V(e,"b","logicalAnd","bool");return pt(t.shape,r.shape),X.runKernelFunc(function(i){return i.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),Zse=G({logicalNot_:function(n){var e=V(n,"x","logicalNot","bool");return X.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),YF=G({logicalOr_:function(n,e){var t=V(n,"a","logicalOr","bool"),r=V(e,"b","logicalOr","bool");return pt(t.shape,r.shape),X.runKernelFunc(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),eue=G({logicalXor_:function(n,e){var t=V(n,"a","logicalXor","bool"),r=V(e,"b","logicalXor","bool");return pt(t.shape,r.shape),YF(n,e).logicalAnd(C0(n,e).logicalNot())}}),Zl=G({where_:function(n,e,t){var r=V(e,"a","where"),i=V(t,"b","where"),o=V(n,"condition","where","bool");return Lt(r.shape,i.shape,"Error in where: "),o.rank===1?U(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Lt(o.shape,i.shape,"Error in where: "),X.runKernelFunc(function(a,s){var u=a.select(o,r,i);return s([o]),u},{$condition:o,$a:r,$b:i},function(a,s){var u=s[0];return{$condition:function(){return Ct(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),JF=function(n){return Pe(this,void 0,void 0,function(){var e,t,r;return Oe(this,function(i){switch(i.label){case 0:return[4,(e=V(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=t2(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},ZF=G({divNoNan_:function(n,e){var t,r=V(n,"a","div"),i=V(e,"b","div");r=(t=fn(r,i))[0],i=t[1];var o=Ou(r,i),a=Ct(o),s=i.equal(a);return Zl(s,a,o)}}),kh=G({tile_:function(n,e){var t=V(n,"x","tile",null);U(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var r=[t],i={x:t},o={reps:e};return X.runKernelFunc(function(a,s){var u=a.tile(t,e);return s([t]),u},i,null,vF,o,r)}}),e4=G({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=et([n,e],r),o=n<=e?n:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(n,e);if(t==null)return s;if(t.length===1)return kh(Gs(s,0),[t[0],1,1]);if(t.length===2)return kh(Gs(Gs(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return kh(Gs(Gs(Gs(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),tue=G({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=V(n,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=X.runKernelFunc(function(l){return l.multinomial(s,r,e,t)},{logits2D:s});return a===1?u.as1D():u}}),Ey=G({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=V(n,"indices","oneHot","int32"),o=i.shape.concat([e]),a={indices:i=i.flatten()},s={depth:e,onValue:t,offValue:r};return X.runKernelFunc(function(u,l){return l([i]),u.oneHot(i,e,t,r)},a,null,pF,s).reshape(o)}}),ys=G({pad_:function(n,e,t){t===void 0&&(t=0);var r=V(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t},o={x:r};return X.runKernelFunc(function(a,s){return s([r]),a.pad(r,e,t)},o,null,gF,i)}}),nue=G({pad1d_:function(n,e,t){return t===void 0&&(t=0),U(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ys(n,[e],t)}}),rue=G({pad2d_:function(n,e,t){return t===void 0&&(t=0),U(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ys(n,e,t)}}),iue=G({pad3d_:function(n,e,t){return t===void 0&&(t=0),U(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ys(n,e,t)}}),oue=G({pad4d_:function(n,e,t){return t===void 0&&(t=0),U(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ys(n,e,t)}}),aue=G({rand_:function(n,e,t){var r=De(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return X.makeTensor(i,n,t)}}),o2=function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=b0(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),sue=function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=b0(o.toString()),this.randn=new o2(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),uue=function(){function n(e,t,r,i){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=b0(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}(),lue=G({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new sue(e,t,r,i),a=et(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),cue=G({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new o2(e,t,r,!1,i),a=et(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),t4=G({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=et(n,r),a=new uue(e,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),n4=G({square_:function(n){var e=V(n,"x","square"),t=[e];return X.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},t,[])}}),r4=G({squaredDifference_:function(n,e){var t,r=V(n,"a","squaredDifference"),i=V(e,"b","squaredDifference");t=fn(r,i),r=t[0],i=t[1],pt(r.shape,i.shape);var o={a:r,b:i},a=[r,i];return X.runKernelFunc(function(s,u){var l=s.squaredDifference(r,i);return u([r,i]),l},o,function(s,u){var l=u[0],c=u[1],h=Le(2);return{a:function(){return s.mul(l.sub(c).mul(h))},b:function(){return s.mul(c.sub(l).mul(h))}}},x0,{},a,[])}}),hue=G({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var o=new o2(e,t,r,!0,i),a=et(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),i4=G({equal_:function(n,e){var t,r=V(n,"a","equal"),i=V(e,"b","equal");return t=fn(r,i),r=t[0],i=t[1],pt(r.shape,i.shape),X.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),due=G({equalStrict_:function(n,e){var t=V(n,"a","equalStrict"),r=V(e,"b","equalStrict");return Lt(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),fue=G({greater_:function(n,e){var t,r=V(n,"a","greater"),i=V(e,"b","greater");return t=fn(r,i),r=t[0],i=t[1],pt(r.shape,i.shape),X.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),o4=G({greaterEqual_:function(n,e){var t,r=V(n,"a","greaterEqual"),i=V(e,"b","greaterEqual");return t=fn(r,i),r=t[0],i=t[1],pt(r.shape,i.shape),X.runKernelFunc(function(o,a){var s=o.greaterEqual(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return Ct(s)},b:function(){return Ct(u)}}},"GreaterEqual")}}),pue=G({greaterEqualStrict_:function(n,e){var t=V(n,"a","greaterEqualStrict"),r=V(e,"b","greaterEqualStrict");return Lt(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),mue=G({greaterStrict_:function(n,e){var t=V(n,"a","greaterStrict"),r=V(e,"b","greaterStrict");return Lt(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),vue=G({less_:function(n,e){var t,r=V(n,"a","less"),i=V(e,"b","less");return t=fn(r,i),r=t[0],i=t[1],pt(r.shape,i.shape),X.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),gue=G({lessEqual_:function(n,e){var t,r=V(n,"a","lessEqual"),i=V(e,"b","lessEqual");return t=fn(r,i),r=t[0],i=t[1],pt(r.shape,i.shape),X.runKernelFunc(function(o,a){var s=o.lessEqual(r,i);return a([r,i]),s},{a:r,b:i},null,"LessEqual")}}),yue=G({lessEqualStrict_:function(n,e){var t=V(n,"a","lessEqualStrict"),r=V(e,"b","lessEqualStrict");return Lt(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),xue=G({lessStrict_:function(n,e){var t=V(n,"a","lessStrict"),r=V(e,"b","lessStrict");return Lt(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),wue=G({notEqual_:function(n,e){var t,r=V(n,"a","notEqual"),i=V(e,"b","notEqual");return t=fn(r,i),r=t[0],i=t[1],pt(r.shape,i.shape),X.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),_ue=G({notEqualStrict_:function(n,e){var t=V(n,"a","notEqualStrict"),r=V(e,"b","notEqualStrict");return Lt(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function jR(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function zR(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var a2=G({gather_:function(n,e,t){t===void 0&&(t=0);var r=V(n,"x","gather"),i=V(e,"indices","gather","int32");t=Qn(t,r.shape)[0];var o=function(a,s,u){for(var l=a.shape[u],c=[],h=1,d=1,f=0;f<u;f++)c.push(a.shape[f]),h*=a.shape[f];for(f=0;f<s.rank;f++)c.push(s.shape[f]);for(f=u+1;f<a.rank;f++)c.push(a.shape[f]),d*=a.shape[f];return{batchSize:h,sliceSize:d,dimSize:l,outputShape:c}}(r,i,t);return X.runKernelFunc(function(a,s){var u=a.gather(r,i.flatten(),t);return s([i]),u},{x:r,indices:i},function(a,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,h=l.slice(0,t),d=h.length,f=l.slice(t,l.length).slice(1),p=f.length,m=jR(0,d),g=jR(d+1,d+1+p),y=zR([h,[c],f]),x=a.reshape(y),_=u.reshape([c]),b=zR([[d],m,g]),C=x.transpose(b),k=a4(C,_,r.shape[t]),T=qE(b);return k=k.transpose(T)},indices:function(){return u}}},"Gather",{axis:t}).reshape(o.outputShape)}}),a4=G({unsortedSegmentSum_:function(n,e,t){var r=V(n,"x","unsortedSegmentSum"),i=V(e,"segmentIds","unsortedSegmentSum","int32");return U(An(t),function(){return"numSegments must be of dtype int"}),X.runKernelFunc(function(o,a){var s=o.unsortedSegmentSum(r,i,t);return a([i]),s},{$x:r},function(o,a){var s=a[0];return{$x:function(){return function(u,l){for(var c=QE(l,Ct(l)),h=a2(u,c),d=o4(l,Le(0,"int32")),f=h.rank-d.rank,p=0;p<f;++p)d=Gs(d,p+1);d=C0(d,Sd(h.shape,"bool"));var m=Ct(h);return Zl(d,h,m)}(o,s)}}})}}),bue=function(n,e,t){return Pe(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h,d,f,p,m;return Oe(this,function(g){switch(g.label){case 0:for(r=V(n,"tensor","boolMask"),i=V(e,"mask","boolMask","bool"),o=t??0,a=i.rank,s=r.shape,U(a>0,function(){return"mask cannot be scalar"}),Lt(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+a;l++)u*=s[l];return c=s.slice(0,o).concat([u],s.slice(o+a)),h=r.reshape(c),d=i.reshape([-1]),[4,JF(d)];case 1:return f=g.sent(),p=f.squeeze([1]),m=a2(h,p,o),n!==r&&r.dispose(),e!==i&&i.dispose(),p.dispose(),h.dispose(),d.dispose(),f.dispose(),[2,m]}})})};function s4(n,e,t,r,i,o,a){o===void 0&&(o="NHWC"),U(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var s=n,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,n[0],n[1],n[2]]),U(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),U(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),U(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var c=o==="NHWC"?s[3]:s[1],h=o==="NHWC"?u.shape[3]:u.shape[1];U(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."}),U(h===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."}),a!=null&&U(An(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=JE(o),f=mc(s,t.shape,r,1,i,a,!1,d),p=X.runKernelFunc(function(m,g){var y=m.conv2dDerInput(u,t,f);return g([t,u]),y},{dy4D:u,filter:t},function(m,g){var y=g[0],x=g[1];return{dy4D:function(){return gc(m,y,r,i,o,1,a)},filter:function(){return s2(m,x,y.shape,r,i,o,a)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function dx(n){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function u4(n,e,t,r,i){U(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var o=n,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],l=a.shape[4];U(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),U(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),U(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),U(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),U(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."});var c=_y(o,t.shape,r,1,i),h=X.runKernelFunc(function(d){return d.conv3dDerInput(a,t,c)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Eue=G({conv1d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=V(n,"x","conv1d"),u=V(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),U(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),U(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&U(An(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),U(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),U(Hr(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),U(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=gc(d,h,[1,t],r,"NHWC",[1,o],a);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),gc=G({conv2d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=V(n,"x","conv2d"),u=V(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),U(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),U(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&U(An(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=i==="NHWC"?l.shape[3]:l.shape[1];U(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),U(Hr(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var d=JE(i),f=mc(l.shape,u.shape,t,o,r,a,!1,d),p=[u,l],m=X.runKernelFunc(function(g,y){var x=g.conv2d(l,u,f);return y([u,l]),x},{x:l,filter:u},function(g,y){var x=y,_=x[0],b=x[1];return U(ud(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return l4(b.shape,g,_,t,r,i)},filter:function(){return s2(b,g,_.shape,t,r,i)}}},"Conv2D",f,p);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Cue=G({conv3d_:function(n,e,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=V(n,"x","conv3d"),s=V(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),U(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),U(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),U(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),U(function(d,f){return dx(d)||dx(f)}(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),U(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=_y(u.shape,s.shape,t,o,r),h=X.runKernelFunc(function(d,f){var p=d.conv3d(u,s,c);return f([u,s]),p},{x:u,$filter:s},function(d,f){U(dx(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=f[0],m=f[1];return{x:function(){return u4(p.shape,d,m,t,r)},$filter:function(){return function(g,y,x,_,b){var C=g;g.rank===4&&(C=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var k=y;k.rank===4&&(k=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),U(C.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+C.shape+"."}),U(k.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+k.shape+"."}),U(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),U(C.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+C.shape[4]+") must match input depth in filter ("+x[3]+"."}),U(k.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+k.shape[4]+") must match output depth for filter ("+x[4]+")."});var T=_y(C.shape,x,_,1,b);return X.runKernelFunc(function(E){return E.conv3dDerFilter(C,k,T)},{x5D:C,dy5D:k})}(p,d,m.shape,t,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),s2=G({conv2dDerFilter_:function(n,e,t,r,i,o,a){o===void 0&&(o="NHWC");var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),U(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),U(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),U(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var l=o==="NHWC"?s.shape[3]:s.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];U(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+t[2]+"."}),U(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."}),a!=null&&U(An(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=JE(o),d=mc(s.shape,t,r,1,i,a,!1,h);return X.runKernelFunc(function(f){return f.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),l4=G({conv2dDerInput_:s4}),u2=G({depthwiseConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]);var s=V(n,"x","depthwiseConv2d"),u=V(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),U(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),U(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),U(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),U(Hr(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),a!=null&&U(An(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=mc(l.shape,u.shape,t,o,r,a,!0),d=[l,u],f=X.runKernelFunc(function(p,m){var g=p.depthwiseConv2D(l,u,h);return m([l,u]),g},{x:l,filter:u},function(p,m){U(ud(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var g=m[0],y=m[1];return{x:function(){return c4(g.shape,p,y,h)},filter:function(){return h4(g,p,y.shape,h)}}},"DepthwiseConv2dNative",h,d);return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),c4=G({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=X.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),h4=G({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),X.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),d4=G({separableConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=V(n,"x","separableConv2d"),u=V(e,"depthwiseFilter","separableConv2d"),l=V(t,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");U(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),U(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),U(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),U(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),U(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],f=u.shape[3];U(l.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+l.shape[2]+"."});var p=u2(c,u,r,i,a,o),m=gc(p,l,1,"valid",a);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Tue=G({conv2dTranspose_:function(n,e,t,r,i,o){return s4(t,V(n,"x","conv2dTranspose"),V(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),Iue=G({conv3dTranspose_:function(n,e,t,r,i){return u4(t,V(n,"x","conv3dTranspose"),V(e,"filter","conv3dTranspose"),r,i)}}),f4=G({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=V(n,"a","matMul"),a=V(e,"b","matMul");i=fn(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),d=a.shape.slice(0,-2),f=De(h),p=De(d);U(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),U(ir(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),U(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var m=o.shape.slice(0,-2).concat([l,c]),g=t?o.as3D(f,s,l):o.as3D(f,l,s),y=r?a.as3D(p,c,u):a.as3D(p,u,c),x={transposeA:t,transposeB:r};return X.runKernelFunc(function(_,b){var C=_.batchMatMul(g,y,t,r);return b([g,y]),C},{a:g,b:y},function(_,b){var C=b,k=C[0],T=C[1];return t||r?!t&&r?{a:function(){return _.matMul(T,!1,!1)},b:function(){return _.matMul(k,!0,!1)}}:t&&!r?{a:function(){return T.matMul(_,!1,!0)},b:function(){return k.matMul(_,!1,!1)}}:{a:function(){return T.matMul(_,!0,!0)},b:function(){return _.matMul(k,!0,!0)}}:{a:function(){return _.matMul(T,!1,!0)},b:function(){return k.matMul(_,!0,!1)}}},"BatchMatMul",x).reshape(m)}}),Sue=G({dot_:function(n,e){var t=V(n,"t1","dot"),r=V(e,"t2","dot");U(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return U(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Rue=G({outerProduct_:function(n,e){var t=V(n,"v1","outerProduct"),r=V(e,"v2","outerProduct");return U(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),cm=G({reverse_:function(n,e){var t=V(n,"x","reverse");if(t.rank===0)return t.clone();var r=Qn(e,t.shape);return X.runKernelFunc(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),kue=G({reverse1d_:function(n){var e=V(n,"x","reverse");return U(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),cm(e,0)}}),Aue=G({reverse2d_:function(n,e){var t=V(n,"x","reverse");return U(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),cm(t,e)}}),Nue=G({reverse3d_:function(n,e){var t=V(n,"x","reverse");return U(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),cm(t,e)}}),Due=G({reverse4d_:function(n,e){var t=V(n,"x","reverse");return U(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),cm(t,e)}});function p4(n,e,t,r,i,o){var a=V(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),U(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),U(Hr(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),o!=null&&U(An(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Jl(s.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&ir(l.inShape,l.outShape))return a.clone();var c=[s],h=X.runKernelFunc(function(d,f){var p=d.maxPool(s,l);return f([s,p]),p},{x:s},function(d,f){var p=f[0],m=f[1];return{x:function(){return function(g,y,x,_,b,C,k,T){var E=V(g,"dy","maxPoolBackprop"),I=V(y,"input","maxPoolBackprop"),R=V(x,"output","maxPoolBackprop");U(I.rank===E.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+E.rank+")"}),U(Hr(b,C),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+C+"'"}),U(E.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),U(I.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."});var N=Jl(I.shape,_,b,C,k,T);return X.runKernelFunc(function(O){return O.maxPoolBackprop(E,I,R,N)},{$dy:E,$input:I})}(d,p,m,e,t,r,i)}}},"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function m4(n,e,t,r,i,o){var a=V(n,"x","avgPool","float32");U(Hr(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),U(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&U(An(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Jl(s.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&ir(l.inShape,l.outShape))return a.clone();var c=X.runKernelFunc(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return function(d,f,p,m,g,y){var x=V(d,"dy","avgPoolBackprop"),_=V(f,"input","avgPoolBackprop");U(_.rank===x.rank,function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+x.rank+")"}),U(Hr(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var b=_,C=x,k=!1;_.rank===3&&(k=!0,b=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]),C=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),U(C.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),U(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var T=Jl(b.shape,p,m,g,y),E=X.runKernelFunc(function(I){return I.avgPoolBackprop(C,b,T)},{dy4D:C,input4D:b});return k?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}(h,s,e,t,r,i)}}},"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var di=G({maxPool_:function(n,e,t,r,i){return p4(n,e,t,1,r,i)}}),Pue=G({avgPool_:function(n,e,t,r,i){return m4(n,e,t,1,r,i)}}),Oue=G({pool_:function(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var a=V(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),U(Hr(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=Jl(s.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(b,C){var k=b.map(function(I,R){return I+(I-1)*(C[R]-1)}).map(function(I){return I-1}),T=k.map(function(I){return Math.floor(I/2)}),E=k.map(function(I,R){return I-T[R]});return k.map(function(I,R){return[T[R],E[R]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,f=function(b,C,k){var T=k.map(function(q){return q[0]}),E=k.map(function(q){return q[1]}),I=b.concat(T,E),R=C.map(function(q,J){return(q-I[J]%q)%q}),N=E.map(function(q,J){return q+R[J]}),O=C.map(function(q,J){return[T[J],N[J]]}),M=C.map(function(q,J){return[0,R[J]]});return[O,M]}([c.inHeight,c.inWidth],h,l),p=f[0],m=f[1],g=d?r:"valid",y=d?s:uF(s,h,p),x=(t==="avg"?function(){return m4(y,e,o,1,g)}:function(){return p4(y,e,o,1,g)})(),_=d?x:sF(x,h,m);return u?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),Mue=G({maxPool3d_:function(n,e,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=V(n,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),U(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),U(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),U(Hr(t,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&U(An(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=wy(u.shape,e,t,a,r,i,o),h=X.runKernelFunc(function(d,f){var p=d.maxPool3d(u,c);return f([u,p]),p},{x:u},function(d,f){var p=f[0],m=f[1];return{x:function(){return function(g,y,x,_,b,C,k,T){var E=V(g,"dy","maxPool3dBackprop"),I=V(y,"input","maxPool3dBackprop"),R=V(x,"output","maxPool3dBackprop"),N=E,O=I,M=R,q=!1;I.rank===4&&(q=!0,N=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),O=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),M=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3])),U(N.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),U(O.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+O.rank+"."}),U(M.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+M.rank+"."}),C==null&&(C=[1,1,1]),U(Hr(b,C),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+C+"'"}),T!=null&&U(An(k),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+k+"."});var J=wy(O.shape,_,b,C,k,T),ee=X.runKernelFunc(function(Q){return Q.maxPool3dBackprop(N,O,M,J)},{dy5D:N,input5D:O});return q?ee.as4D(ee.shape[1],ee.shape[2],ee.shape[3],ee.shape[4]):ee}(d,p,m,e,t,a,r,i)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Fue=G({avgPool3d_:function(n,e,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=V(n,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),U(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),U(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),U(Hr(t,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&U(An(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=wy(u.shape,e,t,a,r,i,o),h=X.runKernelFunc(function(d){return d.avgPool3d(u,c)},{x:u},function(d){return{x:function(){return function(f,p,m,g,y,x,_){var b=V(f,"dy","avgPool3dBackprop"),C=V(p,"input","avgPool3dBackprop"),k=b,T=C,E=!1;C.rank===4&&(E=!0,k=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),T=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3])),U(k.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+k.rank+"."}),U(T.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),y==null&&(y=[1,1,1]),U(Hr(g,y),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+y+"'"}),_!=null&&U(An(x),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+x+"."});var I=wy(T.shape,m,g,y,x,_),R=X.runKernelFunc(function(N){return N.avgPool3dBackprop(k,T,I)},{dy5D:k,input5D:T});return E?R.as4D(R.shape[1],R.shape[2],R.shape[3],R.shape[4]):R}(d,u,e,t,a,r,i)}}});return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Lue=G({maxPoolWithArgmax_:function(n,e,t,r,i){i===void 0&&(i=!1);var o=V(n,"x","maxPoolWithArgmax"),a={filterSize:e,strides:t,pad:r,includeBatchInIndex:i},s=X.runKernel("MaxPoolWithArgmax",{x:o},a);return{result:s[0],indexes:s[1]}}}),Mu=G({slice_:function(n,e,t){var r,i,o=V(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){U(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(u,l){return u>=0?u:(U(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),o.shape[l]-r[l])}),Poe(o,r,i);var a=o.shape,s={begin:r,size:i};return X.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],a[c]-r[c]-i[c]]);return{x:function(){return ys(u,l)}}},"Slice",s)}}),Bue=G({slice1d_:function(n,e,t){var r=V(n,"x","slice1d");return U(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Mu(r,[e],[t])}}),Vue=G({slice2d_:function(n,e,t){var r=V(n,"x","slice2d");return U(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Mu(r,e,t)}}),Uue=G({slice3d_:function(n,e,t){var r=V(n,"x","slice3d");return U(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Mu(r,e,t)}}),Wue=G({slice4d_:function(n,e,t){var r=V(n,"x","slice4d");return U(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Mu(r,e,t)}});function v4(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(ui(e.shape,r))),n.rank<t.rank&&(n=n.reshape(ui(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}var jue=G({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","all","bool"),i=Qn(e,r.shape),o=i,a=wa(o,r.rank);a!=null&&(r=r.transpose(a),o=_a(o.length,r.rank));var s=X.runKernelFunc(function(l){return l.all(r,o)},{$x:r});if(t){var u=ui(s.shape,i);return s.reshape(u)}return s}}),zue=G({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","any","bool"),i=Qn(e,r.shape),o=i,a=wa(o,r.rank);a!=null&&(r=r.transpose(a),o=_a(o.length,r.rank));var s=X.runKernelFunc(function(l){return l.any(r,o)},{$x:r});if(t){var u=ui(s.shape,i);return s.reshape(u)}return s}}),$ue=G({argMax_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","argMax");e==null&&(e=0);var r=Qn(e,t.shape),i=wa(r,t.rank);i!=null&&(t=t.transpose(i),r=_a(r.length,t.rank));var o={axis:r[0]},a=[t];return X.runKernelFunc(function(s,u){var l=s.argMax(t,r[0]);return u([t]),l},{x:t},function(s,u){var l=u[0];return{x:function(){return Ct(l)}}},"ArgMax",o,a)}}),Hue=G({argMin_:function(n,e){e===void 0&&(e=0);var t=V(n,"x","argMin");e==null&&(e=0);var r=Qn(e,t.shape),i=wa(r,t.rank);return i!=null&&(t=t.transpose(i),r=_a(r.length,t.rank)),X.runKernelFunc(function(o,a){var s=o.argMin(t,r[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return Ct(s)}}})}}),Gue=G({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","logSumExp"),i=Qn(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=ui(s.shape,i);return s.reshape(u)}return s}}),que=G({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","max"),i=r,o=Qn(e,r.shape),a=o,s=wa(a,r.rank);s!=null&&(r=r.transpose(s),a=_a(a.length,r.rank));var u=[r],l=X.runKernelFunc(function(h,d){var f=h.max(r,a);return d([i,f]),f},{x:r},function(h,d){return v4(h,d[1],d[0],o,s)},"Max",{axes:a},u,[!0]);if(t){var c=ui(l.shape,o);l=l.reshape(c)}return l}}),Kue=G({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","mean"),i=Qn(e,r.shape),o=De(Sr(r.shape,i)[1]);return w0(function(a){var s=Le(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var l=a.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Sd(a.shape,"float32")).div(o)}}})(r)}}),Xue=G({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","min"),i=r,o=Qn(e,r.shape),a=o,s=wa(a,r.rank);s!=null&&(r=r.transpose(s),a=_a(a.length,r.rank));var u=[r],l=X.runKernelFunc(function(h,d){var f=h.min(r,a);return d([i,f]),f},{x:r},function(h,d){return v4(h,d[1],d[0],o,s)},"Min",{axes:a},u,[!0]);if(t){var c=ui(l.shape,o);l=l.reshape(c)}return l}}),Que=G({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Qn(e,(n=V(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=ui(i.shape,r));var a=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,t)}}}),qs=G({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Qn(e,r.shape);return w0(function(o){var a=wa(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=_a(s.length,o.rank));var l=function(f){var p=o.shape.slice();return i.forEach(function(m){p[m]=1}),f.reshape(p).mul(Sd(o.shape,"float32"))},c={axes:s},h=X.runKernelFunc(function(f){return f.sum(u,s)},{x:u},function(f){return{x:function(){return l(f)}}},"Sum",c);if(t){var d=ui(h.shape,i);h=h.reshape(d)}return{value:h,gradFunc:l}})(r)}}),Yue=G({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=V(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Qn(e,r.shape),o=wa(i,r.rank),a=i,s=r;o!=null&&(s=r.transpose(o),a=_a(a.length,r.rank));var u=X.runKernelFunc(function(c){return c.prod(s,a)},{permutedX:s});if(t){var l=ui(u.shape,i);u=u.reshape(l)}return u}}),g4=G({elu_:function(n){var e=V(n,"x","elu");return X.runKernelFunc(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return X.runKernelFunc(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),Jue=G({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=V(n,"x","leakyRelu");return QE(Le(e).mul(t),t)}}),y4=G({prelu_:function(n,e){var t=V(n,"x","prelu"),r=V(e,"alpha","prelu");return X.runKernelFunc(function(i,o){var a=i.prelu(t,r);return o([t,r]),a},{x:t,alpha:r},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{x:function(){return Zl(u,i,i.mul(s))},alpha:function(){var l=Zl(u,Ct(i),i.mul(a)),c=$n(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),T0=G({relu_:function(n){var e=V(n,"x","relu");return e.dtype==="bool"?e.toInt():X.runKernelFunc(function(t,r){var i=t.relu(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),x4=G({relu6_:function(n){var e=V(n,"x","relu6");return e.dtype==="bool"?e.toInt():X.runKernelFunc(function(t,r){var i=t.relu6(e);return r([e]),i},{x:e},function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),Zue=G({selu_:function(n){var e=V(n,"x","selu");return X.runKernelFunc(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(Le(0)),a=Le(r2),s=Le(i2),u=t.mul(s),l=t.mul(a).mul(i.toFloat().exp());return Zl(o,u,l)}}})}}),ele=G({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=V(n,"x","localResponseNormalization");U(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),U(An(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=X.runKernelFunc(function(l,c){var h=l.localResponseNormalization4D(a,e,t,r,i);return c([a,h]),h},{x4D:a},function(l,c){var h=c[0],d=c[1];return{x4D:function(){return X.runKernelFunc(function(f){return f.LRNGrad(l,h,d,e,t,r,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),w4=G({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(Le(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=V(n,"x","norm"),e,t),o=i.shape;if(r){var a=Qn(t,n.shape);o=ui(i.shape,a)}return i.reshape(o)}}),tle=G({basicLSTMCell_:function(n,e,t,r,i,o){var a=V(n,"forgetBias","basicLSTMCell"),s=V(e,"lstmKernel","basicLSTMCell"),u=V(t,"lstmBias","basicLSTMCell"),l=V(r,"data","basicLSTMCell"),c=V(i,"c","basicLSTMCell"),h=V(o,"h","basicLSTMCell"),d=l.concat(h,1).matMul(s).add(u),f=d.shape[0],p=d.shape[1]/4,m=[f,p],g=d.slice([0,0],m),y=d.slice([0,p],m),x=d.slice([0,2*p],m),_=d.slice([0,3*p],m),b=g.sigmoid().mulStrict(y.tanh()).addStrict(c.mulStrict(a.add(x).sigmoid())),C=b.tanh().mulStrict(_.sigmoid());return[b,C]}}),nle=G({multiRNNCell_:function(n,e,t,r){for(var i=V(e,"data","multiRNNCell"),o=fy(t,"c","multiRNNCell"),a=fy(r,"h","multiRNNCell"),s=i,u=[],l=0;l<n.length;l++){var c=n[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],d=[];for(l=0;l<u.length;l+=2)h.push(u[l]),d.push(u[l+1]);return[h,d]}}),rle=G({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var o=V(n,"v","movingAverage"),a=V(e,"x","movingAverage"),s=V(t,"decay","movingAverage");Qre(o,a),U(ir(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Le(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){U(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=V(r,"step","movingAverage");c=c.div(u.sub(yy(s,h)))}return o.add(c)}}),ile=G({stridedSlice_:function(n,e,t,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=V(n,"x","stridedSlice"),c=bR(s),h=l.shape.slice();c.forEach(function(g){e[g]=0,t[g]=1,h.splice(g,0,1)}),l=l.reshape(h);for(var d=0;d<l.rank;d++)e[d]=Ooe(i,e,r,l.shape,d),t[d]=Moe(o,t,r,l.shape,d),r[d]=r[d]||1;var f=bR(u);f.forEach(function(g){t[g]=e[g]+1,r[g]=1});var p=YE(e,t,r),m=p.filter(function(g,y){return f.indexOf(y)===-1});return r.every(function(g){return g===1})?Mu(l,e,p).reshape(m):X.runKernelFunc(function(g){return g.stridedSlice(l,e,t,r)},{$x:l}).reshape(m)}}),ole=G({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=V(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=X.runKernelFunc(function(a){return a.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}}),ale=G({scatterND_:function(n,e,t){var r=V(n,"indices","scatterND","int32"),i=V(e,"updates","scatterND");return Doe(i,r,t),X.runKernelFunc(function(o){return o.scatterND(r,i,t)},{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),l2=G({fft_:function(n){U(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return X.runKernelFunc(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),Cy=G({ifft_:function(n){U(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return X.runKernelFunc(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),c2=G({rfft_:function(n,e){U(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var o=n.shape.map(function(y){return 0}),a=n.shape.map(function(y){return y});a[n.shape.length-1]=e,t=n.slice(o,a),r=e}else if(e!=null&&e>r){var s=n.shape.map(function(y){return y});s[n.shape.length-1]=e-r,t=n.concat(wn(s),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=lr(t,u).as2D(i,r),c=l2(l),h=Math.floor(r/2)+1,d=zi(c),f=Zo(c),p=d.split([h,r-h],d.shape.length-1),m=f.split([h,r-h],f.shape.length-1),g=t.shape.slice();return g[t.shape.length-1]=h,lr(p[0],m[0]).reshape(g)}}),_4=G({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=Cy(r);return zi(i)}var o=[t,2*(e-1)],a=zi(n).as2D(t,e),s=Zo(n).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),l=s.slice([0,1],[t,e-2]).reverse(1).mul(Le(-1)),c=a.concat(u,1),h=s.concat(l,1);return r=lr(c,h).as2D(o[0],o[1]),i=Cy(r),zi(i)}}),sle=Object.freeze({fft:l2,ifft:Cy,rfft:c2,irfft:_4}),ule=G({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=V(n,"sparseIndices","sparseToDense","int32"),o=V(e,"sparseValues","sparseToDense"),a=V(r,"defaultValue","sparseToDense",o.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(l.length!==d)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+d+".");var f=u.size;if(u.rank!==0&&(u.rank!==1||f!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,a),X.runKernelFunc(function(s){return s.sparseToDense(i,o,t,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),lle=G({gatherND_:function(n,e){var t=V(e,"indices","gatherND","int32"),r=V(n,"x","gatherND");return X.runKernelFunc(function(i){return i.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),cle=G({diag_:function(n){var e=V(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return X.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),hle=G({dropout_:function(n,e,t,r){var i=V(n,"x","dropout");if(U(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),U(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return n instanceof Yt?i.clone():i;var o=function(u,l){if(l==null)return u.shape.slice();if(ir(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l}(i,t),a=1-e,s=t4(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(s)}});function b4(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var a=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(a)}return No(i,"float32")}var h2=G({hannWindow_:function(n){return b4(n,.5,.5)}}),E4=G({hammingWindow_:function(n){return b4(n,.54,.46)}}),d2=G({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=n.size;)a.push(Mu(n,o,e)),o+=t;if(r)for(;o<n.size;){var s=o+e-n.size,u=no([Mu(n,o,e-s),Fl([s],i)]);a.push(u),o+=t}return a.length===0?Ml([],[0,e]):no(a).as2D(a.length,e)}}),C4=G({stft_:function(n,e,t,r,i){var o;i===void 0&&(i=h2),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=d2(n,e,t),s=xn(a,i(e)),u=[],l=0;l<a.shape[0];l++)u.push(c2(s.slice([l,0],[1,e]),r));return no(u)}}),dle=Object.freeze({hannWindow:h2,hammingWindow:E4,frame:d2,stft:C4}),Dr,fle=function(n,e,t){return t===void 0&&(t=1),Pe(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h,d,f,p,m,g;return Oe(this,function(y){switch(y.label){case 0:return r=V(n,"predictions","inTopK"),i=V(e,"targets","inTopK"),U(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),U(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),Lt(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],U(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,r.data()];case 1:return a=y.sent(),[4,i.data()];case 2:for(s=y.sent(),u=[a.length/o,o],c=u[1],h=od("bool",l=u[0]),d=0;d<l;d++){for(f=d*c,p=a.subarray(f,f+c),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(x,_){return _.value-x.value}),h[d]=0,g=0;g<t;g++)if(m[g].index===s[d]){h[d]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,dr(h,i.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Dr||(Dr={}));var ple=G({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"labels","absoluteDifference"),o=V(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=V(t,"weights","absoluteDifference")),Lt(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return xs(s,a,r)}}),xs=G({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Dr.SUM_BY_NONZERO_WEIGHTS);var r=V(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=V(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===Dr.NONE)return o;if(t===Dr.SUM)return o.sum();if(t===Dr.MEAN){if(i==null)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(Le(a)):s}if(t===Dr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(Le(r.size));var u=i.mul(Sd(r.shape)).notEqual(Le(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),mle=G({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=Dr.SUM_BY_NONZERO_WEIGHTS);var o=V(n,"labels","cosineDistance"),a=V(e,"predictions","cosineDistance"),s=null;r!=null&&(s=V(r,"weights","cosineDistance")),Lt(o.shape,a.shape,"Error in cosineDistance: ");var u=Le(1).sub(o.mul(a).sum(t,!0));return xs(u,s,i)}}),vle=G({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"labels","hingeLoss"),o=V(e,"predictions","hingeLoss"),a=null;t!=null&&(a=V(t,"weights","hingeLoss")),Lt(i.shape,o.shape,"Error in hingeLoss: ");var s=Le(1);i=Le(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return xs(u,a,r)}}),gle=G({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Dr.SUM_BY_NONZERO_WEIGHTS);var o=V(n,"labels","huberLoss"),a=V(e,"predictions","huberLoss"),s=null;t!=null&&(s=V(t,"weights","huberLoss")),Lt(o.shape,a.shape,"Error in huberLoss: ");var u=Le(r),l=a.sub(o).abs(),c=wF(l,u),h=l.sub(c),d=Le(.5).mul(c.square()).add(u.mul(h));return xs(d,s,i)}}),yle=G({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Dr.SUM_BY_NONZERO_WEIGHTS);var o=V(n,"labels","logLoss"),a=V(e,"predictions","logLoss"),s=null;t!=null&&(s=V(t,"weights","logLoss")),Lt(o.shape,a.shape,"Error in logLoss: ");var u=Le(1),l=Le(r),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return xs(c,s,i)}}),xle=G({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var i=V(n,"labels","meanSquaredError"),o=V(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=V(t,"weights","meanSquaredError")),Lt(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return xs(s,a,r)}}),wle=G({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Dr.SUM_BY_NONZERO_WEIGHTS);var o=V(n,"multiClassLabels","sigmoidCrossEntropy"),a=V(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=V(t,"weights","sigmoidCrossEntropy")),Lt(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Le(r),l=Le(1),c=Le(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=function(d,f){var p=V(d,"labels","sigmoidCrossEntropyWithLogits"),m=V(f,"logits","sigmoidCrossEntropyWithLogits");Lt(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),y=m.mul(p),x=m.abs().neg().exp().log1p();return g.sub(y).add(x)}(o,a);return xs(h,s,i)}}),_le=G({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Dr.SUM_BY_NONZERO_WEIGHTS);var o=V(n,"onehotLabels","softmaxCrossEntropy"),a=V(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=V(t,"weights","softmaxCrossEntropy")),Lt(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Le(r),l=Le(1),c=Le(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=function(d,f,p){if(p===void 0&&(p=-1),p===-1&&(p=f.rank-1),p!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+p);return w0(function(m,g,y){var x=g.logSumExp([p],!0),_=g.toFloat().sub(x);return y([m,_]),{value:_.mul(m).neg().sum([p]),gradFunc:function(b,C){var k=C[0],T=C[1],E=ui(b.shape,[p]);return[b.reshape(E).mul(k.toFloat().sub(T.exp())),b.reshape(E).mul(T.exp().sub(k.toFloat()))]}}})(d,f)}(o,a);return xs(h,s,i)}}),ble=Object.freeze({get Reduction(){return Dr},absoluteDifference:ple,computeWeightedLoss:xs,cosineDistance:mle,hingeLoss:vle,huberLoss:gle,logLoss:yle,meanSquaredError:xle,sigmoidCrossEntropy:wle,softmaxCrossEntropy:_le});function $R(n,e){return e===void 0&&(e=!1),X.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=e4(t),o=n.clone(),a=Ml([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,l=function(h){var d,f=o,p=s,m=i;d=X.tidy(function(){var g=o.slice([h,h],[t-h,1]),y=g.norm(),x=o.slice([h,h],[1,1]),_=Ml([[-1]]).where(x.greater(0),Ml([[1]])),b=x.sub(_.mul(y)),C=g.div(b);s=C.shape[0]===1?a.clone():a.concat(C.slice([1,0],[C.shape[0]-1,C.shape[1]]),0);var k=_.matMul(b).div(y).neg(),T=o.slice([h,0],[t-h,r]),E=k.mul(s),I=s.transpose();if(h===0)o=T.sub(E.matMul(I.matMul(T)));else{var R=T.sub(E.matMul(I.matMul(T)));o=o.slice([0,0],[h,r]).concat(R,0)}var N=E.transpose(),O=i.slice([0,h],[t,i.shape[1]-h]);if(h===0)i=O.sub(O.matMul(s).matMul(N));else{var M=O.sub(O.matMul(s).matMul(N));i=i.slice([0,0],[t,h]).concat(M,1)}return[s,o,i]}),s=d[0],o=d[1],i=d[2],si([f,p,m])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var Ele=G({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=V(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],s=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),t<0&&(t=s);var u=py(0,a,1,"int32").reshape([-1,1]),l=py(0,s,1,"int32"),c=Ro(u,l),h=C0(c.lessEqual(Le(+e,"int32")),c.greaterEqual(Le(-t,"int32"))),d=wn([a,s],r.dtype);return Pu(g0(r.reshape([-1,a,s])).map(function(f){return Zl(h,f,d)})).reshape(i)}}),Cle=G({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,U(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){U(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=KE(n,n.shape[0],0).map(function(u){return lF(u,[0])});U(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],a=n,s=function(u){o.push(X.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=qs(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(w4(l,"euclidean"))}))};for(i=0;i<n.length;++i)s(i);return e?Pu(o,0):o}}),Tle=G({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return $R(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(a,s){return a*s}),r=g0(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(a){var s=$R(a,e),u=s[0],l=s[1];i.push(u),o.push(l)}),[Pu(i,0).reshape(n.shape),Pu(o,0).reshape(n.shape)]}}),Ile=Object.freeze({bandPart:Ele,gramSchmidt:Cle,qr:Tle});function I0(n,e,t,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var a=n.shape[0];return t=Math.min(t,a),U(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),U(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),U(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),U(e.rank===1,function(){return"scores must be a 1D tensor"}),U(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),U(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var Sle=G({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=V(n,"images","resizeBilinear");U(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),U(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=X.runKernelFunc(function(l,c){return c([i]),l.resizeBilinear(i,a,s,t)},{x:i},function(l,c){return{x:function(){return X.runKernelFunc(function(h){return h.resizeBilinearBackprop(l,c[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Rle=G({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=V(n,"images","resizeNearestNeighbor");U(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),U(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),U(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=X.runKernelFunc(function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return X.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),kle=G({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=V(n,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),s=I0(o,a,t,r,i);t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return X.runKernelFunc(function(l){return l.nonMaxSuppression(o,a,t,r,i)},{boxes:o,scores:a},null,"NonMaxSuppressionV3",u)}}),Ale=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Pe(this,void 0,void 0,function(){var o,a,s,u,l,c,h;return Oe(this,function(d){switch(d.label){case 0:return o=V(n,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),s=I0(o,a,t,r,i),t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=d.sent(),l=u[0],c=u[1],h=ZE(l,c,t,r,i),o!==n&&o.dispose(),a!==e&&a.dispose(),[2,h]}})})},Nle=G({nonMaxSuppressionWithScore_:function(n,e,t,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var a=V(n,"boxes","nonMaxSuppression"),s=V(e,"scores","nonMaxSuppression"),u=I0(a,s,t,r,i,o),l={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=X.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),Dle=function(n,e,t,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),Pe(this,void 0,void 0,function(){var a,s,u,l,c,h,d;return Oe(this,function(f){switch(f.label){case 0:return a=V(n,"boxes","nonMaxSuppressionAsync"),s=V(e,"scores","nonMaxSuppressionAsync"),u=I0(a,s,t,r,i,o),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=f.sent(),c=l[0],h=l[1],d=e2(c,h,t,r,i,o),a!==n&&a.dispose(),s!==e&&s.dispose(),[2,d]}})})},Ple=G({cropAndResize_:function(n,e,t,r,i,o){var a=V(n,"image","cropAndResize"),s=V(e,"boxes","cropAndResize","float32"),u=V(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return U(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),U(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),U(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),U(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),U(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),U(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),X.runKernelFunc(function(c,h){return c.cropAndResize(a,s,u,r,i,o)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),T4=Object.freeze({resizeBilinear:Sle,resizeNearestNeighbor:Rle,nonMaxSuppression:kle,nonMaxSuppressionAsync:Ale,nonMaxSuppressionWithScore:Nle,nonMaxSuppressionWithScoreAsync:Dle,cropAndResize:Ple}),f2=function(n,e){return!(n>0)||e==="linear"},p2=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},m2=function(n,e){var t=e,r=$n(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},v2=function(n,e,t){if(e==="linear")return n;if(e==="relu")return T0(n);if(e==="elu")return g4(n);if(e==="relu6")return x4(n);if(e==="prelu")return y4(n,t);throw new Error("Unknown fused activation "+e+".")},Ole=G({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,o=i!==void 0&&i,a=n.transposeB,s=a!==void 0&&a,u=n.bias,l=n.activation,c=l===void 0?"linear":l,h=n.preluActivationWeights;if(f2(X.state.gradientDepth,c)===!1){var d=f4(t,r,o,s);return u!=null&&(d=ro(d,u)),v2(d,c,h)}var f=V(t,"a","fused matMul"),p=V(r,"b","fused matMul");e=fn(f,p),f=e[0],p=e[1];var m=o?f.shape[f.rank-2]:f.shape[f.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],y=o?f.shape[f.rank-1]:f.shape[f.rank-2],x=s?p.shape[p.rank-2]:p.shape[p.rank-1],_=f.shape.slice(0,-2),b=p.shape.slice(0,-2),C=De(_),k=De(b);U(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),U(ir(_,b),function(){return"Error in fused matMul: outer dimensions ("+_+") and ("+b+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),U(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var T,E,I=f.shape.slice(0,-2).concat([y,x]),R=o?f.as3D(C,m,y):f.as3D(C,y,m),N=s?p.as3D(k,x,g):p.as3D(k,g,x);u!=null&&pt(I,(T=fn(T=V(u,"bias","fused matMul"),f)[0]).shape),h!=null&&(E=V(h,"prelu weights","fused matMul"));var O={a:R,b:N};u!=null&&(O.bias=T),h!=null&&(O.preluActivationWeights=E);var M=[R,N];return X.runKernelFunc(function(q,J){var ee=q.fusedBatchMatMul({a:R,b:N,transposeA:o,transposeB:s,bias:T,activation:c,preluActivationWeights:E});return J([R,N,ee]),ee},O,function(q,J){var ee=J[0],Q=J[1],$=J[2],K=p2(q,$,c),j={};return u!=null&&(j={bias:function(){return m2(T,K)}}),Object.assign(o||s?!o&&s?{a:function(){return K.matMul(Q,!1,!1)},b:function(){return K.matMul(ee,!0,!1)}}:o&&!s?{a:function(){return Q.matMul(K,!1,!0)},b:function(){return ee.matMul(K,!1,!1)}}:{a:function(){return Q.matMul(K,!0,!0)},b:function(){return K.matMul(ee,!0,!0)}}:{a:function(){return K.matMul(Q,!1,!0)},b:function(){return ee.matMul(K,!0,!1)}},j)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:c},M,[!0]).reshape(I)}}),Mle=G({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,a=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,f=n.preluActivationWeights;if(d=d||"linear",f2(X.state.gradientDepth,d)===!1){var p=gc(e,t,r,i,a,u,l);return c!=null&&(p=ro(p,c)),v2(p,d,f)}var m=V(e,"x","conv2d"),g=V(t,"filter","conv2d"),y=m,x=!1;m.rank===3&&(x=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),U(y.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+y.rank+"."}),U(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),l!=null&&U(An(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),U(y.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+y.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),U(Hr(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),U(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var _,b,C=mc(y.shape,g.shape,r,u,i,l);c!=null&&(_=fn(_=V(c,"bias","fused conv2d"),m)[0],pt(C.outShape,_.shape)),f!=null&&(b=V(f,"prelu weights","fused conv2d"));var k={x:y,filter:g};c!=null&&(k.bias=_),f!=null&&(k.preluActivationWeights=b);var T=[g,y],E=X.runKernelFunc(function(I,R){var N=I.fusedConv2d({input:y,filter:g,convInfo:C,bias:_,activation:d,preluActivationWeights:b});return R([g,y,N]),N},k,function(I,R){var N=R,O=N[0],M=N[1],q=N[2],J=p2(I,q,d);U(ud(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var ee={};return c!=null&&(ee={bias:function(){return m2(_,J)}}),Object.assign({x:function(){return l4(M.shape,J,O,r,i)},filter:function(){return s2(M,J,O.shape,r,i)}},ee)},"FusedConv2D",{convInfo:C,activation:d},T,[!0]);return x?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Fle=G({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,a=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,f=n.preluActivationWeights;if(f2(X.state.gradientDepth,d)===!1){var p=u2(e,t,r,i,a,u,l);return c!=null&&(p=ro(p,c)),v2(p,d,f)}var m=V(e,"x","depthwiseConv2d"),g=V(t,"filter","depthwiseConv2d"),y=m,x=!1;m.rank===3&&(x=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),U(y.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+y.rank+"."}),U(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),U(y.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+y.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),u==null&&(u=[1,1]),U(Hr(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&U(An(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var _,b,C=mc(y.shape,g.shape,r,u,i,l,!0);c!=null&&(_=fn(_=V(c,"bias","fused conv2d"),m)[0],pt(C.outShape,_.shape)),f!=null&&(b=V(f,"prelu weights","fused depthwiseConv2d"));var k={x:y,filter:g};c!=null&&(k.bias=_),f!=null&&(k.preluActivationWeights=b);var T=[g,y],E=X.runKernelFunc(function(I,R){var N=I.fusedDepthwiseConv2D({input:y,filter:g,convInfo:C,bias:_,activation:d,preluActivationWeights:b});return R([g,y,N]),N},k,function(I,R){U(ud(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=R[0],O=R[1],M=R[2],q=p2(I,M,d),J={};return c!=null&&(J={bias:function(){return m2(_,q)}}),Object.assign({x:function(){return c4(O.shape,q,N,C)},filter:function(){return h4(O,q,N.shape,C)}},J)},"FusedDepthwiseConv2D",{convInfo:C,activation:d},T,[!0]);return x?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Lle=Object.freeze({matMul:Ole,conv2d:Mle,depthwiseConv2d:Fle}),Ble=Object.freeze({image:T4,linalg:Ile,losses:ble,spectral:sle,fused:Lle,signal:dle,add:ro,addN:$se,batchNorm:lm,batchNormalization:Hse,batchNorm2d:qse,batchNormalization2d:Gse,batchNorm3d:Xse,batchNormalization3d:Kse,batchNorm4d:Yse,batchNormalization4d:Qse,broadcastTo:QF,clone:Jse,div:Ou,divNoNan:ZF,eye:e4,multinomial:tue,oneHot:Ey,pad:ys,pad1d:nue,pad2d:rue,pad3d:iue,pad4d:oue,rand:aue,randomGamma:lue,randomNormal:cue,randomUniform:t4,square:n4,squaredDifference:r4,tile:kh,truncatedNormal:hue,conv1d:Eue,conv2d:gc,conv3d:Cue,depthwiseConv2d:u2,separableConv2d:d4,conv2dTranspose:Tue,conv3dTranspose:Iue,op:G,booleanMaskAsync:bue,complex:lr,real:zi,imag:Zo,concat:no,concat1d:Pie,concat2d:Oie,concat3d:Mie,concat4d:Fie,split:KE,matMul:f4,dot:Sue,outerProduct:Rue,reverse:cm,reverse1d:kue,reverse2d:Aue,reverse3d:Nue,reverse4d:Due,maxPool:di,avgPool:Pue,pool:Oue,maxPool3d:Mue,avgPool3d:Fue,maxPoolWithArgmax:Lue,slice:Mu,slice1d:Bue,slice2d:Vue,slice3d:Uue,slice4d:Wue,abs:jie,acos:zie,acosh:$ie,asin:Hie,asinh:Gie,atan:qie,atanh:Kie,ceil:Xie,clipByValue:Qie,cos:Yie,cosh:Jie,erf:Zie,exp:eoe,expm1:toe,floor:noe,log:roe,log1p:ioe,logSigmoid:ooe,neg:XE,reciprocal:aoe,round:soe,rsqrt:yF,sigmoid:uoe,sign:loe,isNaN:coe,isInf:hoe,isFinite:doe,sin:foe,sinh:poe,softplus:moe,sqrt:voe,step:goe,tan:yoe,tanh:xoe,all:jue,any:zue,argMax:$ue,argMin:Hue,logSumExp:Gue,max:que,mean:Kue,min:Xue,moments:Que,sum:qs,prod:Yue,equal:i4,equalStrict:due,greater:fue,greaterEqual:o4,greaterEqualStrict:pue,greaterStrict:mue,less:vue,lessEqual:gue,lessEqualStrict:yue,lessStrict:xue,notEqual:wue,notEqualStrict:_ue,addStrict:woe,atan2:_oe,divStrict:boe,floorDiv:xF,maximum:QE,maximumStrict:Eoe,minimum:wF,minimumStrict:Coe,mod:Toe,modStrict:Ioe,mul:xn,mulStrict:Soe,pow:yy,powStrict:Roe,squaredDifferenceStrict:koe,sub:Ro,subStrict:Aoe,elu:g4,leakyRelu:Jue,prelu:y4,relu:T0,relu6:x4,selu:Zue,logicalAnd:C0,logicalNot:Zse,logicalOr:YF,logicalXor:eue,where:Zl,whereAsync:JF,buffer:et,print:Lie,batchToSpaceND:sF,cast:Bie,cumsum:Vie,depthToSpace:Uie,expandDims:Gs,reshape:Va,spaceToBatchND:uF,squeeze:lF,stack:Pu,unstack:g0,setdiff1dAsync:Wie,fill:Fl,linspace:Die,ones:Sd,range:py,scalar:Le,tensor:dr,tensor1d:No,tensor2d:Ml,tensor3d:oF,tensor4d:Qo,tensor5d:kie,tensor6d:Aie,variable:Nie,zeros:wn,onesLike:aF,zerosLike:Ct,transpose:_o,softmax:_0,logSoftmax:Loe,localResponseNormalization:ele,norm:w4,gather:a2,unsortedSegmentSum:a4,basicLSTMCell:tle,multiRNNCell:nle,movingAverage:rle,stridedSlice:ile,topk:ole,scatterND:ale,fft:l2,ifft:Cy,rfft:c2,irfft:_4,sparseToDense:ule,gatherND:lle,diag:cle,dropout:hle,hannWindow:h2,hammingWindow:E4,frame:d2,stft:C4,inTopKAsync:fle});function pe(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&U(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function S_(n,e,t,r,i,o){for(var a=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=i.padInfo.top,f=i.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=et(i.outShape,t),g=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],x=i.outShape[2]*i.outShape[3],_=i.outShape[3],b=0;b<i.batchSize;++b)for(var C=b*y,k=b*r[0],T=0;T<i.inChannels;++T)for(var E=0;E<i.outHeight;++E)for(var I=E*a-d,R=Math.max(0,I),N=Math.min(i.inHeight,c+I),O=C+E*x,M=0;M<i.outWidth;++M){for(var q=M*s-f,J=Math.max(0,q),ee=Math.min(i.inWidth,h+q),Q=p,$=0,K=0,j=R;j<N;j+=u){for(var ue=k+j*r[1],he=J;he<ee;he+=l){var ve=n[ue+he*r[2]+T];o==="max"&&ve>Q?Q=ve:o==="avg"&&($+=ve,K++)}if(isNaN(Q))break}g[O+M*_+T]=o==="avg"?$/K:Q}return m}function I4(n,e,t,r,i,o){i===void 0&&(i=!1),o===void 0&&(o=!1);for(var a=et(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=et(e,t,n),g=0;g<r.batchSize;++g)for(var y=0;y<r.inChannels;++y)for(var x=0;x<r.outHeight;++x){for(var _=x*s-f,b=_;b<0;)b+=l;for(var C=Math.min(r.inHeight,h+_),k=0;k<r.outWidth;++k){for(var T=k*u-p,E=T;E<0;)E+=c;for(var I=Math.min(r.inWidth,d+T),R=Number.NEGATIVE_INFINITY,N=-1,O=b;O<C;O+=l)for(var M=O-_,q=E;q<I;q+=c){var J=q-T,ee=m.get(g,O,q,y);ee>R&&(R=ee,N=i?o?((g*r.inHeight+O)*r.inWidth+q)*r.inChannels+y:(O*r.inWidth+q)*r.inChannels+y:M*d+J)}a.set(N,g,x,k,y)}}return a}function fx(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var Vle=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new TF(t,X),t}return Do(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,le().get("IS_NODE")&&dy(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Pe(this,void 0,void 0,function(){return Oe(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,o=r.complexTensors;return i==="complex64"?I_(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map(function(o){return ly(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return et(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return X.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Pe(this,void 0,void 0,function(){var r;return Oe(this,function(i){return r=Xo(),t(),[2,{kernelMs:Xo()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:X.keep(t.clone()),imag:X.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(pe(t,"slice"),EF(t.shape,r,i)){var o=CF(r,t.strides),a=De(i);return dr(this.readSync(t.dataId).subarray(o,o+a),i,t.dtype)}for(var s=et(i,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(h,d){return h+r[d]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},e.prototype.stridedSlice=function(t,r,i,o){pe(t,"stridedSlice");var a=YE(r,i,o);if(a.some(function(f){return f===0}))return dr([],a);for(var s=et(a,t.dtype),u=this.bufferSync(t),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),h=new Array(c.length),d=0;d<h.length;d++)h[d]=c[d]*o[d]+r[d];s.set.apply(s,[u.get.apply(u,h)].concat(c))}return s.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=et([t.size,t.size],t.dtype),o=i.values,a=0;a<r.length;a++)o[a*t.size+a]=r[a];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.reverse=function(t,r){pe(t,"reverse");for(var i=et(t.shape,t.dtype),o=this.bufferSync(t),a=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach(function(h){return c[h]=t.shape[h]-1-c[h]}),i.set.apply(i,[o.get.apply(o,c)].concat(l))},s=0;s<i.size;s++)a(s);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var o=t.map(function(f){return zi(f)}),a=t.map(function(f){return Zo(f)});return lr(this.concat(o,r),this.concat(a,r))}var s=t.map(function(f){var p=De(f.shape.slice(r));return f.as2D(-1,p)}),u=sd(s.map(function(f){return f.shape}),1),l=et(u,t[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(f){l.set(i.readSync(f.dataId),c),c+=f.size})}else{var h=0;s.forEach(function(f){for(var p=i.readSync(f.dataId),m=0,g=0;g<f.shape[0];++g)for(var y=g*u[1]+h,x=0;x<f.shape[1];++x)l[y+x]=p[m++];h+=f.shape[1]})}var d=sd(t.map(function(f){return f.shape}),r);return dr(l,d,t[0].dtype)},e.prototype.neg=function(t){return pe(t,"neg"),this.multiply(Le(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i+a,imag:o+s}}):this.broadcastedBinaryOp(t,r,hr(t.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(t){var r=this;pe(t,"addN");for(var i=t.map(function(c){return r.readSync(c.dataId)}),o=et(t[0].shape,t[0].dtype),a=o.values,s=0;s<t.length;s++)for(var u=i[s],l=0;l<a.length;l++)a[l]+=u[l];return o.toTensor()},e.prototype.softmax=function(t,r){var i=Qn([r],t.shape),o=this.max(t,i),a=ui(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return Ou(u,l)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i-a,imag:o-s}}):this.broadcastedBinaryOp(t,r,hr(t.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(t,r){return pe([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(t,r,i,o){pe([t,r],"matMul");for(var a=i?t.shape[1]:t.shape[2],s=i?t.shape[2]:t.shape[1],u=o?r.shape[1]:r.shape[2],l=t.shape[0],c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=d[0],p=d[1],m=d[2],g=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],y=g[0],x=g[1],_=g[2],b=s*u,C=et([l,s,u],t.dtype),k=C.values,T=this.blockSize,E=0;E<l;E++)for(var I=0;I<s;I+=T)for(var R=0;R<u;R+=T)for(var N=0;N<a;N+=T)for(var O=Math.min(I+T,s),M=Math.min(R+T,u),q=Math.min(N+T,a),J=I;J<O;J++)for(var ee=R;ee<M;ee++){for(var Q=0,$=N;$<q;$++)Q+=c[E*f+J*p+$*m]*h[$*y+ee*x+E*_];k[E*b+(J*u+ee)]+=Q}return C.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=this.batchMatMul(r,i,o,a);return s&&(c=this.add(c,s)),u&&(c=fx(this,c,u,l)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}}):this.broadcastedBinaryOp(t,r,hr(t.dtype,r.dtype),function(i,o){return i*o})},e.prototype.floorDiv=function(t,r){return pe([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(t,r){pe(t,"sum"),mi("sum",r,t.rank);for(var i=Sr(t.shape,r),o=i[0],a=i[1],s=wn(o,hr(t.dtype,"int32")),u=De(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,f=0,p=0;p<u;++p)f+=c[d+p];l[h]=f}return s},e.prototype.prod=function(t,r){pe(t,"sum");for(var i=Sr(t.shape,r),o=i[0],a=i[1],s=wn(o,hr(t.dtype,"int32")),u=De(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,f=1,p=0;p<u;++p)f*=c[d+p];l[h]=f}return s},e.prototype.unsortedSegmentSum=function(t,r,i){pe(t,"unsortedSegmentSum");for(var o=[],a=t.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<i;++s){var u=Le(s,"int32"),l=i4(u,r).asType("float32").mul(t).sum(0);o.push(l)}return Pu(o)},e.prototype.argMin=function(t,r){pe(t,"argMin");var i=[r];mi("argMin",i,t.rank);for(var o=Sr(t.shape,i),a=o[0],s=o[1],u=wn(a,"int32"),l=De(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=h[f],m=0,g=0;g<l;++g){var y=h[f+g];y<p&&(p=y,m=g)}c[d]=m}return u},e.prototype.argMax=function(t,r){pe(t,"argMax");var i=[r];mi("argMax",i,t.rank);for(var o=Sr(t.shape,i),a=o[0],s=o[1],u=wn(a,"int32"),l=De(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=h[f],m=0,g=0;g<l;++g){var y=h[f+g];y>p&&(p=y,m=g)}c[d]=m}return u},e.prototype.cumsum=function(t,r,i,o){if(pe(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var a=hr(t.dtype,"int32"),s=wn(t.shape,a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),c=t.shape[t.rank-1],h=o?function(g,y){return g+c-y-1}:function(g,y){return g+y},d=0;d<l.length;d+=c)for(var f=0;f<c;f++){var p=h(d,f);if(f===0)u[p]=i?0:l[p];else{var m=h(d,f-1);u[p]=i?l[m]+u[m]:l[p]+u[m]}}return s},e.prototype.equal=function(t,r){return pe([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(t,r){return pe([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(t,r){return pe([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(t,r){return pe([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(t,r){return pe([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(t,r){return pe([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(t){pe(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return pe([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(t,r){return pe([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i||o})},e.prototype.select=function(t,r,i){pe([t,r,i],"select");for(var o=this.readSync(t.dataId),a=this.readSync(r.dataId),s=this.readSync(i.dataId),u=wn(r.shape,hr(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,h=t.rank===0||t.rank>1||r.rank===1?1:De(r.shape.slice(1)),d=0;d<o.length;d++)for(var f=0;f<h;f++)o[d]===1?l[c++]=a[d]:l[c++]=s[d];return u},e.prototype.where=function(t){pe([t],"where");var r=this.readSync(t.dataId);return t2(t.shape,r)},e.prototype.topk=function(t,r,i){return pe(t,"topk"),PF(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){pe(t,"min"),mi("min",r,t.rank);for(var i=Sr(t.shape,r),o=i[0],a=i[1],s=wn(o,t.dtype),u=De(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,f=c[d],p=0;p<u;++p){var m=c[d+p];m<f&&(f=m)}l[h]=f}return s},e.prototype.minimum=function(t,r){return pe([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(t,r){return pe([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o})},e.prototype.max=function(t,r){pe(t,"max"),mi("max",r,t.rank);for(var i=Sr(t.shape,r),o=i[0],a=i[1],s=wn(o,t.dtype),u=De(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,f=c[d],p=0;p<u;++p){var m=c[d+p];m>f&&(f=m)}l[h]=f}return s},e.prototype.maximum=function(t,r){return pe([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(t,r){pe(t,"all"),mi("all",r,t.rank);for(var i=Sr(t.shape,r),o=i[0],a=i[1],s=wn(o,t.dtype),u=De(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,f=c[d],p=0;p<u;++p){var m=c[d+p];f=f&&m}l[h]=f}return s},e.prototype.any=function(t,r){pe(t,"any"),mi("any",r,t.rank);for(var i=Sr(t.shape,r),o=i[0],a=i[1],s=wn(o,t.dtype),u=De(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*u,f=c[d],p=0;p<u;++p){var m=c[d+p];f=f||m}l[h]=f}return s},e.prototype.squaredDifference=function(t,r){return pe([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var a=i-o;return a*a})},e.prototype.ceil=function(t){pe(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){pe(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){pe(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){pe(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){pe(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){pe(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){pe(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=Math.floor(r[o]);r[o]-a<.5?i[o]=Math.floor(r[o]):r[o]-a>.5?i[o]=Math.ceil(r[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){pe(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){pe(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){pe(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){pe(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log1p(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){pe(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){pe(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){pe(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){pe(t,"relu");for(var r=wn(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return r},e.prototype.relu6=function(t){pe(t,"relu");for(var r=wn(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return r},e.prototype.prelu=function(t,r){return pe([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(t){pe(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){pe([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){pe(t,"selu");for(var r=r2,i=i2,o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,i){pe(t,"clip");for(var o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>i?i:u<r?r:u}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var a=i[2*o],s=i[2*o+1];r[o]=Math.hypot(a,s)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){pe(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){pe(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){pe(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a]>-r,u=o[a]<r,l=Math.exp(o[a]),c=void 0;c=u?l:s?o[a]:Math.log(1+l),i[a]=c}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){pe(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){pe(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){pe(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){pe(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){pe(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){pe(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return pe([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(t){pe(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){pe(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){pe(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Lre(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){pe(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){pe(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){pe(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){pe(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),u=1/(1+.3275911*s);r[o]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),pe(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.conv2d(r,i,o);return a&&(l=this.add(l,a)),s&&(l=fx(this,l,s,u)),l},e.prototype.conv2d=function(t,r,i){pe([t,r],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.dataFormat==="channelsLast",d=et(i.outShape,t.dtype),f=t.strides[0],p=h?t.strides[1]:t.strides[2],m=h?t.strides[2]:1,g=h?1:t.strides[1],y=d.strides[0],x=h?d.strides[1]:d.strides[2],_=h?d.strides[2]:1,b=h?1:d.strides[1],C=this.readSync(t.dataId),k=this.readSync(r.dataId),T=d.values,E=0;E<i.batchSize;++E)for(var I=E*f,R=E*y,N=0;N<i.outHeight;++N)for(var O=R+N*x,M=N*i.strideHeight-c,q=0;q<o;q++){var J=M+q*s;if(!(J<0||J>=i.inHeight))for(var ee=q*r.strides[0],Q=I+J*p,$=0;$<i.outWidth;++$)for(var K=O+$*_,j=$*i.strideWidth-l,ue=0;ue<a;ue++){var he=j+ue*u;if(!(he<0||he>=i.inWidth))for(var ve=Q+he*m,we=ee+ue*r.strides[1],Ee=0;Ee<i.inChannels;++Ee){for(var Ce=C[ve+Ee*g],Ie=0;Ie<i.outChannels;++Ie)T[K+Ie*b]+=Ce*k[we+Ie];we+=i.outChannels}}}return d.toTensor()},e.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.front,d=i.padInfo.left,f=i.padInfo.top,p=et(i.outShape,t.dtype),m=this.readSync(t.dataId),g=this.readSync(r.dataId),y=p.values,x=0;x<i.batchSize;++x)for(var _=x*t.strides[0],b=x*p.strides[0],C=0;C<i.outDepth;++C)for(var k=b+C*p.strides[1],T=C*i.strideDepth-h,E=0;E<o;E++){var I=T+E*u;if(!(I<0||I>=i.inDepth))for(var R=E*r.strides[0],N=_+I*t.strides[1],O=0;O<i.outHeight;++O)for(var M=k+O*p.strides[2],q=O*i.strideHeight-f,J=0;J<a;J++){var ee=q+J*l;if(!(ee<0||ee>=i.inHeight))for(var Q=R+J*r.strides[1],$=N+ee*t.strides[2],K=0;K<i.outWidth;++K)for(var j=M+K*i.outChannels,ue=K*i.strideWidth-d,he=0;he<s;he++){var ve=ue+he*c;if(!(ve<0||ve>=i.inWidth))for(var we=Q+he*r.strides[2],Ee=$+ve*i.inChannels,Ce=we,Ie=0;Ie<i.inChannels;++Ie){for(var ce=m[Ee+Ie],Ue=0;Ue<i.outChannels;++Ue)y[j+Ue]+=ce*g[Ce+Ue];Ce+=i.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){pe([t,r],"conv2dDerInput");for(var o=et(i.inShape,"float32"),a=o.values,s=this.readSync(t.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],h=l[1],d=l[2],f=i.batchSize,p=i.filterHeight,m=i.filterWidth,g=i.inChannels,y=i.inHeight,x=i.inWidth,_=i.outChannels,b=i.outHeight,C=i.outWidth,k=i.strideHeight,T=i.strideWidth,E=i.dataFormat,I=p-1-i.padInfo.top,R=m-1-i.padInfo.left,N=E==="channelsLast",O=o.strides[0],M=N?o.strides[1]:o.strides[2],q=N?o.strides[2]:1,J=N?1:o.strides[1],ee=t.strides[0],Q=N?t.strides[1]:t.strides[2],$=N?t.strides[2]:1,K=N?1:t.strides[1],j=0;j<f;++j)for(var ue=0;ue<g;++ue)for(var he=0;he<y;++he)for(var ve=he-I,we=Math.max(0,Math.ceil(ve/k)),Ee=Math.min(b,(p+ve)/k),Ce=0;Ce<x;++Ce){for(var Ie=Ce-R,ce=Math.max(0,Math.ceil(Ie/T)),Ue=Math.min(C,(m+Ie)/T),je=0,Be=we;Be<Ee;++Be)for(var Ge=Be*k-ve,We=ce;We<Ue;++We)for(var ut=ee*j+Q*Be+$*We,ot=c*(p-1-Ge)+h*(m-1-(We*T-Ie))+d*ue,dt=0;dt<_;++dt)je+=s[ut+K*dt]*u[ot+dt];a[O*j+M*he+q*Ce+J*ue]=je}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var o=et(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=s[3],d=this.readSync(t.dataId),f=t.strides,p=f[0],m=f[1],g=f[2],y=f[3],x=this.readSync(r.dataId),_=r.strides,b=_[0],C=_[1],k=_[2],T=_[3],E=i.batchSize,I=i.filterDepth,R=i.filterHeight,N=i.filterWidth,O=i.inChannels,M=i.inDepth,q=i.inHeight,J=i.inWidth,ee=i.outChannels,Q=i.outDepth,$=i.outHeight,K=i.outWidth,j=i.strideDepth,ue=i.strideHeight,he=i.strideWidth,ve=I-1-i.padInfo.front,we=R-1-i.padInfo.top,Ee=N-1-i.padInfo.left,Ce=0;Ce<E;++Ce)for(var Ie=0;Ie<O;++Ie)for(var ce=0;ce<M;++ce)for(var Ue=ce-ve,je=Math.max(0,Math.ceil(Ue/j)),Be=Math.min(Q,(I+Ue)/j),Ge=0;Ge<q;++Ge)for(var We=Ge-we,ut=Math.max(0,Math.ceil(We/ue)),ot=Math.min($,(R+We)/ue),dt=0;dt<J;++dt){for(var Yn=dt-Ee,En=Math.max(0,Math.ceil(Yn/he)),sn=Math.min(K,(N+Yn)/he),Ln=0,Cn=je;Cn<Be;++Cn)for(var Bn=Cn*j-Ue,ar=ut;ar<ot;++ar)for(var Nn=ar*ue-We,un=En;un<sn;++un)for(var tn=p*Ce+m*Cn+g*ar+y*un,Tt=b*(I-1-Bn)+C*(R-1-Nn)+k*(N-1-(un*he-Yn))+T*Ie,pn=0;pn<ee;++pn)Ln+=d[tn+pn]*x[Tt+pn];a[u*Ce+l*ce+c*Ge+h*dt+Ie]=Ln}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){pe([t,r],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=et(i.filterShape,"float32"),h=i.padInfo.left,d=i.padInfo.top,f=this.bufferSync(t),p=this.bufferSync(r),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((d-m)/o)),y=Math.min(i.outHeight,(i.inHeight+d-m)/o),x=0;x<u;++x)for(var _=Math.max(0,Math.ceil((h-x)/a)),b=Math.min(i.outWidth,(i.inWidth+h-x)/a),C=0;C<i.inChannels;++C)for(var k=0;k<i.outChannels;++k){for(var T=0,E=0;E<i.batchSize;++E)for(var I=g;I<y;++I)for(var R=m+I*o-d,N=_;N<b;++N){var O=x+N*a-h;T+=l?f.get(E,R,O,C)*p.get(E,I,N,k):f.get(E,C,R,O)*p.get(E,k,I,N)}c.set(T,m,x,C,k)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=et(i.filterShape,"float32"),d=h.values,f=h.strides,p=f[0],m=f[1],g=f[2],y=f[3],x=this.readSync(r.dataId),_=r.strides,b=_[0],C=_[1],k=_[2],T=_[3],E=this.readSync(t.dataId),I=t.strides,R=I[0],N=I[1],O=I[2],M=I[3],q=i.padInfo.front,J=i.padInfo.left,ee=i.padInfo.top,Q=0;Q<u;++Q)for(var $=Math.max(0,Math.ceil((q-Q)/o)),K=Math.min(i.outDepth,(i.inDepth+q-Q)/o),j=Q*p,ue=0;ue<l;++ue)for(var he=Math.max(0,Math.ceil((ee-ue)/a)),ve=Math.min(i.outHeight,(i.inHeight+ee-ue)/a),we=ue*m+j,Ee=0;Ee<c;++Ee)for(var Ce=Math.max(0,Math.ceil((J-Ee)/s)),Ie=Math.min(i.outWidth,(i.inWidth+J-Ee)/s),ce=Ee*g+we,Ue=0;Ue<i.inChannels;++Ue)for(var je=Ue*y+ce,Be=0;Be<i.outChannels;++Be){for(var Ge=0,We=0;We<i.batchSize;++We)for(var ut=We*R,ot=We*b,dt=$;dt<K;++dt)for(var Yn=(Q+dt*o-q)*N+ut,En=dt*C+ot,sn=he;sn<ve;++sn)for(var Ln=(ue+sn*a-ee)*O+Yn,Cn=sn*k+En,Bn=Ce;Bn<Ie;++Bn){var ar=Bn*T+Cn;Ge+=E[(Ee+Bn*s-J)*M+Ln+Ue]*x[ar+Be]}d[je+Be]=Ge}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.depthwiseConv2D(r,i,o);return a&&(l=this.add(l,a)),s&&(l=fx(this,l,s,u)),l},e.prototype.depthwiseConv2D=function(t,r,i){pe([t,r],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.outChannels/i.inChannels,d=et(i.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(r.dataId),m=d.values,g=0;g<i.batchSize;++g)for(var y=g*t.strides[0],x=g*d.strides[0],_=0;_<i.outHeight;++_)for(var b=x+_*d.strides[1],C=_*i.strideHeight-l,k=0;k<o;++k){var T=C+k*s;if(!(T<0||T>=i.inHeight))for(var E=k*r.strides[0],I=y+T*t.strides[1],R=0;R<i.outWidth;++R)for(var N=b+R*d.strides[2],O=R*i.strideWidth-c,M=0;M<a;++M){var q=O+M*u;if(!(q<0||q>=i.inWidth))for(var J=E+M*r.strides[1],ee=I+q*i.inChannels,Q=N,$=J,K=0;K<i.inChannels;++K){for(var j=f[ee+K],ue=0;ue<h;++ue)m[Q+ue]+=j*p[$+ue];Q+=h,$+=h}}}return d.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){pe([t,r],"depthwiseConv2DDerInput");for(var o=et(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=this.readSync(t.dataId),d=t.strides,f=d[0],p=d[1],m=d[2],g=this.readSync(r.dataId),y=r.strides,x=y[0],_=y[1],b=y[2],C=i.batchSize,k=i.filterHeight,T=i.filterWidth,E=i.inChannels,I=i.inHeight,R=i.inWidth,N=i.outChannels,O=i.outHeight,M=i.outWidth,q=i.strideHeight,J=i.strideWidth,ee=k-1-i.padInfo.top,Q=T-1-i.padInfo.left,$=N/E,K=0;K<C;++K)for(var j=0;j<E;++j)for(var ue=0;ue<I;++ue)for(var he=ue-ee,ve=Math.max(0,Math.ceil(he/q)),we=Math.min(O,(k+he)/q),Ee=0;Ee<R;++Ee){for(var Ce=Ee-Q,Ie=Math.max(0,Math.ceil(Ce/J)),ce=Math.min(M,(T+Ce)/J),Ue=0,je=ve;je<we;++je)for(var Be=je*q-he,Ge=Ie;Ge<ce;++Ge)for(var We=f*K+p*je+m*Ge,ut=x*(k-1-Be)+_*(T-1-(Ge*J-Ce))+b*j,ot=0;ot<$;++ot)Ue+=h[We+(j*$+ot)]*g[ut+ot];a[u*K+l*ue+c*Ee+j]=Ue}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){pe([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=et(i.filterShape,"float32"),c=i.padInfo.left,h=i.padInfo.top,d=i.outChannels/i.inChannels,f=this.bufferSync(t),p=this.bufferSync(r),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((h-m)/o)),y=Math.min(i.outHeight,(i.inHeight+h-m)/o),x=0;x<u;++x)for(var _=Math.max(0,Math.ceil((c-x)/a)),b=Math.min(i.outWidth,(i.inWidth+c-x)/a),C=0;C<i.outChannels;++C){for(var k=Math.trunc(C/d),T=C%d,E=0,I=0;I<i.batchSize;++I)for(var R=g;R<y;++R)for(var N=m+R*o-h,O=_;O<b;++O){var M=x+O*a-c;E+=f.get(I,N,M,k)*p.get(I,R,O,C)}l.set(E,m,x,k,T)}return l.toTensor()},e.prototype.tile=function(t,r){return pe(t,"tile"),DF(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){pe(t,"pad");var o=r.map(function(d,f){return d[0]+t.shape[f]+d[1]}),a=r.map(function(d){return d[0]}),s=this.bufferSync(t),u=et(o,t.dtype);i!==0&&u.values.fill(i);for(var l=0;l<t.size;l++){var c=s.indexToLoc(l),h=c.map(function(d,f){return d+a[f]});u.set.apply(u,[s.get.apply(s,c)].concat(h))}return u.toTensor()},e.prototype.gather=function(t,r,i){pe([t,r],"gather");var o=t.shape.slice(),a=this.readSync(r.dataId);o[i]=a.length;for(var s=et(o,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l),h=c.slice();h[i]=a[c[i]];var d=u.locToIndex(h);s.values[l]=u.values[d]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){pe([t],"batchToSpaceND");var o=r.reduce(function(h,d){return h*d}),a=my(t.shape,r,o),s=vy(a.length,r.length),u=gy(t.shape,r,o),l=cF(i,r.length),c=hF(u,i,r.length);return _o(t.reshape(a),s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){pe([t],"spaceToBatchND");var o=r.reduce(function(d,f){return d*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=my(u.shape,r,o,!1),c=vy(l.length,r.length,!1),h=gy(u.shape,r,o,!1);return _o(u.reshape(l),c).reshape(h)},e.prototype.maxPool=function(t,r){return pe(t,"maxPool"),S_(this.readSync(t.dataId),t.shape,t.dtype,t.strides,r,"max").toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,o){pe([r,i],"maxPoolBackprop");for(var a=this.readSync(r.dataId),s=et(o.outShape,r.dtype,I4(a,r.shape,r.dtype,o).values),u=o.strideHeight,l=o.strideWidth,c=o.dilationHeight,h=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,p=f-1-o.padInfo.left,m=d-1-o.padInfo.top,g=et(r.shape,"float32"),y=this.bufferSync(t),x=0;x<o.batchSize;++x)for(var _=0;_<o.inChannels;++_)for(var b=0;b<o.inHeight;++b)for(var C=0;C<o.inWidth;++C){for(var k=b-m,T=C-p,E=0,I=0;I<d;I+=c){var R=(k+I)/u;if(!(R<0||R>=o.outHeight||Math.floor(R)!==R))for(var N=0;N<f;N+=h){var O=(T+N)/l;if(!(O<0||O>=o.outWidth||Math.floor(O)!==O)){var M=d*f-1-s.get(x,R,O,_)===I*f+N?1:0;M!==0&&(E+=y.get(x,R,O,_)*M)}}}g.set(E,x,b,C,_)}return g.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){pe([t,r],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,f=d-1-i.padInfo.left,p=h-1-i.padInfo.top,m=et(r.shape,"float32"),g=1/(s*u),y=this.bufferSync(t),x=0;x<i.batchSize;++x)for(var _=0;_<i.inChannels;++_)for(var b=0;b<i.inHeight;++b)for(var C=0;C<i.inWidth;++C){for(var k=b-p,T=C-f,E=0,I=0;I<h;I+=l){var R=(k+I)/o;if(!(R<0||R>=i.outHeight||Math.floor(R)!==R))for(var N=0;N<d;N+=c){var O=(T+N)/a;O<0||O>=i.outWidth||Math.floor(O)!==O||(E+=y.get(x,R,O,_))}}m.set(E*g,x,b,C,_)}return m.toTensor()},e.prototype.pool3d=function(t,r,i){pe(t,"pool3d");for(var o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),_=et(r.outShape,t.dtype),b=_.values,C=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],E=r.outShape[4],I=0;I<r.batchSize;++I)for(var R=I*C,N=I*t.strides[0],O=0;O<r.inChannels;++O)for(var M=0;M<r.outDepth;++M){for(var q=M*o-p,J=q;J<0;)J+=u;for(var ee=Math.min(r.inDepth,h+q),Q=R+M*k,$=0;$<r.outHeight;++$){for(var K=$*a-m,j=K;j<0;)j+=l;for(var ue=Math.min(r.inHeight,d+K),he=Q+$*T,ve=0;ve<r.outWidth;++ve){for(var we=ve*s-g,Ee=we;Ee<0;)Ee+=c;for(var Ce=Math.min(r.inWidth,f+we),Ie=he+ve*E,ce=y,Ue=0,je=0,Be=J;Be<ee;Be+=u){for(var Ge=N+Be*t.strides[1],We=j;We<ue;We+=l){for(var ut=Ge+We*t.strides[2],ot=Ee;ot<Ce;ot+=c){var dt=x[ut+ot*t.strides[3]+O];if(i==="max"&&dt>ce?ce=dt:i==="avg"&&(Ue+=dt,je++),isNaN(ce))break}if(isNaN(ce))break}if(isNaN(ce))break}b[Ie+O]=i==="avg"?Ue/je:ce}}}return _.toTensor()},e.prototype.avgPool3d=function(t,r){return pe(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){pe([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,p=i.effectiveFilterDepth,m=i.effectiveFilterHeight,g=i.effectiveFilterWidth,y=p-1-i.padInfo.front,x=g-1-i.padInfo.left,_=m-1-i.padInfo.top,b=et(r.shape,"float32"),C=1/(u*l*c),k=this.bufferSync(t),T=0;T<i.batchSize;++T)for(var E=0;E<i.inChannels;++E)for(var I=0;I<i.inDepth;++I)for(var R=0;R<i.inHeight;++R)for(var N=0;N<i.inWidth;++N){for(var O=I-y,M=R-_,q=N-x,J=0,ee=0;ee<p;ee+=h){var Q=(O+ee)/o;if(!(Q<0||Q>=i.outDepth||Math.floor(Q)!==Q))for(var $=0;$<m;$+=d){var K=(M+$)/a;if(!(K<0||K>=i.outHeight||Math.floor(K)!==K))for(var j=0;j<g;j+=f){var ue=(q+j)/s;ue<0||ue>=i.outWidth||Math.floor(ue)!==ue||(J+=k.get(T,Q,K,ue,E))}}}b.set(J*C,T,I,R,N,E)}return b.toTensor()},e.prototype.maxPool3d=function(t,r){return pe(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=et(r.outShape,"int32"),o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,y=this.bufferSync(t),x=0;x<r.batchSize;++x)for(var _=0;_<r.inChannels;++_)for(var b=0;b<r.outDepth;++b){for(var C=b*o-p,k=C;k<0;)k+=u;for(var T=Math.min(r.inDepth,h+C),E=0;E<r.outHeight;++E){for(var I=E*a-m,R=I;R<0;)R+=l;for(var N=Math.min(r.inHeight,d+I),O=0;O<r.outWidth;++O){for(var M=O*s-g,q=M;q<0;)q+=c;for(var J=Math.min(r.inWidth,f+M),ee=Number.NEGATIVE_INFINITY,Q=-1,$=k;$<T;$+=u)for(var K=$-C,j=R;j<N;j+=l)for(var ue=j-I,he=q;he<J;he+=c){var ve=he-M,we=y.get(x,$,j,he,_);we>=ee&&(ee=we,Q=K*d*f+ue*d+ve)}i.set(Q,x,b,E,O,_)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,o){pe([r,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,o),s=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,h=o.dilationHeight,d=o.dilationWidth,f=o.effectiveFilterDepth,p=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=f-1-o.padInfo.front,y=m-1-o.padInfo.left,x=p-1-o.padInfo.top,_=et(r.shape,"float32"),b=this.bufferSync(a),C=this.bufferSync(t),k=0;k<o.batchSize;++k)for(var T=0;T<o.inChannels;++T)for(var E=0;E<o.inDepth;++E)for(var I=0;I<o.inHeight;++I)for(var R=0;R<o.inWidth;++R){for(var N=E-g,O=I-x,M=R-y,q=0,J=0;J<f;J+=c){var ee=(N+J)/s;if(!(ee<0||ee>=o.outDepth||Math.floor(ee)!==ee))for(var Q=0;Q<p;Q+=h){var $=(O+Q)/u;if(!($<0||$>=o.outHeight||Math.floor($)!==$))for(var K=0;K<m;K+=d){var j=(M+K)/l;if(!(j<0||j>=o.outWidth||Math.floor(j)!==j)){var ue=f*p*m-1-b.get(k,ee,$,j,T)===J*p*m+Q*m+K?1:0;ue!==0&&(q+=C.get(k,ee,$,j,T)*ue)}}}}_.set(q,k,E,I,R,T)}return _.toTensor()},e.prototype.cast=function(t,r){return RF(t,r,this)},e.prototype.reshape=function(t,r){return T_(t,r)},e.prototype.avgPool=function(t,r){return pe(t,"avgPool"),pe(t,"maxPool"),S_(this.readSync(t.dataId),t.shape,t.dtype,t.strides,r,"avg").toTensor().toFloat()},e.prototype.resizeBilinear=function(t,r,i,o){pe(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),d=new Float32Array(De([s,r,i,c])),f=[o&&r>1?u-1:u,o&&i>1?l-1:l],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],m=0,g=f[0]/p[0],y=f[1]/p[1],x=0;x<s;x++)for(var _=0;_<r;_++)for(var b=g*_,C=Math.floor(b),k=b-C,T=Math.min(u-1,Math.ceil(b)),E=x*t.strides[0]+C*t.strides[1],I=x*t.strides[0]+T*t.strides[1],R=0;R<i;R++)for(var N=y*R,O=Math.floor(N),M=N-O,q=Math.min(l-1,Math.ceil(N)),J=E+O*t.strides[2],ee=I+O*t.strides[2],Q=E+q*t.strides[2],$=I+q*t.strides[2],K=0;K<c;K++){var j=h[J+K],ue=h[ee+K],he=j+(h[Q+K]-j)*M,ve=he+(ue+(h[$+K]-ue)*M-he)*k;d[m++]=ve}return dr(d,[s,r,i,c])},e.prototype.resizeBilinearBackprop=function(t,r,i){pe([t,r],"resizeBilinearBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],d=c[2],f=new Float32Array(a*s*u*l),p=[i&&h>1?s-1:s,i&&d>1?u-1:u],m=[i&&h>1?h-1:h,i&&d>1?d-1:d],g=p[0]/m[0],y=p[1]/m[1],x=this.readSync(t.dataId),_=0,b=0;b<a;b++)for(var C=b*r.strides[0],k=0;k<h;k++)for(var T=k*g,E=Math.floor(T),I=Math.min(Math.ceil(T),s-1),R=C+E*r.strides[1],N=C+I*r.strides[1],O=T-E,M=1-O,q=0;q<d;q++)for(var J=q*y,ee=Math.floor(J),Q=Math.min(Math.ceil(J),u-1),$=J-ee,K=1-$,j=R+ee*r.strides[2],ue=R+Q*r.strides[2],he=N+ee*r.strides[2],ve=N+Q*r.strides[2],we=M*K,Ee=M*$,Ce=O*K,Ie=O*$,ce=0;ce<l;ce++){var Ue=x[_++];f[j+ce]+=Ue*we,f[ue+ce]+=Ue*Ee,f[he+ce]+=Ue*Ce,f[ve+ce]+=Ue*Ie}return Qo(f,[a,u,s,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,o){pe(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),d=new Float32Array(s*r*i*c),f=[o&&r>1?u-1:u,o&&i>1?l-1:l],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],m=f[0]/p[0],g=f[1]/p[1],y=0,x=0;x<s;x++)for(var _=x*t.strides[0],b=0;b<r;b++)for(var C=m*b,k=_+Math.min(u-1,o?Math.round(C):Math.floor(C))*t.strides[1],T=0;T<i;T++)for(var E=g*T,I=k+Math.min(l-1,o?Math.round(E):Math.floor(E))*t.strides[2],R=0;R<c;R++){var N=h[I+R];d[y++]=N}return dr(d,[s,r,i,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){pe([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],d=c[2],f=new Float32Array(a*s*u*l),p=this.readSync(t.dataId),m=[i&&h>1?s-1:s,i&&d>1?u-1:u],g=[i&&h>1?h-1:h,i&&d>1?d-1:d],y=m[0]/g[0],x=m[1]/g[1],_=1/y,b=1/x,C=2*Math.ceil(_)+2,k=2*Math.ceil(b)+2,T=0;T<a;T++)for(var E=T*r.strides[0],I=0;I<s;I++)for(var R=E+I*r.strides[1],N=Math.floor(I*_),O=Math.floor(N-C/2),M=0;M<u;M++)for(var q=R+M*r.strides[2],J=Math.floor(M*b),ee=Math.floor(J-k/2),Q=0;Q<l;Q++){for(var $=0,K=0;K<C;K++){var j=K+O;if(!(j<0||j>=h)){var ue=E+j*t.strides[1],he=j*y;if(I===Math.min(s-1,i?Math.round(he):Math.floor(he)))for(var ve=0;ve<k;ve++){var we=ve+ee;if(!(we<0||we>=d)){var Ee=ue+we*t.strides[2],Ce=we*x;M===Math.min(u-1,i?Math.round(Ce):Math.floor(Ce))&&($+=p[Ee+Q])}}}}f[q+Q]=$}return Qo(f,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,o,a,s){pe([t,r,i,a,s],"batchNorm");for(var u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),h=a?this.readSync(a.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),f=new Float32Array(u.length),p=d.length,m=h.length,g=c.length,y=l.length,x=0,_=0,b=0,C=0,k=0;k<u.length;++k)f[k]=d[x++]+(u[k]-l[_++])*h[b++]/Math.sqrt(c[C++]+o),x>=p&&(x=0),_>=y&&(_=0),b>=m&&(b=0),C>=g&&(C=0);return Qo(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,o,a){pe(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,l=this.readSync(t.dataId),c=t.size,h=new Float32Array(c);function d(g){for(var y=g%s,x=g-y+Math.max(0,y-r),_=g-y+Math.min(y+r,u),b=0;x<=_;x++){var C=l[x];b+=C*C}return b}for(var f=0;f<c;f++){var p=d(f),m=l[f]*Math.pow(i+o*p,-a);h[f]=m}return Qo(h,t.shape)},e.prototype.LRNGrad=function(t,r,i,o,a,s,u){pe(t,"LRNGrad");for(var l=t.shape[3],c=this.readSync(t.dataId),h=this.readSync(r.dataId),d=this.readSync(i.dataId),f=new Float32Array(t.size),p=t.size,m=0;m<p;m++){for(var g=m%l,y=m-g+Math.max(0,g-o),x=m-g+Math.min(l,g+o+1),_=0,b=y;b<x;b++)_+=Math.pow(h[b],2);for(_=s*_+a,b=y;b<x;b++){var C=-2*s*u*h[b]*d[m]/_;m===b&&(C+=Math.pow(_,-u)),C*=c[m],f[b]+=C}}return Qo(f,t.shape)},e.prototype.multinomial=function(t,r,i,o){pe(t,"multinomial");for(var a=r?t:_0(t),s=a.shape[0],u=a.shape[1],l=wn([s,i],"int32"),c=this.readSync(l.dataId),h=this.readSync(a.dataId),d=0;d<s;++d){var f=d*u,p=new Float32Array(u-1);p[0]=h[f];for(var m=1;m<p.length;++m)p[m]=p[m-1]+h[f+m];for(var g=b0(o.toString()),y=d*i,x=0;x<i;++x){var _=g();c[y+x]=p.length;for(var b=0;b<p.length;b++)if(_<p[b]){c[y+x]=b;break}}}return l},e.prototype.oneHot=function(t,r,i,o){pe(t,"oneHot");var a=new Float32Array(t.size*r);a.fill(o);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=i);return Ml(a,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,o,a){return pe(t,"nonMaxSuppression"),ZE(this.readSync(t.dataId),this.readSync(r.dataId),i,o,a)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],a=et(t.shape,"float32"),s=et(t.shape,"float32"),u=zi(t).as2D(i,o),l=Zo(t).as2D(i,o),c=0;c<i;c++)for(var h=u.slice([c,0],[1,o]),d=l.slice([c,0],[1,o]),f=lr(h,d),p=this.readSync(this.fftImpl(f,r).dataId),m=0;m<o;m++){var g=ER(p,m);a.values[c*o+m]=g.real,s.values[c*o+m]=g.imag}return lr(a.toTensor(),s.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(a=lr(zi(a).div(Le(o)),Zo(a).div(Le(o)))),a}var s=this.readSync(t.dataId),u=function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),d=0;d<l.length;d+=2)c[d/2]=l[d],h[d/2]=l[d+1];return{real:c,imag:h}}(this.fourierTransformByMatmul(s,o,r));return lr(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var o=this.readSync(t.dataId),a=r/2,s=function(y){for(var x=Math.ceil(y.length/4),_=new Float32Array(x),b=new Float32Array(x),C=0;C<y.length;C+=4)_[Math.floor(C/4)]=y[C],b[Math.floor(C/4)]=y[C+1];return{real:_,imag:b}}(o),u=lr(s.real,s.imag).as1D(),l=function(y){for(var x=Math.floor(y.length/4),_=new Float32Array(x),b=new Float32Array(x),C=2;C<y.length;C+=4)_[Math.floor(C/4)]=y[C],b[Math.floor(C/4)]=y[C+1];return{real:_,imag:b}}(o),c=lr(l.real,l.imag).as1D();u=this.fftRadix2(u,a,i),c=this.fftRadix2(c,a,i);var h=function(y,x){for(var _=new Float32Array(y/2),b=new Float32Array(y/2),C=0;C<Math.ceil(y/2);C++){var k=(x?2:-2)*Math.PI*(C/y);_[C]=Math.cos(k),b[C]=Math.sin(k)}return{real:_,imag:b}}(r,i),d=lr(h.real,h.imag).mul(c),f=u.add(d),p=u.sub(d),m=zi(f).concat(zi(p)),g=Zo(f).concat(Zo(p));return lr(m,g).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,l=0;l<r;l++){var c=Voe(a*l,r,i),h=ER(t,l);s+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}i&&(s/=r,u/=r),Boe(o,s,u,a)}return o},e.prototype.depthToSpace=function(t,r,i){U(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),U(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],l=a*r,c=s*r,h=u/(r*r),d=this.readSync(t.dataId),f=new Float32Array(o*l*c*h),p=0,m=0;m<o;++m)for(var g=0;g<l;++g)for(var y=Math.floor(g/r),x=g%r,_=0;_<c;++_)for(var b=Math.floor(_/r),C=(x*r+_%r)*h,k=0;k<h;++k){var T=k+C+u*(b+s*(y+a*m));f[p++]=d[T]}return Qo(f,[o,l,c,h])},e.prototype.broadcastedBinaryOp=function(t,r,i,o){var a=pt(t.shape,r.shape),s=et(a,i),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=ou(t.shape,a),h=ou(r.shape,a),d=s.values;if(c.length+h.length===0)for(var f=0;f<d.length;++f)d[f]=o(u[f%u.length],l[f%l.length]);else{var p=this.bufferSync(t),m=this.bufferSync(r),g=function(y){var x=s.indexToLoc(y),_=x.slice(-t.rank);c.forEach(function(T){return _[T]=0});var b=p.locToIndex(_),C=x.slice(-r.rank);h.forEach(function(T){return C[T]=0});var k=m.locToIndex(C);d[y]=o(u[b],l[k])};for(f=0;f<d.length;++f)g(f)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=pt(t.shape,r.shape),a=et(o,"float32"),s=et(o,"float32"),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=ou(t.shape,o),h=ou(r.shape,o),d=a.values,f=s.values;if(c.length+h.length===0)for(var p=0;p<d.length;p++){var m=p%u.length,g=p%l.length,y=i(u[2*m],u[2*m+1],l[2*g],l[2*g+1]);d[p]=y.real,f[p]=y.imag}else{var x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),_=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(C){var k=a.indexToLoc(C),T=k.slice(-t.rank);c.forEach(function(O){return T[O]=0});var E=x.locToIndex(T),I=k.slice(-r.rank);h.forEach(function(O){return I[O]=0});var R=_.locToIndex(I),N=i(u[2*E],u[2*E+1],l[2*R],l[2*R+1]);d[C]=N.real,f[C]=N.imag};for(p=0;p<d.length;p++)b(p)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(t,r,i){return NF(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,o,a,s){for(var u=t.shape,l=u[0],c=u[1],h=u[2],d=u[3],f=r.shape[0],p=o[0],m=o[1],g=et([f,p,m,d],"float32"),y=this.readSync(r.dataId),x=this.readSync(i.dataId),_=this.readSync(t.dataId),b=t.strides,C=g.strides,k=0;k<f;k++){var T=4*k,E=y[T],I=y[T+1],R=y[T+2],N=y[T+3],O=x[k];if(!(O>=l))for(var M=p>1?(R-E)*(c-1)/(p-1):0,q=m>1?(N-I)*(h-1)/(m-1):0,J=0;J<p;J++){var ee=p>1?E*(c-1)+J*M:.5*(E+R)*(c-1);if(ee<0||ee>c-1)for(var Q=0;Q<m;Q++)for(var $=0;$<d;$++){var K=$+Q*C[2]+J*C[1]+k*C[0];g.values[K]=s}else if(a==="bilinear"){var j=Math.floor(ee),ue=Math.ceil(ee),he=ee-j;for(Q=0;Q<m;Q++)if((Be=m>1?I*(h-1)+Q*q:.5*(I+N)*(h-1))<0||Be>h-1)for($=0;$<d;$++)K=$+Q*C[2]+J*C[1]+k*C[0],g.values[K]=s;else{var ve=Math.floor(Be),we=Math.ceil(Be),Ee=Be-ve;for($=0;$<d;$++){var Ce=_[K=$+ve*b[2]+j*b[1]+O*b[0]],Ie=_[K=$+we*b[2]+j*b[1]+O*b[0]],ce=_[K=$+ve*b[2]+ue*b[1]+O*b[0]],Ue=Ce+(Ie-Ce)*Ee,je=ce+(_[K=$+we*b[2]+ue*b[1]+O*b[0]]-ce)*Ee;K=$+Q*C[2]+J*C[1]+k*C[0],g.values[K]=Ue+(je-Ue)*he}}}else for(Q=0;Q<m;++Q){var Be;if((Be=m>1?I*(h-1)+Q*q:.5*(I+N)*(h-1))<0||Be>h-1)for($=0;$<d;$++)K=$+Q*C[2]+J*C[1]+k*C[0],g.values[K]=s;else{var Ge=Math.round(Be),We=Math.round(ee);for($=0;$<d;$++){var ut=$+Ge*b[2]+We*b[1]+O*b[0],ot=$+Q*C[2]+J*C[1]+k*C[0];g.values[ot]=_[ut]}}}}}return g.toTensor()},e.prototype.sparseToDense=function(t,r,i,o){var a=xy(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,h=a.outputSize;return this.scatter(t,r,i,h,l,u,s,c,o,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=_F(t,r),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return dr([],s,t.dtype);for(var h=new _p([u,l],t.dtype),d=this.readSync(r.dataId),f=this.readSync(t.dataId),p=0;p<u;p++){for(var m=[],g=0,y=0;y<o;y++){var x=d[p*o+y];g+=x*c[y],m.push(x)}if(g<0||g>=t.size/l)throw new Error("Invalid indices: "+m+" does not index into "+t.shape);for(var _=0;_<l;_++)h.values[p*l+_]=f[g*l+_]}return h.toTensor().reshape(s)},e.prototype.scatterND=function(t,r,i){var o=xy(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=Le(0);return this.scatter(t,r,i,c,u,s,a,l,h,!0)},e.prototype.fill=function(t,r,i){var o=uy(i=i||om(r),De(t));return o.fill(r),X.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=uy(t.dtype,De(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return kF(t,r,i)},e.prototype.scatter=function(t,r,i,o,a,s,u,l,c,h){var d=[o/a,a],f=this.readSync(t.dataId),p=this.readSync(r.dataId);if(o===0)return dr([],i,r.dtype);var m=new _p(d,r.dtype);m.values.fill(this.readSync(c.dataId)[0]);for(var g=0;g<s;g++){for(var y=[],x=0,_=0;_<u;_++){var b=f[g*u+_];y.push(b),x+=b*l[_]}if(x<0||x>=o/a)throw new Error("Invalid indices: "+y+" does not index into "+i);for(var C=0;C<a;C++)h?m.values[x*a+C]+=p[g*a+C]:m.values[x*a+C]=r.rank===0?p[0]:p[g*a+C]}return m.toTensor().reshape(i)},e}(IF);function S4(n,e){return{kernelName:n,backendName:"cpu",kernelFunc:function(t){var r=t.inputs,i=t.backend,o=r,a=o.a,s=o.b,u=i;pe([a,s],n);var l=u.data.get(a.dataId).values,c=u.data.get(s.dataId).values,h=e(a.shape,s.shape,l,c,a.dtype),d=h[0],f=h[1];return{dataId:u.write(d,f,a.dtype),shape:f,dtype:a.dtype}}}}function R4(n){return function(e,t,r,i,o){var a=pt(e,t),s=a.length,u=Ti(a),l=od(o,De(a)),c=e.length,h=t.length,d=Ti(e),f=Ti(t),p=ou(e,a),m=ou(t,a);if(p.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],i[g%i.length]);else{var y=function(x){var _=JM(x,s,u),b=_.slice(-c);p.forEach(function(E){return b[E]=0});var C=y_(b,c,d),k=_.slice(-h);m.forEach(function(E){return k[E]=0});var T=y_(k,h,f);l[x]=n(r[C],i[T])};for(g=0;g<l.length;++g)y(g)}return[l,a]}}X.registerBackend("cpu",function(){return new Vle},1);var Ule=R4(function(n,e){return n/e}),Wle=S4(y0,Ule),jle={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t,a=o.filterSize,s=o.strides,u=o.pad,l=o.includeBatchInIndex,c=r;pe(i,"MaxPoolWithArgmax");var h=c.data.get(i.dataId).values,d=Jl(i.shape,a,s,[1,1],u),f=function(x,_,b,C,k){var T=S_(x,0,b,Ti(_),k,"max"),E=I4(x,_,b,k,!0,C);return[T.values,E.values]}(h,i.shape,i.dtype,l,d),p=f[0],m=f[1],g=c.write(p,d.outShape,i.dtype),y=c.write(m,d.outShape,i.dtype);return[{dataId:g,shape:d.outShape,dtype:i.dtype},{dataId:y,shape:d.outShape,dtype:"int32"}]}},zle={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,d=t;pe(o,"NonMaxSuppressionWithScore");var f=e2(d.data.get(o.dataId).values,d.data.get(a.dataId).values,u,l,c,h);return[f.selectedIndices,f.selectedScores]}},$le={kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;pe(r,"square");for(var o=i.data.get(r.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Hle=R4(function(n,e){var t=n-e;return t*t});function k4(n,e,t,r,i){for(var o=De(e),a=e.length,s=Ti(e),u=Ti(i),l=od(t,De(i)),c=0;c<o;++c){for(var h=JM(c,a,s),d=new Array(h.length),f=0;f<d.length;f++)d[f]=h[r[f]];l[y_(d,a,u)]=n[c]}return l}for(var px=0,HR=[zle,$le,S4(x0,Hle),Wle,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t.perm,a=r;pe(i,"transpose");for(var s=i.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=i.shape[o[l]];var c=k4(a.data.get(i.dataId).values,i.shape,i.dtype,o,u);return{dataId:a.write(c,u,i.dtype),shape:u,dtype:i.dtype}}},jle];px<HR.length;px++)HM(HR[px]);var Wc,Gle=function(n){this.variableNames=["A"];var e=Nr(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},qle=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Nr(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `},Kle=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=en(this.rank),o=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},Xle=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=en(this.rank),o=OF("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `};for(var mx=0,GR=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,o=r.numChannels,a=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],h=[c,l],d=[c,l,o];(s||a)&&(Wc==null&&(Wc=document.createElement("canvas").getContext("2d")),Wc.canvas.width=l,Wc.canvas.height=c,Wc.drawImage(i,0,0,l,c),i=Wc.canvas);var f=t.makeTensorInfo(h,"int32");t.texData.get(f.dataId).usage=_i.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),i);var p=le().getBool("WEBGL_PACK")?new qle(d):new Gle(d),m=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),m}},{kernelName:y0,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e;return function(i,o,a){var s=new yn(oae,i.shape,o.shape);return le().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(s=new Go(aae,i.shape,o.shape,!0)),a.runWebGLProgram(s,[i,o],"float32")}(r.a,r.b,t)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;dy("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,d=t,f=e2(d.readSync(o.dataId),d.readSync(a.dataId),u,l,c,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,o=new st(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:x0,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,o=r.b,a=t,s=le().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Go("return (a - b) * (a - b);",i.shape,o.shape):new yn("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(n){for(var e,t=n.inputs,r=n.attrs,i=n.backend,o=t.x,a=r.perm,s=i,u=o.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=o.shape[a[c]];if(s.shouldExecuteOnCPU([o])){var h=k4(s.texData.get(o.dataId).values,o.shape,o.dtype,a,l);e=s.makeTensorInfo(l,o.dtype),s.texData.get(e.dataId).values=h}else e=function(d,f,p){var m=le().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xle(d.shape,f):new Kle(d.shape,f);return p.runWebGLProgram(m,[d],d.dtype)}(o,a,s);return e}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t,a=o.filterSize,s=o.strides,u=o.pad,l=o.includeBatchInIndex,c=r;U(i.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+i.shape.length+"."});var h=[1,1];U(Hr(s,h),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+h+"'"});var d=Jl(i.shape,a,s,h,u),f=function(p,m,g,y){var x=new jf(g,"max",!1),_=y.runWebGLProgram(x,[p],"float32");return x=new jf(g,"max",!0,!0,m),[_,y.runWebGLProgram(x,[p],"float32")]}(i,l,d,c);return[f[0],f[1]]}}];mx<GR.length;mx++)HM(GR[mx]);for(var vx=0,qR=[{kernelName:dF,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=pt(t.shape,r.shape);return{a:function(){var o=n,a=$n(t.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(t.shape)},b:function(){var o=n,a=$n(r.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(n,e){var t={};return e.forEach(function(r,i){t[i]=function(){return n.clone()}}),t}},{kernelName:fF,gradFunc:function(n,e,t){for(var r=t,i=r.inputShape,o=r.shape,a=Array.from(o),s=i.length-1;s>=0;s--)if(i[s]===o[s])a[s]=1;else if(i[s]!==1)throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+o+"].");var u=[];for(s=0;s<a.length;s++)a[s]>1&&u.push(s);return{x:function(){return n.sum(u,!0)}}}},{kernelName:y0,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=pt(t.shape,r.shape);return{a:function(){var o=Ou(n,r.toFloat()),a=$n(t.shape,i);return a.length>0?qs(o,a).reshape(t.shape):o},b:function(){var o=n.mul(t.toFloat()),a=$n(r.shape,i);a.length>0&&(o=qs(o,a).reshape(r.shape));var s=n4(r);return XE(Ou(o,s.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,e,t){var r=t.varianceEpsilon,i=e[0],o=e[1],a=e[2],s=e[3],u=HF(i),l=s??Le(1),c=$n(o.shape,u.shape),h=[];if(o.rank===1){for(var d=0;d<u.shape.length-1;++d)h.push(u.shape[d]);h.push(1)}var f=Ro(i,o),p=xn(n,l),m=yF(ro(a,Le(r))),g=xn(xn(xn(m,m),m),Le(-.5));return{x:function(){return o.rank===1?Va(xn(xn(n,kh(m.as4D(1,1,1,o.shape[0]),h)),l),i.shape):Va(xn(xn(n,m),l),i.shape)},mean:function(){var y=xn(xn(m,Le(-1)),p);return o.rank===1&&(y=qs(y,c)),Va(y,o.shape)},variance:function(){var y=xn(xn(g,f),p);return o.rank===1&&(y=qs(y,c)),Va(y,o.shape)},scale:function(){var y=xn(f,m),x=xn(n,y);return o.rank===1&&(x=qs(x,c)),Va(x,o.shape)},offset:function(){var y=n;return o.rank===1&&(y=qs(y,c)),Va(y,o.shape)}}}},{kernelName:mF,gradFunc:function(n){return{x:function(){return n.toFloat()}}}},{kernelName:pF,inputsToSave:["indices"],gradFunc:function(n,e){var t=e[0];return{indices:function(){return wn(t.shape,"float32")}}}},{kernelName:gF,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],i=t.paddings.map(function(o){return o[0]});return{x:function(){return n.slice(i,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:x0,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=Le(2);return{a:function(){return xn(n,xn(i,Ro(t,r)))},b:function(){return xn(n,xn(i,Ro(r,t)))}}}},{kernelName:vF,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],i=t.reps;return{x:function(){var o=Ct(r);if(r.rank===1)for(var a=0;a<i[0];++a)o=o.add(n.slice([a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(a=0;a<i[0];++a)for(var s=0;s<i[1];++s)o=o.add(n.slice([a*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(a=0;a<i[0];++a)for(s=0;s<i[1];++s)for(var u=0;u<i[2];++u)o=o.add(n.slice([a*r.shape[0],s*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(r.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(a=0;a<i[0];++a)for(s=0;s<i[1];++s)for(u=0;u<i[2];++u)for(var l=0;l<i[3];++l)o=o.add(n.slice([a*r.shape[0],s*r.shape[1],u*r.shape[2],l*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return o}}}},{kernelName:"Transpose",gradFunc:function(n,e,t){var r=qE(t.perm);return{x:function(){return _o(n,r)}}}}];vx<qR.length;vx++)Mre(qR[vx]);var Qle=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();le().get("IS_BROWSER")&&le().setPlatform("browser",new Qle);var gx,Yle=function(){return require("node-fetch")},Jle=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return le().global.fetch!=null?le().global.fetch(e,t):(gx==null&&(gx=Yle()),gx(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n}();le().get("IS_NODE")&&le().setPlatform("node",new Jle);var R_={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ty=4;function A4(n,e){for(var t={},r=0,i=function(s){var u=s.name,l=s.dtype,c=s.shape,h=De(c),d=void 0;if("quantization"in s){var f=s.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=R_[f.dtype],m=n.slice(r,r+h*p),g=f.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(l==="float32")d=Float32Array.from(g,function(k){return k*f.scale+f.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=Int32Array.from(g,function(k){return Math.round(k*f.scale+f.min)})}r+=h*p}else if(l==="string"){var y=De(s.shape);d=[];for(var x=0;x<y;x++){var _=new Uint32Array(n.slice(r,r+Ty))[0];r+=Ty;var b=new Uint8Array(n.slice(r,r+_));d.push(b),r+=_}}else{var C=R_[l];if(m=n.slice(r,r+h*C),l==="float32")d=new Float32Array(m);else if(l==="int32")d=new Int32Array(m);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=new Uint8Array(m)}r+=h*C}t[u]=dr(d,c,l)},o=0,a=e;o<a.length;o++)i(a[o]);return t}function Zle(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return t.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var k_=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function KR(n){return k_?Buffer.byteLength(n):new Blob([n]).size}function g2(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function XR(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function hm(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:KR(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:KR(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var bi=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var a=o(e,r);a!==null&&i.push(a)}),i},n}(),Ah="://",_u=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){U(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Ah)&&(e=e.slice(0,e.indexOf(Ah))),U(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();U(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function tg(n){if(n.indexOf(Ah)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+_u.getSchemes().join(","));return{scheme:n.split(Ah)[0],path:n.split(Ah)[1]}}function QR(n,e,t){return t===void 0&&(t=!1),Pe(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,h;return Oe(this,function(d){switch(d.label){case 0:return U(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),U((r=bi.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),U(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),i=r[0],U((o=bi.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),U(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=o[0],s=tg(n).scheme,u=tg(n).path,l=s===tg(n).scheme,[4,i.load()];case 1:return c=d.sent(),t&&l?[4,_u.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(c)];case 4:return h=d.sent(),!t||l?[3,6]:[4,_u.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var Al="models_store",au="model_info_store";function N4(){if(!le().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function A_(n){var e=n.result;e.createObjectStore(Al,{keyPath:"modelPath"}),e.createObjectStore(au,{keyPath:"modelPath"})}var Nh=function(){function n(e){if(this.indexedDB=N4(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return A_(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(Al,"readonly"),l=u.objectStore(Al).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=hm(t),d=s.transaction(au,"readwrite"),f=d.objectStore(au),p=f.put({modelPath:r.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var m=(c=s.transaction(Al,"readwrite")).objectStore(Al).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});m.onsuccess=function(){return i({modelArtifactsInfo:h})},m.onerror=function(g){var y=(f=d.objectStore(au)).delete(r.modelPath);y.onsuccess=function(){return s.close(),o(m.error)},y.onerror=function(x){return s.close(),o(m.error)}}},p.onerror=function(m){return s.close(),o(p.error)},d.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},n.URL_SCHEME="indexeddb://",n}(),YR=function(n){return le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Nh.URL_SCHEME)?(e=n.slice(Nh.URL_SCHEME.length),new Nh(e)):null;var e};bi.registerSaveRouter(YR),bi.registerLoadRouter(YR);var ece=function(){function n(){this.indexedDB=N4()}return n.prototype.listModels=function(){return Pe(this,void 0,void 0,function(){var e=this;return Oe(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return A_(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(au,"readonly"),u=s.objectStore(au).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var d=h[c];l[d.modelPath]=d.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return Pe(this,void 0,void 0,function(){var t=this;return Oe(this,function(r){var i;return e=(i=e).startsWith(Nh.URL_SCHEME)?i.slice(Nh.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return A_(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(au,"readwrite"),h=c.objectStore(au),d=h.get(e);d.onsuccess=function(){if(d.result==null)return l.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var f=h.delete(e),p=function(){var m=(u=l.transaction(Al,"readwrite")).objectStore(Al).delete(e);m.onsuccess=function(){return o(d.result.modelArtifactsInfo)},m.onerror=function(g){return a(d.error)}};f.onsuccess=p,f.onerror=function(m){return p(),l.close(),a(d.error)}},d.onerror=function(f){return l.close(),a(d.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},n}();if(le().getBool("IS_BROWSER"))try{_u.registerManager(Nh.URL_SCHEME,new ece)}catch{}var ja="/",eh="tensorflowjs_models",D4="info",tce="model_topology",nce="weight_specs",rce="weight_data",ice="model_metadata";function P4(n){return{info:[eh,n,D4].join(ja),topology:[eh,n,tce].join(ja),weightSpecs:[eh,n,nce].join(ja),weightData:[eh,n,rce].join(ja),modelMetadata:[eh,n,ice].join(ja)}}function oce(n){var e=n.split(ja);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(ja)}var Dh=function(){function n(e){if(!le().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=P4(this.modelPath)}return n.prototype.save=function(e){return Pe(this,void 0,void 0,function(){var t,r,i;return Oe(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=hm(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(k_)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return Pe(this,void 0,void 0,function(){var e,t,r,i,o,a,s;return Oe(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(l){if(k_){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),d=new Uint8Array(h.length),f=0;f<h.length;++f)d.set([h.charCodeAt(f)],f);return d.buffer}(s),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),JR=function(n){return le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Dh.URL_SCHEME)?(e=n.slice(Dh.URL_SCHEME.length),new Dh(e)):null;var e};bi.registerSaveRouter(JR),bi.registerLoadRouter(JR);var ace=function(){function n(){U(le().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),U(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Pe(this,void 0,void 0,function(){var e,t,r,i,o,a;return Oe(this,function(s){for(e={},t=eh+ja,r=ja+D4,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(a=oce(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return Pe(this,void 0,void 0,function(){var t,r;return Oe(this,function(i){var o;if(e=(o=e).startsWith(Dh.URL_SCHEME)?o.slice(Dh.URL_SCHEME.length):o,t=P4(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(le().getBool("IS_BROWSER"))try{_u.registerManager(Dh.URL_SCHEME,new ace)}catch{}var sce="model",uce=".json",lce=".weights.bin";function ZR(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var yx=function(){function n(e){if(!le().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=sce),this.modelTopologyFileName=e+uce,this.weightDataFileName=e+lce}return n.prototype.save=function(e){return Pe(this,void 0,void 0,function(){var t,r,i,o,a,s;return Oe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,ZR(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,ZR(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:hm(e)}]}})})},n.URL_SCHEME="downloads://",n}(),cce=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return Pe(this,void 0,void 0,function(){var e,t,r=this;return Oe(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){t.length===0&&o({modelTopology:c});var h=l.weightsManifest;if(h!=null){var d;try{d=r.checkManifestAndWeightFiles(h,t)}catch(g){return void a(g)}var f=[],p=[],m=[];h.forEach(function(g){g.paths.forEach(function(y){p.push(y),m.push(null)}),f.push.apply(f,g.weights)}),h.forEach(function(g){g.paths.forEach(function(y){var x=new FileReader;x.onload=function(_){var b=_.target.result,C=p.indexOf(y);m[C]=b,m.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:f,weightData:g2(m),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},x.onerror=function(_){return a("Failed to weights data from file of path '"+y+"'.")},x.readAsArrayBuffer(d[y])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map(function(u){return XR(u.name)}),o={},a=0,s=e;a<s.length;a++)s[a].paths.forEach(function(u){var l=XR(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=t[i.indexOf(l)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n}();function ek(n,e,t,r){(function(o){U(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(n),function(o,a){U(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),U(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),U(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})}(t=t??0,r=r??1);var i=0;return Promise.all(n.map(function(o){return o.then(function(a){var s=t+ ++i/n.length*(r-t);return e(s),a}),o}))}function O4(n,e){return Pe(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c;return Oe(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?le().platform.fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,ek(r,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,ek(s,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}function tk(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),Pe(e,void 0,void 0,function(){var o,a,s,u,l,c,h,d,f,p;return Oe(this,function(m){switch(m.label){case 0:if(o=t.map(function(){return!1}),a={},s=i!=null?i.map(function(){return!1}):[],u=[],t.forEach(function(g,y){var x=0;g.weights.forEach(function(_){var b="quantization"in _?_.quantization.dtype:_.dtype,C=R_[b]*De(_.shape),k=function(){o[y]=!0,a[y]==null&&(a[y]=[]),a[y].push({manifestEntry:_,groupOffset:x,sizeBytes:C})};i!=null?i.forEach(function(T,E){T===_.name&&(k(),s[E]=!0)}):k(),u.push(_.name),x+=C})}),!s.every(function(g){return g}))throw l=i.filter(function(g,y){return!s[y]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce(function(g,y,x){return y&&g.push(x),g},[]),h=[],c.forEach(function(g){t[g].paths.forEach(function(y){var x=r+(r.endsWith("/")?"":"/")+y;h.push(x)})}),[4,n(h)];case 1:return d=m.sent(),f={},p=0,c.forEach(function(g){for(var y=t[g].paths.length,x=0,_=0;_<y;_++)x+=d[p+_].byteLength;for(var b=new ArrayBuffer(x),C=new Uint8Array(b),k=0,T=0;T<y;T++){var E=new Uint8Array(d[p+T]);C.set(E,k),k+=E.byteLength}a[g].forEach(function(I){var R=A4(b.slice(I.groupOffset,I.groupOffset+I.sizeBytes),[I.manifestEntry]);for(var N in R)f[N]=R[N]}),p+=y}),[2,f]}})})}}bi.registerSaveRouter(function(n){return le().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(yx.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new yx(e)}(n.slice(yx.URL_SCHEME.length)):null});var M4=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(U(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=le().platform.fetch,U(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&U(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Pe(this,void 0,void 0,function(){var t,r,i,o;return Oe(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:hm(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return Pe(this,void 0,void 0,function(){var e,t,r,i,o,a,s,u,l,c,h,d;return Oe(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,l=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:d=f.sent(),c=d[0],h=d[1],f.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}})})},n.prototype.loadWeights=function(e){return Pe(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,d;return Oe(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var m=p.lastIndexOf("/"),g=p.lastIndexOf("?"),y=p.substring(0,m),x=g>m?p.substring(g):"";return[y+"/",x]}(t),i=r[0],o=r[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],e.forEach(function(p){p.paths.forEach(function(m){h.push(a+m+o)})}),[4,O4(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=f.sent(),[2,[s,g2(d)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function N_(n){return n.match(M4.URL_SCHEME_REGEX)!=null}var nk=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return N_(t)}):N_(n))?D_(n,{onProgress:e}):null};function D_(n,e){return new M4(n,e)}bi.registerSaveRouter(nk),bi.registerLoadRouter(nk);var xx=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(e){return[2,this.modelArtifacts]})})},n}(),hce=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){return[2,this.saveHandler(e)]})})},n}(),F4=Object.freeze({browserFiles:function(n){return new cce(n)},browserHTTPRequest:function(n,e){return D_(n,e)},concatenateArrayBuffers:g2,decodeWeights:A4,encodeWeights:function(n,e){return Pe(this,void 0,void 0,function(){var t,r,i,o,a,s=this;return Oe(this,function(u){switch(u.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),o=function(l){var c=i[l],h=Array.isArray(n)?n[l].tensor:n[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var d={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var f=new Promise(function(p){return Pe(s,void 0,void 0,function(){var m,g,y,x,_,b,C;return Oe(this,function(k){switch(k.label){case 0:return[4,h.bytes()];case 1:for(m=k.sent(),g=m.reduce(function(T,E){return T+E.length},0)+Ty*m.length,y=new Uint8Array(g),x=0,_=0;_<m.length;_++)b=m[_],C=new Uint8Array(new Uint32Array([b.length]).buffer),y.set(C,x),x+=Ty,y.set(b,x),x+=b.length;return p(y),[2]}})})});r.push(f)}else r.push(h.data());e!=null&&(d.group=e),t.push(d)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:Zle(u.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new xx(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xx({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xx({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return bi.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:hm,getSaveHandlers:function(n){return bi.getSaveHandlers(n)},http:D_,isHTTPScheme:N_,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),Pe(this,void 0,void 0,function(){return Oe(this,function(i){return[2,tk(function(o){return O4(o,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return bi.registerLoadRouter(n)},registerSaveRouter:function(n){return bi.registerSaveRouter(n)},weightsLoaderFactory:tk,withSaveHandler:function(n){return new hce(n)},copyModel:function(n,e){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){return[2,QR(n,e,!1)]})})},listModels:function(){return Pe(this,void 0,void 0,function(){var n,e,t,r,i,o,a;return Oe(this,function(s){switch(s.label){case 0:n=_u.getSchemes(),e={},t=0,r=n,s.label=1;case 1:return t<r.length?(i=r[t],[4,_u.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())e[i+Ah+a]=o[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){return[2,QR(n,e,!0)]})})},removeModel:function(n){return Pe(this,void 0,void 0,function(){var e;return Oe(this,function(t){return e=tg(n),[2,_u.getManager(e.scheme).removeModel(e.path)]})})}}),jc;G({confusionMatrix_:function(n,e,t){var r=V(n,"labels","confusionMatrix"),i=V(e,"predictions","confusionMatrix");U(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),U(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),U(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),U(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),U(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=Ey(r.asType("int32"),t),a=Ey(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}});var dce=G({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);a=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if($M("FromPixels",X.backendName)!=null)return X.runKernel("FromPixels",{pixels:n},{numChannels:e});var s,u,l=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],h=l[1];if(a?s=n.getContext("2d").getImageData(0,0,c,h).data:r||t?s=n.data:(o||i)&&(jc==null&&(jc=document.createElement("canvas").getContext("2d")),jc.canvas.width=c,jc.canvas.height=h,jc.drawImage(n,0,0,c,h),s=jc.getImageData(0,0,c,h).data),e===4)u=new Int32Array(s);else{var d=c*h;u=new Int32Array(d*e);for(var f=0;f<d;f++)for(var p=0;p<e;++p)u[f*e+p]=s[4*f+p]}return oF(u,[h,c,e],"int32")}}),L4=Object.freeze({toPixels:function(n,e){return Pe(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,d,f,p,m,g,y,x,_,b,C,k,T,E;return Oe(this,function(I){switch(I.label){case 0:if(t=V(n,"img","toPixels"),n instanceof Yt||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=I.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=I.sent(),h=c[0],d=c[1],f=h[0],p=d[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m=t.dtype==="float32"?255:1,g=new Uint8ClampedArray(o*i*4),y=0;y<i*o;++y)x=void 0,_=void 0,b=void 0,C=void 0,a===1?(x=s[y]*m,_=s[y]*m,b=s[y]*m,C=255):a===3?(x=s[3*y]*m,_=s[3*y+1]*m,b=s[3*y+2]*m,C=255):a===4&&(x=s[4*y]*m,_=s[4*y+1]*m,b=s[4*y+2]*m,C=s[4*y+3]*m),g[(k=4*y)+0]=Math.round(x),g[k+1]=Math.round(_),g[k+2]=Math.round(b),g[k+3]=Math.round(C);return e!=null&&(e.width=o,e.height=i,T=e.getContext("2d"),E=new ImageData(g,o,i),T.putImageData(E,0,0)),t!==n&&t.dispose(),[2,g]}})})},fromPixels:dce}),fce=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),pce=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function yc(n){U(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),U(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),U(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),pce.register(n)}var xc=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Do(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return si(s),r?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return Foe(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&si(this.iterations_)},e.prototype.saveIterations=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Le(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){return Oe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Pe(this,void 0,void 0,function(){var r;return Oe(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(fce);Object.defineProperty(xc,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var mce=function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=X.backend.epsilon()),o}return Do(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=X.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Ot(function(){return Ct(a).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Ot(function(){return Ct(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;Ot(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),d=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(d);var f=h.mul(-r.learningRate).add(a);a.assign(f)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(si(this.accumulatedGrads.map(function(t){return t.variable})),si(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){var t;return Oe(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){var r;return Oe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(xc);yc(mce);var vce=function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Do(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=X.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Ot(function(){return Fl(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable;Ot(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(X.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&si(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){return Oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(xc);yc(vce);var gce=function(n){function e(t,r,i,o){o===void 0&&(o=null);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Ot(function(){a.accBeta1=Le(r).variable(),a.accBeta2=Le(i).variable()}),o==null&&(a.epsilon=X.backend.epsilon()),a}return Do(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Ot(function(){var o=Ro(1,r.accBeta1),a=Ro(1,r.accBeta2);i.forEach(function(s,u){var l=X.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Ot(function(){return Ct(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Ot(function(){return Ct(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,f=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=d.mul(r.beta2).add(c.square().mul(1-r.beta2)),m=f.div(o),g=p.div(a);h.assign(f),d.assign(p);var y=m.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(y)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&si(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&si(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){var t;return Oe(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){var r,i=this;return Oe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Ot(function(){i.accBeta1.assign(yy(i.beta1,i.iterations_+1)),i.accBeta2.assign(yy(i.beta2,i.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(xc);yc(gce);var yce=function(n){function e(t,r,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Ot(function(){s.iteration=Le(0).variable(),s.accBeta1=Le(r).variable()}),o==null&&(s.epsilon=X.backend.epsilon()),s}return Do(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Ot(function(){var o=Ro(1,r.accBeta1),a=Ou(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(s,u){var l=X.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Ct(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Ct(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,f=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=d.mul(r.beta2),m=c.abs(),g=p.maximum(m);h.assign(f),d.assign(g);var y=a.div(o).mul(f.div(g.add(r.epsilon))).add(l);l.assign(y)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&si(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&si(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){return Oe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(xc);yc(yce);var B4=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Do(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=X.registeredVariables[i];Ot(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Iie(Le(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){return Oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(xc);yc(B4);var xce=function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=Le(o.momentum),o}return Do(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=X.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:Ot(function(){return Ct(a).variable(!1)})});var s=r.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&Ot(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&si(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){return Oe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){return Oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(B4);yc(xce);var wce=function(n){function e(t,r,i,o,a){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=X.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Do(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=X.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Ot(function(){return Ct(a).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:Ot(function(){return Ct(a).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Ot(function(){return Ct(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;Ot(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[o].variable,d=h.mul(r.decay).add(s.mul(1-r.decay)),f=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(d.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(d),l.assign(f);var p=a.sub(f);a.assign(p)}else{var m=u.mul(r.decay).add(s.square().mul(1-r.decay));f=l.mul(r.momentum).add(s.mul(r.learningRate).div(m.add(r.epsilon).sqrt())),u.assign(m),l.assign(f),p=a.sub(f),a.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&si(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&si(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&si(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Pe(this,void 0,void 0,function(){var t;return Oe(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Pe(this,void 0,void 0,function(){var r;return Oe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(xc);yc(wce);Yt.prototype.add=function(n){return ro(this,n)},Yt.prototype.broadcastTo=function(n){return QF(this,n)},Yt.prototype.div=function(n){return Ou(this,n)},Yt.prototype.divNoNan=function(n){return ZF(this,n)},Yt.prototype.squaredDifference=function(n){return r4(this,n)},Yt.prototype.tile=function(n){return kh(this,n)},Yt.prototype.oneHot=function(n,e,t){return e===void 0&&(e=1),t===void 0&&(t=0),Ey(this,n,e,t)},Yt.prototype.transpose=function(n){return _o(this,n)},Yt.prototype.pad=function(n,e){return ys(this,n,e)},Yt.prototype.batchNorm=function(n,e,t,r,i){return lm(this,n,e,t,r,i)},se=Ble;var Ph=function(){function n(e,t){if(!Ll(e)||!Ll(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}(),Nt=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}();function S0(n,e){return n instanceof Yt&&n.shape.length===e}function _ce(n){return S0(n,2)}function R0(n){return S0(n,3)}function bu(n){return S0(n,4)}function bce(n){return n%1!==0}function rk(n){return n%2===0}function y2(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function ik(n){return n&&n.width&&n.height}function Ece(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Ph(Math.round(t*i),Math.round(r*i))}function x2(n){return n.reduce(function(e,t){return e.add(t)},new Nt(0,0)).div(new Nt(n.length,n.length))}function Ep(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function Ll(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function ok(n){return Ll(n)&&0<=n&&n<=1}var da=function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Ll),o=[r.x,r.y,r.width,r.height].every(Ll);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],l=a[2],c=a[3];n.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",t),this._x=s,this._y=u,this._width=l,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Ll)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Nt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Nt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Nt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Nt(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,o=e.height,a=Math.abs(i-o);return i<o&&(t-=a/2,i+=a),o<i&&(r-=a/2,o+=a),new n({x:t,y:r,width:i,height:o})},n.prototype.rescale=function(e){var t=ik(e)?e.width:e,r=ik(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],o=r[1],a=r[2],s=r[3];return new n({x:i,y:o,width:a,height:s})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,o=r.y,a=r.right,s=r.bottom,u=Math.max(i,0),l=Math.max(o,0),c=a-u,h=s-l,d=Math.min(c,e-u),f=Math.min(h,t-l);return new n({x:u,y:l,width:d,height:f}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,o=r.height,a=this.x+e,s=this.y+t;return new n({x:a,y:s,width:i,height:o})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,o=1,a=1,s=r,u=i,l=this.left,c=this.top,h=this.right,d=this.bottom;return h>t&&(s=-h+t+r,h=t),d>e&&(u=-d+e+i,d=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:o,edx:s,y:c,ey:d,x:l,ex:h,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),k0=function(n){im(e,n);function e(t,r,i,o,a){return a===void 0&&(a=!1),n.call(this,{left:t,top:r,right:i,bottom:o},a)||this}return e}(da),ak=function(n){im(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(da.assertIsValidBox(t,r),!Ll(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(da),V4=function(){function n(e,t,r,i,o){this._imageDims=new Ph(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new da(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new da(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}();(function(n){im(e,n);function e(t,r,i,o){var a=n.call(this,t,r)||this;return a._score=i,a._classScore=o,a}return e.assertIsValidPredictedBox=function(t,r){if(ak.assertIsValidLabeledBox(t,r),!ok(t.score)||!ok(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(ak);var w2=function(n){im(e,n);function e(t,r,i,o,a){return a===void 0&&(a=!1),n.call(this,{x:t,y:r,width:i,height:o},a)||this}return e}(da);function U4(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function W4(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,o){n.readFile(r,function(a,s){return a?o(a):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function j4(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=W4();return ay({Canvas:n||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:e||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:t,createImageElement:r,fetch:i},o)}function z4(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function $4(){return typeof global=="object"&&typeof require=="function"&&typeof R3<"u"&&typeof process<"u"&&!!process.version}var Wn;function Cce(){if(!Wn)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Wn}function P_(n){Wn=n}function _2(){z4()&&P_(U4()),$4()&&P_(j4())}function Tce(n){if(Wn||_2(),!Wn)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?Wn.Canvas:e,r=n.Image,i=r===void 0?Wn.Image:r;Wn.Canvas=t,Wn.Image=i,Wn.createCanvasElement=n.createCanvasElement||function(){return new t},Wn.createImageElement=n.createImageElement||function(){return new i},Wn.ImageData=n.ImageData||Wn.ImageData,Wn.Video=n.Video||Wn.Video,Wn.fetch=n.fetch||Wn.fetch,Wn.readFile=n.readFile||Wn.readFile}var Mr={getEnv:Cce,setEnv:P_,initialize:_2,createBrowserEnv:U4,createFileSystem:W4,createNodejsEnv:j4,monkeyPatch:Tce,isBrowser:z4,isNodejs:$4};_2();function b2(n){return!Mr.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function fa(n){var e=Mr.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=b2(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var Xa;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Xa||(Xa={}));var E2=function(){function n(e){e===void 0&&(e={});var t=e.anchorPosition,r=e.backgroundColor,i=e.fontColor,o=e.fontSize,a=e.fontStyle,s=e.padding;this.anchorPosition=t||Xa.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=s||4}return n}(),C2=function(){function n(e,t,r){r===void 0&&(r={}),this.text=typeof e=="string"?[e]:e instanceof n?e.text:e,this.anchor=t,this.options=new E2(r)}return n.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(r){return e.measureText(r).width}).reduce(function(r,i){return r<i?i:r},0)+2*t},n.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,r=e.padding;return this.text.length*t+2*r},n.prototype.getUpperLeft=function(e,t){var r=this.options.anchorPosition,i=r===Xa.BOTTOM_RIGHT||r===Xa.TOP_RIGHT,o=r===Xa.BOTTOM_LEFT||r===Xa.BOTTOM_RIGHT,a=this.measureWidth(e),s=this.measureHeight(),u=i?this.anchor.x-a:this.anchor.x,l=o?this.anchor.y-s:this.anchor.y;if(t){var c=t.width,h=t.height,d=Math.max(Math.min(u,c-a),0),f=Math.max(Math.min(l,h-s),0);return{x:d,y:f}}return{x:u,y:l}},n.prototype.draw=function(e){var t=b2(e),r=fa(t),i=this.options,o=i.backgroundColor,a=i.fontColor,s=i.fontSize,u=i.fontStyle,l=i.padding;r.font=s+"px "+u;var c=this.measureWidth(r),h=this.measureHeight();r.fillStyle=o;var d=this.getUpperLeft(r,t);r.fillRect(d.x,d.y,c,h),r.fillStyle=a,this.text.forEach(function(f,p){var m=l+d.x,g=l+d.y+(p+1)*s;r.fillText(f,m,g)})},n}(),H4=function(){function n(e){e===void 0&&(e={});var t=e.boxColor,r=e.lineWidth,i=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=i;var a={anchorPosition:Xa.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new E2(Object.assign({},a,o))}return n}(),G4=function(){function n(e,t){t===void 0&&(t={}),this.box=new da(e),this.options=new H4(t)}return n.prototype.draw=function(e){var t=fa(e),r=this.options,i=r.boxColor,o=r.lineWidth,a=this.box,s=a.x,u=a.y,l=a.width,c=a.height;t.strokeStyle=i,t.lineWidth=o,t.strokeRect(s,u,l,c);var h=this.options.label;h&&new C2([h],{x:s-o/2,y:u},this.options.drawLabelOptions).draw(e)},n}();const Ice=Object.freeze(Object.defineProperty({__proto__:null,get AnchorPosition(){return Xa},DrawBox:G4,DrawBoxOptions:H4,DrawTextField:C2,DrawTextFieldOptions:E2},Symbol.toStringTag,{value:"Module"}));function ko(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),Ot(function(){var i=ro(gc(n,e.filters,[1,1],t),e.bias);return r?T0(i):i})}function ws(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function A0(n,e){return function(t,r,i,o){var a=Qo(n(t*r*i*i),[i,i,t,r]),s=No(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function T2(n,e){return function(t,r,i){var o=Ml(n(t*r),[t,r]),a=No(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var q4=function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n}();function I2(n,e){return function(t,r,i){var o=Qo(n(9*t),[3,3,t,1]),a=Qo(n(t*r),[1,1,t,r]),s=No(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new q4(o,a,s)}}function S2(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new q4(t,r,i)}}function Ku(n,e){return function(t,r,i){var o=n[t];if(!S0(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function _s(n){var e=n;function t(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function K4(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(s){return s}),o=n.endsWith(".json")?i[i.length-1]:t,a=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return a=n.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+o:a+"/"+o}}function X4(n){var e=Mr.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function Sce(n){return new Promise(function(e,t){if(n instanceof Mr.getEnv().Canvas||X4(n))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}function Q4(n){var e=Mr.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Ph(n.naturalWidth,n.naturalHeight):n instanceof r?new Ph(n.videoWidth,n.videoHeight):new Ph(n.width,n.height)}function N0(n){var e=n.width,t=n.height,r=Mr.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function R2(n,e){var t=Mr.getEnv().ImageData;if(!(n instanceof t)&&!X4(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=Q4(n),i=r.width,o=r.height,a=N0({width:i,height:o});return n instanceof t?fa(a).putImageData(n,0,0):fa(a).drawImage(n,0,0,i,o),a}function Rce(n,e){return Hi(this,void 0,void 0,function(){var t,r;return Gi(this,function(i){switch(i.label){case 0:return t=Mr.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function kce(n){return Hi(this,void 0,void 0,function(){return Gi(this,function(e){switch(e.label){case 0:return[4,Rce(n)];case 1:return[2,e.sent().json()]}})})}function Ace(n,e){return Hi(this,void 0,void 0,function(){var t,r,i,o,a,s;return Gi(this,function(u){switch(u.label){case 0:return t=Mr.getEnv().createCanvasElement(),r=n.shape.slice(bu(n)?1:0),i=r[0],o=r[1],a=r[2],s=Ot(function(){return n.as3D(i,o,a).toInt()}),[4,L4.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function Nce(n,e,t){t===void 0&&(t=!1);var r=Mr.getEnv(),i=r.Image,o=r.Canvas;if(!(n instanceof i||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=Q4(n),s=e/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=N0({width:e,height:e}),h=n instanceof o?n:R2(n),d=Math.abs(u-l)/2,f=t&&u<l?d:0,p=t&&l<u?d:0;return fa(c).drawImage(h,f,p,u,l),c}function sk(n){var e=Mr.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function Dce(n,e){return Hi(this,void 0,void 0,function(){var t,r,i,o;return Gi(this,function(a){switch(a.label){case 0:return t=K4(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,kce(r)];case 1:return o=a.sent(),[2,F4.loadWeights(o,i)]}})})}function Pce(n,e){return e===void 0&&(e=!1),Ot(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var o=Math.abs(r-i),a=Math.round(o*(e?.5:1)),s=r>i?2:1,u=function(f){var p=n.shape.slice();return p[s]=f,Fl(p,0)},l=u(a),c=o-l.shape[s],h=e&&c?u(c):null,d=[h,n,l].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return no(d,s)})}var Iy=function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(R0(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(bu(i)){var a=i.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var s=i instanceof Mr.getEnv().Canvas?i:R2(i);r._canvases[o]=s,r._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Ep(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return Ece({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,Ot(function(){var i=Ep(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Yt){var u=bu(s)?s:s.expandDims();return u=Pce(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=T4.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof Mr.getEnv().Canvas)return L4.fromPixels(Nce(s,e,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=Pu(i.map(function(a){return a.toFloat()})).as4D(r.batchSize,e,e,3);return o})},n}();function or(n){return Hi(this,void 0,void 0,function(){var e,t,r;return Gi(this,function(i){switch(i.label){case 0:if(n instanceof Iy)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},r=e.map(b2),r.forEach(function(o,a){if(!sk(o)&&!R0(o)&&!bu(o))throw typeof e[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(bu(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return sk(o)&&Sce(o)}))];case 1:return i.sent(),[2,new Iy(r,Array.isArray(n))]}})})}var bs=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof ad})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof ad)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=dr(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return Hi(this,void 0,void 0,function(){return Gi(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return Hi(this,void 0,void 0,function(){var t;return Gi(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Dce(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return Hi(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h;return Gi(this,function(d){switch(d.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Mr.getEnv().readFile,r=K4(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=function(f){return Promise.all(f.map(function(p){return t(p).then(function(m){return m.buffer})}))},s=F4.weightsLoaderFactory(a),c=(l=JSON).parse,[4,t(i)];case 1:return u=c.apply(l,[d.sent().toString()]),[4,s(u,o)];case 2:return h=d.sent(),this.loadFromWeightMap(h),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,a){if(!o.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:o.nextObj,objProp:a,nextObj:o.nextObj[a]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof Yt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n}();function Oce(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),o=r*i;return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function Cp(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),o=[],a=function(){var s=i.pop();o.push(s);for(var u=i,l=[],c=0;c<u.length;c++){var h=u[c],d=n[s],f=n[h];l.push(Oce(d,f,r))}i=i.filter(function(p,m){return l[m]<=t})};i.length>0;)a();return o}function dm(n,e){return Ot(function(){var t=e[0],r=e[1],i=e[2],o=Fl(Q1(n.shape.slice(0,3),[1]),t),a=Fl(Q1(n.shape.slice(0,3),[1]),r),s=Fl(Q1(n.shape.slice(0,3),[1]),i),u=no([o,a,s],3);return Ro(n,u)})}function wx(n){return 1/(1+Math.exp(-n))}var kv=function(n){return typeof n=="number"};function Mce(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!kv(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return kv(e.x)&&kv(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(kv)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function k2(n){return Ot(function(){var e=xn(n,Le(.10000000149011612));return ro(T0(Ro(n,e)),e)})}function Ws(n,e){return Ot(function(){var t=ys(n,[[0,0],[1,1],[1,1],[0,0]]);return t=gc(t,e.conv.filters,[1,1],"valid"),t=Ro(t,e.bn.sub),t=xn(t,e.bn.truediv),t=ro(t,e.conv.bias),k2(t)})}function js(n,e){return Ot(function(){var t=ys(n,[[0,0],[1,1],[1,1],[0,0]]);return t=d4(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=ro(t,e.bias),k2(t)})}function Fce(n,e){var t=A0(n,e);function r(a,s){var u=No(n(a)),l=No(n(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function i(a,s,u){var l=t(a,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var o=I2(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function Lce(n,e,t,r){var i=_s(n),o=i.extractWeights,a=i.getRemainingWeights,s=[],u=Fce(o,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,d;if(e.withSeparableConvs){var f=r[0],p=r[1],m=r[2],g=r[3],y=r[4],x=r[5],_=r[6],b=r[7],C=r[8],k=e.isFirstLayerConv2d?l(f,p,3,"conv0"):h(f,p,"conv0"),T=h(p,m,"conv1"),E=h(m,g,"conv2"),I=h(g,y,"conv3"),R=h(y,x,"conv4"),N=h(x,_,"conv5"),O=b?h(_,b,"conv6"):void 0,M=C?h(b,C,"conv7"):void 0,q=l(C||b||_,5*t,1,"conv8");d={conv0:k,conv1:T,conv2:E,conv3:I,conv4:R,conv5:N,conv6:O,conv7:M,conv8:q}}else{var f=r[0],p=r[1],m=r[2],g=r[3],y=r[4],x=r[5],_=r[6],b=r[7],C=r[8],k=c(f,p,"conv0"),T=c(p,m,"conv1"),E=c(m,g,"conv2"),I=c(g,y,"conv3"),R=c(y,x,"conv4"),N=c(x,_,"conv5"),O=c(_,b,"conv6"),M=c(b,C,"conv7"),q=l(C,5*t,1,"conv8");d={conv0:k,conv1:T,conv2:E,conv3:I,conv4:R,conv5:N,conv6:O,conv7:M,conv8:q}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:d,paramMappings:s}}function Bce(n,e){var t=Ku(n,e);function r(s){var u=t(s+"/sub",1),l=t(s+"/truediv",1);return{sub:u,truediv:l}}function i(s){var u=t(s+"/filters",4),l=t(s+"/bias",1);return{filters:u,bias:l}}function o(s){var u=i(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var a=S2(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function Vce(n,e){var t=[],r=Bce(n,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?i("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:i("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return ws(n,t),{params:s,paramMappings:t}}var uk;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(uk||(uk={}));var A2=function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),Y4=function(n){im(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return Mce(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=Ws(t,r.conv0);return i=di(i,[2,2],[2,2],"same"),i=Ws(i,r.conv1),i=di(i,[2,2],[2,2],"same"),i=Ws(i,r.conv2),i=di(i,[2,2],[2,2],"same"),i=Ws(i,r.conv3),i=di(i,[2,2],[2,2],"same"),i=Ws(i,r.conv4),i=di(i,[2,2],[2,2],"same"),i=Ws(i,r.conv5),i=di(i,[2,2],[1,1],"same"),i=Ws(i,r.conv6),i=Ws(i,r.conv7),ko(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?k2(ko(t,r.conv0,"valid",!1)):js(t,r.conv0);return i=di(i,[2,2],[2,2],"same"),i=js(i,r.conv1),i=di(i,[2,2],[2,2],"same"),i=js(i,r.conv2),i=di(i,[2,2],[2,2],"same"),i=js(i,r.conv3),i=di(i,[2,2],[2,2],"same"),i=js(i,r.conv4),i=di(i,[2,2],[2,2],"same"),i=js(i,r.conv5),i=di(i,[2,2],[1,1],"same"),i=r.conv6?js(i,r.conv6):i,i=r.conv7?js(i,r.conv7):i,ko(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return Ot(function(){var a=t.toBatchTensor(r,!1).toFloat();return a=i.config.meanRgb?dm(a,i.config.meanRgb):a,a=a.div(Le(256)),i.config.withSeparableConvs?i.runMobilenet(a,o):i.runTinyYolov2(a,o)})},e.prototype.forward=function(t,r){return Hi(this,void 0,void 0,function(){var i;return Gi(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,or(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),Hi(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,d,f,p,m,g,y,x=this;return Gi(this,function(_){switch(_.label){case 0:return i=new A2(r),o=i.inputSize,a=i.scoreThreshold,[4,or(t)];case 1:return s=_.sent(),[4,this.forwardInput(s,o)];case 2:return u=_.sent(),l=Ot(function(){return g0(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return h=_.sent(),u.dispose(),l.dispose(),d=h.map(function(b){return b.box}),f=h.map(function(b){return b.score}),p=h.map(function(b){return b.classScore}),m=h.map(function(b){return x.config.classes[b.label]}),g=Cp(d.map(function(b){return b.rescale(o)}),f,this.config.iouThreshold,!0),y=g.map(function(b){return new V4(f[b],p[b],m[b],d[b],c)}),[2,y]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return Vce(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return Lce(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return Hi(this,void 0,void 0,function(){var o,a,s,u,l,c,h,d,f,p,m,g,y,x,_,b,C,k,T,E,I,R,N,O,M,q,J,ee,Q,$=this;return Gi(this,function(K){switch(K.label){case 0:return o=r.width,a=r.height,s=Math.max(o,a),u=s/o,l=s/a,c=t.shape[1],h=this.config.anchors.length,d=Ot(function(){var j=t.reshape([c,c,h,$.boxEncodingSize]),ue=j.slice([0,0,0,0],[c,c,h,4]),he=j.slice([0,0,0,4],[c,c,h,1]),ve=$.withClassScores?_0(j.slice([0,0,0,5],[c,c,h,$.config.classes.length]),3):Le(0);return[ue,he,ve]}),f=d[0],p=d[1],m=d[2],g=[],[4,p.array()];case 1:return y=K.sent(),[4,f.array()];case 2:x=K.sent(),_=0,K.label=3;case 3:if(!(_<c))return[3,12];b=0,K.label=4;case 4:if(!(b<c))return[3,11];C=0,K.label=5;case 5:return C<h?(k=wx(y[_][b][C][0]),!i||k>i?(T=(b+wx(x[_][b][C][0]))/c*u,E=(_+wx(x[_][b][C][1]))/c*l,I=Math.exp(x[_][b][C][2])*this.config.anchors[C].x/c*u,R=Math.exp(x[_][b][C][3])*this.config.anchors[C].y/c*l,N=T-I/2,O=E-R/2,M={row:_,col:b,anchor:C},this.withClassScores?[4,this.extractPredictedClass(m,M)]:[3,7]):[3,9]):[3,10];case 6:return Q=K.sent(),[3,8];case 7:Q={classScore:1,label:0},K.label=8;case 8:q=Q,J=q.classScore,ee=q.label,g.push(ay({box:new k0(N,O,N+I,O+R),score:k,classScore:k*J,label:ee},M)),K.label=9;case 9:return C++,[3,5];case 10:return b++,[3,4];case 11:return _++,[3,3];case 12:return f.dispose(),p.dispose(),m.dispose(),[2,g]}})})},e.prototype.extractPredictedClass=function(t,r){return Hi(this,void 0,void 0,function(){var i,o,a,s;return Gi(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,a=r.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[i][o][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(bs);function zs(n,e,t){if(t===void 0&&(t=!1),n.beginPath(),e.slice(1).forEach(function(o,a){var s=o.x,u=o.y,l=e[a];n.moveTo(l.x,l.y),n.lineTo(s,u)}),t){var r=e[e.length-1],i=e[0];if(!r||!i)return;n.moveTo(r.x,r.y),n.lineTo(i.x,i.y)}n.stroke()}var io=function(n){ht(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),o=i.score,a=i.relativeBox,s=i.imageDims;return new e(o,a,s)},e}(V4);function Sy(n){return n.detection instanceof io}function N2(n,e){var t={detection:e};return Object.assign({},n,t)}function Uce(n,e){var t=Array.isArray(e)?e:[e];t.forEach(function(r){var i=r instanceof io?r.score:Sy(r)?r.detection.score:void 0,o=r instanceof io?r.box:Sy(r)?r.detection.box:new da(r),a=i?""+y2(i):void 0;new G4(o,{label:a}).draw(n)})}function Ei(n,e,t){return Ve(function(){var r=vM(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=Pt(r,e.bias),r})}function _x(n,e,t){return t===void 0&&(t=!1),Ve(function(){var r=Fn(t?Pt(ms(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):Ei(n,e.conv0,[2,2])),i=Ei(r,e.conv1,[1,1]),o=Fn(Pt(r,i)),a=Ei(o,e.conv2,[1,1]);return Fn(Pt(r,Pt(i,a)))})}function Av(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),Ve(function(){var i=Fn(t?Pt(ms(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Ei(n,e.conv0,r?[2,2]:[1,1])),o=Ei(i,e.conv1,[1,1]),a=Fn(Pt(i,o)),s=Ei(a,e.conv2,[1,1]),u=Fn(Pt(i,Pt(o,s))),l=Ei(u,e.conv3,[1,1]);return Fn(Pt(i,Pt(o,Pt(s,l))))})}function J4(n,e){var t=A0(n,e),r=I2(n,e);function i(a,s,u,l){l===void 0&&(l=!1);var c=l?t(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),h=r(s,s,u+"/conv1"),d=r(s,s,u+"/conv2");return{conv0:c,conv1:h,conv2:d}}function o(a,s,u,l){l===void 0&&(l=!1);var c=i(a,s,u,l),h=c.conv0,d=c.conv1,f=c.conv2,p=r(s,s,u+"/conv3");return{conv0:h,conv1:d,conv2:f,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function Wce(n){var e=[],t=_s(n),r=t.extractWeights,i=t.getRemainingWeights,o=J4(r,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function Z4(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function e3(n,e){var t=Ku(n,e),r=Z4(t),i=S2(t);function o(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2");return{conv0:l,conv1:c,conv2:h}}function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2"),d=i(s+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:d}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function jce(n){var e=[],t=e3(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return ws(n,e),{params:r,paramMappings:e}}var t3=function(n){ht(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Ve(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=dm(i,o).div(ye(255)),s=Av(a,r.dense0,!0);return s=Av(s,r.dense1),s=Av(s,r.dense2),s=Av(s,r.dense3),s=rm(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return jce(t)},e.prototype.extractParams=function(t){return Wce(t)},e}(bs);function na(n,e){return Ve(function(){return Pt(UE(n,e.weights),e.bias)})}function zce(n,e,t){var r=[],i=_s(n),o=i.extractWeights,a=i.getRemainingWeights,s=T2(o,r),u=s(e,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function $ce(n){var e=[],t=Ku(n,e);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:r("fc")};return ws(n,e),{params:i,paramMappings:e}}function n3(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var r3=function(n){ht(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Ve(function(){var o=t instanceof Iy?r.faceFeatureExtractor.forwardInput(t):t;return na(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return zce(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=n3(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),$ce(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,a=t.slice(0,t.length-o),s=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e}(bs),lk=["neutral","happy","sad","angry","fearful","disgusted","surprised"],D2=function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);lk.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return lk.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),Hce=function(n){ht(e,n);function e(t){return t===void 0&&(t=new t3),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return Ve(function(){return $u(r.runNet(t))})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return Je(this,void 0,void 0,function(){var r,i,o,a,s=this;return Ze(this,function(u){switch(u.label){case 0:return[4,or(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(mr(i).map(function(l){return Je(s,void 0,void 0,function(){var c;return Ze(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),a=o.map(function(l){return new D2(l)}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(r3);function Gce(n){return n.expressions instanceof D2}function i3(n,e){var t={expressions:e};return Object.assign({},n,t)}function qce(n,e,t,r){t===void 0&&(t=.1);var i=Array.isArray(e)?e:[e];i.forEach(function(o){var a=o instanceof D2?o:Gce(o)?o.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var s=a.asSortedArray(),u=s.filter(function(h){return h.probability>t}),l=Sy(o)?o.detection.box.bottomLeft:r||new Nt(0,0),c=new C2(u.map(function(h){return h.expression+" ("+y2(h.probability)+")"}),l);c.draw(n)})}function Kce(n){var e=n.map(function(s){return s.x}),t=n.map(function(s){return s.y}),r=e.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new k0(r,i,o,a)}var Xce=.5,Qce=.43,Yce=.45,Tp=function(){function n(e,t,r){r===void 0&&(r=new Nt(0,0));var i=t.width,o=t.height;this._imgDims=new Ph(i,o),this._shift=r,this._positions=e.map(function(a){return a.mul(new Nt(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Nt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Nt(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Nt(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof io?e.box.floor():new da(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,a=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],o=function(h){return i.sub(h).magnitude()},a=(o(t)+o(r))/2,s=Math.floor(a/Yce),u=x2(e),l=Math.floor(Math.max(0,u.x-Xce*s)),c=Math.floor(Math.max(0,u.y-Qce*s));return new w2(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=Kce(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),o3=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(x2)},e}(Tp);function a3(n){return Sy(n)&&n.landmarks instanceof Tp&&n.unshiftedLandmarks instanceof Tp&&n.alignedRect instanceof io}function P2(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),o=n.detection.imageDims,a=new io(n.detection.score,i.rescale(o.reverse()),o),s={landmarks:r,unshiftedLandmarks:e,alignedRect:a};return Object.assign({},n,s)}var s3=function(){function n(e){e===void 0&&(e={});var t=e.drawLines,r=t===void 0?!0:t,i=e.drawPoints,o=i===void 0?!0:i,a=e.lineWidth,s=e.lineColor,u=e.pointSize,l=e.pointColor;this.drawLines=r,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=l||"rgba(255, 0, 255, 1)"}return n}(),u3=function(){function n(e,t){t===void 0&&(t={}),this.faceLandmarks=e,this.options=new s3(t)}return n.prototype.draw=function(e){var t=fa(e),r=this.options,i=r.drawLines,o=r.drawPoints,a=r.lineWidth,s=r.lineColor,u=r.pointSize,l=r.pointColor;if(i&&this.faceLandmarks instanceof o3&&(t.strokeStyle=s,t.lineWidth=a,zs(t,this.faceLandmarks.getJawOutline()),zs(t,this.faceLandmarks.getLeftEyeBrow()),zs(t,this.faceLandmarks.getRightEyeBrow()),zs(t,this.faceLandmarks.getNose()),zs(t,this.faceLandmarks.getLeftEye(),!0),zs(t,this.faceLandmarks.getRightEye(),!0),zs(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=l,t.fillStyle=l;var c=function(h){t.beginPath(),t.arc(h.x,h.y,u,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(c)}},n}();function Jce(n,e){var t=Array.isArray(e)?e:[e];t.forEach(function(r){var i=r instanceof Tp?r:a3(r)?r.landmarks:void 0;if(!i)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new u3(i).draw(n)})}const Zce=Object.freeze(Object.defineProperty({__proto__:null,DrawFaceLandmarks:u3,DrawFaceLandmarksOptions:s3,drawContour:zs,drawDetections:Uce,drawFaceExpressions:qce,drawFaceLandmarks:Jce},Symbol.toStringTag,{value:"Module"}));function ehe(n,e){var t=A0(n,e),r=I2(n,e);function i(a,s,u){var l=r(a,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),h=t(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function o(a,s){var u=r(a,a,s+"/separable_conv0"),l=r(a,a,s+"/separable_conv1"),c=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function the(n,e){var t=[],r=_s(n),i=r.extractWeights,o=r.getRemainingWeights,a=ehe(i,t),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),d=l(32,64,"entry_flow/reduction_block_0"),f=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:h,reduction_block_0:d,reduction_block_1:f},m={};Ep(e,0,1).forEach(function(_){m["main_block_"+_]=c(128,"middle_flow/main_block_"+_)});var g=l(128,256,"exit_flow/reduction_block"),y=u(256,512,"exit_flow/separable_conv"),x={reduction_block:g,separable_conv:y};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:m,exit_flow:x}}}function nhe(n,e){var t=Ku(n,e),r=Z4(t),i=S2(t);function o(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=i(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:a}}function rhe(n,e){var t=[],r=nhe(n,t),i=r.extractConvParams,o=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=i("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},d={};Ep(e,0,1).forEach(function(g){d["main_block_"+g]=s("middle_flow/main_block_"+g)});var f=a("exit_flow/reduction_block"),p=o("exit_flow/separable_conv"),m={reduction_block:f,separable_conv:p};return ws(n,t),{params:{entry_flow:h,middle_flow:d,exit_flow:m},paramMappings:t}}function l3(n,e,t){return Pt(ms(n,e.filters,t,"same"),e.bias)}function bx(n,e,t){t===void 0&&(t=!0);var r=t?Fn(n):n;return r=Ei(r,e.separable_conv0,[1,1]),r=Ei(Fn(r),e.separable_conv1,[1,1]),r=td(r,[3,3],[2,2],"same"),r=Pt(r,l3(n,e.expansion_conv,[2,2])),r}function ihe(n,e){var t=Ei(Fn(n),e.separable_conv0,[1,1]);return t=Ei(Fn(t),e.separable_conv1,[1,1]),t=Ei(Fn(t),e.separable_conv2,[1,1]),t=Pt(t,n),t}var ohe=function(n){ht(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Ve(function(){var o=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=dm(o,a).div(ye(256)),u=Fn(l3(s,i.entry_flow.conv_in,[2,2]));return u=bx(u,i.entry_flow.reduction_block_0,!1),u=bx(u,i.entry_flow.reduction_block_1),Ep(r._numMainBlocks,0,1).forEach(function(l){u=ihe(u,i.middle_flow["main_block_"+l])}),u=bx(u,i.exit_flow.reduction_block),u=Fn(Ei(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return rhe(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return the(t,this._numMainBlocks)},e}(bs);function ahe(n){var e=[],t=_s(n),r=t.extractWeights,i=t.getRemainingWeights,o=T2(r,e),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}function she(n){var e=[],t=Ku(n,e);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return ws(n,e),{params:i,paramMappings:e}}var Ry;(function(n){n.FEMALE="female",n.MALE="male"})(Ry||(Ry={}));var uhe=function(n){ht(e,n);function e(t){t===void 0&&(t=new ohe(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Ve(function(){var o=t instanceof Iy?r.faceFeatureExtractor.forwardInput(t):t,a=rm(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=na(a,i.fc.age).as1D(),u=na(a,i.fc.gender);return{age:s,gender:u}})},e.prototype.forwardInput=function(t){var r=this;return Ve(function(){var i=r.runNet(t),o=i.age,a=i.gender;return{age:o,gender:$u(a)}})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Je(this,void 0,void 0,function(){var r,i,o,a,s,u,l=this;return Ze(this,function(c){switch(c.label){case 0:return[4,or(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=mr(i.age),a=mr(i.gender),s=o.map(function(h,d){return{ageTensor:h,genderTensor:a[d]}}),[4,Promise.all(s.map(function(h){var d=h.ageTensor,f=h.genderTensor;return Je(l,void 0,void 0,function(){var p,m,g,y,x;return Ze(this,function(_){switch(_.label){case 0:return[4,d.data()];case 1:return p=_.sent()[0],[4,f.data()];case 2:return m=_.sent()[0],g=m>.5,y=g?Ry.MALE:Ry.FEMALE,x=g?m:1-m,d.dispose(),f.dispose(),[2,{age:p,gender:y,genderProbability:x}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return ahe(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=n3(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),she(o)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(bs),lhe=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],x2([t[3],t[4]])]},e}(Tp),ck=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+y2(this.distance)+")":"")},n}(),Ex=function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n}();function O2(n,e){return Je(this,void 0,void 0,function(){var t,r,i,o,a,s,u;return Ze(this,function(l){switch(l.label){case 0:return t=Mr.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,or(n)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(a=o,[3,4]):[3,2];case 2:return[4,Ace(o)];case 3:a=l.sent(),l.label=4;case 4:r=a,l.label=5;case 5:return s=fa(r),u=e.map(function(c){return c instanceof io?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var h=c.x,d=c.y,f=c.width,p=c.height,m=N0({width:f,height:p});return fa(m).putImageData(s.getImageData(h,d,f,p),0,0),m})]}})})}function M2(n,e){return Je(this,void 0,void 0,function(){return Ze(this,function(t){if(!R0(n)&&!bu(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(bu(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Ve(function(){var r=n.shape.slice(bu(n)?1:0),i=r[0],o=r[1],a=r[2],s=e.map(function(l){return l instanceof io?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}),u=s.map(function(l){var c=l.x,h=l.y,d=l.width,f=l.height;return xM(n.as3D(i,o,a),[h,c,0],[f,d,a])});return u})]})})}var c3=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var o=i.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),a=o.length;return Ve(function(){var s=function(d,f){return So([Vf([68],d),Vf([68],f)],1).as2D(1,136).as1D()},u=function(d,f){var p=o[d],m=p.width,g=p.height;return f(m,g)?Math.abs(m-g)/2:0},l=function(d){return u(d,function(f,p){return f<p})},c=function(d){return u(d,function(f,p){return p<f})},h=t.mul(Vf([a,136],r)).sub(So(Array.from(Array(a),function(d,f){return s(l(f),c(f))}))).div(So(Array.from(Array(a),function(d,f){return s(o[f].width,o[f].height)})));return h})},e.prototype.forwardInput=function(t){var r=this;return Ve(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var a=o[0],s=o[1];return{height:a,width:s}}))})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Je(this,void 0,void 0,function(){var r,i,o,a=this;return Ze(this,function(s){switch(s.label){case 0:return[4,or(t)];case 1:return r=s.sent(),i=Ve(function(){return mr(a.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return Je(a,void 0,void 0,function(){var c,h,d,f,p;return Ze(this,function(m){switch(m.label){case 0:return d=(h=Array).from,[4,u.data()];case 1:return c=d.apply(h,[m.sent()]),f=c.filter(function(g,y){return rk(y)}),p=c.filter(function(g,y){return!rk(y)}),[2,new o3(Array(68).fill(0).map(function(g,y){return new Nt(f[y],p[y])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(r3),h3=function(n){ht(e,n);function e(t){return t===void 0&&(t=new t3),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(c3);function che(n){var e=[],t=e3(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return ws(n,e),{params:r,paramMappings:e}}function hhe(n){var e=[],t=_s(n),r=t.extractWeights,i=t.getRemainingWeights,o=J4(r,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}var dhe=function(n){ht(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ve(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=dm(i,o).div(ye(255)),s=_x(a,r.dense0,!0);return s=_x(s,r.dense1),s=_x(s,r.dense2),s=rm(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return che(t)},e.prototype.extractParams=function(t){return hhe(t)},e}(bs),fhe=function(n){ht(e,n);function e(t){return t===void 0&&(t=new dhe),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(c3);(function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(h3);function phe(n,e){return Pt(Ka(n,e.weights),e.biases)}function F2(n,e,t,r,i){i===void 0&&(i="same");var o=e.conv,a=o.filters,s=o.bias,u=ms(n,a,t,i);return u=Pt(u,s),u=phe(u,e.scale),r?Fn(u):u}function mhe(n,e){return F2(n,e,[1,1],!0)}function d3(n,e){return F2(n,e,[1,1],!1)}function f3(n,e){return F2(n,e,[2,2],!0,"valid")}function vhe(n,e){function t(s,u,l){var c=n(s),h=c.length/(u*l*l);if(bce(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return Ve(function(){return Du(wo(c,[u,h,l,l]),[2,3,1,0])})}function r(s,u,l,c){var h=t(s,u,l),d=yi(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:d}}function i(s,u){var l=yi(n(s)),c=yi(n(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(s,u,l,c){var h=r(s,u,l,c+"/conv"),d=i(u,c+"/scale");return{conv:h,scale:d}}function a(s,u,l,c,h){h===void 0&&(h=!1);var d=o((h?.5:1)*s,u,l,c+"/conv1"),f=o(s,u,l,c+"/conv2");return{conv1:d,conv2:f}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function ghe(n){var e=_s(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=vhe(t,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),y=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),_=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),C=s(589824,256,3,"conv256_2"),k=s(589824,256,3,"conv256_down_out"),T=Ve(function(){return Du(d0(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var E={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:d,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:y,conv128_2:x,conv256_down:_,conv256_1:b,conv256_2:C,conv256_down_out:k,fc:T};return{params:E,paramMappings:i}}function yhe(n,e){var t=Ku(n,e);function r(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function i(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),l=r(a);return{conv:{filters:s,bias:u},scale:l}}function o(a){return{conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function xhe(n){var e=[],t=yhe(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=r("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),h=i("conv64_2"),d=i("conv64_3"),f=i("conv128_down"),p=i("conv128_1"),m=i("conv128_2"),g=i("conv256_down"),y=i("conv256_1"),x=i("conv256_2"),_=i("conv256_down_out"),b=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!_ce(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var C={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:d,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:y,conv256_2:x,conv256_down_out:_,fc:b};return ws(n,e),{params:C,paramMappings:e}}function $o(n,e){var t=mhe(n,e.conv1);return t=d3(t,e.conv2),t=Pt(t,n),t=Fn(t),t}function Nv(n,e){var t=f3(n,e.conv1);t=d3(t,e.conv2);var r=rm(n,2,2,"valid"),i=In(r.shape),o=r.shape[3]!==t.shape[3],a=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(a){var s=t.shape.slice();s[1]=1;var u=In(s);t=ai([t,u],1);var l=t.shape.slice();l[2]=1;var c=In(l);t=ai([t,c],2)}return r=o?ai([r,i],3):r,t=Pt(r,t),t=Fn(t),t}var whe=function(n){ht(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Ve(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],a=dm(i,o).div(ye(256)),s=f3(a,r.conv32_down);s=td(s,3,2,"valid"),s=$o(s,r.conv32_1),s=$o(s,r.conv32_2),s=$o(s,r.conv32_3),s=Nv(s,r.conv64_down),s=$o(s,r.conv64_1),s=$o(s,r.conv64_2),s=$o(s,r.conv64_3),s=Nv(s,r.conv128_down),s=$o(s,r.conv128_1),s=$o(s,r.conv128_2),s=Nv(s,r.conv256_down),s=$o(s,r.conv256_1),s=$o(s,r.conv256_2),s=Nv(s,r.conv256_down_out);var u=s.mean([1,2]),l=UE(u,r.fc);return l})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Je(this,void 0,void 0,function(){var r,i,o,a=this;return Ze(this,function(s){switch(s.label){case 0:return[4,or(t)];case 1:return r=s.sent(),i=Ve(function(){return mr(a.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return xhe(t)},e.prototype.extractParams=function(t){return ghe(t)},e}(bs);function p3(n,e){var t={descriptor:e};return Object.assign({},n,t)}var m3=function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function _he(n,e){function t(u,l){var c=wo(n(9*u),[3,3,u,1]),h=yi(n(u)),d=yi(n(u)),f=yi(n(u)),p=yi(n(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:d,batch_norm_mean:f,batch_norm_variance:p}}function r(u,l,c,h,d){var f=wo(n(u*l*c*c),[c,c,u,l]),p=yi(n(l));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(d?"batch_norm_offset":"bias")}),{filters:f,bias:p}}function i(u,l,c,h){var d=r(u,l,c,h,!0),f=d.filters,p=d.bias;return{filters:f,batch_norm_offset:p}}function o(u,l,c){var h=t(u,c+"/depthwise_conv"),d=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:d}}function a(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),h=o(128,128,"mobilenetv1/conv_3"),d=o(128,256,"mobilenetv1/conv_4"),f=o(256,256,"mobilenetv1/conv_5"),p=o(256,512,"mobilenetv1/conv_6"),m=o(512,512,"mobilenetv1/conv_7"),g=o(512,512,"mobilenetv1/conv_8"),y=o(512,512,"mobilenetv1/conv_9"),x=o(512,512,"mobilenetv1/conv_10"),_=o(512,512,"mobilenetv1/conv_11"),b=o(512,1024,"mobilenetv1/conv_12"),C=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:m,conv_8:g,conv_9:y,conv_10:x,conv_11:_,conv_12:b,conv_13:C}}function s(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),h=i(128,256,3,"prediction_layer/conv_3"),d=i(256,128,1,"prediction_layer/conv_4"),f=i(128,256,3,"prediction_layer/conv_5"),p=i(256,64,1,"prediction_layer/conv_6"),m=i(64,128,3,"prediction_layer/conv_7"),g=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),y=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),x=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),_=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),C=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),k=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),I=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),R=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),O={box_encoding_predictor:g,class_predictor:y},M={box_encoding_predictor:x,class_predictor:_},q={box_encoding_predictor:b,class_predictor:C},J={box_encoding_predictor:k,class_predictor:T},ee={box_encoding_predictor:E,class_predictor:I},Q={box_encoding_predictor:R,class_predictor:N};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:m,box_predictor_0:O,box_predictor_1:M,box_predictor_2:q,box_predictor_3:J,box_predictor_4:ee,box_predictor_5:Q}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function bhe(n){var e=[],t=_s(n),r=t.extractWeights,i=t.getRemainingWeights,o=_he(r,e),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=a(),l=s(),c=kE(r(5118*4),[1,5118,4]),h={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:e}}function Ehe(n,e){var t=Ku(n,e);function r(l,c,h){var d=t(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),f=t(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:d,batch_norm_offset:f}}function i(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",d=c+"/depthwise_conv",f=c+"/pointwise_conv",p=t(h+"/depthwise_weights",4,d+"/filters"),m=t(h+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),g=t(h+"/BatchNorm/beta",1,d+"/batch_norm_offset"),y=t(h+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),x=t(h+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:g,batch_norm_mean:y,batch_norm_variance:x},pointwise_conv:r("MobilenetV1",l,f)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function a(l,c){var h=t(l+"/weights",4,c+"/filters"),d=t(l+"/biases",1,c+"/bias");return{filters:h,bias:d}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function Che(n){var e=[],t=Ehe(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!R0(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return ws(n,e),{params:a,paramMappings:e}}function qo(n,e,t){return Ve(function(){var r=ms(n,e.filters,t,"same");return r=Pt(r,e.batch_norm_offset),LE(r,0,6)})}var The=.0010000000474974513;function Ihe(n,e,t){return Ve(function(){var r=VE(n,e.filters,t,"same");return r=dM(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,The),LE(r,0,6)})}function She(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function Rhe(n,e){return Ve(function(){var t=null,r=qo(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,a){var s=a+1,u=She(s);r=Ihe(r,o.depthwise_conv,u),r=qo(r,o.pointwise_conv,[1,1]),s===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function khe(n,e,t,r,i){var o=n.shape[0],a=Math.min(t,o),s=e.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>i}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var h=c.score,d=l.length-1;d>=0;--d){var f=Ahe(n,c.boxIndex,l[d]);if(f!==0&&(c.score*=u(f),c.score<=i))break}h===c.score&&l.push(c.boxIndex)}}),l}function Ahe(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),l=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),h=Math.max(r[t][1],r[t][3]),d=(a-i)*(s-o),f=(c-u)*(h-l);if(d<=0||f<=0)return 0;var p=Math.max(i,u),m=Math.max(o,l),g=Math.min(a,c),y=Math.min(s,h),x=Math.max(g-p,0)*Math.max(y-m,0);return x/(d+f-x)}function Nhe(n){var e=mr(Du(n,[1,0])),t=[ha(e[2],e[0]),ha(e[3],e[1])],r=[Pt(e[0],Ba(t[0],ye(2))),Pt(e[1],Ba(t[1],ye(2)))];return{sizes:t,centers:r}}function Dhe(n,e){var t=Nhe(n),r=t.sizes,i=t.centers,o=mr(Du(e,[1,0])),a=Ba(Ka(a_(Ba(o[2],ye(5))),r[0]),ye(2)),s=Pt(Ka(Ba(o[0],ye(10)),r[0]),i[0]),u=Ba(Ka(a_(Ba(o[3],ye(5))),r[1]),ye(2)),l=Pt(Ka(Ba(o[1],ye(10)),r[1]),i[1]);return Du(So([ha(s,a),ha(l,u),Pt(s,a),Pt(l,u)]),[1,0])}function Phe(n,e,t){return Ve(function(){var r=n.shape[0],i=Dhe(Eo(Th(t.extra_dim,[r,1,1]),[-1,4]),Eo(n,[-1,4]));i=Eo(i,[r,i.shape[0]/r,4]);var o=uM(Nu(e,[0,0,1],[-1,-1,-1])),a=Nu(o,[0,0,0],[-1,-1,1]);a=Eo(a,[r,a.shape[1]]);var s=mr(i),u=mr(a);return{boxes:s,scores:u}})}function zc(n,e){return Ve(function(){var t=n.shape[0],r=Eo(ko(n,e.box_encoding_predictor),[t,-1,1,4]),i=Eo(ko(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function Ohe(n,e,t){return Ve(function(){var r=qo(n,t.conv_0,[1,1]),i=qo(r,t.conv_1,[2,2]),o=qo(i,t.conv_2,[1,1]),a=qo(o,t.conv_3,[2,2]),s=qo(a,t.conv_4,[1,1]),u=qo(s,t.conv_5,[2,2]),l=qo(u,t.conv_6,[1,1]),c=qo(l,t.conv_7,[2,2]),h=zc(e,t.box_predictor_0),d=zc(n,t.box_predictor_1),f=zc(i,t.box_predictor_2),p=zc(a,t.box_predictor_3),m=zc(u,t.box_predictor_4),g=zc(c,t.box_predictor_5),y=ai([h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),x=ai([h.classPrediction,d.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1);return{boxPredictions:y,classPredictions:x}})}var D0=function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),v3=function(n){ht(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Ve(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=ha(Ka(i,ye(.007843137718737125)),ye(1)),a=Rhe(o,r.mobilenetv1),s=Ohe(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return Phe(u,l,r.output_layer)})},e.prototype.forward=function(t){return Je(this,void 0,void 0,function(){var r;return Ze(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,or(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,d,f,p,m,g,y,x,_,b,C,k,T,E;return Ze(this,function(I){switch(I.label){case 0:return i=new D0(r),o=i.maxResults,a=i.minConfidence,[4,or(t)];case 1:for(s=I.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,h=l[0],d=c[0],f=1;f<l.length;f++)l[f].dispose(),c[f].dispose();return g=(m=Array).from,[4,d.data()];case 2:return p=g.apply(m,[I.sent()]),y=.5,x=khe(h,p,o,y,a),_=s.getReshapedInputDimensions(0),b=s.inputSize,C=b/_.width,k=b/_.height,T=h.arraySync(),E=x.map(function(R){var N=[Math.max(0,T[R][0]),Math.min(1,T[R][2])].map(function(Q){return Q*k}),O=N[0],M=N[1],q=[Math.max(0,T[R][1]),Math.min(1,T[R][3])].map(function(Q){return Q*C}),J=q[0],ee=q[1];return new io(p[R],new w2(J,O,ee-J,M-O),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),d.dispose(),[2,E]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Che(t)},e.prototype.extractParams=function(t){return bhe(t)},e}(bs);(function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(v3);var g3=function(n){ht(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(A2),fm=function(){function n(){}return n.prototype.then=function(e){return Je(this,void 0,void 0,function(){var t;return Ze(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return Je(this,void 0,void 0,function(){return Ze(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function P0(n,e,t,r,i){return i===void 0&&(i=function(o){var a=o.alignedRect;return a}),Je(this,void 0,void 0,function(){var o,a,s,u,l;return Ze(this,function(c){switch(c.label){case 0:return o=n.map(function(h){return a3(h)?i(h):h.detection}),s=r,s?[3,5]:e instanceof Te?[4,M2(e,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,O2(e,o)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,t(a)];case 6:return l=c.sent(),a.forEach(function(h){return h instanceof Te&&h.dispose()}),[2,l]}})})}function L2(n,e,t,r,i){return Je(this,void 0,void 0,function(){var o=this;return Ze(this,function(a){return[2,P0([n],e,function(s){return Je(o,void 0,void 0,function(){return Ze(this,function(u){return[2,t(s[0])]})})},r,i)]})})}function Mhe(n){return Ve(function(){return So(mr(n,3).reverse(),3)})}var Dv=2,ky=12;function Fhe(n,e){var t=A0(n,e),r=T2(n,e);function i(l,c){var h=yi(n(l));return e.push({paramPath:c}),h}function o(l,c,h){h===void 0&&(h=!1);var d=t(l[0],l[1],3,c+"/conv1"),f=i(l[1],c+"/prelu1_alpha"),p=t(l[1],l[2],3,c+"/conv2"),m=i(l[2],c+"/prelu2_alpha"),g=t(l[2],l[3],h?2:3,c+"/conv3"),y=i(l[3],c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:y}}function a(){var l=o([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return Za({},l,{conv4_1:c,conv4_2:h})}function s(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=i(128,"rnet/prelu4_alpha"),d=r(128,2,"rnet/fc2_1"),f=r(128,4,"rnet/fc2_2");return Za({},l,{fc1:c,prelu4_alpha:h,fc2_1:d,fc2_2:f})}function u(){var l=o([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),h=i(128,"onet/prelu4_alpha"),d=r(1152,256,"onet/fc1"),f=i(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return Za({},l,{conv4:c,prelu4_alpha:h,fc1:d,prelu5_alpha:f,fc2_1:p,fc2_2:m,fc2_3:g})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function Lhe(n){var e=_s(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=Fhe(t,i),a=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,l=a(),c=s(),h=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:i}}function Bhe(n,e){var t=Ku(n,e);function r(c){var h=t(c+"/weights",4,c+"/filters"),d=t(c+"/bias",1);return{filters:h,bias:d}}function i(c){var h=t(c+"/weights",2),d=t(c+"/bias",1);return{weights:h,bias:d}}function o(c){return t(c,1)}function a(c){var h=r(c+"/conv1"),d=o(c+"/prelu1_alpha"),f=r(c+"/conv2"),p=o(c+"/prelu2_alpha"),m=r(c+"/conv3"),g=o(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:d,conv2:f,prelu2_alpha:p,conv3:m,prelu3_alpha:g}}function s(){var c=a("pnet"),h=r("pnet/conv4_1"),d=r("pnet/conv4_2");return Za({},c,{conv4_1:h,conv4_2:d})}function u(){var c=a("rnet"),h=i("rnet/fc1"),d=o("rnet/prelu4_alpha"),f=i("rnet/fc2_1"),p=i("rnet/fc2_2");return Za({},c,{fc1:h,prelu4_alpha:d,fc2_1:f,fc2_2:p})}function l(){var c=a("onet"),h=r("onet/conv4"),d=o("onet/prelu4_alpha"),f=i("onet/fc1"),p=o("onet/prelu5_alpha"),m=i("onet/fc2_1"),g=i("onet/fc2_2"),y=i("onet/fc2_3");return Za({},c,{conv4:h,prelu4_alpha:d,fc1:f,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:y})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function Vhe(n){var e=[],t=Bhe(n,e),r=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,a=r(),s=i(),u=o();return ws(n,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function O_(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function Uhe(n,e,t){for(var r=t[0],i=t[1],o=ky/n,a=[],s=Math.min(r,i)*o,u=0;s>=12;)a.push(o*Math.pow(e,u)),s=s*e,u+=1;return a}var B2=function(n){ht(e,n);function e(t,r,i,o){return n.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return e}(da);function y3(n){return Ve(function(){return Ka(ha(n,ye(127.5)),ye(.0078125))})}function Oh(n,e){return Ve(function(){return Pt(Fn(n),Ka(e,ny(Fn(ny(n)))))})}function V2(n,e,t){return t===void 0&&(t=!1),Ve(function(){var r=ko(n,e.conv1,"valid");return r=Oh(r,e.prelu1_alpha),r=td(r,t?[2,2]:[3,3],[2,2],"same"),r=ko(r,e.conv2,"valid"),r=Oh(r,e.prelu2_alpha),r=t?r:td(r,[3,3],[2,2],"valid"),r=ko(r,e.conv3,"valid"),r=Oh(r,e.prelu3_alpha),r})}function Whe(n,e){return Ve(function(){var t=V2(n,e,!0),r=ko(t,e.conv4_1,"valid"),i=Wi(p0(r,3),3),o=$u(ha(r,i),3),a=ko(t,e.conv4_2,"valid");return{prob:o,regions:a}})}function jhe(n,e){return Ve(function(){var t=O_(e,n.shape.slice(1)),r=t.height,i=t.width,o=MM.resizeBilinear(n,[r,i]),a=y3(o);return Du(a,[0,2,1,3])})}function zhe(n,e,t,r){for(var i=[],o=n.arraySync(),a=0;a<n.shape[0];a++)for(var s=0;s<n.shape[1];s++)o[a][s]>=r&&i.push(new Nt(s,a));var u=i.map(function(l){var c=new k0(Math.round((l.y*Dv+1)/t),Math.round((l.x*Dv+1)/t),Math.round((l.y*Dv+ky)/t),Math.round((l.x*Dv+ky)/t)),h=o[l.y][l.x],d=e.arraySync(),f=new B2(d[l.y][l.x][0],d[l.y][l.x][1],d[l.y][l.x][2],d[l.y][l.x][3]);return{cell:c,score:h,region:f}});return u}function $he(n,e,t,r,i){i.stage1=[];var o=e.map(function(d){return Ve(function(){var f={scale:d},p=jhe(n,d),m=Date.now(),g=Whe(p,r),y=g.prob,x=g.regions;f.pnet=Date.now()-m;var _=mr(mr(y,3)[1])[0],b=mr(x)[0];return{scoresTensor:_,regionsTensor:b,scale:d,statsForScale:f}})}),a=o.map(function(d){var f=d.scoresTensor,p=d.regionsTensor,m=d.scale,g=d.statsForScale,y=zhe(f,p,m,t);if(f.dispose(),p.dispose(),!y.length)return i.stage1.push(g),[];var x=Date.now(),_=Cp(y.map(function(b){return b.cell}),y.map(function(b){return b.score}),.5);return g.nms=Date.now()-x,g.numBoxes=_.length,i.stage1.push(g),_.map(function(b){return y[b]})}),s=a.reduce(function(d,f){return d.concat(f)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),h=Cp(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);i.stage1_nms=Date.now()-c,l=h.map(function(d){return s[d].score}),u=h.map(function(d){return s[d]}).map(function(d){var f=d.cell,p=d.region;return new k0(f.left+p.left*f.width,f.top+p.top*f.height,f.right+p.right*f.width,f.bottom+p.bottom*f.height).toSquare().round()})}return{boxes:u,scores:l}}function x3(n,e,t){var r=t.width,i=t.height;return Je(this,void 0,void 0,function(){var o,a,s,u=this;return Ze(this,function(l){switch(l.label){case 0:return o=fa(n),[4,Promise.all(e.map(function(c){return Je(u,void 0,void 0,function(){var h,d,f,p,m,g,y,x;return Ze(this,function(_){return h=c.padAtBorders(n.height,n.width),d=h.y,f=h.ey,p=h.x,m=h.ex,g=p-1,y=d-1,x=o.getImageData(g,y,m-g,f-y),[2,Mr.isNodejs()?R2(x):createImageBitmap(x)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var h=N0({width:r,height:i}),d=fa(h);d.drawImage(c,0,0,r,i);for(var f=d.getImageData(0,0,r,i).data,p=[],m=0;m<f.length;m+=4)p.push(f[m+2]),p.push(f[m+1]),p.push(f[m]);s.push(p)}),[2,s.map(function(c){var h=Ve(function(){var d=Du(wo(c,[1,r,i,3]),[0,2,1,3]).toFloat();return y3(d)});return h})]}})})}function Hhe(n,e){return Ve(function(){var t=V2(n,e),r=Eo(t,[t.shape[0],e.fc1.weights.shape[0]]),i=na(r,e.fc1),o=Oh(i,e.prelu4_alpha),a=na(o,e.fc2_1),s=Wi(p0(a,1),1),u=$u(ha(a,s),1),l=na(o,e.fc2_2),c=mr(u,1)[1];return{scores:c,regions:l}})}function Ghe(n,e,t,r,i){return Je(this,void 0,void 0,function(){var o,a,s,u,l,c,h,d,f,p,m,g,y,x;return Ze(this,function(_){switch(_.label){case 0:return o=Date.now(),[4,x3(n,e,{width:24,height:24})];case 1:return a=_.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(b){var C=Hhe(b,r);return b.dispose(),C}),i.stage2_rnet=Date.now()-o,u=s.length>1?ai(s.map(function(b){return b.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[_.sent()]),u.dispose(),d=l.map(function(b,C){return{score:b,idx:C}}).filter(function(b){return b.score>t}).map(function(b){var C=b.idx;return C}),f=d.map(function(b){return e[b]}),p=d.map(function(b){return l[b]}),m=[],g=[],f.length>0&&(o=Date.now(),y=Cp(f,p,.7),i.stage2_nms=Date.now()-o,x=y.map(function(b){var C=s[d[b]].regions.arraySync();return new B2(C[0][0],C[0][1],C[0][2],C[0][3])}),g=y.map(function(b){return p[b]}),m=y.map(function(b,C){return f[b].calibrate(x[C])})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function qhe(n,e){return Ve(function(){var t=V2(n,e);t=td(t,[2,2],[2,2],"same"),t=ko(t,e.conv4,"valid"),t=Oh(t,e.prelu4_alpha);var r=Eo(t,[t.shape[0],e.fc1.weights.shape[0]]),i=na(r,e.fc1),o=Oh(i,e.prelu5_alpha),a=na(o,e.fc2_1),s=Wi(p0(a,1),1),u=$u(ha(a,s),1),l=na(o,e.fc2_2),c=na(o,e.fc2_3),h=mr(u,1)[1];return{scores:h,regions:l,points:c}})}function Khe(n,e,t,r,i){return Je(this,void 0,void 0,function(){var o,a,s,u,l,c,h,d,f,p,m,g,y,x,_;return Ze(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,x3(n,e,{width:48,height:48})];case 1:return a=b.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(C){var k=qhe(C,r);return C.dispose(),k}),i.stage3_onet=Date.now()-o,u=s.length>1?ai(s.map(function(C){return C.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[b.sent()]),u.dispose(),d=l.map(function(C,k){return{score:C,idx:k}}).filter(function(C){return C.score>t}).map(function(C){var k=C.idx;return k}),f=d.map(function(C){var k=s[C].regions.arraySync();return new B2(k[0][0],k[0][1],k[0][2],k[0][3])}),p=d.map(function(C,k){return e[C].calibrate(f[k])}),m=d.map(function(C){return l[C]}),g=[],y=[],x=[],p.length>0&&(o=Date.now(),_=Cp(p,m,.7,!1),i.stage3_nms=Date.now()-o,g=_.map(function(C){return p[C]}),y=_.map(function(C){return m[C]}),x=_.map(function(C,k){return Array(5).fill(0).map(function(T,E){var I=s[C].points.arraySync();return new Nt(I[0][E]*(g[k].width+1)+g[k].left,I[0][E+5]*(g[k].height+1)+g[k].top)})})),s.forEach(function(C){C.regions.dispose(),C.scores.dispose(),C.points.dispose()}),[2,{boxes:g,scores:y,points:x}]}})})}var Xhe=function(n){ht(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,d,f,p,m,g,y,x,_,b,C,k,T,E;return Ze(this,function(I){switch(I.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=Ve(function(){return Mhe(Wi(Cre.fromPixels(o)).toFloat())}),l=function(R){return u.dispose(),a.total=Date.now()-s,R},c=u.shape.slice(1),h=c[0],d=c[1],f=new m3(r),p=f.minFaceSize,m=f.scaleFactor,g=f.maxNumScales,y=f.scoreThresholds,x=f.scaleSteps,_=(x||Uhe(p,m,[h,d])).filter(function(R){var N=O_(R,[h,d]);return Math.min(N.width,N.height)>ky}).slice(0,g),a.scales=_,a.pyramid=_.map(function(R){return O_(R,[h,d])}),b=Date.now(),[4,$he(u,_,y[0],i.pnet,a)];case 1:return C=I.sent(),a.total_stage1=Date.now()-b,C.boxes.length?(a.stage2_numInputBoxes=C.boxes.length,b=Date.now(),[4,Ghe(o,C.boxes,y[1],i.rnet,a)]):[2,l({results:[],stats:a})];case 2:return k=I.sent(),a.total_stage2=Date.now()-b,k.boxes.length?(a.stage3_numInputBoxes=k.boxes.length,b=Date.now(),[4,Khe(o,k.boxes,y[2],i.onet,a)]):[2,l({results:[],stats:a})];case 3:return T=I.sent(),a.total_stage3=Date.now()-b,E=T.boxes.map(function(R,N){return P2(N2({},new io(T.scores[N],new w2(R.left/d,R.top/h,R.width/d,R.height/h),{height:h,width:d})),new lhe(T.points[N].map(function(O){return O.sub(new Nt(R.left,R.top)).div(new Nt(R.width,R.height))}),{width:R.width,height:R.height}))}),[2,l({results:E,stats:a})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i;return Ze(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,or(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),Je(this,void 0,void 0,function(){var i;return Ze(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,or(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Vhe(t)},e.prototype.extractParams=function(t){return Lhe(t)},e}(bs),Qhe=.4,Yhe=[new Nt(1.603231,2.094468),new Nt(6.041143,7.080126),new Nt(2.882459,3.518061),new Nt(4.266906,5.178857),new Nt(9.041765,10.66308)],Jhe=[117.001,114.697,97.404],Zhe=function(n){ht(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:Qhe,classes:["face"],anchors:Yhe,meanRgb:Jhe,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Je(this,void 0,void 0,function(){var i;return Ze(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new io(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(Y4),ede=.4,tde=[new Nt(.738768,.874946),new Nt(2.42204,2.65704),new Nt(4.30971,7.04493),new Nt(10.246,4.59428),new Nt(12.6868,11.8741)],nde=[new Nt(1.603231,2.094468),new Nt(6.041143,7.080126),new Nt(2.882459,3.518061),new Nt(4.266906,5.178857),new Nt(9.041765,10.66308)],rde=[117.001,114.697,97.404],ide="tiny_yolov2_model",ode="tiny_yolov2_separable_conv_model",ade=function(n){ht(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:ede,classes:["face"]},t?{anchors:nde,meanRgb:rde}:{anchors:tde,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Je(this,void 0,void 0,function(){var i;return Ze(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new io(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?ode:ide},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(Y4),jr={ssdMobilenetv1:new v3,tinyFaceDetector:new Zhe,tinyYolov2:new ade,mtcnn:new Xhe,faceLandmark68Net:new h3,faceLandmark68TinyNet:new fhe,faceRecognitionNet:new whe,faceExpressionNet:new Hce,ageGenderNet:new uhe};function w3(n,e){var t={age:e};return Object.assign({},n,t)}function _3(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var b3=function(n){ht(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e}(fm),U2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r,i=this;return Ze(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,P0(t,this.input,function(a){return Je(i,void 0,void 0,function(){return Ze(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return jr.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){return i3(a,r[s])})]}})})},e.prototype.withAgeAndGender=function(){return new $2(this,this.input)},e}(b3),W2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r;return Ze(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,L2(t,this.input,function(o){return jr.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,i3(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new H2(this,this.input)},e}(b3),j2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new G2(this,this.input)},e.prototype.withFaceDescriptors=function(){return new K2(this,this.input)},e}(U2),z2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new q2(this,this.input)},e.prototype.withFaceDescriptor=function(){return new X2(this,this.input)},e}(W2),E3=function(n){ht(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e}(fm),$2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r,i=this;return Ze(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,P0(t,this.input,function(a){return Je(i,void 0,void 0,function(){return Ze(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return jr.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){var u=r[s],l=u.age,c=u.gender,h=u.genderProbability;return w3(_3(a,c,h),l)})]}})})},e.prototype.withFaceExpressions=function(){return new U2(this,this.input)},e}(E3),H2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r,i,o,a;return Ze(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,L2(t,this.input,function(u){return jr.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),i=r.age,o=r.gender,a=r.genderProbability,[2,w3(_3(t,o,a),i)]}})})},e.prototype.withFaceExpressions=function(){return new W2(this,this.input)},e}(E3),G2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new j2(this,this.input)},e.prototype.withFaceDescriptors=function(){return new K2(this,this.input)},e}($2),q2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new z2(this,this.input)},e.prototype.withFaceDescriptor=function(){return new X2(this,this.input)},e}(H2),C3=function(n){ht(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e}(fm),K2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r;return Ze(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,P0(t,this.input,function(o){return Promise.all(o.map(function(a){return jr.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,a){return p3(t[a],o)})]}})})},e.prototype.withFaceExpressions=function(){return new j2(this,this.input)},e.prototype.withAgeAndGender=function(){return new G2(this,this.input)},e}(C3),X2=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r;return Ze(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,L2(t,this.input,function(o){return jr.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,p3(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new z2(this,this.input)},e.prototype.withAgeAndGender=function(){return new q2(this,this.input)},e}(C3),T3=function(n){ht(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?jr.faceLandmark68TinyNet:jr.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(fm),sde=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r,i,o,a,s=this;return Ze(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(l){return l.detection}),this.input instanceof Te?[4,M2(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,O2(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),i.forEach(function(l){return l instanceof Te&&l.dispose()}),[2,t.map(function(l,c){return P2(l,a[c])})]}})})},e.prototype.withFaceExpressions=function(){return new j2(this,this.input)},e.prototype.withAgeAndGender=function(){return new G2(this,this.input)},e.prototype.withFaceDescriptors=function(){return new K2(this,this.input)},e}(T3),ude=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r,i,o,a;return Ze(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(r=t.detection,this.input instanceof Te?[4,M2(this.input,[r])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,O2(this.input,[r])];case 4:o=s.sent(),s.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return a=s.sent(),i.forEach(function(u){return u instanceof Te&&u.dispose()}),[2,P2(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new z2(this,this.input)},e.prototype.withAgeAndGender=function(){return new q2(this,this.input)},e.prototype.withFaceDescriptor=function(){return new X2(this,this.input)},e}(T3),I3=function(n){ht(e,n);function e(t,r){r===void 0&&(r=new D0);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e}(fm),S3=function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r,i,o;return Ze(this,function(a){switch(a.label){case 0:return t=this,r=t.input,i=t.options,i instanceof m3?[4,jr.mtcnn.forward(r,i)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(o=i instanceof g3?function(s){return jr.tinyFaceDetector.locateFaces(s,i)}:i instanceof D0?function(s){return jr.ssdMobilenetv1.locateFaces(s,i)}:i instanceof A2?function(s){return jr.tinyYolov2.locateFaces(s,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return Je(t,void 0,void 0,function(){var i;return Ze(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(a){return N2({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new sde(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new U2(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new $2(this.runAndExtendWithFaceDetections(),this.input)},e}(I3);(function(n){ht(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Je(this,void 0,void 0,function(){var t,r;return Ze(this,function(i){switch(i.label){case 0:return[4,new S3(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return Je(t,void 0,void 0,function(){var i;return Ze(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?N2({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new ude(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new W2(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new H2(this.runAndExtendWithFaceDetection(),this.input)},e})(I3);function lde(n,e){return e===void 0&&(e=new D0),new S3(n,e)}function cde(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(a){if(a instanceof Ex)return a;if(a instanceof Float32Array)return new Ex(o(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Ex(o(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return cde(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new ck(o,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new ck("unknown",t.distance)},n})();Za({},Ice,Zce);function hde(){const n=fe.useRef(null),e=fe.useRef(null),[t,r]=fe.useState(null),[i,o]=fe.useState(!1),[a,s]=fe.useState(!1),[u,l]=fe.useState(!1),[c,h]=fe.useState(0),d=Np(),f=async()=>{try{console.log("Loading models..."),await jr.tinyFaceDetector.loadFromUri("/models"),console.log("TinyFaceDetector model loaded successfully"),await jr.faceLandmark68Net.loadFromUri("/models"),console.log("FaceLandmark68Net model loaded successfully"),await jr.faceExpressionNet.loadFromUri("/models"),console.log("FaceExpressionNet model loaded successfully")}catch(T){console.error("Error loading models:",T)}},p=async()=>{try{const T=await navigator.mediaDevices.getUserMedia({video:!0});n.current&&(n.current.srcObject=T,console.log("Webcam stream started successfully"))}catch(T){r("Unable to access the webcam. Please allow access to continue."),console.error("Error accessing webcam:",T)}},m=()=>{e.current&&(e.current.requestFullscreen?e.current.requestFullscreen():e.current.mozRequestFullScreen?e.current.mozRequestFullScreen():e.current.webkitRequestFullscreen?e.current.webkitRequestFullscreen():e.current.msRequestFullscreen&&e.current.msRequestFullscreen())},g=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{console.log("Exited fullscreen mode successfully.")}).catch(T=>{console.error("Error exiting fullscreen mode:",T)}):console.warn("Document is not in fullscreen mode.")},y=()=>{const E=setInterval(async()=>{if(n.current){const I=await lde(n.current,new g3);console.log("Face detections:",I),I.length===0?(l(!0),h(R=>R+1),c>=3?(alert("No face detected after 3 warnings. Your test will be dismissed."),x()):alert(`No face detected. Warning ${c+1}/3. Please ensure your face is visible.`)):(l(!1),h(0))}},1e3);return()=>clearInterval(E)},x=async()=>{window.confirm("Are you sure you want to submit the test?")&&(s(!0),alert("Test submitted successfully!"),window.confirm("Do you want to turn off the webcam?")&&_(),await g(),d("/home"))},_=()=>{n.current&&n.current.srcObject&&(n.current.srcObject.getTracks().forEach(I=>I.stop()),n.current.srcObject=null)},b=()=>{m(),o(!0)},C=()=>{const T=()=>{document.visibilityState==="hidden"&&(window.confirm("You are not allowed to leave the test. Do you want to submit the test now?")?x():m())};return document.addEventListener("visibilitychange",T),()=>{document.removeEventListener("visibilitychange",T)}},k=()=>{const T=()=>{document.fullscreenElement||(window.confirm("You are not allowed to exit full-screen mode. Do you want to submit the test now?")?x():m())};return document.addEventListener("fullscreenchange",T),()=>{document.removeEventListener("fullscreenchange",T)}};return fe.useEffect(()=>{if(i){f(),p();const T=C(),E=k(),I=y();return()=>{T(),E(),I()}}},[i,c]),P.jsxs("div",{className:"online-test-container",ref:e,children:[P.jsx("h1",{children:"Online Test"}),t?P.jsx("p",{style:{color:"red"},children:t}):i?P.jsxs("div",{className:"test-layout",children:[P.jsxs("div",{className:"webcam-section",children:[P.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,width:"320",height:"240",style:{borderRadius:"10px",border:"2px solid #ccc"}}),u&&P.jsx("p",{className:"no-face-detected",children:"No face detected. Please ensure your face is visible."})]}),P.jsxs("div",{className:"test-questions-section",children:[P.jsx("h2",{children:"Test Questions"}),P.jsxs("div",{className:"question",children:[P.jsx("p",{children:"1. What is the capital of France?"}),P.jsx("input",{type:"text",placeholder:"Your answer"})]}),P.jsxs("div",{className:"question",children:[P.jsx("p",{children:"2. Solve: 2 + 2 = ?"}),P.jsx("input",{type:"text",placeholder:"Your answer"})]}),P.jsx("div",{className:"submit-button-container",children:P.jsx("button",{onClick:x,className:"submit-button",children:"Submit Test"})})]})]}):P.jsx("button",{onClick:b,children:"Start Test"})]})}function dde(){return P.jsxs("div",{className:"proctoring-dashboard",children:[P.jsx("h1",{children:"Proctoring Dashboard"}),P.jsx("div",{className:"student-list",children:P.jsxs("div",{className:"student",children:[P.jsx("h3",{children:"Student 1"}),P.jsx("video",{src:"student1-webcam-feed",autoPlay:!0,muted:!0}),P.jsx("video",{src:"student1-screen-feed",autoPlay:!0,muted:!0})]})})]})}function fde(){const[n,e]=fe.useState(null);return fe.useEffect(()=>{const t=Yh.onAuthStateChanged(r=>{e(r)});return()=>t()},[]),P.jsx(vW,{children:P.jsx(pde,{user:n})})}function pde({user:n}){const e=nc(),t=["/login","/register","/profile"],r=["/login","/register","/profile","/online-test","/proctoring-dashboard"];return P.jsxs(P.Fragment,{children:[!t.includes(e.pathname)&&P.jsx(wW,{}),P.jsx("br",{}),P.jsx("br",{}),P.jsxs(lW,{children:[P.jsx(vo,{path:"/",element:n?P.jsx(uf,{to:"/profile"}):P.jsx(IS,{})}),P.jsx(vo,{path:"/login",element:n?P.jsx(uf,{to:"/profile"}):P.jsx(IS,{})}),P.jsx(vo,{path:"/register",element:P.jsx(zq,{})}),P.jsx(vo,{path:"/profile",element:n?P.jsx($q,{}):P.jsx(uf,{to:"/login"})}),P.jsx(vo,{path:"/home",element:P.jsx(WW,{})}),P.jsx(vo,{path:"/about",element:P.jsx(OW,{})}),P.jsx(vo,{path:"/online-test",element:n?P.jsx(hde,{}):P.jsx(uf,{to:"/login"})}),P.jsx(vo,{path:"/proctoring-dashboard",element:n?P.jsx(dde,{}):P.jsx(uf,{to:"/login"})}),P.jsx(vo,{path:"/contact",element:P.jsx(_W,{})}),P.jsx(vo,{path:"*",element:P.jsx(zW,{})})]}),P.jsx(cO,{}),P.jsx("br",{}),P.jsx("br",{}),!r.includes(e.pathname)&&P.jsx(jW,{})]})}EN(document.getElementById("root")).render(P.jsx(fe.StrictMode,{children:P.jsx(fde,{})}))});export default mde();
